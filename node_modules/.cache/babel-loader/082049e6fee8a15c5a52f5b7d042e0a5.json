{"ast":null,"code":"\"use strict\";\n\nvar _Object$defineProperty = require(\"@babel/runtime-corejs2/core-js/object/define-property\");\n\nvar _interopRequireDefault = require(\"@babel/runtime-corejs2/helpers/interopRequireDefault\");\n\n_Object$defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nexports.default = void 0;\n\nvar _state = _interopRequireDefault(require(\"../roap/state\"));\n/* eslint-disable */\n\n\nvar RoapCollection = {\n  sessions: {},\n  getSession: function getSession(id) {\n    if (!this.sessions[id]) {\n      this.sessions[id] = {\n        activeSequences: 0\n      };\n    }\n\n    return this.sessions[id];\n  },\n  deleteSession: function deleteSession(id) {\n    if (this.getSession(id)) {\n      delete this.sessions[id];\n    }\n  },\n  getSessionSequence: function getSessionSequence(id, seqId) {\n    var session = this.getSession(id);\n\n    if (!session[seqId]) {\n      session[seqId] = {\n        state: _state.default.createState(),\n        finished: false\n      };\n      session.activeSequences += 1;\n    }\n\n    return session[seqId];\n  },\n  deleteSessionSequence: function deleteSessionSequence(id, seqId) {\n    var seq = this.getSessionSequence(id, seqId);\n\n    if (seq) {\n      if (!seq.finished) {\n        session.activeSequences -= 1;\n      }\n\n      delete this.sessions[id][seqId];\n    }\n  },\n  isBusy: function isBusy(id) {\n    var session = this.getSession(id);\n    if (!session) return false;\n    return session.activeSequences > 0;\n  },\n  onSessionSequenceFinish: function onSessionSequenceFinish(id, seqId) {\n    var session = this.getSession(id);\n    var seq = session[seqId];\n\n    if (seq && !seq.finished) {\n      seq.finished = true;\n      session.activeSequences -= 1;\n    }\n  }\n};\nvar _default = RoapCollection;\nexports.default = _default;","map":{"version":3,"mappings":";;;;;;;;;;;;AAAA;AAEA;;;AACA,IAAMA,cAAc,GAAG;AACrBC,UAAQ,EAAE,EADW;AAGrBC,YAHqB,sBAGVC,EAHU,EAGN;AACb,QAAI,CAAC,KAAKF,QAAL,CAAcE,EAAd,CAAL,EAAwB;AACtB,WAAKF,QAAL,CAAcE,EAAd,IAAoB;AAClBC,uBAAe,EAAE;AADC,OAApB;AAGD;;AACD,WAAO,KAAKH,QAAL,CAAcE,EAAd,CAAP;AATmB;AAYrBE,eAZqB,yBAYPF,EAZO,EAYH;AAChB,QAAI,KAAKD,UAAL,CAAgBC,EAAhB,CAAJ,EAAyB;AACvB,aAAO,KAAKF,QAAL,CAAcE,EAAd,CAAP;AACD;AAfkB;AAkBrBG,oBAlBqB,8BAkBFH,EAlBE,EAkBEI,KAlBF,EAkBS;AAC5B,QAAMC,OAAO,GAAG,KAAKN,UAAL,CAAgBC,EAAhB,CAAhB;;AACA,QAAI,CAACK,OAAO,CAACD,KAAD,CAAZ,EAAqB;AACnBC,aAAO,CAACD,KAAD,CAAPC,GAAiB;AACfC,aAAK,EAAEC,eAAiBC,WAAjBD,EADQ;AAEfE,gBAAQ,EAAE;AAFK,OAAjBJ;AAIAA,aAAO,CAACJ,eAARI,IAA2B,CAA3BA;AAED;;AACD,WAAOA,OAAO,CAACD,KAAD,CAAd;AA5BmB;AA+BrBM,uBA/BqB,iCA+BCV,EA/BD,EA+BKI,KA/BL,EA+BY;AAC/B,QAAMO,GAAG,GAAG,KAAKR,kBAAL,CAAwBH,EAAxB,EAA4BI,KAA5B,CAAZ;;AACA,QAAIO,GAAJ,EAAS;AACP,UAAI,CAACA,GAAG,CAACF,QAAT,EAAmB;AACjBJ,eAAO,CAACJ,eAARI,IAA2B,CAA3BA;AACD;;AACD,aAAO,KAAKP,QAAL,CAAcE,EAAd,EAAkBI,KAAlB,CAAP;AACD;AAtCkB;AAyCrBQ,QAzCqB,kBAyCdZ,EAzCc,EAyCV;AACT,QAAMK,OAAO,GAAG,KAAKN,UAAL,CAAgBC,EAAhB,CAAhB;AACA,QAAI,CAACK,OAAL,EAAc,OAAO,KAAP;AAEd,WAAOA,OAAO,CAACJ,eAARI,GAA0B,CAAjC;AA7CmB;AAgDrBQ,yBAhDqB,mCAgDGb,EAhDH,EAgDOI,KAhDP,EAgDc;AACjC,QAAMC,OAAO,GAAG,KAAKN,UAAL,CAAgBC,EAAhB,CAAhB;AACA,QAAMW,GAAG,GAAGN,OAAO,CAACD,KAAD,CAAnB;;AACA,QAAIO,GAAG,IAAI,CAACA,GAAG,CAACF,QAAhB,EAA0B;AACxBE,SAAG,CAACF,QAAJE,GAAe,IAAfA;AACAN,aAAO,CAACJ,eAARI,IAA2B,CAA3BA;AACD;AACF;AAvDoB,CAAvB;eA2DeR","names":["RoapCollection","sessions","getSession","id","activeSequences","deleteSession","getSessionSequence","seqId","session","state","RoapStateMachine","createState","finished","deleteSessionSequence","seq","isBusy","onSessionSequenceFinish"],"sources":["collection.js"],"sourcesContent":["import RoapStateMachine from '../roap/state';\n\n/* eslint-disable */\nconst RoapCollection = {\n  sessions: {},\n\n  getSession(id) {\n    if (!this.sessions[id]) {\n      this.sessions[id] = {\n        activeSequences: 0,\n      };\n    }\n    return this.sessions[id];\n  },\n\n  deleteSession(id) {\n    if (this.getSession(id)) {\n      delete this.sessions[id];\n    }\n  },\n\n  getSessionSequence(id, seqId) {\n    const session = this.getSession(id);\n    if (!session[seqId]) {\n      session[seqId] = {\n        state: RoapStateMachine.createState(),\n        finished: false,\n      };\n      session.activeSequences += 1;\n\n    }\n    return session[seqId];\n  },\n\n  deleteSessionSequence(id, seqId) {\n    const seq = this.getSessionSequence(id, seqId);\n    if (seq) {\n      if (!seq.finished) {\n        session.activeSequences -= 1;\n      }\n      delete this.sessions[id][seqId];\n    }\n  },\n\n  isBusy(id) {\n    const session = this.getSession(id);\n    if (!session) return false;\n\n    return session.activeSequences > 0;\n  },\n\n  onSessionSequenceFinish(id, seqId) {\n    const session = this.getSession(id);\n    const seq = session[seqId];\n    if (seq && !seq.finished) {\n      seq.finished = true;\n      session.activeSequences -= 1;\n    }\n  }\n\n};\n\nexport default RoapCollection;\n"]},"metadata":{},"sourceType":"script"}