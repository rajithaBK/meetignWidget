{"ast":null,"code":"\"use strict\";\n\nvar _Object$keys2 = require(\"@babel/runtime-corejs2/core-js/object/keys\");\n\nvar _Object$getOwnPropertySymbols = require(\"@babel/runtime-corejs2/core-js/object/get-own-property-symbols\");\n\nvar _Object$getOwnPropertyDescriptor2 = require(\"@babel/runtime-corejs2/core-js/object/get-own-property-descriptor\");\n\nvar _Object$getOwnPropertyDescriptors = require(\"@babel/runtime-corejs2/core-js/object/get-own-property-descriptors\");\n\nvar _Object$defineProperties = require(\"@babel/runtime-corejs2/core-js/object/define-properties\");\n\nvar _Object$defineProperty = require(\"@babel/runtime-corejs2/core-js/object/define-property\");\n\nvar _interopRequireDefault = require(\"@babel/runtime-corejs2/helpers/interopRequireDefault\");\n\n_Object$defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nexports.registerPlugin = registerPlugin;\nexports.registerInternalPlugin = registerInternalPlugin;\nexports.default = void 0;\n\nvar _regenerator = _interopRequireDefault(require(\"@babel/runtime-corejs2/regenerator\"));\n\nvar _apply = _interopRequireDefault(require(\"@babel/runtime-corejs2/core-js/reflect/apply\"));\n\nvar _keys = _interopRequireDefault(require(\"@babel/runtime-corejs2/core-js/object/keys\"));\n\nvar _promise = _interopRequireDefault(require(\"@babel/runtime-corejs2/core-js/promise\"));\n\nvar _assign = _interopRequireDefault(require(\"@babel/runtime-corejs2/core-js/object/assign\"));\n\nvar _stringify = _interopRequireDefault(require(\"@babel/runtime-corejs2/core-js/json/stringify\"));\n\nvar _deleteProperty = _interopRequireDefault(require(\"@babel/runtime-corejs2/core-js/reflect/delete-property\"));\n\nvar _getOwnPropertyDescriptor = _interopRequireDefault(require(\"@babel/runtime-corejs2/core-js/object/get-own-property-descriptor\"));\n\nvar _defineProperty2 = _interopRequireDefault(require(\"@babel/runtime-corejs2/helpers/defineProperty\"));\n\nvar _asyncToGenerator2 = _interopRequireDefault(require(\"@babel/runtime-corejs2/helpers/asyncToGenerator\"));\n\nvar _applyDecoratedDescriptor2 = _interopRequireDefault(require(\"@babel/runtime-corejs2/helpers/applyDecoratedDescriptor\"));\n\nvar _unset2 = _interopRequireDefault(require(\"lodash/unset\"));\n\nvar _set2 = _interopRequireDefault(require(\"lodash/set\"));\n\nvar _omit2 = _interopRequireDefault(require(\"lodash/omit\"));\n\nvar _merge2 = _interopRequireDefault(require(\"lodash/merge\"));\n\nvar _last2 = _interopRequireDefault(require(\"lodash/last\"));\n\nvar _isString2 = _interopRequireDefault(require(\"lodash/isString\"));\n\nvar _isFunction2 = _interopRequireDefault(require(\"lodash/isFunction\"));\n\nvar _get2 = _interopRequireDefault(require(\"lodash/get\"));\n\nvar _defaultsDeep2 = _interopRequireDefault(require(\"lodash/defaultsDeep\"));\n\nvar _events = require(\"events\");\n\nvar _util = _interopRequireDefault(require(\"util\"));\n\nvar _common = require(\"@webex/common\");\n\nvar _httpCore = require(\"@webex/http-core\");\n\nvar _ampersandState = _interopRequireDefault(require(\"ampersand-state\"));\n\nvar _uuid = _interopRequireDefault(require(\"uuid\"));\n\nvar _auth = _interopRequireDefault(require(\"./interceptors/auth\"));\n\nvar _networkTiming = _interopRequireDefault(require(\"./interceptors/network-timing\"));\n\nvar _payloadTransformer = _interopRequireDefault(require(\"./interceptors/payload-transformer\"));\n\nvar _redirect = _interopRequireDefault(require(\"./interceptors/redirect\"));\n\nvar _requestEvent = _interopRequireDefault(require(\"./interceptors/request-event\"));\n\nvar _requestLogger = _interopRequireDefault(require(\"./interceptors/request-logger\"));\n\nvar _requestTiming = _interopRequireDefault(require(\"./interceptors/request-timing\"));\n\nvar _responseLogger = _interopRequireDefault(require(\"./interceptors/response-logger\"));\n\nvar _webexHttpError = _interopRequireDefault(require(\"./lib/webex-http-error\"));\n\nvar _userAgent = _interopRequireDefault(require(\"./interceptors/user-agent\"));\n\nvar _webexTrackingId = _interopRequireDefault(require(\"./interceptors/webex-tracking-id\"));\n\nvar _webexUserAgent = _interopRequireDefault(require(\"./interceptors/webex-user-agent\"));\n\nvar _rateLimit = _interopRequireDefault(require(\"./interceptors/rate-limit\"));\n\nvar _embargo = _interopRequireDefault(require(\"./interceptors/embargo\"));\n\nvar _defaultOptions = _interopRequireDefault(require(\"./interceptors/default-options\"));\n\nvar _config = _interopRequireDefault(require(\"./config\"));\n\nvar _storage = require(\"./lib/storage\");\n\nvar _webexCorePluginMixin = _interopRequireDefault(require(\"./lib/webex-core-plugin-mixin\"));\n\nvar _webexInternalCorePluginMixin = _interopRequireDefault(require(\"./lib/webex-internal-core-plugin-mixin\"));\n\nvar _webexInternalCore = _interopRequireDefault(require(\"./webex-internal-core\"));\n\nvar _obj;\n\nfunction ownKeys(object, enumerableOnly) {\n  var keys = _Object$keys2(object);\n\n  if (_Object$getOwnPropertySymbols) {\n    var symbols = _Object$getOwnPropertySymbols(object);\n\n    if (enumerableOnly) {\n      symbols = symbols.filter(function (sym) {\n        return _Object$getOwnPropertyDescriptor2(object, sym).enumerable;\n      });\n    }\n\n    keys.push.apply(keys, symbols);\n  }\n\n  return keys;\n}\n\nfunction _objectSpread(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i] != null ? arguments[i] : {};\n\n    if (i % 2) {\n      ownKeys(Object(source), true).forEach(function (key) {\n        (0, _defineProperty2.default)(target, key, source[key]);\n      });\n    } else if (_Object$getOwnPropertyDescriptors) {\n      _Object$defineProperties(target, _Object$getOwnPropertyDescriptors(source));\n    } else {\n      ownKeys(Object(source)).forEach(function (key) {\n        _Object$defineProperty(target, key, _Object$getOwnPropertyDescriptor2(source, key));\n      });\n    }\n  }\n\n  return target;\n} // TODO replace the Interceptor.create with Reflect.construct (\n// Interceptor.create exists because new was really hard to call on an array of\n// constructors)\n\n\nvar interceptors = {\n  WebexTrackingIdInterceptor: _webexTrackingId.default.create,\n  RequestEventInterceptor: _requestEvent.default.create,\n  RateLimitInterceptor: _rateLimit.default.create,\n\n  /* eslint-disable no-extra-parens */\n  RequestLoggerInterceptor: process.env.ENABLE_NETWORK_LOGGING || process.env.ENABLE_VERBOSE_NETWORK_LOGGING ? _requestLogger.default.create : undefined,\n  ResponseLoggerInterceptor: process.env.ENABLE_NETWORK_LOGGING || process.env.ENABLE_VERBOSE_NETWORK_LOGGING ? _responseLogger.default.create : undefined,\n\n  /* eslint-enable no-extra-parens */\n  RequestTimingInterceptor: _requestTiming.default.create,\n  ServiceInterceptor: undefined,\n  UserAgentInterceptor: _userAgent.default.create,\n  WebexUserAgentInterceptor: _webexUserAgent.default.create,\n  AuthInterceptor: _auth.default.create,\n  KmsDryErrorInterceptor: undefined,\n  PayloadTransformerInterceptor: _payloadTransformer.default.create,\n  ConversationInterceptor: undefined,\n  RedirectInterceptor: _redirect.default.create,\n  HttpStatusInterceptor: function HttpStatusInterceptor() {\n    return _httpCore.HttpStatusInterceptor.create({\n      error: _webexHttpError.default\n    });\n  },\n  NetworkTimingInterceptor: _networkTiming.default.create,\n  EmbargoInterceptor: _embargo.default.create,\n  DefaultOptionsInterceptor: _defaultOptions.default.create\n};\nvar preInterceptors = ['ResponseLoggerInterceptor', 'RequestTimingInterceptor', 'RequestEventInterceptor', 'WebexTrackingIdInterceptor', 'RateLimitInterceptor'];\nvar postInterceptors = ['HttpStatusInterceptor', 'NetworkTimingInterceptor', 'EmbargoInterceptor', 'RequestLoggerInterceptor', 'RateLimitInterceptor'];\nvar MAX_FILE_SIZE_IN_MB = 2048;\n/**\n * @class\n */\n\nvar WebexCore = _ampersandState.default.extend((_obj = {\n  version: \"1.154.2\",\n  children: {\n    internal: _webexInternalCore.default\n  },\n  constructor: function constructor() {\n    var attrs = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    var options = arguments.length > 1 ? arguments[1] : undefined;\n\n    if (typeof attrs === 'string') {\n      attrs = {\n        credentials: {\n          supertoken: {\n            // eslint-disable-next-line camelcase\n            access_token: attrs\n          }\n        }\n      };\n    } else {\n      // Reminder: order is important here\n      ['credentials.authorization', 'authorization', 'credentials.supertoken.supertoken', 'supertoken', 'access_token', 'credentials.authorization.supertoken'].forEach(function (path) {\n        var val = (0, _get2.default)(attrs, path);\n\n        if (val) {\n          (0, _unset2.default)(attrs, path);\n          (0, _set2.default)(attrs, 'credentials.supertoken', val);\n        }\n      });\n      ['credentials', 'credentials.authorization'].forEach(function (path) {\n        var val = (0, _get2.default)(attrs, path);\n\n        if (typeof val === 'string') {\n          (0, _unset2.default)(attrs, path);\n          (0, _set2.default)(attrs, 'credentials.supertoken', val);\n        }\n      });\n\n      if (typeof (0, _get2.default)(attrs, 'credentials.access_token') === 'string') {\n        // Send access_token to get validated and corrected and then set it\n        (0, _set2.default)(attrs, 'credentials.access_token', this.bearerValidator((0, _get2.default)(attrs, 'credentials.access_token').trim()));\n        (0, _set2.default)(attrs, 'credentials.supertoken', attrs.credentials);\n      }\n    }\n\n    return (0, _apply.default)(_ampersandState.default, this, [attrs, options]);\n  },\n  derived: {\n    boundedStorage: {\n      deps: [],\n      fn: function fn() {\n        return (0, _storage.makeWebexStore)('bounded', this);\n      }\n    },\n    unboundedStorage: {\n      deps: [],\n      fn: function fn() {\n        return (0, _storage.makeWebexStore)('unbounded', this);\n      }\n    },\n    ready: {\n      deps: ['loaded', 'internal.ready'],\n      fn: function fn() {\n        var _this = this;\n\n        return this.loaded && (0, _keys.default)(this._children).reduce(function (ready, name) {\n          return ready && _this[name] && _this[name].ready !== false;\n        }, true);\n      }\n    }\n  },\n  session: {\n    config: {\n      type: 'object'\n    },\n\n    /**\n     * When true, indicates that the initial load from the storage layer is\n     * complete\n     * @instance\n     * @memberof WebexCore\n     * @type {boolean}\n     */\n    loaded: {\n      default: false,\n      type: 'boolean'\n    },\n    request: {\n      setOnce: true,\n      // It's supposed to be a function, but that's not a type defined in\n      // Ampersand\n      type: 'any'\n    },\n    sessionId: {\n      setOnce: true,\n      type: 'string'\n    }\n  },\n\n  /**\n   * @instance\n   * @memberof WebexCore\n   * @param {[type]} args\n   * @returns {[type]}\n   */\n  refresh: function refresh() {\n    var _this$credentials;\n\n    return (_this$credentials = this.credentials).refresh.apply(_this$credentials, arguments);\n  },\n\n  /**\n   * Applies the directionally appropriate transforms to the specified object\n   * @param {string} direction\n   * @param {Object} object\n   * @returns {Promise}\n   */\n  transform: function transform(direction, object) {\n    var _this2 = this;\n\n    var predicates = this.config.payloadTransformer.predicates.filter(function (p) {\n      return !p.direction || p.direction === direction;\n    });\n    var ctx = {\n      webex: this\n    };\n    return _promise.default.all(predicates.map(function (p) {\n      return p.test(ctx, object).then(function (shouldTransform) {\n        if (!shouldTransform) {\n          return undefined;\n        }\n\n        return p.extract(object) // eslint-disable-next-line max-nested-callbacks\n        .then(function (target) {\n          return {\n            name: p.name,\n            target: target\n          };\n        });\n      });\n    })).then(function (data) {\n      return data.filter(function (d) {\n        return Boolean(d);\n      }) // eslint-disable-next-line max-nested-callbacks\n      .reduce(function (promise, _ref) {\n        var name = _ref.name,\n            target = _ref.target,\n            alias = _ref.alias;\n        return promise.then(function () {\n          if (alias) {\n            return _this2.applyNamedTransform(direction, alias, target);\n          }\n\n          return _this2.applyNamedTransform(direction, name, target);\n        });\n      }, _promise.default.resolve());\n    }).then(function () {\n      return object;\n    });\n  },\n\n  /**\n   * Applies the directionally appropriate transform to the specified parameters\n   * @param {string} direction\n   * @param {Object} ctx\n   * @param {string} name\n   * @returns {Promise}\n   */\n  applyNamedTransform: function applyNamedTransform(direction, ctx, name) {\n    var _this3 = this;\n\n    for (var _len = arguments.length, rest = new Array(_len > 3 ? _len - 3 : 0), _key = 3; _key < _len; _key++) {\n      rest[_key - 3] = arguments[_key];\n    }\n\n    if ((0, _isString2.default)(ctx)) {\n      rest.unshift(name);\n      name = ctx;\n      ctx = {\n        webex: this,\n        transform: function transform() {\n          for (var _len2 = arguments.length, args = new Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {\n            args[_key2] = arguments[_key2];\n          }\n\n          return _this3.applyNamedTransform.apply(_this3, [direction, ctx].concat(args));\n        }\n      };\n    }\n\n    var transforms = ctx.webex.config.payloadTransformer.transforms.filter(function (tx) {\n      return tx.name === name && (!tx.direction || tx.direction === direction);\n    }); // too many implicit returns on the same line is difficult to interpret\n    // eslint-disable-next-line arrow-body-style\n\n    return transforms.reduce(function (promise, tx) {\n      return promise.then(function () {\n        if (tx.alias) {\n          var _ctx;\n\n          return (_ctx = ctx).transform.apply(_ctx, [tx.alias].concat(rest));\n        }\n\n        return _promise.default.resolve(tx.fn.apply(tx, [ctx].concat(rest)));\n      });\n    }, _promise.default.resolve()).then(function () {\n      return (0, _last2.default)(rest);\n    });\n  },\n\n  /**\n   * @private\n   * @returns {Window}\n   */\n  getWindow: function getWindow() {\n    // eslint-disable-next-line\n    return window;\n  },\n\n  /**\n   * Initializer\n   *\n   * @emits WebexCore#loaded\n   * @emits WebexCore#ready\n   * @instance\n   * @memberof WebexCore\n   * @param {Object} attrs\n   * @returns {WebexCore}\n   */\n  initialize: function initialize() {\n    var _this4 = this;\n\n    var attrs = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    this.config = (0, _merge2.default)({}, _config.default, attrs.config); // There's some unfortunateness with the way {@link AmpersandState#children}\n    // get initialized. We'll fire the change:config event so that\n    // {@link WebexPlugin#initialize()} can use\n    // `this.listenToOnce(parent, 'change:config', () => {});` to act on config\n    // during initialization\n\n    this.trigger('change:config');\n\n    var onLoaded = function onLoaded() {\n      if (_this4.loaded) {\n        /**\n         * Fires when all data has been loaded from the storage layer\n         * @event loaded\n         * @instance\n         * @memberof WebexCore\n         */\n        _this4.trigger('loaded');\n\n        _this4.stopListening(_this4, 'change:loaded', onLoaded);\n      }\n    }; // This needs to run on nextTick or we'll never be able to wire up listeners\n\n\n    process.nextTick(function () {\n      _this4.listenToAndRun(_this4, 'change:loaded', onLoaded);\n    });\n\n    var onReady = function onReady() {\n      if (_this4.ready) {\n        /**\n         * Fires when all plugins have fully initialized\n         * @event ready\n         * @instance\n         * @memberof WebexCore\n         */\n        _this4.trigger('ready');\n\n        _this4.stopListening(_this4, 'change:ready', onReady);\n      }\n    }; // This needs to run on nextTick or we'll never be able to wire up listeners\n\n\n    process.nextTick(function () {\n      _this4.listenToAndRun(_this4, 'change:ready', onReady);\n    }); // Make nested events propagate in a consistent manner\n\n    (0, _keys.default)(this.constructor.prototype._children).forEach(function (key) {\n      _this4.listenTo(_this4[key], 'change', function () {\n        for (var _len3 = arguments.length, args = new Array(_len3), _key3 = 0; _key3 < _len3; _key3++) {\n          args[_key3] = arguments[_key3];\n        }\n\n        args.unshift(\"change:\".concat(key));\n\n        _this4.trigger.apply(_this4, args);\n      });\n    });\n\n    var addInterceptor = function addInterceptor(ints, key) {\n      var interceptor = interceptors[key];\n\n      if (!(0, _isFunction2.default)(interceptor)) {\n        return ints;\n      }\n\n      ints.push((0, _apply.default)(interceptor, _this4, []));\n      return ints;\n    };\n\n    var ints = [];\n    ints = preInterceptors.reduce(addInterceptor, ints);\n    ints = (0, _keys.default)(interceptors).filter(function (key) {\n      return !(preInterceptors.includes(key) || postInterceptors.includes(key));\n    }).reduce(addInterceptor, ints);\n    ints = postInterceptors.reduce(addInterceptor, ints);\n    this.request = (0, _httpCore.defaults)({\n      json: true,\n      interceptors: ints\n    });\n    var sessionId = \"\".concat((0, _get2.default)(this, 'config.trackingIdPrefix', 'webex-js-sdk'), \"_\").concat((0, _get2.default)(this, 'config.trackingIdBase', _uuid.default.v4()));\n\n    if ((0, _get2.default)(this, 'config.trackingIdSuffix')) {\n      sessionId += \"_\".concat((0, _get2.default)(this, 'config.trackingIdSuffix'));\n    }\n\n    this.sessionId = sessionId;\n  },\n\n  /**\n   * setConfig\n   *\n   * Allows updating config\n   *\n   * @instance\n   * @memberof WebexCore\n   * @param {Object} newConfig\n   * @returns {null}\n   */\n  setConfig: function setConfig() {\n    var newConfig = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    this.config = (0, _merge2.default)({}, this.config, newConfig);\n  },\n\n  /**\n   *\n   * Check if access token is correctly formated and correct if it's not\n   * Warn user if token string has errors in it\n   * @param {string} token\n   * @returns {string}\n   */\n  bearerValidator: function bearerValidator(token) {\n    if (token.includes('Bearer') && token.split(' ').length - 1 === 0) {\n      console.warn(\"Your access token does not have a space between 'Bearer' and the token, please add a space to it or replace it with this already fixed version:\\n\\n\".concat(token.replace('Bearer', 'Bearer ').replace(/\\s+/g, ' ')));\n      console.info(\"Tip: You don't need to add 'Bearer' to the access_token field. The token by itself is fine\");\n      return token.replace('Bearer', 'Bearer ').replace(/\\s+/g, ' ');\n    } // Allow elseIf return\n    // eslint-disable-next-line  no-else-return\n    else if (token.split(' ').length - 1 > 1) {\n      console.warn(\"Your access token has \".concat(token.split(' ').length - 2, \" too many spaces, please use this format:\\n\\n\").concat(token.replace(/\\s+/g, ' ')));\n      console.info(\"Tip: You don't need to add 'Bearer' to the access_token field, the token by itself is fine\");\n      return token.replace(/\\s+/g, ' ');\n    }\n\n    return token.replace(/\\s+/g, ' '); // Clean it anyway (just in case)\n  },\n\n  /**\n   * @instance\n   * @memberof WebexPlugin\n   * @param {number} depth\n   * @private\n   * @returns {Object}\n   */\n  inspect: function inspect(depth) {\n    return _util.default.inspect((0, _omit2.default)(this.serialize({\n      props: true,\n      session: true,\n      derived: true\n    }), 'boundedStorage', 'unboundedStorage', 'request', 'config'), {\n      depth: depth\n    });\n  },\n\n  /**\n   * Invokes all `onBeforeLogout` handlers in the scope of their plugin, clears\n   * all stores, and revokes the access token\n   * Note: If you're using the sdk in a server environment, you may be more\n   * interested in {@link `webex.internal.mercury.disconnect()`| Mercury#disconnect()}\n   * and {@link `webex.internal.device.unregister()`|Device#unregister()}\n   * or {@link `webex.phone.unregister()`|Phone#unregister}\n   * @instance\n   * @memberof WebexCore\n   * @param {Object} options Passed as the first argument to all\n   * `onBeforeLogout` handlers\n   * @returns {Promise}\n   */\n  logout: function logout(options) {\n    var _this5 = this;\n\n    for (var _len4 = arguments.length, rest = new Array(_len4 > 1 ? _len4 - 1 : 0), _key4 = 1; _key4 < _len4; _key4++) {\n      rest[_key4 - 1] = arguments[_key4];\n    } // prefer the refresh token, but for clients that don't have one, fallback\n    // to the access token\n\n\n    var token = this.credentials.supertoken && (this.credentials.supertoken.refresh_token || this.credentials.supertoken.access_token);\n    options = (0, _assign.default)({\n      token: token\n    }, options); // onBeforeLogout should be executed in the opposite order in which handlers\n    // were registered. In that way, wdm unregister() will be above mercury\n    // disconnect(), but disconnect() will execute first.\n    // eslint-disable-next-line arrow-body-style\n\n    return this.config.onBeforeLogout.reverse().reduce(function (promise, _ref2) {\n      var plugin = _ref2.plugin,\n          fn = _ref2.fn;\n      return promise.then(function () {\n        return _promise.default.resolve((0, _apply.default)(fn, _this5[plugin] || _this5.internal[plugin], [options].concat(rest))) // eslint-disable-next-line max-nested-callbacks\n        .catch(function (err) {\n          _this5.logger.warn(\"onBeforeLogout from plugin \".concat(plugin, \": failed\"), err);\n        });\n      });\n    }, _promise.default.resolve()).then(function () {\n      return _promise.default.all([_this5.boundedStorage.clear(), _this5.unboundedStorage.clear()]);\n    }).then(function () {\n      var _this5$credentials;\n\n      return (_this5$credentials = _this5.credentials).invalidate.apply(_this5$credentials, rest);\n    }).then(function () {\n      var _this5$authorization;\n\n      return _this5.authorization && _this5.authorization.logout && (_this5$authorization = _this5.authorization).logout.apply(_this5$authorization, [options].concat(rest));\n    }).then(function () {\n      return _this5.trigger('client:logout');\n    });\n  },\n\n  /**\n   * General purpose wrapper to submit metrics via the metrics plugin (if the\n   * metrics plugin is installed)\n   * @instance\n   * @memberof WebexCore\n   * @returns {Promise}\n   */\n  measure: function measure() {\n    if (this.metrics) {\n      var _this$metrics;\n\n      return (_this$metrics = this.metrics).sendUnstructured.apply(_this$metrics, arguments);\n    }\n\n    return _promise.default.resolve();\n  },\n  upload: function upload(options) {\n    var _this6 = this;\n\n    return (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee() {\n      var shunt, promise;\n      return _regenerator.default.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              if (options.file) {\n                _context.next = 2;\n                break;\n              }\n\n              return _context.abrupt(\"return\", _promise.default.reject(new Error('`options.file` is required')));\n\n            case 2:\n              options.phases = options.phases || {};\n              options.phases.initialize = options.phases.initialize || {};\n              options.phases.upload = options.phases.upload || {};\n              options.phases.finalize = options.phases.finalize || {};\n              (0, _defaultsDeep2.default)(options.phases.initialize, {\n                method: 'POST',\n                body: {\n                  uploadProtocol: 'content-length'\n                }\n              }, (0, _omit2.default)(options, 'file', 'phases'));\n              (0, _defaultsDeep2.default)(options.phases.upload, {\n                method: 'PUT',\n                json: false,\n                withCredentials: false,\n                body: options.file,\n                headers: {\n                  'x-trans-id': _uuid.default.v4(),\n                  authorization: undefined\n                }\n              });\n              (0, _defaultsDeep2.default)(options.phases.finalize, {\n                method: 'POST'\n              }, (0, _omit2.default)(options, 'file', 'phases'));\n              shunt = new _events.EventEmitter();\n              promise = _this6._uploadPhaseInitialize(options).then(function () {\n                var p = _this6._uploadPhaseUpload(options);\n\n                (0, _common.transferEvents)('progress', p, shunt);\n                return p;\n              }).then(function () {\n                for (var _len5 = arguments.length, args = new Array(_len5), _key5 = 0; _key5 < _len5; _key5++) {\n                  args[_key5] = arguments[_key5];\n                }\n\n                return _this6._uploadPhaseFinalize.apply(_this6, [options].concat(args));\n              }).then(function (res) {\n                return _objectSpread(_objectSpread({}, res.body), res.headers);\n              });\n              (0, _common.proxyEvents)(shunt, promise);\n              return _context.abrupt(\"return\", promise);\n\n            case 13:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }))();\n  },\n  _uploadPhaseInitialize: function _uploadPhaseInitialize(options) {\n    var _this7 = this;\n\n    this.logger.debug('client: initiating upload session');\n    return this.request(options.phases.initialize).then(function () {\n      for (var _len6 = arguments.length, args = new Array(_len6), _key6 = 0; _key6 < _len6; _key6++) {\n        args[_key6] = arguments[_key6];\n      }\n\n      var fileUploadSizeLimitInBytes = (args[0].body.fileUploadSizeLimit || MAX_FILE_SIZE_IN_MB) * 1024 * 1024;\n      var currentFileSizeInBytes = options.file.byteLength;\n\n      if (fileUploadSizeLimitInBytes && fileUploadSizeLimitInBytes < currentFileSizeInBytes) {\n        return _this7._uploadAbortSession.apply(_this7, [currentFileSizeInBytes].concat(args));\n      }\n\n      return _this7._uploadApplySession.apply(_this7, [options].concat(args));\n    }).then(function (res) {\n      _this7.logger.debug('client: initiated upload session');\n\n      return res;\n    });\n  },\n  _uploadAbortSession: function _uploadAbortSession(currentFileSizeInBytes, response) {\n    var _this8 = this;\n\n    this.logger.debug('client: deleting uploaded file');\n    return this.request({\n      method: 'DELETE',\n      url: response.body.url,\n      headers: response.options.headers\n    }).then(function () {\n      _this8.logger.debug('client: deleting uploaded file complete');\n\n      var abortErrorDetails = {\n        currentFileSizeInBytes: currentFileSizeInBytes,\n        fileUploadSizeLimitInMB: response.body.fileUploadSizeLimit || MAX_FILE_SIZE_IN_MB,\n        message: 'file-upload-size-limit-enabled'\n      };\n      return _promise.default.reject(new Error(\"\".concat((0, _stringify.default)(abortErrorDetails))));\n    });\n  },\n  _uploadApplySession: function _uploadApplySession(options, res) {\n    var session = res.body;\n    ['upload', 'finalize'].reduce(function (opts, key) {\n      opts[key] = (0, _keys.default)(opts[key]).reduce(function (phaseOptions, phaseKey) {\n        if (phaseKey.startsWith('$')) {\n          phaseOptions[phaseKey.substr(1)] = phaseOptions[phaseKey](session);\n          (0, _deleteProperty.default)(phaseOptions, phaseKey);\n        }\n\n        return phaseOptions;\n      }, opts[key]);\n      return opts;\n    }, options.phases);\n  },\n  _uploadPhaseUpload: function _uploadPhaseUpload(options) {\n    var _this9 = this;\n\n    this.logger.debug('client: uploading file');\n    var promise = this.request(options.phases.upload).then(function (res) {\n      _this9.logger.debug('client: uploaded file');\n\n      return res;\n    });\n    (0, _common.proxyEvents)(options.phases.upload.upload, promise);\n    /* istanbul ignore else */\n\n    if (process.env.NODE_ENV === 'test') {\n      promise.on('progress', function (event) {\n        _this9.logger.info('upload progress', event.loaded, event.total);\n      });\n    }\n\n    return promise;\n  },\n  _uploadPhaseFinalize: function _uploadPhaseFinalize(options) {\n    var _this10 = this;\n\n    this.logger.debug('client: finalizing upload session');\n    return this.request(options.phases.finalize).then(function (res) {\n      _this10.logger.debug('client: finalized upload session');\n\n      return res;\n    });\n  }\n}, (0, _applyDecoratedDescriptor2.default)(_obj, \"_uploadPhaseUpload\", [_common.retry], (0, _getOwnPropertyDescriptor.default)(_obj, \"_uploadPhaseUpload\"), _obj), _obj));\n\nWebexCore.version = \"1.154.2\";\n(0, _webexInternalCorePluginMixin.default)(_webexInternalCore.default, _config.default, interceptors);\n(0, _webexCorePluginMixin.default)(WebexCore, _config.default, interceptors);\nvar _default = WebexCore;\n/**\n * @method registerPlugin\n * @param {string} name\n * @param {function} constructor\n * @param {Object} options\n * @param {Array<string>} options.proxies\n * @param {Object} options.interceptors\n * @returns {null}\n */\n\nexports.default = _default;\n\nfunction registerPlugin(name, constructor, options) {\n  WebexCore.registerPlugin(name, constructor, options);\n}\n/**\n * Registers plugins used by internal products that do not talk to public APIs.\n * @method registerInternalPlugin\n * @param {string} name\n * @param {function} constructor\n * @param {Object} options\n * @param {Object} options.interceptors\n * @private\n * @returns {null}\n */\n\n\nfunction registerInternalPlugin(name, constructor, options) {\n  _webexInternalCore.default.registerPlugin(name, constructor, options);\n}","map":{"version":3,"mappings":"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","names":["interceptors","WebexTrackingIdInterceptor","create","RequestEventInterceptor","RateLimitInterceptor","RequestLoggerInterceptor","process","env","ENABLE_NETWORK_LOGGING","ENABLE_VERBOSE_NETWORK_LOGGING","undefined","ResponseLoggerInterceptor","RequestTimingInterceptor","ServiceInterceptor","UserAgentInterceptor","WebexUserAgentInterceptor","AuthInterceptor","KmsDryErrorInterceptor","PayloadTransformerInterceptor","ConversationInterceptor","RedirectInterceptor","HttpStatusInterceptor","error","WebexHttpError","NetworkTimingInterceptor","EmbargoInterceptor","DefaultOptionsInterceptor","preInterceptors","postInterceptors","MAX_FILE_SIZE_IN_MB","WebexCore","AmpState","extend","version","children","internal","WebexInternalCore","constructor","attrs","options","credentials","supertoken","access_token","forEach","path","val","bearerValidator","trim","derived","boundedStorage","deps","fn","unboundedStorage","ready","loaded","_children","reduce","name","_this","session","config","type","default","request","setOnce","sessionId","refresh","transform","direction","object","predicates","payloadTransformer","filter","p","ctx","webex","_promise","all","map","test","then","shouldTransform","extract","target","data","d","Boolean","promise","alias","_this2","applyNamedTransform","resolve","rest","arguments","unshift","args","_this3","transforms","tx","getWindow","window","initialize","trigger","onLoaded","_this4","stopListening","nextTick","listenToAndRun","onReady","prototype","key","listenTo","addInterceptor","ints","interceptor","push","includes","json","uuid","v4","setConfig","newConfig","token","split","length","console","warn","replace","info","inspect","depth","util","serialize","props","logout","refresh_token","onBeforeLogout","reverse","plugin","_this5","catch","err","logger","clear","invalidate","authorization","measure","metrics","sendUnstructured","upload","file","_context","reject","Error","phases","finalize","method","body","uploadProtocol","withCredentials","headers","shunt","EventEmitter","_this6","_uploadPhaseInitialize","_uploadPhaseUpload","_uploadPhaseFinalize","res","debug","fileUploadSizeLimitInBytes","fileUploadSizeLimit","currentFileSizeInBytes","byteLength","_this7","_uploadAbortSession","_uploadApplySession","response","url","_this8","abortErrorDetails","fileUploadSizeLimitInMB","message","opts","phaseOptions","phaseKey","startsWith","substr","_this9","NODE_ENV","on","event","total","_this10","retry","registerPlugin","registerInternalPlugin"],"sources":["webex-core.js"],"sourcesContent":["/*!\n * Copyright (c) 2015-2020 Cisco Systems, Inc. See LICENSE file.\n */\n\nimport {EventEmitter} from 'events';\nimport util from 'util';\n\nimport {proxyEvents, retry, transferEvents} from '@webex/common';\nimport {HttpStatusInterceptor, defaults as requestDefaults} from '@webex/http-core';\nimport {defaultsDeep, get, isFunction, isString, last, merge, omit, set, unset} from 'lodash';\nimport AmpState from 'ampersand-state';\nimport uuid from 'uuid';\n\nimport AuthInterceptor from './interceptors/auth';\nimport NetworkTimingInterceptor from './interceptors/network-timing';\nimport PayloadTransformerInterceptor from './interceptors/payload-transformer';\nimport RedirectInterceptor from './interceptors/redirect';\nimport RequestEventInterceptor from './interceptors/request-event';\nimport RequestLoggerInterceptor from './interceptors/request-logger';\nimport RequestTimingInterceptor from './interceptors/request-timing';\nimport ResponseLoggerInterceptor from './interceptors/response-logger';\nimport WebexHttpError from './lib/webex-http-error';\nimport UserAgentInterceptor from './interceptors/user-agent';\nimport WebexTrackingIdInterceptor from './interceptors/webex-tracking-id';\nimport WebexUserAgentInterceptor from './interceptors/webex-user-agent';\nimport RateLimitInterceptor from './interceptors/rate-limit';\nimport EmbargoInterceptor from './interceptors/embargo';\nimport DefaultOptionsInterceptor from './interceptors/default-options';\nimport config from './config';\nimport {makeWebexStore} from './lib/storage';\nimport mixinWebexCorePlugins from './lib/webex-core-plugin-mixin';\nimport mixinWebexInternalCorePlugins from './lib/webex-internal-core-plugin-mixin';\nimport WebexInternalCore from './webex-internal-core';\n\n// TODO replace the Interceptor.create with Reflect.construct (\n// Interceptor.create exists because new was really hard to call on an array of\n// constructors)\nconst interceptors = {\n  WebexTrackingIdInterceptor: WebexTrackingIdInterceptor.create,\n  RequestEventInterceptor: RequestEventInterceptor.create,\n  RateLimitInterceptor: RateLimitInterceptor.create,\n  /* eslint-disable no-extra-parens */\n  RequestLoggerInterceptor: (process.env.ENABLE_NETWORK_LOGGING || process.env.ENABLE_VERBOSE_NETWORK_LOGGING) ? RequestLoggerInterceptor.create : undefined,\n  ResponseLoggerInterceptor: (process.env.ENABLE_NETWORK_LOGGING || process.env.ENABLE_VERBOSE_NETWORK_LOGGING) ? ResponseLoggerInterceptor.create : undefined,\n  /* eslint-enable no-extra-parens */\n  RequestTimingInterceptor: RequestTimingInterceptor.create,\n  ServiceInterceptor: undefined,\n  UserAgentInterceptor: UserAgentInterceptor.create,\n  WebexUserAgentInterceptor: WebexUserAgentInterceptor.create,\n  AuthInterceptor: AuthInterceptor.create,\n  KmsDryErrorInterceptor: undefined,\n  PayloadTransformerInterceptor: PayloadTransformerInterceptor.create,\n  ConversationInterceptor: undefined,\n  RedirectInterceptor: RedirectInterceptor.create,\n  HttpStatusInterceptor() {\n    return HttpStatusInterceptor.create({\n      error: WebexHttpError\n    });\n  },\n  NetworkTimingInterceptor: NetworkTimingInterceptor.create,\n  EmbargoInterceptor: EmbargoInterceptor.create,\n  DefaultOptionsInterceptor: DefaultOptionsInterceptor.create\n};\n\nconst preInterceptors = [\n  'ResponseLoggerInterceptor',\n  'RequestTimingInterceptor',\n  'RequestEventInterceptor',\n  'WebexTrackingIdInterceptor',\n  'RateLimitInterceptor'\n];\n\nconst postInterceptors = [\n  'HttpStatusInterceptor',\n  'NetworkTimingInterceptor',\n  'EmbargoInterceptor',\n  'RequestLoggerInterceptor',\n  'RateLimitInterceptor'\n];\n\nconst MAX_FILE_SIZE_IN_MB = 2048;\n\n/**\n * @class\n */\nconst WebexCore = AmpState.extend({\n  version: PACKAGE_VERSION,\n\n  children: {\n    internal: WebexInternalCore\n  },\n\n  constructor(attrs = {}, options) {\n    if (typeof attrs === 'string') {\n      attrs = {\n        credentials: {\n          supertoken: {\n            // eslint-disable-next-line camelcase\n            access_token: attrs\n          }\n        }\n      };\n    }\n    else {\n      // Reminder: order is important here\n      [\n        'credentials.authorization',\n        'authorization',\n        'credentials.supertoken.supertoken',\n        'supertoken',\n        'access_token',\n        'credentials.authorization.supertoken'\n      ].forEach((path) => {\n        const val = get(attrs, path);\n\n        if (val) {\n          unset(attrs, path);\n          set(attrs, 'credentials.supertoken', val);\n        }\n      });\n\n      [\n        'credentials',\n        'credentials.authorization'\n      ]\n        .forEach((path) => {\n          const val = get(attrs, path);\n\n          if (typeof val === 'string') {\n            unset(attrs, path);\n            set(attrs, 'credentials.supertoken', val);\n          }\n        });\n\n      if (typeof get(attrs, 'credentials.access_token') === 'string') {\n        // Send access_token to get validated and corrected and then set it\n        set(attrs, 'credentials.access_token', this.bearerValidator(get(attrs, 'credentials.access_token').trim()));\n\n        set(attrs, 'credentials.supertoken', attrs.credentials);\n      }\n    }\n\n    return Reflect.apply(AmpState, this, [attrs, options]);\n  },\n\n  derived: {\n    boundedStorage: {\n      deps: [],\n      fn() {\n        return makeWebexStore('bounded', this);\n      }\n    },\n    unboundedStorage: {\n      deps: [],\n      fn() {\n        return makeWebexStore('unbounded', this);\n      }\n    },\n    ready: {\n      deps: ['loaded', 'internal.ready'],\n      fn() {\n        return this.loaded && Object.keys(this._children).reduce((ready, name) => ready && this[name] && this[name].ready !== false, true);\n      }\n    }\n  },\n\n  session: {\n    config: {\n      type: 'object'\n    },\n    /**\n     * When true, indicates that the initial load from the storage layer is\n     * complete\n     * @instance\n     * @memberof WebexCore\n     * @type {boolean}\n     */\n    loaded: {\n      default: false,\n      type: 'boolean'\n    },\n    request: {\n      setOnce: true,\n      // It's supposed to be a function, but that's not a type defined in\n      // Ampersand\n      type: 'any'\n    },\n    sessionId: {\n      setOnce: true,\n      type: 'string'\n    }\n  },\n\n  /**\n   * @instance\n   * @memberof WebexCore\n   * @param {[type]} args\n   * @returns {[type]}\n   */\n  refresh(...args) {\n    return this.credentials.refresh(...args);\n  },\n\n  /**\n   * Applies the directionally appropriate transforms to the specified object\n   * @param {string} direction\n   * @param {Object} object\n   * @returns {Promise}\n   */\n  transform(direction, object) {\n    const predicates = this.config.payloadTransformer.predicates.filter(\n      (p) => !p.direction || p.direction === direction\n    );\n    const ctx = {\n      webex: this\n    };\n\n    return Promise.all(predicates.map((p) => p.test(ctx, object)\n      .then((shouldTransform) => {\n        if (!shouldTransform) {\n          return undefined;\n        }\n\n        return p.extract(object)\n          // eslint-disable-next-line max-nested-callbacks\n          .then((target) => ({\n            name: p.name,\n            target\n          }));\n      })))\n      .then((data) => data\n        .filter((d) => Boolean(d))\n        // eslint-disable-next-line max-nested-callbacks\n        .reduce((promise, {name, target, alias}) => promise.then(() => {\n          if (alias) {\n            return this.applyNamedTransform(direction, alias, target);\n          }\n\n          return this.applyNamedTransform(direction, name, target);\n        }), Promise.resolve()))\n      .then(() => object);\n  },\n\n  /**\n   * Applies the directionally appropriate transform to the specified parameters\n   * @param {string} direction\n   * @param {Object} ctx\n   * @param {string} name\n   * @returns {Promise}\n   */\n  applyNamedTransform(direction, ctx, name, ...rest) {\n    if (isString(ctx)) {\n      rest.unshift(name);\n      name = ctx;\n      ctx = {\n        webex: this,\n        transform: (...args) => this.applyNamedTransform(direction, ctx, ...args)\n      };\n    }\n\n    const transforms = ctx.webex.config.payloadTransformer.transforms.filter(\n      (tx) => tx.name === name && (!tx.direction || tx.direction === direction)\n    );\n\n    // too many implicit returns on the same line is difficult to interpret\n    // eslint-disable-next-line arrow-body-style\n    return transforms.reduce((promise, tx) => promise.then(() => {\n      if (tx.alias) {\n        return ctx.transform(tx.alias, ...rest);\n      }\n\n      return Promise.resolve(tx.fn(ctx, ...rest));\n    }), Promise.resolve())\n      .then(() => last(rest));\n  },\n\n  /**\n   * @private\n   * @returns {Window}\n   */\n  getWindow() {\n    // eslint-disable-next-line\n    return window;\n  },\n\n  /**\n   * Initializer\n   *\n   * @emits WebexCore#loaded\n   * @emits WebexCore#ready\n   * @instance\n   * @memberof WebexCore\n   * @param {Object} attrs\n   * @returns {WebexCore}\n   */\n  initialize(attrs = {}) {\n    this.config = merge({}, config, attrs.config);\n\n\n    // There's some unfortunateness with the way {@link AmpersandState#children}\n    // get initialized. We'll fire the change:config event so that\n    // {@link WebexPlugin#initialize()} can use\n    // `this.listenToOnce(parent, 'change:config', () => {});` to act on config\n    // during initialization\n    this.trigger('change:config');\n\n    const onLoaded = () => {\n      if (this.loaded) {\n        /**\n         * Fires when all data has been loaded from the storage layer\n         * @event loaded\n         * @instance\n         * @memberof WebexCore\n         */\n        this.trigger('loaded');\n\n        this.stopListening(this, 'change:loaded', onLoaded);\n      }\n    };\n\n    // This needs to run on nextTick or we'll never be able to wire up listeners\n    process.nextTick(() => {\n      this.listenToAndRun(this, 'change:loaded', onLoaded);\n    });\n\n    const onReady = () => {\n      if (this.ready) {\n        /**\n         * Fires when all plugins have fully initialized\n         * @event ready\n         * @instance\n         * @memberof WebexCore\n         */\n        this.trigger('ready');\n\n        this.stopListening(this, 'change:ready', onReady);\n      }\n    };\n\n    // This needs to run on nextTick or we'll never be able to wire up listeners\n    process.nextTick(() => {\n      this.listenToAndRun(this, 'change:ready', onReady);\n    });\n\n    // Make nested events propagate in a consistent manner\n    Object.keys(this.constructor.prototype._children).forEach((key) => {\n      this.listenTo(this[key], 'change', (...args) => {\n        args.unshift(`change:${key}`);\n        this.trigger(...args);\n      });\n    });\n\n    const addInterceptor = (ints, key) => {\n      const interceptor = interceptors[key];\n\n      if (!isFunction(interceptor)) {\n        return ints;\n      }\n\n      ints.push(Reflect.apply(interceptor, this, []));\n\n      return ints;\n    };\n\n    let ints = [];\n\n    ints = preInterceptors.reduce(addInterceptor, ints);\n    ints = Object.keys(interceptors)\n      .filter((key) => !(preInterceptors.includes(key) || postInterceptors.includes(key)))\n      .reduce(addInterceptor, ints);\n    ints = postInterceptors.reduce(addInterceptor, ints);\n\n    this.request = requestDefaults({\n      json: true,\n      interceptors: ints\n    });\n\n    let sessionId = `${get(this, 'config.trackingIdPrefix', 'webex-js-sdk')}_${get(this, 'config.trackingIdBase', uuid.v4())}`;\n\n    if (get(this, 'config.trackingIdSuffix')) {\n      sessionId += `_${get(this, 'config.trackingIdSuffix')}`;\n    }\n\n    this.sessionId = sessionId;\n  },\n\n  /**\n   * setConfig\n   *\n   * Allows updating config\n   *\n   * @instance\n   * @memberof WebexCore\n   * @param {Object} newConfig\n   * @returns {null}\n   */\n  setConfig(newConfig = {}) {\n    this.config = merge({}, this.config, newConfig);\n  },\n\n  /**\n   *\n   * Check if access token is correctly formated and correct if it's not\n   * Warn user if token string has errors in it\n   * @param {string} token\n   * @returns {string}\n   */\n  bearerValidator(token) {\n    if (token.includes('Bearer') && token.split(' ').length - 1 === 0) {\n      console.warn(\n        `Your access token does not have a space between 'Bearer' and the token, please add a space to it or replace it with this already fixed version:\\n\\n${token.replace('Bearer', 'Bearer ').replace(/\\s+/g, ' ')}`\n      );\n      console.info(\"Tip: You don't need to add 'Bearer' to the access_token field. The token by itself is fine\");\n\n      return token.replace('Bearer', 'Bearer ').replace(/\\s+/g, ' ');\n    }\n    // Allow elseIf return\n    // eslint-disable-next-line  no-else-return\n    else if (token.split(' ').length - 1 > 1) {\n      console.warn(\n        `Your access token has ${token.split(' ').length - 2} too many spaces, please use this format:\\n\\n${token.replace(/\\s+/g, ' ')}`\n      );\n      console.info(\"Tip: You don't need to add 'Bearer' to the access_token field, the token by itself is fine\");\n\n      return token.replace(/\\s+/g, ' ');\n    }\n\n    return token.replace(/\\s+/g, ' '); // Clean it anyway (just in case)\n  },\n\n  /**\n   * @instance\n   * @memberof WebexPlugin\n   * @param {number} depth\n   * @private\n   * @returns {Object}\n   */\n  inspect(depth) {\n    return util.inspect(omit(this.serialize({\n      props: true,\n      session: true,\n      derived: true\n    }), 'boundedStorage', 'unboundedStorage', 'request', 'config'), {depth});\n  },\n\n  /**\n   * Invokes all `onBeforeLogout` handlers in the scope of their plugin, clears\n   * all stores, and revokes the access token\n   * Note: If you're using the sdk in a server environment, you may be more\n   * interested in {@link `webex.internal.mercury.disconnect()`| Mercury#disconnect()}\n   * and {@link `webex.internal.device.unregister()`|Device#unregister()}\n   * or {@link `webex.phone.unregister()`|Phone#unregister}\n   * @instance\n   * @memberof WebexCore\n   * @param {Object} options Passed as the first argument to all\n   * `onBeforeLogout` handlers\n   * @returns {Promise}\n   */\n  logout(options, ...rest) {\n    // prefer the refresh token, but for clients that don't have one, fallback\n    // to the access token\n    const token = this.credentials.supertoken && (this.credentials.supertoken.refresh_token || this.credentials.supertoken.access_token);\n\n    options = Object.assign({token}, options);\n\n    // onBeforeLogout should be executed in the opposite order in which handlers\n    // were registered. In that way, wdm unregister() will be above mercury\n    // disconnect(), but disconnect() will execute first.\n    // eslint-disable-next-line arrow-body-style\n    return this.config.onBeforeLogout.reverse().reduce((promise, {plugin, fn}) => promise.then(() => {\n      return Promise.resolve(Reflect.apply(fn, this[plugin] || this.internal[plugin], [options, ...rest]))\n        // eslint-disable-next-line max-nested-callbacks\n        .catch((err) => {\n          this.logger.warn(`onBeforeLogout from plugin ${plugin}: failed`, err);\n        });\n    }), Promise.resolve())\n      .then(() => Promise.all([\n        this.boundedStorage.clear(),\n        this.unboundedStorage.clear()\n      ]))\n      .then(() => this.credentials.invalidate(...rest))\n      .then(() => this.authorization && this.authorization.logout && this.authorization.logout(options, ...rest))\n      .then(() => this.trigger('client:logout'));\n  },\n\n  /**\n   * General purpose wrapper to submit metrics via the metrics plugin (if the\n   * metrics plugin is installed)\n   * @instance\n   * @memberof WebexCore\n   * @returns {Promise}\n   */\n  measure(...args) {\n    if (this.metrics) {\n      return this.metrics.sendUnstructured(...args);\n    }\n\n    return Promise.resolve();\n  },\n\n  async upload(options) {\n    if (!options.file) {\n      return Promise.reject(new Error('`options.file` is required'));\n    }\n\n    options.phases = options.phases || {};\n    options.phases.initialize = options.phases.initialize || {};\n    options.phases.upload = options.phases.upload || {};\n    options.phases.finalize = options.phases.finalize || {};\n\n    defaultsDeep(options.phases.initialize, {\n      method: 'POST',\n      body: {\n        uploadProtocol: 'content-length'\n      }\n    }, omit(options, 'file', 'phases'));\n\n    defaultsDeep(options.phases.upload, {\n      method: 'PUT',\n      json: false,\n      withCredentials: false,\n      body: options.file,\n      headers: {\n        'x-trans-id': uuid.v4(),\n        authorization: undefined\n      }\n    });\n\n    defaultsDeep(options.phases.finalize, {\n      method: 'POST'\n    }, omit(options, 'file', 'phases'));\n\n    const shunt = new EventEmitter();\n\n    const promise = this._uploadPhaseInitialize(options)\n      .then(() => {\n        const p = this._uploadPhaseUpload(options);\n\n        transferEvents('progress', p, shunt);\n\n        return p;\n      })\n      .then((...args) => this._uploadPhaseFinalize(options, ...args))\n      .then((res) => ({...res.body, ...res.headers}));\n\n    proxyEvents(shunt, promise);\n\n    return promise;\n  },\n\n  _uploadPhaseInitialize: function _uploadPhaseInitialize(options) {\n    this.logger.debug('client: initiating upload session');\n\n    return this.request(options.phases.initialize)\n      .then((...args) => {\n        const fileUploadSizeLimitInBytes = (args[0].body.fileUploadSizeLimit || MAX_FILE_SIZE_IN_MB) * 1024 * 1024;\n        const currentFileSizeInBytes = options.file.byteLength;\n\n        if (fileUploadSizeLimitInBytes && fileUploadSizeLimitInBytes < currentFileSizeInBytes) {\n          return this._uploadAbortSession(currentFileSizeInBytes, ...args);\n        }\n\n        return this._uploadApplySession(options, ...args);\n      })\n      .then((res) => {\n        this.logger.debug('client: initiated upload session');\n\n        return res;\n      });\n  },\n\n  _uploadAbortSession(currentFileSizeInBytes, response) {\n    this.logger.debug('client: deleting uploaded file');\n\n    return this.request({\n      method: 'DELETE',\n      url: response.body.url,\n      headers: response.options.headers\n    }).then(() => {\n      this.logger.debug('client: deleting uploaded file complete');\n\n      const abortErrorDetails = {\n        currentFileSizeInBytes,\n        fileUploadSizeLimitInMB: response.body.fileUploadSizeLimit || MAX_FILE_SIZE_IN_MB,\n        message: 'file-upload-size-limit-enabled'\n      };\n\n      return Promise.reject(new Error(`${JSON.stringify(abortErrorDetails)}`));\n    });\n  },\n\n  _uploadApplySession(options, res) {\n    const session = res.body;\n\n    ['upload', 'finalize'].reduce((opts, key) => {\n      opts[key] = Object.keys(opts[key]).reduce((phaseOptions, phaseKey) => {\n        if (phaseKey.startsWith('$')) {\n          phaseOptions[phaseKey.substr(1)] = phaseOptions[phaseKey](session);\n          Reflect.deleteProperty(phaseOptions, phaseKey);\n        }\n\n        return phaseOptions;\n      }, opts[key]);\n\n      return opts;\n    }, options.phases);\n  },\n\n  @retry\n  _uploadPhaseUpload(options) {\n    this.logger.debug('client: uploading file');\n\n    const promise = this.request(options.phases.upload)\n      .then((res) => {\n        this.logger.debug('client: uploaded file');\n\n        return res;\n      });\n\n    proxyEvents(options.phases.upload.upload, promise);\n\n    /* istanbul ignore else */\n    if (process.env.NODE_ENV === 'test') {\n      promise.on('progress', (event) => {\n        this.logger.info('upload progress', event.loaded, event.total);\n      });\n    }\n\n    return promise;\n  },\n\n  _uploadPhaseFinalize: function _uploadPhaseFinalize(options) {\n    this.logger.debug('client: finalizing upload session');\n\n    return this.request(options.phases.finalize)\n      .then((res) => {\n        this.logger.debug('client: finalized upload session');\n\n        return res;\n      });\n  }\n});\n\nWebexCore.version = PACKAGE_VERSION;\n\nmixinWebexInternalCorePlugins(WebexInternalCore, config, interceptors);\nmixinWebexCorePlugins(WebexCore, config, interceptors);\n\nexport default WebexCore;\n\n/**\n * @method registerPlugin\n * @param {string} name\n * @param {function} constructor\n * @param {Object} options\n * @param {Array<string>} options.proxies\n * @param {Object} options.interceptors\n * @returns {null}\n */\nexport function registerPlugin(name, constructor, options) {\n  WebexCore.registerPlugin(name, constructor, options);\n}\n\n/**\n * Registers plugins used by internal products that do not talk to public APIs.\n * @method registerInternalPlugin\n * @param {string} name\n * @param {function} constructor\n * @param {Object} options\n * @param {Object} options.interceptors\n * @private\n * @returns {null}\n */\nexport function registerInternalPlugin(name, constructor, options) {\n  WebexInternalCore.registerPlugin(name, constructor, options);\n}\n"]},"metadata":{},"sourceType":"script"}