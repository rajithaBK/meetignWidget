{"ast":null,"code":"import _toConsumableArray from \"C:/Users/rkanthet/Documents/test_window_object/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";\nimport _classCallCheck from \"C:/Users/rkanthet/Documents/test_window_object/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";\nimport _createClass from \"C:/Users/rkanthet/Documents/test_window_object/node_modules/@babel/runtime/helpers/esm/createClass.js\";\n\n/*\r\n * Copyright (c) 2016-2018, Peculiar Ventures\r\n * All rights reserved.\r\n *\r\n * Author 2016-2018, Yury Strozhevsky <www.strozhevsky.com>.\r\n *\r\n */\n//**************************************************************************************\nexport var ByteStream = /*#__PURE__*/function () {\n  //**********************************************************************************\n  // noinspection FunctionWithMultipleLoopsJS\n\n  /**\r\n   * Constructor for ByteStream class\r\n   * @param {{[length]: number, [stub]: number, [view]: Uint8Array, [buffer]: ArrayBuffer, [string]: string, [hexstring]: string}} parameters\r\n   */\n  function ByteStream() {\n    var parameters = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n\n    _classCallCheck(this, ByteStream);\n\n    this.clear();\n\n    for (var _i = 0, _Object$keys = Object.keys(parameters); _i < _Object$keys.length; _i++) {\n      var key = _Object$keys[_i];\n\n      switch (key) {\n        case \"length\":\n          this.length = parameters.length;\n          break;\n\n        case \"stub\":\n          // noinspection NonBlockStatementBodyJS\n          for (var i = 0; i < this._view.length; i++) {\n            this._view[i] = parameters.stub;\n          }\n\n          break;\n\n        case \"view\":\n          this.fromUint8Array(parameters.view);\n          break;\n\n        case \"buffer\":\n          this.fromArrayBuffer(parameters.buffer);\n          break;\n\n        case \"string\":\n          this.fromString(parameters.string);\n          break;\n\n        case \"hexstring\":\n          this.fromHexString(parameters.hexstring);\n          break;\n\n        default:\n      }\n    }\n  } //**********************************************************************************\n\n  /**\r\n   * Setter for \"buffer\"\r\n   * @param {ArrayBuffer} value\r\n   */\n\n\n  _createClass(ByteStream, [{\n    key: \"buffer\",\n    get: //**********************************************************************************\n\n    /**\r\n     * Getter for \"buffer\"\r\n     * @returns {ArrayBuffer}\r\n     */\n    function get() {\n      return this._buffer;\n    } //**********************************************************************************\n\n    /**\r\n     * Setter for \"view\"\r\n     * @param {Uint8Array} value\r\n     */\n    ,\n    set: function set(value) {\n      this._buffer = value.slice(0);\n      this._view = new Uint8Array(this._buffer);\n    }\n  }, {\n    key: \"view\",\n    get: //**********************************************************************************\n\n    /**\r\n     * Getter for \"view\"\r\n     * @returns {Uint8Array}\r\n     */\n    function get() {\n      return this._view;\n    } //**********************************************************************************\n\n    /**\r\n     * Getter for \"length\"\r\n     * @returns {number}\r\n     */\n    ,\n    set: function set(value) {\n      this._buffer = new ArrayBuffer(value.length);\n      this._view = new Uint8Array(this._buffer);\n\n      this._view.set(value);\n    }\n  }, {\n    key: \"length\",\n    get: function get() {\n      return this._buffer.byteLength;\n    } //**********************************************************************************\n\n    /**\r\n     * Setter for \"length\"\r\n     * @param {number} value\r\n     */\n    ,\n    set: function set(value) {\n      this._buffer = new ArrayBuffer(value);\n      this._view = new Uint8Array(this._buffer);\n    } //**********************************************************************************\n\n    /**\r\n     * Clear existing stream\r\n     */\n\n  }, {\n    key: \"clear\",\n    value: function clear() {\n      this._buffer = new ArrayBuffer(0);\n      this._view = new Uint8Array(this._buffer);\n    } //**********************************************************************************\n\n    /**\r\n     * Initialize \"Stream\" object from existing \"ArrayBuffer\"\r\n     * @param {!ArrayBuffer} array The ArrayBuffer to copy from\r\n     */\n\n  }, {\n    key: \"fromArrayBuffer\",\n    value: function fromArrayBuffer(array) {\n      this.buffer = array;\n    } //**********************************************************************************\n    // noinspection FunctionNamingConventionJS\n\n    /**\r\n     * Initialize \"Stream\" object from existing \"Uint8Array\"\r\n     * @param {!Uint8Array} array The Uint8Array to copy from\r\n     */\n\n  }, {\n    key: \"fromUint8Array\",\n    value: function fromUint8Array(array) {\n      this._buffer = new ArrayBuffer(array.length);\n      this._view = new Uint8Array(this._buffer);\n\n      this._view.set(array);\n    } //**********************************************************************************\n\n    /**\r\n     * Initialize \"Stream\" object from existing string\r\n     * @param {string} string The string to initialize from\r\n     */\n\n  }, {\n    key: \"fromString\",\n    value: function fromString(string) {\n      var stringLength = string.length;\n      this.length = stringLength; // noinspection NonBlockStatementBodyJS\n\n      for (var i = 0; i < stringLength; i++) {\n        this.view[i] = string.charCodeAt(i);\n      }\n    } //**********************************************************************************\n\n    /**\r\n     * Represent \"Stream\" object content as a string\r\n     * @param {number} [start] Start position to convert to string\r\n     * @param {number} [length] Length of array to convert to string\r\n     * @returns {string}\r\n     */\n\n  }, {\n    key: \"toString\",\n    value: function toString() {\n      var start = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 0;\n      var length = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : this.view.length - start;\n      //region Initial variables\n      var result = \"\"; //endregion\n      //region Check input parameters\n      // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\n\n      if (start >= this.view.length || start < 0) {\n        // noinspection AssignmentToFunctionParameterJS\n        start = 0;\n      } // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\n\n\n      if (length >= this.view.length || length < 0) {\n        // noinspection AssignmentToFunctionParameterJS\n        length = this.view.length - start;\n      } //endregion\n      //region Convert array of bytes to string\n      // noinspection NonBlockStatementBodyJS\n\n\n      for (var i = start; i < start + length; i++) {\n        result += String.fromCharCode(this.view[i]);\n      } //endregion\n\n\n      return result;\n    } //**********************************************************************************\n    // noinspection FunctionTooLongJS\n\n    /**\r\n     * Initialize \"Stream\" object from existing hexdecimal string\r\n     * @param {string} hexString String to initialize from\r\n     */\n\n  }, {\n    key: \"fromHexString\",\n    value: function fromHexString(hexString) {\n      //region Initial variables\n      var stringLength = hexString.length;\n      this.buffer = new ArrayBuffer(stringLength >> 1);\n      this.view = new Uint8Array(this.buffer);\n      var hexMap = new Map(); // noinspection MagicNumberJS\n\n      hexMap.set(\"0\", 0x00); // noinspection MagicNumberJS\n\n      hexMap.set(\"1\", 0x01); // noinspection MagicNumberJS\n\n      hexMap.set(\"2\", 0x02); // noinspection MagicNumberJS\n\n      hexMap.set(\"3\", 0x03); // noinspection MagicNumberJS\n\n      hexMap.set(\"4\", 0x04); // noinspection MagicNumberJS\n\n      hexMap.set(\"5\", 0x05); // noinspection MagicNumberJS\n\n      hexMap.set(\"6\", 0x06); // noinspection MagicNumberJS\n\n      hexMap.set(\"7\", 0x07); // noinspection MagicNumberJS\n\n      hexMap.set(\"8\", 0x08); // noinspection MagicNumberJS\n\n      hexMap.set(\"9\", 0x09); // noinspection MagicNumberJS\n\n      hexMap.set(\"A\", 0x0A); // noinspection MagicNumberJS\n\n      hexMap.set(\"a\", 0x0A); // noinspection MagicNumberJS\n\n      hexMap.set(\"B\", 0x0B); // noinspection MagicNumberJS\n\n      hexMap.set(\"b\", 0x0B); // noinspection MagicNumberJS\n\n      hexMap.set(\"C\", 0x0C); // noinspection MagicNumberJS\n\n      hexMap.set(\"c\", 0x0C); // noinspection MagicNumberJS\n\n      hexMap.set(\"D\", 0x0D); // noinspection MagicNumberJS\n\n      hexMap.set(\"d\", 0x0D); // noinspection MagicNumberJS\n\n      hexMap.set(\"E\", 0x0E); // noinspection MagicNumberJS\n\n      hexMap.set(\"e\", 0x0E); // noinspection MagicNumberJS\n\n      hexMap.set(\"F\", 0x0F); // noinspection MagicNumberJS\n\n      hexMap.set(\"f\", 0x0F);\n      var j = 0; // noinspection MagicNumberJS\n\n      var temp = 0x00; //endregion\n      //region Convert char-by-char\n\n      for (var i = 0; i < stringLength; i++) {\n        // noinspection NegatedIfStatementJS\n        if (!(i % 2)) {\n          // noinspection NestedFunctionCallJS\n          temp = hexMap.get(hexString.charAt(i)) << 4;\n        } else {\n          // noinspection NestedFunctionCallJS\n          temp |= hexMap.get(hexString.charAt(i));\n          this.view[j] = temp;\n          j++;\n        }\n      } //endregion\n\n    } //**********************************************************************************\n    // noinspection JSUnusedGlobalSymbols\n\n    /**\r\n     * Represent \"Stream\" object content as a hexdecimal string\r\n     * @param {number} [start=0] Start position to convert to string\r\n     * @param {number} [length=(this.view.length - start)] Length of array to convert to string\r\n     * @returns {string}\r\n     */\n\n  }, {\n    key: \"toHexString\",\n    value: function toHexString() {\n      var start = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 0;\n      var length = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : this.view.length - start;\n      //region Initial variables\n      var result = \"\"; //endregion\n      //region Check input parameters\n      // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\n\n      if (start >= this.view.length || start < 0) {\n        // noinspection AssignmentToFunctionParameterJS\n        start = 0;\n      } // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\n\n\n      if (length >= this.view.length || length < 0) {\n        // noinspection AssignmentToFunctionParameterJS\n        length = this.view.length - start;\n      } //endregion\n\n\n      for (var i = start; i < start + length; i++) {\n        // noinspection ChainedFunctionCallJS\n        var str = this.view[i].toString(16).toUpperCase(); // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, ConditionalExpressionJS, EqualityComparisonWithCoercionJS\n\n        result = result + (str.length == 1 ? \"0\" : \"\") + str;\n      }\n\n      return result;\n    } //**********************************************************************************\n    // noinspection FunctionWithMultipleReturnPointsJS\n\n    /**\r\n     * Return copy of existing \"Stream\"\r\n     * @param {number} [start=0] Start position of the copy\r\n     * @param {number} [length=this.view.length] Length of the copy\r\n     * @returns {ByteStream}\r\n     */\n\n  }, {\n    key: \"copy\",\n    value: function copy() {\n      var start = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 0;\n      var length = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : this._buffer.byteLength - start;\n      //region Check input parameters\n      // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, NonBlockStatementBodyJS\n      if (start === 0 && this._buffer.byteLength === 0) return new ByteStream(); // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, NonBlockStatementBodyJS\n\n      if (start < 0 || start > this._buffer.byteLength - 1) throw new Error(\"Wrong start position: \".concat(start)); //endregion\n\n      var stream = new ByteStream();\n      stream._buffer = this._buffer.slice(start, start + length);\n      stream._view = new Uint8Array(stream._buffer);\n      return stream;\n    } //**********************************************************************************\n    // noinspection JSUnusedGlobalSymbols, FunctionWithMultipleReturnPointsJS\n\n    /**\r\n     * Return slice of existing \"Stream\"\r\n     * @param {number} [start=0] Start position of the slice\r\n     * @param {number} [end=this._buffer.byteLength] End position of the slice\r\n     * @returns {ByteStream}\r\n     */\n\n  }, {\n    key: \"slice\",\n    value: function slice() {\n      var start = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 0;\n      var end = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : this._buffer.byteLength;\n      //region Check input parameters\n      // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, NonBlockStatementBodyJS\n      if (start === 0 && this._buffer.byteLength === 0) return new ByteStream(); // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, NonBlockStatementBodyJS\n\n      if (start < 0 || start > this._buffer.byteLength - 1) throw new Error(\"Wrong start position: \".concat(start)); //endregion\n\n      var stream = new ByteStream();\n      stream._buffer = this._buffer.slice(start, end);\n      stream._view = new Uint8Array(stream._buffer);\n      return stream;\n    } //**********************************************************************************\n\n    /**\r\n     * Change size of existing \"Stream\"\r\n     * @param {!number} size Size for new \"Stream\"\r\n     */\n\n  }, {\n    key: \"realloc\",\n    value: function realloc(size) {\n      //region Initial variables\n      var buffer = new ArrayBuffer(size);\n      var view = new Uint8Array(buffer); //endregion\n      //region Create a new ArrayBuffer content\n      // noinspection NonBlockStatementBodyJS\n\n      if (size > this._view.length) view.set(this._view);else {\n        // noinspection NestedFunctionCallJS\n        view.set(new Uint8Array(this._buffer, 0, size));\n      } //endregion\n      //region Initialize \"Stream\" with new \"ArrayBuffer\"\n\n      this._buffer = buffer.slice(0);\n      this._view = new Uint8Array(this._buffer); //endregion\n    } //**********************************************************************************\n    // noinspection JSUnusedGlobalSymbols\n\n    /**\r\n     * Append a new \"Stream\" content to the current \"Stream\"\r\n     * @param {ByteStream} stream A new \"stream\" to append to current \"stream\"\r\n     */\n\n  }, {\n    key: \"append\",\n    value: function append(stream) {\n      //region Initial variables\n      var initialSize = this._buffer.byteLength;\n      var streamViewLength = stream._buffer.byteLength;\n\n      var copyView = stream._view.slice(); //endregion\n      //region Re-allocate current internal buffer\n\n\n      this.realloc(initialSize + streamViewLength); //endregion\n      //region Copy input stream content to a new place\n\n      this._view.set(copyView, initialSize); //endregion\n\n    } //**********************************************************************************\n    // noinspection JSUnusedGlobalSymbols, FunctionWithMultipleReturnPointsJS\n\n    /**\r\n     * Insert \"Stream\" content to the current \"Stream\" at specific position\r\n     * @param {ByteStream} stream A new \"stream\" to insert to current \"stream\"\r\n     * @param {number} [start=0] Start position to insert to\r\n     * @param {number} [length]\r\n     * @returns {boolean}\r\n     */\n\n  }, {\n    key: \"insert\",\n    value: function insert(stream) {\n      var start = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;\n      var length = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : this._buffer.byteLength - start;\n      //region Initial variables\n      // noinspection NonBlockStatementBodyJS\n      if (start > this._buffer.byteLength - 1) return false;\n\n      if (length > this._buffer.byteLength - start) {\n        // noinspection AssignmentToFunctionParameterJS\n        length = this._buffer.byteLength - start;\n      } //endregion\n      //region Check input variables\n\n\n      if (length > stream._buffer.byteLength) {\n        // noinspection AssignmentToFunctionParameterJS\n        length = stream._buffer.byteLength;\n      } //endregion\n      //region Update content of the current stream\n      // noinspection NonBlockStatementBodyJS, EqualityComparisonWithCoercionJS\n\n\n      if (length == stream._buffer.byteLength) this._view.set(stream._view, start);else {\n        // noinspection NestedFunctionCallJS\n        this._view.set(stream._view.slice(0, length), start);\n      } //endregion\n\n      return true;\n    } //**********************************************************************************\n    // noinspection FunctionWithMultipleReturnPointsJS\n\n    /**\r\n     * Check that two \"Stream\" objects has equal content\r\n     * @param {ByteStream} stream Stream to compare with\r\n     * @returns {boolean}\r\n     */\n\n  }, {\n    key: \"isEqual\",\n    value: function isEqual(stream) {\n      //region Check length of both buffers\n      // noinspection NonBlockStatementBodyJS, EqualityComparisonWithCoercionJS\n      if (this._buffer.byteLength != stream._buffer.byteLength) return false; //endregion\n      //region Compare each byte of both buffers\n\n      for (var i = 0; i < stream._buffer.byteLength; i++) {\n        // noinspection NonBlockStatementBodyJS, EqualityComparisonWithCoercionJS\n        if (this.view[i] != stream.view[i]) return false;\n      } //endregion\n\n\n      return true;\n    } //**********************************************************************************\n    // noinspection JSUnusedGlobalSymbols, FunctionWithMultipleReturnPointsJS\n\n    /**\r\n     * Check that current \"Stream\" objects has equal content with input \"Uint8Array\"\r\n     * @param {Uint8Array} view View to compare with\r\n     * @returns {boolean}\r\n     */\n\n  }, {\n    key: \"isEqualView\",\n    value: function isEqualView(view) {\n      //region Check length of both buffers\n      // noinspection NonBlockStatementBodyJS, EqualityComparisonWithCoercionJS\n      if (view.length != this.view.length) return false; //endregion\n      //region Compare each byte of both buffers\n\n      for (var i = 0; i < view.length; i++) {\n        // noinspection NonBlockStatementBodyJS, EqualityComparisonWithCoercionJS\n        if (this.view[i] != view[i]) return false;\n      } //endregion\n\n\n      return true;\n    } //**********************************************************************************\n    // noinspection JSUnusedGlobalSymbols, FunctionWithMultipleLoopsJS, FunctionWithMultipleReturnPointsJS, OverlyComplexFunctionJS, FunctionTooLongJS\n\n    /**\r\n     * Find any byte pattern in \"Stream\"\r\n     * @param {ByteStream} pattern Stream having pattern value\r\n     * @param {?number} [start] Start position to search from\r\n     * @param {?number} [length] Length of byte block to search at\r\n     * @param {boolean} [backward] Flag to search in backward order\r\n     * @returns {number}\r\n     */\n\n  }, {\n    key: \"findPattern\",\n    value: function findPattern(pattern) {\n      var start = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;\n      var length = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;\n      var backward = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : false;\n\n      //region Check input variables\n      // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\n      if (start == null) {\n        // noinspection AssignmentToFunctionParameterJS, ConditionalExpressionJS\n        start = backward ? this.buffer.byteLength : 0;\n      }\n\n      if (start > this.buffer.byteLength) {\n        // noinspection AssignmentToFunctionParameterJS\n        start = this.buffer.byteLength;\n      }\n\n      if (backward) {\n        // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\n        if (length == null) {\n          // noinspection AssignmentToFunctionParameterJS\n          length = start;\n        }\n\n        if (length > start) {\n          // noinspection AssignmentToFunctionParameterJS\n          length = start;\n        }\n      } else {\n        // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\n        if (length == null) {\n          // noinspection AssignmentToFunctionParameterJS\n          length = this.buffer.byteLength - start;\n        }\n\n        if (length > this.buffer.byteLength - start) {\n          // noinspection AssignmentToFunctionParameterJS\n          length = this.buffer.byteLength - start;\n        }\n      } //endregion\n      //region Initial variables\n\n\n      var patternLength = pattern.buffer.byteLength; // noinspection NonBlockStatementBodyJS\n\n      if (patternLength > length) return -1; //endregion\n      //region Make a \"pre-read\" array for pattern\n\n      var patternArray = []; // noinspection NonBlockStatementBodyJS\n\n      for (var i = 0; i < patternLength; i++) {\n        patternArray.push(pattern.view[i]);\n      } //endregion\n      //region Search for pattern\n\n\n      for (var _i2 = 0; _i2 <= length - patternLength; _i2++) {\n        var equal = true; // noinspection ConditionalExpressionJS\n\n        var equalStart = backward ? start - patternLength - _i2 : start + _i2;\n\n        for (var j = 0; j < patternLength; j++) {\n          // noinspection EqualityComparisonWithCoercionJS\n          if (this.view[j + equalStart] != patternArray[j]) {\n            equal = false; // noinspection BreakStatementJS\n\n            break;\n          }\n        }\n\n        if (equal) {\n          // noinspection ConditionalExpressionJS\n          return backward ? start - patternLength - _i2 : start + patternLength + _i2; // Position after the pattern found\n        }\n      } //endregion\n\n\n      return -1;\n    } //**********************************************************************************\n    // noinspection OverlyComplexFunctionJS\n\n    /**\r\n     * Find first position of any pattern from input array\r\n     * @param {Array.<ByteStream>} patterns Array with patterns which should be found\r\n     * @param {?number} [start] Start position to search from\r\n     * @param {?number} [length] Length of byte block to search at\r\n     * @param {boolean} [backward=false] Flag to search in backward order\r\n     * @returns {{id: number, position: number}}\r\n     */\n\n  }, {\n    key: \"findFirstIn\",\n    value: function findFirstIn(patterns) {\n      var start = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;\n      var length = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;\n      var backward = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : false;\n\n      //region Initial variables\n      // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\n      if (start == null) {\n        // noinspection AssignmentToFunctionParameterJS, ConditionalExpressionJS\n        start = backward ? this.buffer.byteLength : 0;\n      }\n\n      if (start > this.buffer.byteLength) {\n        // noinspection AssignmentToFunctionParameterJS\n        start = this.buffer.byteLength;\n      }\n\n      if (backward) {\n        // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\n        if (length == null) {\n          // noinspection AssignmentToFunctionParameterJS\n          length = start;\n        }\n\n        if (length > start) {\n          // noinspection AssignmentToFunctionParameterJS\n          length = start;\n        }\n      } else {\n        // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\n        if (length == null) {\n          // noinspection AssignmentToFunctionParameterJS\n          length = this.buffer.byteLength - start;\n        }\n\n        if (length > this.buffer.byteLength - start) {\n          // noinspection AssignmentToFunctionParameterJS\n          length = this.buffer.byteLength - start;\n        }\n      } // noinspection ConditionalExpressionJS\n\n\n      var result = {\n        id: -1,\n        position: backward ? 0 : start + length,\n        length: 0\n      }; //endregion\n\n      for (var i = 0; i < patterns.length; i++) {\n        var position = this.findPattern(patterns[i], start, length, backward); // noinspection EqualityComparisonWithCoercionJS\n\n        if (position != -1) {\n          var valid = false;\n          var patternLength = patterns[i].length;\n\n          if (backward) {\n            // noinspection NonBlockStatementBodyJS\n            if (position - patternLength >= result.position - result.length) valid = true;\n          } else {\n            // noinspection NonBlockStatementBodyJS\n            if (position - patternLength <= result.position - result.length) valid = true;\n          }\n\n          if (valid) {\n            result.position = position;\n            result.id = i;\n            result.length = patternLength;\n          }\n        }\n      }\n\n      return result;\n    } //**********************************************************************************\n    // noinspection FunctionWithMultipleReturnPointsJS\n\n    /**\r\n     * Find all positions of any pattern from input array\r\n     * @param {Array.<ByteStream>} patterns Array with patterns which should be found\r\n     * @param {?number} [start] Start position to search from\r\n     * @param {?number} [length] Length of byte block to search at\r\n     * @returns {Array}\r\n     */\n\n  }, {\n    key: \"findAllIn\",\n    value: function findAllIn(patterns) {\n      var start = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;\n      var length = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : this.buffer.byteLength - start;\n      //region Initial variables\n      var result = []; // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\n\n      if (start == null) {\n        // noinspection AssignmentToFunctionParameterJS\n        start = 0;\n      } // noinspection NonBlockStatementBodyJS\n\n\n      if (start > this.buffer.byteLength - 1) return result; // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\n\n      if (length == null) {\n        // noinspection AssignmentToFunctionParameterJS\n        length = this.buffer.byteLength - start;\n      }\n\n      if (length > this.buffer.byteLength - start) {\n        // noinspection AssignmentToFunctionParameterJS\n        length = this.buffer.byteLength - start;\n      }\n\n      var patternFound = {\n        id: -1,\n        position: start\n      }; //endregion\n      //region Find all accurences of patterns\n\n      do {\n        var position = patternFound.position;\n        patternFound = this.findFirstIn(patterns, patternFound.position, length); // noinspection EqualityComparisonWithCoercionJS\n\n        if (patternFound.id == -1) {\n          // noinspection BreakStatementJS\n          break;\n        } // noinspection AssignmentToFunctionParameterJS\n\n\n        length -= patternFound.position - position;\n        result.push({\n          id: patternFound.id,\n          position: patternFound.position\n        });\n      } while (true); // eslint-disable-line\n      //endregion\n\n\n      return result;\n    } //**********************************************************************************\n    // noinspection FunctionWithMultipleLoopsJS, FunctionWithMultipleReturnPointsJS\n\n    /**\r\n     * Find all positions of a pattern\r\n     * @param {ByteStream} pattern Stream having pattern value\r\n     * @param {?number} [start] Start position to search from\r\n     * @param {?number} [length] Length of byte block to search at\r\n     * @returns {Array|number} Array with all pattern positions or (-1) if failed\r\n     */\n\n  }, {\n    key: \"findAllPatternIn\",\n    value: function findAllPatternIn(pattern) {\n      var start = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;\n      var length = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : this.buffer.byteLength - start;\n\n      //region Check input variables\n      // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\n      if (start == null) {\n        // noinspection AssignmentToFunctionParameterJS\n        start = 0;\n      }\n\n      if (start > this.buffer.byteLength) {\n        // noinspection AssignmentToFunctionParameterJS\n        start = this.buffer.byteLength;\n      } // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\n\n\n      if (length == null) {\n        // noinspection AssignmentToFunctionParameterJS\n        length = this.buffer.byteLength - start;\n      }\n\n      if (length > this.buffer.byteLength - start) {\n        // noinspection AssignmentToFunctionParameterJS\n        length = this.buffer.byteLength - start;\n      } //endregion\n      //region Initial variables\n\n\n      var result = [];\n      var patternLength = pattern.buffer.byteLength; // noinspection NonBlockStatementBodyJS\n\n      if (patternLength > length) return -1; //endregion\n      //region Make a \"pre-read\" array for pattern\n\n      var patternArray = Array.from(pattern.view); //endregion\n      //region Search for pattern\n\n      for (var i = 0; i <= length - patternLength; i++) {\n        var equal = true;\n        var equalStart = start + i;\n\n        for (var j = 0; j < patternLength; j++) {\n          // noinspection EqualityComparisonWithCoercionJS\n          if (this.view[j + equalStart] != patternArray[j]) {\n            equal = false; // noinspection BreakStatementJS\n\n            break;\n          }\n        }\n\n        if (equal) {\n          result.push(start + patternLength + i); // Position after the pattern found\n\n          i += patternLength - 1; // On next step of \"for\" we will have \"i++\"\n        }\n      } //endregion\n\n\n      return result;\n    } //**********************************************************************************\n    // noinspection OverlyComplexFunctionJS, FunctionTooLongJS\n\n    /**\r\n     * Find first position of data, not included in patterns from input array\r\n     * @param {Array.<ByteStream>} patterns Array with patterns which should be ommited\r\n     * @param {?number} [start] Start position to search from\r\n     * @param {?number} [length] Length of byte block to search at\r\n     * @param {boolean} [backward=false] Flag to search in backward order\r\n     * @returns {{left: {id: number, position: *}, right: {id: number, position: number}, value: ByteStream}}\r\n     */\n\n  }, {\n    key: \"findFirstNotIn\",\n    value: function findFirstNotIn(patterns) {\n      var start = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;\n      var length = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;\n      var backward = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : false;\n\n      //region Initial variables\n      // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\n      if (start == null) {\n        // noinspection AssignmentToFunctionParameterJS, ConditionalExpressionJS\n        start = backward ? this.buffer.byteLength : 0;\n      }\n\n      if (start > this.buffer.byteLength) {\n        // noinspection AssignmentToFunctionParameterJS\n        start = this.buffer.byteLength;\n      }\n\n      if (backward) {\n        // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\n        if (length == null) {\n          // noinspection AssignmentToFunctionParameterJS\n          length = start;\n        }\n\n        if (length > start) {\n          // noinspection AssignmentToFunctionParameterJS\n          length = start;\n        }\n      } else {\n        // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\n        if (length == null) {\n          // noinspection AssignmentToFunctionParameterJS\n          length = this.buffer.byteLength - start;\n        }\n\n        if (length > this.buffer.byteLength - start) {\n          // noinspection AssignmentToFunctionParameterJS\n          length = this.buffer.byteLength - start;\n        }\n      }\n\n      var result = {\n        left: {\n          id: -1,\n          position: start\n        },\n        right: {\n          id: -1,\n          position: 0\n        },\n        value: new ByteStream()\n      };\n      var currentLength = length; //endregion\n      // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\n\n      while (currentLength > 0) {\n        //region Search for nearest \"pattern\"\n        // noinspection ConditionalExpressionJS\n        result.right = this.findFirstIn(patterns, backward ? start - length + currentLength : start + length - currentLength, currentLength, backward); //endregion\n        //region No pattern at all\n        // noinspection EqualityComparisonWithCoercionJS\n\n        if (result.right.id == -1) {\n          // noinspection AssignmentToFunctionParameterJS\n          length = currentLength;\n\n          if (backward) {\n            // noinspection AssignmentToFunctionParameterJS\n            start -= length;\n          } else {\n            // noinspection AssignmentToFunctionParameterJS\n            start = result.left.position;\n          }\n\n          result.value = new ByteStream();\n          result.value._buffer = this._buffer.slice(start, start + length);\n          result.value._view = new Uint8Array(result.value._buffer); // noinspection BreakStatementJS\n\n          break;\n        } //endregion\n        //region Check distance between two patterns\n        // noinspection ConditionalExpressionJS, EqualityComparisonWithCoercionJS\n\n\n        if (result.right.position != (backward ? result.left.position - patterns[result.right.id].buffer.byteLength : result.left.position + patterns[result.right.id].buffer.byteLength)) {\n          if (backward) {\n            // noinspection AssignmentToFunctionParameterJS\n            start = result.right.position + patterns[result.right.id].buffer.byteLength; // noinspection AssignmentToFunctionParameterJS\n\n            length = result.left.position - result.right.position - patterns[result.right.id].buffer.byteLength;\n          } else {\n            // noinspection AssignmentToFunctionParameterJS\n            start = result.left.position; // noinspection AssignmentToFunctionParameterJS\n\n            length = result.right.position - result.left.position - patterns[result.right.id].buffer.byteLength;\n          }\n\n          result.value = new ByteStream();\n          result.value._buffer = this._buffer.slice(start, start + length);\n          result.value._view = new Uint8Array(result.value._buffer); // noinspection BreakStatementJS\n\n          break;\n        } //endregion\n        //region Store information about previous pattern\n\n\n        result.left = result.right; //endregion\n        //region Change current length\n\n        currentLength -= patterns[result.right.id]._buffer.byteLength; //endregion\n      } //region Swap \"patterns\" in case of backward order\n\n\n      if (backward) {\n        var temp = result.right;\n        result.right = result.left;\n        result.left = temp;\n      } //endregion\n\n\n      return result;\n    } //**********************************************************************************\n    // noinspection FunctionWithMultipleReturnPointsJS\n\n    /**\r\n     * Find all positions of data, not included in patterns from input array\r\n     * @param {Array.<ByteStream>} patterns Array with patterns which should be ommited\r\n     * @param {?number} [start] Start position to search from\r\n     * @param {?number} [length] Length of byte block to search at\r\n     * @returns {Array}\r\n     */\n\n  }, {\n    key: \"findAllNotIn\",\n    value: function findAllNotIn(patterns) {\n      var start = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;\n      var length = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;\n      //region Initial variables\n      var result = []; // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\n\n      if (start == null) {\n        // noinspection AssignmentToFunctionParameterJS\n        start = 0;\n      } // noinspection NonBlockStatementBodyJS\n\n\n      if (start > this.buffer.byteLength - 1) return result; // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\n\n      if (length == null) {\n        // noinspection AssignmentToFunctionParameterJS\n        length = this.buffer.byteLength - start;\n      }\n\n      if (length > this.buffer.byteLength - start) {\n        // noinspection AssignmentToFunctionParameterJS\n        length = this.buffer.byteLength - start;\n      }\n\n      var patternFound = {\n        left: {\n          id: -1,\n          position: start\n        },\n        right: {\n          id: -1,\n          position: start\n        },\n        value: new ByteStream()\n      }; //endregion\n      //region Find all accurences of patterns\n      // noinspection EqualityComparisonWithCoercionJS\n\n      do {\n        var position = patternFound.right.position;\n        patternFound = this.findFirstNotIn(patterns, patternFound.right.position, length); // noinspection AssignmentToFunctionParameterJS\n\n        length -= patternFound.right.position - position;\n        result.push({\n          left: {\n            id: patternFound.left.id,\n            position: patternFound.left.position\n          },\n          right: {\n            id: patternFound.right.id,\n            position: patternFound.right.position\n          },\n          value: patternFound.value\n        });\n      } while (patternFound.right.id != -1); //endregion\n\n\n      return result;\n    } //**********************************************************************************\n    // noinspection FunctionWithMultipleReturnPointsJS, OverlyComplexFunctionJS\n\n    /**\r\n     * Find position of a sequence of any patterns from input array\r\n     * @param {Array.<ByteStream>} patterns Array of pattern to look for\r\n     * @param {?number} [start] Start position to search from\r\n     * @param {?number} [length] Length of byte block to search at\r\n     * @param {boolean} [backward=false] Flag to search in backward order\r\n     * @returns {*}\r\n     */\n\n  }, {\n    key: \"findFirstSequence\",\n    value: function findFirstSequence(patterns) {\n      var start = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;\n      var length = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;\n      var backward = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : false;\n\n      //region Initial variables\n      // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\n      if (start == null) {\n        // noinspection AssignmentToFunctionParameterJS, ConditionalExpressionJS\n        start = backward ? this.buffer.byteLength : 0;\n      }\n\n      if (start > this.buffer.byteLength) {\n        // noinspection AssignmentToFunctionParameterJS\n        start = this.buffer.byteLength;\n      }\n\n      if (backward) {\n        // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\n        if (length == null) {\n          // noinspection AssignmentToFunctionParameterJS\n          length = start;\n        }\n\n        if (length > start) {\n          // noinspection AssignmentToFunctionParameterJS\n          length = start;\n        }\n      } else {\n        // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\n        if (length == null) {\n          // noinspection AssignmentToFunctionParameterJS\n          length = this.buffer.byteLength - start;\n        }\n\n        if (length > this.buffer.byteLength - start) {\n          // noinspection AssignmentToFunctionParameterJS\n          length = this.buffer.byteLength - start;\n        }\n      } //endregion\n      //region Find first byte from sequence\n\n\n      var firstIn = this.skipNotPatterns(patterns, start, length, backward); // noinspection EqualityComparisonWithCoercionJS\n\n      if (firstIn == -1) {\n        return {\n          position: -1,\n          value: new ByteStream()\n        };\n      } //endregion\n      //region Find first byte not in sequence\n      // noinspection ConditionalExpressionJS\n\n\n      var firstNotIn = this.skipPatterns(patterns, firstIn, length - (backward ? start - firstIn : firstIn - start), backward); //endregion\n      //region Make output value\n\n      if (backward) {\n        // noinspection AssignmentToFunctionParameterJS\n        start = firstNotIn; // noinspection AssignmentToFunctionParameterJS\n\n        length = firstIn - firstNotIn;\n      } else {\n        // noinspection AssignmentToFunctionParameterJS\n        start = firstIn; // noinspection AssignmentToFunctionParameterJS\n\n        length = firstNotIn - firstIn;\n      }\n\n      var value = new ByteStream();\n      value._buffer = this._buffer.slice(start, start + length);\n      value._view = new Uint8Array(value._buffer); //endregion\n\n      return {\n        position: firstNotIn,\n        value: value\n      };\n    } //**********************************************************************************\n    // noinspection FunctionWithMultipleReturnPointsJS\n\n    /**\r\n     * Find all positions of a sequence of any patterns from input array\r\n     * @param {Array.<ByteStream>} patterns Array of patterns to search for\r\n     * @param {?number} [start] Start position to search from\r\n     * @param {?number} [length] Length of byte block to search at\r\n     * @returns {Array}\r\n     */\n\n  }, {\n    key: \"findAllSequences\",\n    value: function findAllSequences(patterns) {\n      var start = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;\n      var length = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;\n      //region Initial variables\n      var result = []; // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\n\n      if (start == null) {\n        // noinspection AssignmentToFunctionParameterJS\n        start = 0;\n      } // noinspection NonBlockStatementBodyJS\n\n\n      if (start > this.buffer.byteLength - 1) return result; // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\n\n      if (length == null) {\n        // noinspection AssignmentToFunctionParameterJS\n        length = this.buffer.byteLength - start;\n      }\n\n      if (length > this.buffer.byteLength - start) {\n        // noinspection AssignmentToFunctionParameterJS\n        length = this.buffer.byteLength - start;\n      }\n\n      var patternFound = {\n        position: start,\n        value: new ByteStream()\n      }; //endregion\n      //region Find all accurences of patterns\n      // noinspection EqualityComparisonWithCoercionJS\n\n      do {\n        var position = patternFound.position;\n        patternFound = this.findFirstSequence(patterns, patternFound.position, length); // noinspection EqualityComparisonWithCoercionJS\n\n        if (patternFound.position != -1) {\n          // noinspection AssignmentToFunctionParameterJS\n          length -= patternFound.position - position;\n          result.push({\n            position: patternFound.position,\n            value: patternFound.value\n          });\n        }\n      } while (patternFound.position != -1); //endregion\n\n\n      return result;\n    } //**********************************************************************************\n    // noinspection FunctionWithMultipleLoopsJS, FunctionWithMultipleReturnPointsJS, OverlyComplexFunctionJS, FunctionTooLongJS\n\n    /**\r\n     * Find all paired patterns in the stream\r\n     * @param {ByteStream} leftPattern Left pattern to search for\r\n     * @param {ByteStream} rightPattern Right pattern to search for\r\n     * @param {?number} [start=null] Start position to search from\r\n     * @param {?number} [length=null] Length of byte block to search at\r\n     * @returns {Array}\r\n     */\n\n  }, {\n    key: \"findPairedPatterns\",\n    value: function findPairedPatterns(leftPattern, rightPattern) {\n      var start = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;\n      var length = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : null;\n      //region Initial variables\n      var result = []; // noinspection NonBlockStatementBodyJS\n\n      if (leftPattern.isEqual(rightPattern)) return result; // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\n\n      if (start == null) {\n        // noinspection AssignmentToFunctionParameterJS\n        start = 0;\n      } // noinspection NonBlockStatementBodyJS\n\n\n      if (start > this.buffer.byteLength - 1) return result; // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\n\n      if (length == null) {\n        // noinspection AssignmentToFunctionParameterJS\n        length = this.buffer.byteLength - start;\n      }\n\n      if (length > this.buffer.byteLength - start) {\n        // noinspection AssignmentToFunctionParameterJS\n        length = this.buffer.byteLength - start;\n      }\n\n      var currentPositionLeft = 0; //endregion\n      //region Find all \"left patterns\" as sorted array\n\n      var leftPatterns = this.findAllPatternIn(leftPattern, start, length); // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, NonBlockStatementBodyJS, EqualityComparisonWithCoercionJS\n\n      if (leftPatterns.length == 0) return result; //endregion\n      //region Find all \"right patterns\" as sorted array\n\n      var rightPatterns = this.findAllPatternIn(rightPattern, start, length); // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, NonBlockStatementBodyJS, EqualityComparisonWithCoercionJS\n\n      if (rightPatterns.length == 0) return result; //endregion\n      //region Combine patterns\n\n      while (currentPositionLeft < leftPatterns.length) {\n        // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, EqualityComparisonWithCoercionJS\n        if (rightPatterns.length == 0) {\n          // noinspection BreakStatementJS\n          break;\n        } // noinspection EqualityComparisonWithCoercionJS\n\n\n        if (leftPatterns[0] == rightPatterns[0]) {\n          // Possible situation when one pattern is a part of another\n          // For example \"stream\" and \"endstream\"\n          // In case when we have only \"endstream\" in fact \"stream\" will be also found at the same position\n          // (position of the pattern is an index AFTER the pattern)\n          result.push({\n            left: leftPatterns[0],\n            right: rightPatterns[0]\n          });\n          leftPatterns.splice(0, 1);\n          rightPatterns.splice(0, 1); // noinspection ContinueStatementJS\n\n          continue;\n        }\n\n        if (leftPatterns[currentPositionLeft] > rightPatterns[0]) {\n          // noinspection BreakStatementJS\n          break;\n        }\n\n        while (leftPatterns[currentPositionLeft] < rightPatterns[0]) {\n          currentPositionLeft++;\n\n          if (currentPositionLeft >= leftPatterns.length) {\n            // noinspection BreakStatementJS\n            break;\n          }\n        }\n\n        result.push({\n          left: leftPatterns[currentPositionLeft - 1],\n          right: rightPatterns[0]\n        });\n        leftPatterns.splice(currentPositionLeft - 1, 1);\n        rightPatterns.splice(0, 1);\n        currentPositionLeft = 0;\n      } //endregion\n      //region Sort result\n\n\n      result.sort(function (a, b) {\n        return a.left - b.left;\n      }); //endregion\n\n      return result;\n    } //**********************************************************************************\n    // noinspection FunctionWithMultipleLoopsJS, FunctionWithMultipleReturnPointsJS, OverlyComplexFunctionJS, FunctionTooLongJS\n\n    /**\r\n     * Find all paired patterns in the stream\r\n     * @param {Array.<ByteStream>} inputLeftPatterns Array of left patterns to search for\r\n     * @param {Array.<ByteStream>} inputRightPatterns Array of right patterns to search for\r\n     * @param {?number} [start=null] Start position to search from\r\n     * @param {?number} [length=null] Length of byte block to search at\r\n     * @returns {Array}\r\n     */\n\n  }, {\n    key: \"findPairedArrays\",\n    value: function findPairedArrays(inputLeftPatterns, inputRightPatterns) {\n      var start = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;\n      var length = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : null;\n      //region Initial variables\n      var result = []; // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\n\n      if (start == null) {\n        // noinspection AssignmentToFunctionParameterJS\n        start = 0;\n      } // noinspection NonBlockStatementBodyJS\n\n\n      if (start > this.buffer.byteLength - 1) return result; // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\n\n      if (length == null) {\n        // noinspection AssignmentToFunctionParameterJS\n        length = this.buffer.byteLength - start;\n      }\n\n      if (length > this.buffer.byteLength - start) {\n        // noinspection AssignmentToFunctionParameterJS\n        length = this.buffer.byteLength - start;\n      }\n\n      var currentPositionLeft = 0; //endregion\n      //region Find all \"left patterns\" as sorted array\n\n      var leftPatterns = this.findAllIn(inputLeftPatterns, start, length); // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, NonBlockStatementBodyJS, EqualityComparisonWithCoercionJS\n\n      if (leftPatterns.length == 0) return result; //endregion\n      //region Find all \"right patterns\" as sorted array\n\n      var rightPatterns = this.findAllIn(inputRightPatterns, start, length); // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, NonBlockStatementBodyJS, EqualityComparisonWithCoercionJS\n\n      if (rightPatterns.length == 0) return result; //endregion\n      //region Combine patterns\n\n      while (currentPositionLeft < leftPatterns.length) {\n        // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, EqualityComparisonWithCoercionJS\n        if (rightPatterns.length == 0) {\n          // noinspection BreakStatementJS\n          break;\n        } // noinspection EqualityComparisonWithCoercionJS\n\n\n        if (leftPatterns[0].position == rightPatterns[0].position) {\n          // Possible situation when one pattern is a part of another\n          // For example \"stream\" and \"endstream\"\n          // In case when we have only \"endstream\" in fact \"stream\" will be also found at the same position\n          // (position of the pattern is an index AFTER the pattern)\n          result.push({\n            left: leftPatterns[0],\n            right: rightPatterns[0]\n          });\n          leftPatterns.splice(0, 1);\n          rightPatterns.splice(0, 1); // noinspection ContinueStatementJS\n\n          continue;\n        }\n\n        if (leftPatterns[currentPositionLeft].position > rightPatterns[0].position) {\n          // noinspection BreakStatementJS\n          break;\n        }\n\n        while (leftPatterns[currentPositionLeft].position < rightPatterns[0].position) {\n          currentPositionLeft++;\n\n          if (currentPositionLeft >= leftPatterns.length) {\n            // noinspection BreakStatementJS\n            break;\n          }\n        }\n\n        result.push({\n          left: leftPatterns[currentPositionLeft - 1],\n          right: rightPatterns[0]\n        });\n        leftPatterns.splice(currentPositionLeft - 1, 1);\n        rightPatterns.splice(0, 1);\n        currentPositionLeft = 0;\n      } //endregion\n      //region Sort result\n\n\n      result.sort(function (a, b) {\n        return a.left.position - b.left.position;\n      }); //endregion\n\n      return result;\n    } //**********************************************************************************\n    // noinspection FunctionWithMultipleReturnPointsJS, FunctionTooLongJS\n\n    /**\r\n     * Replace one patter with other\r\n     * @param {ByteStream} searchPattern The pattern to search for\r\n     * @param {ByteStream} replacePattern The pattern to replace initial pattern\r\n     * @param {?number} [start=null] Start position to search from\r\n     * @param {?number} [length=null] Length of byte block to search at\r\n     * @param {Array|null} [findAllResult=null] Pre-calculated results of \"findAllIn\"\r\n     * @returns {*}\r\n     */\n\n  }, {\n    key: \"replacePattern\",\n    value: function replacePattern(searchPattern, _replacePattern) {\n      var _output$searchPattern;\n\n      var start = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;\n      var length = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : null;\n      var findAllResult = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : null;\n      //region Initial variables\n      var result;\n      var i;\n      var output = {\n        status: -1,\n        searchPatternPositions: [],\n        replacePatternPositions: []\n      }; // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\n\n      if (start == null) {\n        // noinspection AssignmentToFunctionParameterJS\n        start = 0;\n      } // noinspection NonBlockStatementBodyJS\n\n\n      if (start > this.buffer.byteLength - 1) return false; // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\n\n      if (length == null) {\n        // noinspection AssignmentToFunctionParameterJS\n        length = this.buffer.byteLength - start;\n      }\n\n      if (length > this.buffer.byteLength - start) {\n        // noinspection AssignmentToFunctionParameterJS\n        length = this.buffer.byteLength - start;\n      } //endregion\n      //region Find a pattern to search for\n      // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, NonBlockStatementBodyJS\n\n\n      if (findAllResult == null) {\n        result = this.findAllIn([searchPattern], start, length); // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, NonBlockStatementBodyJS, EqualityComparisonWithCoercionJS\n\n        if (result.length == 0) return output;\n      } else result = findAllResult; // noinspection NestedFunctionCallJS\n\n\n      (_output$searchPattern = output.searchPatternPositions).push.apply(_output$searchPattern, _toConsumableArray(Array.from(result, function (element) {\n        return element.position;\n      }))); //endregion\n      //region Variables for new buffer initialization\n\n\n      var patternDifference = searchPattern.buffer.byteLength - _replacePattern.buffer.byteLength;\n      var changedBuffer = new ArrayBuffer(this.view.length - result.length * patternDifference);\n      var changedView = new Uint8Array(changedBuffer); //endregion\n      //region Copy data from 0 to start\n      // noinspection NestedFunctionCallJS\n\n      changedView.set(new Uint8Array(this.buffer, 0, start)); //endregion\n      //region Replace pattern\n\n      for (i = 0; i < result.length; i++) {\n        //region Initial variables\n        // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, ConditionalExpressionJS, EqualityComparisonWithCoercionJS\n        var currentPosition = i == 0 ? start : result[i - 1].position; //endregion\n        //region Copy bytes other then search pattern\n        // noinspection NestedFunctionCallJS\n\n        changedView.set(new Uint8Array(this.buffer, currentPosition, result[i].position - searchPattern.buffer.byteLength - currentPosition), currentPosition - i * patternDifference); //endregion\n        //region Put replace pattern in a new buffer\n\n        changedView.set(_replacePattern.view, result[i].position - searchPattern.buffer.byteLength - i * patternDifference);\n        output.replacePatternPositions.push(result[i].position - searchPattern.buffer.byteLength - i * patternDifference); //endregion\n      } //endregion\n      //region Copy data from the end of old buffer\n\n\n      i--; // noinspection NestedFunctionCallJS\n\n      changedView.set(new Uint8Array(this.buffer, result[i].position, this.buffer.byteLength - result[i].position), result[i].position - searchPattern.buffer.byteLength + _replacePattern.buffer.byteLength - i * patternDifference); //endregion\n      //region Re-initialize existing buffer\n\n      this.buffer = changedBuffer;\n      this.view = new Uint8Array(this.buffer); //endregion\n\n      output.status = 1;\n      return output;\n    } //**********************************************************************************\n    // noinspection FunctionWithMultipleLoopsJS, FunctionWithMultipleReturnPointsJS, OverlyComplexFunctionJS, FunctionTooLongJS\n\n    /**\r\n     * Skip any pattern from input array\r\n     * @param {Array.<ByteStream>} patterns Array with patterns which should be ommited\r\n     * @param {?number} [start=null] Start position to search from\r\n     * @param {?number} [length=null] Length of byte block to search at\r\n     * @param {boolean} [backward=false] Flag to search in backward order\r\n     * @returns {*}\r\n     */\n\n  }, {\n    key: \"skipPatterns\",\n    value: function skipPatterns(patterns) {\n      var start = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;\n      var length = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;\n      var backward = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : false;\n\n      //region Initial variables\n      // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\n      if (start == null) {\n        // noinspection AssignmentToFunctionParameterJS, ConditionalExpressionJS\n        start = backward ? this.buffer.byteLength : 0;\n      }\n\n      if (start > this.buffer.byteLength) {\n        // noinspection AssignmentToFunctionParameterJS\n        start = this.buffer.byteLength;\n      }\n\n      if (backward) {\n        // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\n        if (length == null) {\n          // noinspection AssignmentToFunctionParameterJS\n          length = start;\n        }\n\n        if (length > start) {\n          // noinspection AssignmentToFunctionParameterJS\n          length = start;\n        }\n      } else {\n        // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\n        if (length == null) {\n          // noinspection AssignmentToFunctionParameterJS\n          length = this.buffer.byteLength - start;\n        }\n\n        if (length > this.buffer.byteLength - start) {\n          // noinspection AssignmentToFunctionParameterJS\n          length = this.buffer.byteLength - start;\n        }\n      }\n\n      var result = start; //endregion\n      //region Search for pattern\n\n      for (var k = 0; k < patterns.length; k++) {\n        var patternLength = patterns[k].buffer.byteLength; // noinspection ConditionalExpressionJS\n\n        var equalStart = backward ? result - patternLength : result;\n        var equal = true;\n\n        for (var j = 0; j < patternLength; j++) {\n          // noinspection EqualityComparisonWithCoercionJS\n          if (this.view[j + equalStart] != patterns[k].view[j]) {\n            equal = false; // noinspection BreakStatementJS\n\n            break;\n          }\n        }\n\n        if (equal) {\n          k = -1;\n\n          if (backward) {\n            result -= patternLength; // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, NonBlockStatementBodyJS\n\n            if (result <= 0) return result;\n          } else {\n            result += patternLength; // noinspection NonBlockStatementBodyJS\n\n            if (result >= start + length) return result;\n          }\n        }\n      } //endregion\n\n\n      return result;\n    } //**********************************************************************************\n    // noinspection FunctionWithMultipleLoopsJS, OverlyComplexFunctionJS, FunctionTooLongJS\n\n    /**\r\n     * Skip any pattern not from input array\r\n     * @param {Array.<ByteStream>} patterns Array with patterns which should not be ommited\r\n     * @param start\r\n     * @param length\r\n     * @param backward\r\n     * @returns {number}\r\n     */\n\n  }, {\n    key: \"skipNotPatterns\",\n    value: function skipNotPatterns(patterns) {\n      var start = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;\n      var length = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;\n      var backward = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : false;\n\n      //region Initial variables\n      // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\n      if (start == null) {\n        // noinspection AssignmentToFunctionParameterJS, ConditionalExpressionJS\n        start = backward ? this.buffer.byteLength : 0;\n      }\n\n      if (start > this.buffer.byteLength) {\n        // noinspection AssignmentToFunctionParameterJS\n        start = this.buffer.byteLength;\n      }\n\n      if (backward) {\n        // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\n        if (length == null) {\n          // noinspection AssignmentToFunctionParameterJS\n          length = start;\n        }\n\n        if (length > start) {\n          // noinspection AssignmentToFunctionParameterJS\n          length = start;\n        }\n      } else {\n        // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\n        if (length == null) {\n          // noinspection AssignmentToFunctionParameterJS\n          length = this.buffer.byteLength - start;\n        }\n\n        if (length > this.buffer.byteLength - start) {\n          // noinspection AssignmentToFunctionParameterJS\n          length = this.buffer.byteLength - start;\n        }\n      }\n\n      var result = -1; //endregion\n      //region Search for pattern\n\n      for (var i = 0; i < length; i++) {\n        for (var k = 0; k < patterns.length; k++) {\n          var patternLength = patterns[k].buffer.byteLength; // noinspection ConditionalExpressionJS\n\n          var equalStart = backward ? start - i - patternLength : start + i;\n          var equal = true;\n\n          for (var j = 0; j < patternLength; j++) {\n            // noinspection EqualityComparisonWithCoercionJS\n            if (this.view[j + equalStart] != patterns[k].view[j]) {\n              equal = false; // noinspection BreakStatementJS\n\n              break;\n            }\n          }\n\n          if (equal) {\n            // noinspection ConditionalExpressionJS\n            result = backward ? start - i : start + i; // Exact position of pattern found\n            // noinspection BreakStatementJS\n\n            break;\n          }\n        } // noinspection EqualityComparisonWithCoercionJS\n\n\n        if (result != -1) {\n          // noinspection BreakStatementJS\n          break;\n        }\n      } //endregion\n\n\n      return result;\n    } //**********************************************************************************\n\n  }]);\n\n  return ByteStream;\n}(); //**************************************************************************************\n\nexport var SeqStream = /*#__PURE__*/function () {\n  //**********************************************************************************\n\n  /**\r\n   * Constructor for \"SeqStream\" class\r\n   * @param {{[stream]: ByteStream, [length]: number, [backward]: boolean, [start]: number, [appendBlock]: number}} parameters\r\n   */\n  function SeqStream() {\n    var parameters = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n\n    _classCallCheck(this, SeqStream);\n\n    /**\r\n     * Major stream\r\n     * @type {ByteStream}\r\n     */\n    this.stream = new ByteStream();\n    /**\r\n     * Length of the major stream\r\n     * @type {number}\r\n     */\n\n    this._length = 0;\n    /**\r\n     * Flag to search in backward direction\r\n     * @type {boolean}\r\n     */\n\n    this.backward = false;\n    /**\r\n     * Start position to search\r\n     * @type {number}\r\n     */\n\n    this._start = 0;\n    /**\r\n     * Length of a block when append information to major stream\r\n     * @type {number}\r\n     */\n\n    this.appendBlock = 0;\n    this.prevLength = 0;\n    this.prevStart = 0;\n\n    for (var _i3 = 0, _Object$keys2 = Object.keys(parameters); _i3 < _Object$keys2.length; _i3++) {\n      var key = _Object$keys2[_i3];\n\n      switch (key) {\n        case \"stream\":\n          this.stream = parameters.stream;\n          break;\n\n        case \"backward\":\n          this.backward = parameters.backward; // noinspection JSUnusedGlobalSymbols\n\n          this._start = this.stream.buffer.byteLength;\n          break;\n\n        case \"length\":\n          // noinspection JSUnusedGlobalSymbols\n          this._length = parameters.length;\n          break;\n\n        case \"start\":\n          // noinspection JSUnusedGlobalSymbols\n          this._start = parameters.start;\n          break;\n\n        case \"appendBlock\":\n          this.appendBlock = parameters.appendBlock;\n          break;\n\n        case \"view\":\n          this.stream = new ByteStream({\n            view: parameters.view\n          });\n          break;\n\n        case \"buffer\":\n          this.stream = new ByteStream({\n            buffer: parameters.buffer\n          });\n          break;\n\n        case \"string\":\n          this.stream = new ByteStream({\n            string: parameters.string\n          });\n          break;\n\n        case \"hexstring\":\n          this.stream = new ByteStream({\n            hexstring: parameters.hexstring\n          });\n          break;\n\n        default:\n      }\n    }\n  } //**********************************************************************************\n\n  /**\r\n   * Setter for \"stream\" property\r\n   * @param {ByteStream} value\r\n   */\n\n\n  _createClass(SeqStream, [{\n    key: \"stream\",\n    get: //**********************************************************************************\n\n    /**\r\n     * Getter for \"stream\" property\r\n     * @returns {ByteStream}\r\n     */\n    function get() {\n      return this._stream;\n    } //**********************************************************************************\n\n    /**\r\n     * Setter for \"length\" property\r\n     * @param {number} value\r\n     */\n    ,\n    set: function set(value) {\n      this._stream = value;\n      this.prevLength = this._length; // noinspection JSUnusedGlobalSymbols\n\n      this._length = value._buffer.byteLength;\n      this.prevStart = this._start; // noinspection JSUnusedGlobalSymbols\n\n      this._start = 0;\n    }\n  }, {\n    key: \"length\",\n    get: //**********************************************************************************\n    // noinspection FunctionWithMultipleReturnPointsJS\n\n    /**\r\n     * Getter for \"length\" property\r\n     * @returns {number}\r\n     */\n    function get() {\n      // noinspection NonBlockStatementBodyJS\n      if (this.appendBlock) return this.start;\n      return this._length;\n    } //**********************************************************************************\n    // noinspection FunctionWithMultipleReturnPointsJS\n\n    /**\r\n     * Setter for \"start\" property\r\n     * @param {number} value\r\n     */\n    ,\n    set: function set(value) {\n      this.prevLength = this._length; // noinspection JSUnusedGlobalSymbols\n\n      this._length = value;\n    }\n  }, {\n    key: \"start\",\n    get: //**********************************************************************************\n\n    /**\r\n     * Getter for \"start\" property\r\n     * @returns {number}\r\n     */\n    function get() {\n      return this._start;\n    } //**********************************************************************************\n\n    /**\r\n     * Return ArrayBuffer with having value of existing SeqStream length\r\n     * @return {ArrayBuffer}\r\n     */\n    ,\n    set: function set(value) {\n      // noinspection NonBlockStatementBodyJS\n      if (value > this.stream.buffer.byteLength) return; //region Initialization of \"prev\" internal variables\n\n      this.prevStart = this._start;\n      this.prevLength = this._length; //endregion\n      // noinspection JSUnusedGlobalSymbols, ConditionalExpressionJS\n\n      this._length -= this.backward ? this._start - value : value - this._start; // noinspection JSUnusedGlobalSymbols\n\n      this._start = value;\n    }\n  }, {\n    key: \"buffer\",\n    get: function get() {\n      return this._stream._buffer.slice(0, this._length);\n    } //**********************************************************************************\n    // noinspection JSUnusedGlobalSymbols\n\n    /**\r\n     * Reset current position of the \"SeqStream\"\r\n     */\n\n  }, {\n    key: \"resetPosition\",\n    value: function resetPosition() {\n      // noinspection JSUnusedGlobalSymbols\n      this._start = this.prevStart; // noinspection JSUnusedGlobalSymbols\n\n      this._length = this.prevLength;\n    } //**********************************************************************************\n    // noinspection JSUnusedGlobalSymbols, FunctionWithMultipleReturnPointsJS\n\n    /**\r\n     * Find any byte pattern in \"ByteStream\"\r\n     * @param {ByteStream} pattern Stream having pattern value\r\n     * @param {?number} [gap] Maximum gap between start position and position of nearest object\r\n     * @returns {number}\r\n     */\n\n  }, {\n    key: \"findPattern\",\n    value: function findPattern(pattern) {\n      var gap = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;\n\n      //region Initial variables\n      // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\n      if (gap == null || gap > this.length) {\n        // noinspection AssignmentToFunctionParameterJS\n        gap = this.length;\n      } //endregion\n      //region Find pattern\n\n\n      var result = this.stream.findPattern(pattern, this.start, this.length, this.backward); // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, NonBlockStatementBodyJS, EqualityComparisonWithCoercionJS\n\n      if (result == -1) return result;\n\n      if (this.backward) {\n        // noinspection NonBlockStatementBodyJS\n        if (result < this.start - pattern.buffer.byteLength - gap) return -1;\n      } else {\n        // noinspection NonBlockStatementBodyJS\n        if (result > this.start + pattern.buffer.byteLength + gap) return -1;\n      } //endregion\n      //region Create new values\n\n\n      this.start = result; //endregion ;\n\n      return result;\n    } //**********************************************************************************\n    // noinspection JSUnusedGlobalSymbols, FunctionWithMultipleReturnPointsJS\n\n    /**\r\n     * Find first position of any pattern from input array\r\n     * @param {Array.<ByteStream>} patterns Array with patterns which should be found\r\n     * @param {?number} [gap] Maximum gap between start position and position of nearest object\r\n     * @returns {{id: number, position: number}}\r\n     */\n\n  }, {\n    key: \"findFirstIn\",\n    value: function findFirstIn(patterns) {\n      var gap = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;\n\n      //region Initial variables\n      // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\n      if (gap == null || gap > this.length) {\n        // noinspection AssignmentToFunctionParameterJS\n        gap = this.length;\n      } //endregion\n      //region Search for patterns\n\n\n      var result = this.stream.findFirstIn(patterns, this.start, this.length, this.backward); // noinspection NonBlockStatementBodyJS, EqualityComparisonWithCoercionJS\n\n      if (result.id == -1) return result;\n\n      if (this.backward) {\n        if (result.position < this.start - patterns[result.id].buffer.byteLength - gap) {\n          // noinspection ConditionalExpressionJS\n          return {\n            id: -1,\n            position: this.backward ? 0 : this.start + this.length\n          };\n        }\n      } else {\n        if (result.position > this.start + patterns[result.id].buffer.byteLength + gap) {\n          // noinspection ConditionalExpressionJS\n          return {\n            id: -1,\n            position: this.backward ? 0 : this.start + this.length\n          };\n        }\n      } //endregion\n      //region Create new values\n\n\n      this.start = result.position; //endregion ;\n\n      return result;\n    } //**********************************************************************************\n    // noinspection JSUnusedGlobalSymbols\n\n    /**\r\n     * Find all positions of any pattern from input array\r\n     * @param {Array.<ByteStream>} patterns Array with patterns which should be found\r\n     * @returns {Array}\r\n     */\n\n  }, {\n    key: \"findAllIn\",\n    value: function findAllIn(patterns) {\n      // In case of \"backward order\" the start position is at the end on stream.\n      // In case of \"normal order\" the start position is at the begging of the stream.\n      // But in fact for search for all patterns we need to have start position in \"normal order\".\n      // noinspection ConditionalExpressionJS\n      var start = this.backward ? this.start - this.length : this.start;\n      return this.stream.findAllIn(patterns, start, this.length);\n    } //**********************************************************************************\n    // noinspection JSUnusedGlobalSymbols, FunctionWithMultipleReturnPointsJS, OverlyComplexFunctionJS\n\n    /**\r\n     * Find first position of data, not included in patterns from input array\r\n     * @param {Array.<ByteStream>} patterns Array with patterns which should be ommited\r\n     * @param {?number} gap Maximum gap between start position and position of nearest object\r\n     * @returns {*}\r\n     */\n\n  }, {\n    key: \"findFirstNotIn\",\n    value: function findFirstNotIn(patterns) {\n      var gap = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;\n\n      //region Initial variables\n      // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\n      if (gap == null || gap > this._length) {\n        // noinspection AssignmentToFunctionParameterJS\n        gap = this._length;\n      } //endregion\n      //region Search for patterns\n\n\n      var result = this._stream.findFirstNotIn(patterns, this._start, this._length, this.backward); // noinspection NonBlockStatementBodyJS, EqualityComparisonWithCoercionJS\n\n\n      if (result.left.id == -1 && result.right.id == -1) return result;\n\n      if (this.backward) {\n        // noinspection EqualityComparisonWithCoercionJS\n        if (result.right.id != -1) {\n          if (result.right.position < this._start - patterns[result.right.id]._buffer.byteLength - gap) {\n            return {\n              left: {\n                id: -1,\n                position: this._start\n              },\n              right: {\n                id: -1,\n                position: 0\n              },\n              value: new ByteStream()\n            };\n          }\n        }\n      } else {\n        // noinspection EqualityComparisonWithCoercionJS\n        if (result.left.id != -1) {\n          if (result.left.position > this._start + patterns[result.left.id]._buffer.byteLength + gap) {\n            return {\n              left: {\n                id: -1,\n                position: this._start\n              },\n              right: {\n                id: -1,\n                position: 0\n              },\n              value: new ByteStream()\n            };\n          }\n        }\n      } //endregion\n      //region Create new values\n\n\n      if (this.backward) {\n        // noinspection NonBlockStatementBodyJS, EqualityComparisonWithCoercionJS\n        if (result.left.id == -1) this.start = 0;else this.start = result.left.position;\n      } else {\n        // noinspection NonBlockStatementBodyJS, EqualityComparisonWithCoercionJS\n        if (result.right.id == -1) this.start = this._start + this._length;else this.start = result.right.position;\n      } //endregion ;\n\n\n      return result;\n    } //**********************************************************************************\n    // noinspection JSUnusedGlobalSymbols\n\n    /**\r\n     * Find all positions of data, not included in patterns from input array\r\n     * @param {Array.<ByteStream>} patterns Array with patterns which should be ommited\r\n     * @returns {Array}\r\n     */\n\n  }, {\n    key: \"findAllNotIn\",\n    value: function findAllNotIn(patterns) {\n      // In case of \"backward order\" the start position is at the end on stream.\n      // In case of \"normal order\" the start position is at the begging of the stream.\n      // But in fact for search for all patterns we need to have start position in \"normal order\".\n      // noinspection ConditionalExpressionJS\n      var start = this.backward ? this._start - this._length : this._start;\n      return this._stream.findAllNotIn(patterns, start, this._length);\n    } //**********************************************************************************\n    // noinspection JSUnusedGlobalSymbols, FunctionWithMultipleReturnPointsJS\n\n    /**\r\n     * Find position of a sequence of any patterns from input array\r\n     * @param {Array.<ByteStream>} patterns Array with patterns which should be ommited\r\n     * @param {?number} [length] Length to search sequence for\r\n     * @param {?number} [gap] Maximum gap between start position and position of nearest object\r\n     * @returns {*}\r\n     */\n\n  }, {\n    key: \"findFirstSequence\",\n    value: function findFirstSequence(patterns) {\n      var length = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;\n      var gap = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;\n\n      //region Initial variables\n      // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\n      if (length == null || length > this._length) {\n        // noinspection AssignmentToFunctionParameterJS\n        length = this._length;\n      } // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\n\n\n      if (gap == null || gap > length) {\n        // noinspection AssignmentToFunctionParameterJS\n        gap = length;\n      } //endregion\n      //region Search for sequence\n\n\n      var result = this._stream.findFirstSequence(patterns, this._start, length, this.backward); // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, NonBlockStatementBodyJS, EqualityComparisonWithCoercionJS\n\n\n      if (result.value.buffer.byteLength == 0) return result;\n\n      if (this.backward) {\n        if (result.position < this._start - result.value._buffer.byteLength - gap) {\n          return {\n            position: -1,\n            value: new ByteStream()\n          };\n        }\n      } else {\n        if (result.position > this._start + result.value._buffer.byteLength + gap) {\n          return {\n            position: -1,\n            value: new ByteStream()\n          };\n        }\n      } //endregion\n      //region Create new values\n\n\n      this.start = result.position; //endregion ;\n\n      return result;\n    } //**********************************************************************************\n    // noinspection JSUnusedGlobalSymbols\n\n    /**\r\n     * Find position of a sequence of any patterns from input array\r\n     * @param {Array.<ByteStream>} patterns Array with patterns which should be found\r\n     * @returns {Array}\r\n     */\n\n  }, {\n    key: \"findAllSequences\",\n    value: function findAllSequences(patterns) {\n      // In case of \"backward order\" the start position is at the end on stream.\n      // In case of \"normal order\" the start position is at the begging of the stream.\n      // But in fact for search for all patterns we need to have start position in \"normal order\".\n      // noinspection ConditionalExpressionJS\n      var start = this.backward ? this.start - this.length : this.start;\n      return this.stream.findAllSequences(patterns, start, this.length);\n    } //**********************************************************************************\n    // noinspection JSUnusedGlobalSymbols, FunctionWithMultipleReturnPointsJS\n\n    /**\r\n     * Find all paired patterns in the stream\r\n     * @param {ByteStream} leftPattern Left pattern to search for\r\n     * @param {ByteStream} rightPattern Right pattern to search for\r\n     * @param {?number} [gap] Maximum gap between start position and position of nearest object\r\n     * @returns {Array}\r\n     */\n\n  }, {\n    key: \"findPairedPatterns\",\n    value: function findPairedPatterns(leftPattern, rightPattern) {\n      var gap = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;\n\n      //region Initial variables\n      // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\n      if (gap == null || gap > this.length) {\n        // noinspection AssignmentToFunctionParameterJS\n        gap = this.length;\n      } //endregion\n      // In case of \"backward order\" the start position is at the end on stream.\n      // In case of \"normal order\" the start position is at the begging of the stream.\n      // But in fact for search for all patterns we need to have start position in \"normal order\".\n      // noinspection ConditionalExpressionJS\n\n\n      var start = this.backward ? this.start - this.length : this.start; //region Search for patterns\n\n      var result = this.stream.findPairedPatterns(leftPattern, rightPattern, start, this.length);\n\n      if (result.length) {\n        if (this.backward) {\n          // noinspection NonBlockStatementBodyJS\n          if (result[0].right < this.start - rightPattern.buffer.byteLength - gap) return [];\n        } else {\n          // noinspection NonBlockStatementBodyJS\n          if (result[0].left > this.start + leftPattern.buffer.byteLength + gap) return [];\n        }\n      } //endregion\n\n\n      return result;\n    } //**********************************************************************************\n    // noinspection JSUnusedGlobalSymbols, FunctionWithMultipleReturnPointsJS\n\n    /**\r\n     * Find all paired patterns in the stream\r\n     * @param {Array.<ByteStream>} leftPatterns Array of left patterns to search for\r\n     * @param {Array.<ByteStream>} rightPatterns Array of right patterns to search for\r\n     * @param {?number} [gap] Maximum gap between start position and position of nearest object\r\n     * @returns {Array}\r\n     */\n\n  }, {\n    key: \"findPairedArrays\",\n    value: function findPairedArrays(leftPatterns, rightPatterns) {\n      var gap = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;\n\n      //region Initial variables\n      // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\n      if (gap == null || gap > this.length) {\n        // noinspection AssignmentToFunctionParameterJS\n        gap = this.length;\n      } //endregion\n      // In case of \"backward order\" the start position is at the end on stream.\n      // In case of \"normal order\" the start position is at the begging of the stream.\n      // But in fact for search for all patterns we need to have start position in \"normal order\".\n      // noinspection ConditionalExpressionJS\n\n\n      var start = this.backward ? this.start - this.length : this.start; //region Search for patterns\n\n      var result = this.stream.findPairedArrays(leftPatterns, rightPatterns, start, this.length);\n\n      if (result.length) {\n        if (this.backward) {\n          // noinspection NonBlockStatementBodyJS\n          if (result[0].right.position < this.start - rightPatterns[result[0].right.id].buffer.byteLength - gap) return [];\n        } else {\n          // noinspection NonBlockStatementBodyJS\n          if (result[0].left.position > this.start + leftPatterns[result[0].left.id].buffer.byteLength + gap) return [];\n        }\n      } //endregion\n\n\n      return result;\n    } //**********************************************************************************\n    // noinspection JSUnusedGlobalSymbols\n\n    /**\r\n     * Replace one patter with other\r\n     * @param {ByteStream} searchPattern The pattern to search for\r\n     * @param {ByteStream} replacePattern The pattern to replace initial pattern\r\n     * @returns {*}\r\n     */\n\n  }, {\n    key: \"replacePattern\",\n    value: function replacePattern(searchPattern, _replacePattern2) {\n      // In case of \"backward order\" the start position is at the end on stream.\n      // In case of \"normal order\" the start position is at the begging of the stream.\n      // But in fact for search for all patterns we need to have start position in \"normal order\".\n      // noinspection ConditionalExpressionJS\n      var start = this.backward ? this.start - this.length : this.start;\n      return this.stream.replacePattern(searchPattern, _replacePattern2, start, this.length);\n    } //**********************************************************************************\n    // noinspection JSUnusedGlobalSymbols\n\n    /**\r\n     * Skip of any pattern from input array\r\n     * @param {Array.<ByteStream>} patterns Array with patterns which should be ommited\r\n     * @returns {*}\r\n     */\n\n  }, {\n    key: \"skipPatterns\",\n    value: function skipPatterns(patterns) {\n      var result = this.stream.skipPatterns(patterns, this.start, this.length, this.backward); //region Create new values\n\n      this.start = result; //endregion ;\n\n      return result;\n    } //**********************************************************************************\n    // noinspection JSUnusedGlobalSymbols, FunctionWithMultipleReturnPointsJS\n\n    /**\r\n     * Skip of any pattern from input array\r\n     * @param {Array.<ByteStream>} patterns Array with patterns which should be ommited\r\n     * @returns {number}\r\n     */\n\n  }, {\n    key: \"skipNotPatterns\",\n    value: function skipNotPatterns(patterns) {\n      var result = this.stream.skipNotPatterns(patterns, this.start, this.length, this.backward); // noinspection NonBlockStatementBodyJS, EqualityComparisonWithCoercionJS\n\n      if (result == -1) return -1; //region Create new values\n\n      this.start = result; //endregion ;\n\n      return result;\n    } //**********************************************************************************\n    // noinspection JSUnusedGlobalSymbols\n\n    /**\r\n     * Append a new \"Stream\" content to the current \"Stream\"\r\n     * @param {ByteStream} stream A new \"stream\" to append to current \"stream\"\r\n     */\n\n  }, {\n    key: \"append\",\n    value: function append(stream) {\n      if (this._start + stream._buffer.byteLength > this._stream._buffer.byteLength) {\n        if (stream._buffer.byteLength > this.appendBlock) {\n          // noinspection MagicNumberJS\n          this.appendBlock = stream._buffer.byteLength + 1000;\n        }\n\n        this._stream.realloc(this._stream._buffer.byteLength + this.appendBlock);\n      }\n\n      this._stream._view.set(stream._view, this._start);\n\n      this._length += stream._buffer.byteLength * 2;\n      this.start = this._start + stream._buffer.byteLength;\n      this.prevLength -= stream._buffer.byteLength * 2;\n    } //**********************************************************************************\n    // noinspection JSUnusedGlobalSymbols\n\n    /**\r\n     * Append a \"view\" content to the current \"Stream\"\r\n     * @param {Uint8Array} view A new \"view\" to append to current \"stream\"\r\n     */\n\n  }, {\n    key: \"appendView\",\n    value: function appendView(view) {\n      if (this._start + view.length > this._stream._buffer.byteLength) {\n        if (view.length > this.appendBlock) {\n          // noinspection MagicNumberJS\n          this.appendBlock = view.length + 1000;\n        }\n\n        this._stream.realloc(this._stream._buffer.byteLength + this.appendBlock);\n      }\n\n      this._stream._view.set(view, this._start);\n\n      this._length += view.length * 2;\n      this.start = this._start + view.length;\n      this.prevLength -= view.length * 2;\n    } //**********************************************************************************\n    // noinspection JSUnusedGlobalSymbols\n\n    /**\r\n     * Append a new char to the current \"Stream\"\r\n     * @param {number} char A new char to append to current \"stream\"\r\n     */\n\n  }, {\n    key: \"appendChar\",\n    value: function appendChar(char) {\n      if (this._start + 1 > this._stream._buffer.byteLength) {\n        // noinspection ConstantOnLefSideOfComparisonJS\n        if (1 > this.appendBlock) {\n          // noinspection MagicNumberJS\n          this.appendBlock = 1000;\n        }\n\n        this._stream.realloc(this._stream._buffer.byteLength + this.appendBlock);\n      }\n\n      this._stream._view[this._start] = char;\n      this._length += 2;\n      this.start = this._start + 1;\n      this.prevLength -= 2;\n    } //**********************************************************************************\n    // noinspection FunctionNamingConventionJS\n\n    /**\r\n     * Append a new number to the current \"Stream\"\r\n     * @param {number} number A new unsigned 16-bit integer to append to current \"stream\"\r\n     */\n\n  }, {\n    key: \"appendUint16\",\n    value: function appendUint16(number) {\n      if (this._start + 2 > this._stream._buffer.byteLength) {\n        // noinspection ConstantOnLefSideOfComparisonJS\n        if (2 > this.appendBlock) {\n          // noinspection MagicNumberJS\n          this.appendBlock = 1000;\n        }\n\n        this._stream.realloc(this._stream._buffer.byteLength + this.appendBlock);\n      }\n\n      var value = new Uint16Array([number]);\n      var view = new Uint8Array(value.buffer);\n      this._stream._view[this._start] = view[1];\n      this._stream._view[this._start + 1] = view[0];\n      this._length += 4;\n      this.start = this._start + 2;\n      this.prevLength -= 4;\n    } //**********************************************************************************\n    // noinspection FunctionNamingConventionJS\n\n    /**\r\n     * Append a new number to the current \"Stream\"\r\n     * @param {number} number A new unsigned 24-bit integer to append to current \"stream\"\r\n     */\n\n  }, {\n    key: \"appendUint24\",\n    value: function appendUint24(number) {\n      if (this._start + 3 > this._stream._buffer.byteLength) {\n        // noinspection ConstantOnLefSideOfComparisonJS\n        if (3 > this.appendBlock) {\n          // noinspection MagicNumberJS\n          this.appendBlock = 1000;\n        }\n\n        this._stream.realloc(this._stream._buffer.byteLength + this.appendBlock);\n      }\n\n      var value = new Uint32Array([number]);\n      var view = new Uint8Array(value.buffer);\n      this._stream._view[this._start] = view[2];\n      this._stream._view[this._start + 1] = view[1];\n      this._stream._view[this._start + 2] = view[0];\n      this._length += 6;\n      this.start = this._start + 3;\n      this.prevLength -= 6;\n    } //**********************************************************************************\n    // noinspection FunctionNamingConventionJS\n\n    /**\r\n     * Append a new number to the current \"Stream\"\r\n     * @param {number} number A new unsigned 32-bit integer to append to current \"stream\"\r\n     */\n\n  }, {\n    key: \"appendUint32\",\n    value: function appendUint32(number) {\n      if (this._start + 4 > this._stream._buffer.byteLength) {\n        // noinspection ConstantOnLefSideOfComparisonJS\n        if (4 > this.appendBlock) {\n          // noinspection MagicNumberJS\n          this.appendBlock = 1000;\n        }\n\n        this._stream.realloc(this._stream._buffer.byteLength + this.appendBlock);\n      }\n\n      var value = new Uint32Array([number]);\n      var view = new Uint8Array(value.buffer);\n      this._stream._view[this._start] = view[3];\n      this._stream._view[this._start + 1] = view[2];\n      this._stream._view[this._start + 2] = view[1];\n      this._stream._view[this._start + 3] = view[0];\n      this._length += 8;\n      this.start = this._start + 4;\n      this.prevLength -= 8;\n    } //**********************************************************************************\n    // noinspection FunctionWithMultipleReturnPointsJS\n\n    /**\r\n     * Get a block of data\r\n     * @param {number} size Size of the data block to get\r\n     * @param {boolean} [changeLength=true] Should we change \"length\" and \"start\" value after reading the data block\r\n     * @returns {Array}\r\n     */\n\n  }, {\n    key: \"getBlock\",\n    value: function getBlock(size) {\n      var changeLength = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : true;\n      //region Check input parameters\n      // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, NonBlockStatementBodyJS\n      if (this._length <= 0) return [];\n\n      if (this._length < size) {\n        // noinspection AssignmentToFunctionParameterJS\n        size = this._length;\n      } //endregion\n      //region Initial variables\n\n\n      var result; //endregion\n      //region Getting result depends on \"backward\" flag\n\n      if (this.backward) {\n        var buffer = this._stream._buffer.slice(this._length - size, this._length);\n\n        var view = new Uint8Array(buffer);\n        result = new Array(size); // noinspection NonBlockStatementBodyJS\n\n        for (var i = 0; i < size; i++) {\n          result[size - 1 - i] = view[i];\n        }\n      } else {\n        var _buffer = this._stream._buffer.slice(this._start, this._start + size); // noinspection NestedFunctionCallJS\n\n\n        result = Array.from(new Uint8Array(_buffer));\n      } //endregion\n      //region Change \"length\" value if needed\n\n\n      if (changeLength) {\n        // noinspection ConditionalExpressionJS\n        this.start += this.backward ? -1 * size : size;\n      } //endregion\n\n\n      return result;\n    } //**********************************************************************************\n    // noinspection JSUnusedGlobalSymbols, FunctionWithMultipleReturnPointsJS, FunctionNamingConventionJS\n\n    /**\r\n     * Get 2-byte unsigned integer value\r\n     * @param {boolean} [changeLength=true] Should we change \"length\" and \"start\" value after reading the data block\r\n     * @returns {number}\r\n     */\n\n  }, {\n    key: \"getUint16\",\n    value: function getUint16() {\n      var changeLength = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : true;\n      var block = this.getBlock(2, changeLength); //region Check posibility for convertion\n      // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, NonBlockStatementBodyJS\n\n      if (block.length < 2) return 0; //endregion\n      //region Convert byte array to \"Uint16Array\" value\n\n      var value = new Uint16Array(1);\n      var view = new Uint8Array(value.buffer);\n      view[0] = block[1];\n      view[1] = block[0]; //endregion\n\n      return value[0];\n    } //**********************************************************************************\n    // noinspection JSUnusedGlobalSymbols, FunctionWithMultipleReturnPointsJS, FunctionNamingConventionJS\n\n    /**\r\n     * Get 2-byte signed integer value\r\n     * @param {boolean} [changeLength=true] Should we change \"length\" and \"start\" value after reading the data block\r\n     * @returns {number}\r\n     */\n\n  }, {\n    key: \"getInt16\",\n    value: function getInt16() {\n      var changeLength = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : true;\n      var block = this.getBlock(2, changeLength); //region Check posibility for convertion\n      // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, NonBlockStatementBodyJS\n\n      if (block.length < 2) return 0; //endregion\n      //region Convert byte array to \"Int16Array\" value\n\n      var value = new Int16Array(1);\n      var view = new Uint8Array(value.buffer);\n      view[0] = block[1];\n      view[1] = block[0]; //endregion\n\n      return value[0];\n    } //**********************************************************************************\n    // noinspection JSUnusedGlobalSymbols, FunctionWithMultipleReturnPointsJS, FunctionNamingConventionJS\n\n    /**\r\n     * Get 3-byte unsigned integer value\r\n     * @param {boolean} [changeLength=true] Should we change \"length\" and \"start\" value after reading the data block\r\n     * @returns {number}\r\n     */\n\n  }, {\n    key: \"getUint24\",\n    value: function getUint24() {\n      var changeLength = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : true;\n      var block = this.getBlock(3, changeLength); //region Check posibility for convertion\n      // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, NonBlockStatementBodyJS\n\n      if (block.length < 3) return 0; //endregion\n      //region Convert byte array to \"Uint32Array\" value\n\n      var value = new Uint32Array(1);\n      var view = new Uint8Array(value.buffer); // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, NonBlockStatementBodyJS\n\n      for (var i = 3; i >= 1; i--) {\n        view[3 - i] = block[i - 1];\n      } //endregion\n\n\n      return value[0];\n    } //**********************************************************************************\n    // noinspection JSUnusedGlobalSymbols, FunctionWithMultipleReturnPointsJS, FunctionNamingConventionJS\n\n    /**\r\n     * Get 4-byte unsigned integer value\r\n     * @param {boolean} [changeLength=true] Should we change \"length\" and \"start\" value after reading the data block\r\n     * @returns {number}\r\n     */\n\n  }, {\n    key: \"getUint32\",\n    value: function getUint32() {\n      var changeLength = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : true;\n      var block = this.getBlock(4, changeLength); //region Check posibility for convertion\n      // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, NonBlockStatementBodyJS\n\n      if (block.length < 4) return 0; //endregion\n      //region Convert byte array to \"Uint32Array\" value\n\n      var value = new Uint32Array(1);\n      var view = new Uint8Array(value.buffer); // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, NonBlockStatementBodyJS\n\n      for (var i = 3; i >= 0; i--) {\n        view[3 - i] = block[i];\n      } //endregion\n\n\n      return value[0];\n    } //**********************************************************************************\n\n    /**\r\n     * Get 4-byte signed integer value\r\n     * @param {boolean} [changeLength=true] Should we change \"length\" and \"start\" value after reading the data block\r\n     * @returns {number}\r\n     */\n\n  }, {\n    key: \"getInt32\",\n    value: function getInt32() {\n      var changeLength = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : true;\n      var block = this.getBlock(4, changeLength); //region Check posibility for convertion\n      // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, NonBlockStatementBodyJS\n\n      if (block.length < 4) return 0; //endregion\n      //region Convert byte array to \"Int32Array\" value\n\n      var value = new Int32Array(1);\n      var view = new Uint8Array(value.buffer); // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, NonBlockStatementBodyJS\n\n      for (var i = 3; i >= 0; i--) {\n        view[3 - i] = block[i];\n      } //endregion\n\n\n      return value[0];\n    } //**********************************************************************************\n\n  }]);\n\n  return SeqStream;\n}(); //**************************************************************************************\n// noinspection FunctionWithMultipleLoopsJS, FunctionWithMultipleReturnPointsJS, OverlyComplexFunctionJS, FunctionTooLongJS\n\n/**\r\n * Get parsed values from \"byte map\"\r\n * @param {ByteStream} stream Stream to parse data from\r\n * @param {Object} map Object with information how to parse \"byte map\"\r\n * @param {number} elements Number of elements in parsing byte map\r\n * @param {?number} [start=null] Start position to parse from\r\n * @param {?number} [length=null] Length of byte block to parse from\r\n * @returns {*}\r\n */\n\nexport function parseByteMap(stream, map, elements) {\n  var start = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : null;\n  var length = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : null;\n\n  /*\r\n   Map example:\r\n   \r\n   let map = [\r\n   {\r\n   type: \"string\",\r\n   name: \"type\",\r\n   minlength: 1,\r\n   maxlength: 1,\r\n   func: function(array)\r\n   {\r\n   let result = {\r\n   status: (-1),\r\n   length: 1\r\n   };\r\n   \r\n   switch(array[0])\r\n   {\r\n   case 0x6E: // \"n\"\r\n   result.value = \"n\";\r\n   break;\r\n   case 0x66: // \"f\"\r\n   result.value = \"f\";\r\n   break;\r\n   default:\r\n   return result;\r\n   }\r\n   \r\n   result.status = 1;\r\n   \r\n   return result;\r\n   }\r\n   },\r\n   {\r\n   type: \"check\",\r\n   minlength: 1,\r\n   maxlength: 2,\r\n   func: function(array)\r\n   {\r\n   let position = (-1);\r\n   \r\n   if(array[0] == 0x0A)\r\n   position = 1;\r\n   if(array[1] == 0x0A)\r\n   position = 2;\r\n   \r\n   return {\r\n   status: (position > 0) ? 1 : (-1),\r\n   length: position\r\n   };\r\n   }\r\n   }\r\n   ];\r\n   */\n  //region Initial variables\n  // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\n  if (start === null) {\n    // noinspection AssignmentToFunctionParameterJS\n    start = 0;\n  } // noinspection NonBlockStatementBodyJS\n\n\n  if (start > stream.buffer.byteLength - 1) return false; // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\n\n  if (length === null) {\n    // noinspection AssignmentToFunctionParameterJS\n    length = stream.buffer.byteLength - start;\n  }\n\n  if (length > stream.buffer.byteLength - start) {\n    // noinspection AssignmentToFunctionParameterJS\n    length = stream.buffer.byteLength - start;\n  }\n\n  var dataView; // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, EqualityComparisonWithCoercionJS, NonBlockStatementBodyJS\n\n  if (start == 0 && length == stream.buffer.byteLength) dataView = stream.view;else dataView = new Uint8Array(stream.buffer, start, length);\n  var resultArray = new Array(elements);\n  var elementsCount = 0;\n  var count = 0;\n  var mapLength = map.length; //endregion\n  //region Parse all byte, structure by structure\n\n  while (count < length) {\n    var structureLength = 0;\n    resultArray[elementsCount] = {};\n\n    for (var i = 0; i < mapLength; i++) {\n      // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, JSUnresolvedVariable, EqualityComparisonWithCoercionJS\n      if (map[i].maxlength == 0) {\n        // noinspection NonBlockStatementBodyJS\n        if (\"defaultValue\" in map[i]) resultArray[elementsCount][map[i].name] = map[i].defaultValue; // noinspection ContinueStatementJS\n\n        continue;\n      } // noinspection JSUnresolvedVariable\n\n\n      var array = new Array(map[i].maxlength); // noinspection JSUnresolvedVariable\n\n      for (var j = 0; j < map[i].maxlength; j++) {\n        // noinspection IncrementDecrementResultUsedJS\n        array[j] = dataView[count++];\n      } // noinspection JSUnresolvedVariable\n\n\n      var result = map[i].func(array); // noinspection EqualityComparisonWithCoercionJS, NonBlockStatementBodyJS\n\n      if (result.status == -1) {\n        // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, NonBlockStatementBodyJS, EqualityComparisonWithCoercionJS\n        if (resultArray.length == 1) return [];\n        return resultArray.slice(0, resultArray.length - 1);\n      } // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, EqualityComparisonWithCoercionJS, NonBlockStatementBodyJS\n\n\n      if (map[i].type != \"check\") resultArray[elementsCount][map[i].name] = result.value; // noinspection JSUnresolvedVariable\n\n      count -= map[i].maxlength - result.length;\n      structureLength += result.length;\n    } // noinspection IncrementDecrementResultUsedJS\n\n\n    resultArray[elementsCount++].structureLength = structureLength;\n  } //endregion\n\n\n  return resultArray;\n} //**************************************************************************************\n//region \"Bits-to-string\" array\n\nvar bitsToStringArray = [\"00000000\", \"00000001\", \"00000010\", \"00000011\", \"00000100\", \"00000101\", \"00000110\", \"00000111\", \"00001000\", \"00001001\", \"00001010\", \"00001011\", \"00001100\", \"00001101\", \"00001110\", \"00001111\", \"00010000\", \"00010001\", \"00010010\", \"00010011\", \"00010100\", \"00010101\", \"00010110\", \"00010111\", \"00011000\", \"00011001\", \"00011010\", \"00011011\", \"00011100\", \"00011101\", \"00011110\", \"00011111\", \"00100000\", \"00100001\", \"00100010\", \"00100011\", \"00100100\", \"00100101\", \"00100110\", \"00100111\", \"00101000\", \"00101001\", \"00101010\", \"00101011\", \"00101100\", \"00101101\", \"00101110\", \"00101111\", \"00110000\", \"00110001\", \"00110010\", \"00110011\", \"00110100\", \"00110101\", \"00110110\", \"00110111\", \"00111000\", \"00111001\", \"00111010\", \"00111011\", \"00111100\", \"00111101\", \"00111110\", \"00111111\", \"01000000\", \"01000001\", \"01000010\", \"01000011\", \"01000100\", \"01000101\", \"01000110\", \"01000111\", \"01001000\", \"01001001\", \"01001010\", \"01001011\", \"01001100\", \"01001101\", \"01001110\", \"01001111\", \"01010000\", \"01010001\", \"01010010\", \"01010011\", \"01010100\", \"01010101\", \"01010110\", \"01010111\", \"01011000\", \"01011001\", \"01011010\", \"01011011\", \"01011100\", \"01011101\", \"01011110\", \"01011111\", \"01100000\", \"01100001\", \"01100010\", \"01100011\", \"01100100\", \"01100101\", \"01100110\", \"01100111\", \"01101000\", \"01101001\", \"01101010\", \"01101011\", \"01101100\", \"01101101\", \"01101110\", \"01101111\", \"01110000\", \"01110001\", \"01110010\", \"01110011\", \"01110100\", \"01110101\", \"01110110\", \"01110111\", \"01111000\", \"01111001\", \"01111010\", \"01111011\", \"01111100\", \"01111101\", \"01111110\", \"01111111\", \"10000000\", \"10000001\", \"10000010\", \"10000011\", \"10000100\", \"10000101\", \"10000110\", \"10000111\", \"10001000\", \"10001001\", \"10001010\", \"10001011\", \"10001100\", \"10001101\", \"10001110\", \"10001111\", \"10010000\", \"10010001\", \"10010010\", \"10010011\", \"10010100\", \"10010101\", \"10010110\", \"10010111\", \"10011000\", \"10011001\", \"10011010\", \"10011011\", \"10011100\", \"10011101\", \"10011110\", \"10011111\", \"10100000\", \"10100001\", \"10100010\", \"10100011\", \"10100100\", \"10100101\", \"10100110\", \"10100111\", \"10101000\", \"10101001\", \"10101010\", \"10101011\", \"10101100\", \"10101101\", \"10101110\", \"10101111\", \"10110000\", \"10110001\", \"10110010\", \"10110011\", \"10110100\", \"10110101\", \"10110110\", \"10110111\", \"10111000\", \"10111001\", \"10111010\", \"10111011\", \"10111100\", \"10111101\", \"10111110\", \"10111111\", \"11000000\", \"11000001\", \"11000010\", \"11000011\", \"11000100\", \"11000101\", \"11000110\", \"11000111\", \"11001000\", \"11001001\", \"11001010\", \"11001011\", \"11001100\", \"11001101\", \"11001110\", \"11001111\", \"11010000\", \"11010001\", \"11010010\", \"11010011\", \"11010100\", \"11010101\", \"11010110\", \"11010111\", \"11011000\", \"11011001\", \"11011010\", \"11011011\", \"11011100\", \"11011101\", \"11011110\", \"11011111\", \"11100000\", \"11100001\", \"11100010\", \"11100011\", \"11100100\", \"11100101\", \"11100110\", \"11100111\", \"11101000\", \"11101001\", \"11101010\", \"11101011\", \"11101100\", \"11101101\", \"11101110\", \"11101111\", \"11110000\", \"11110001\", \"11110010\", \"11110011\", \"11110100\", \"11110101\", \"11110110\", \"11110111\", \"11111000\", \"11111001\", \"11111010\", \"11111011\", \"11111100\", \"11111101\", \"11111110\", \"11111111\"]; //endregion\n//**************************************************************************************\n\nexport var BitStream = /*#__PURE__*/function () {\n  //**********************************************************************************\n\n  /**\r\n   * Constructor for \"BitStream\" class\r\n   * @param {{[byteStream]: ByteStream, [view]: Uint8Array, [buffer]: ArrayBuffer, [string]: string, [bitsCount]: number}} parameters\r\n   */\n  function BitStream() {\n    var parameters = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n\n    _classCallCheck(this, BitStream);\n\n    this.buffer = new ArrayBuffer(0);\n    this.view = new Uint8Array(this.buffer);\n    this.bitsCount = 0; // Number of bits stored in current \"BitStream\"\n\n    for (var _i4 = 0, _Object$keys3 = Object.keys(parameters); _i4 < _Object$keys3.length; _i4++) {\n      var key = _Object$keys3[_i4];\n\n      switch (key) {\n        case \"byteStream\":\n          this.fromByteStream(parameters.byteStream);\n          break;\n\n        case \"view\":\n          this.fromUint8Array(parameters.view);\n          break;\n\n        case \"buffer\":\n          this.fromArrayBuffer(parameters.buffer);\n          break;\n\n        case \"string\":\n          this.fromString(parameters.string);\n          break;\n\n        case \"uint32\":\n          this.fromUint32(parameters.uint32);\n          break;\n\n        case \"bitsCount\":\n          this.bitsCount = parameters.bitsCount;\n          break;\n\n        default:\n      }\n    }\n  } //**********************************************************************************\n\n  /**\r\n   * Clear existing stream\r\n   */\n\n\n  _createClass(BitStream, [{\n    key: \"clear\",\n    value: function clear() {\n      this.buffer = new ArrayBuffer(0);\n      this.view = new Uint8Array(this.buffer);\n      this.bitsCount = 0;\n    } //**********************************************************************************\n\n    /**\r\n     * Initialize \"BitStream\" by data from existing \"ByteStream\"\r\n     * @param {ByteStream} stream\r\n     */\n\n  }, {\n    key: \"fromByteStream\",\n    value: function fromByteStream(stream) {\n      this.buffer = stream.buffer.slice(0);\n      this.view = new Uint8Array(this.buffer);\n      this.bitsCount = this.view.length << 3;\n    } //**********************************************************************************\n\n    /**\r\n     * Initialize \"BitStream\" object from existing \"ArrayBuffer\"\r\n     * @param {ArrayBuffer} array The ArrayBuffer to copy from\r\n     */\n\n  }, {\n    key: \"fromArrayBuffer\",\n    value: function fromArrayBuffer(array) {\n      this.buffer = array.slice(0);\n      this.view = new Uint8Array(this.buffer);\n      this.bitsCount = this.view.length << 3;\n    } //**********************************************************************************\n    // noinspection FunctionNamingConventionJS\n\n    /**\r\n     * Initialize \"BitStream\" object from existing \"Uint8Array\"\r\n     * @param {Uint8Array} array The Uint8Array to copy from\r\n     */\n\n  }, {\n    key: \"fromUint8Array\",\n    value: function fromUint8Array(array) {\n      this.buffer = new ArrayBuffer(array.length);\n      this.view = new Uint8Array(this.buffer);\n      this.view.set(array);\n      this.bitsCount = this.view.length << 3;\n    } //**********************************************************************************\n\n    /**\r\n     * Initialize \"BitStream\" object from existing bit string\r\n     * @param {string} string The string to initialize from\r\n     */\n\n  }, {\n    key: \"fromString\",\n    value: function fromString(string) {\n      //region Initial variables\n      var stringLength = string.length; // noinspection ConditionalExpressionJS\n\n      this.buffer = new ArrayBuffer((stringLength >> 3) + (stringLength % 8 ? 1 : 0));\n      this.view = new Uint8Array(this.buffer);\n      this.bitsCount = (stringLength >> 3) + 1 << 3; // In order to handle correct shifting\n\n      var byteIndex = 0; //endregion\n      //region Convert from \"bit string\" to bytes\n\n      for (var i = 0; i < stringLength; i++) {\n        // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, EqualityComparisonWithCoercionJS, NonBlockStatementBodyJS\n        if (string[i] == \"1\") this.view[byteIndex] |= 1 << 7 - i % 8; // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, EqualityComparisonWithCoercionJS, NonBlockStatementBodyJS\n\n        if (i && (i + 1) % 8 == 0) byteIndex++;\n      } //endregion\n      //region Shift \"BitStream\" into correct position\n      // noinspection NonBlockStatementBodyJS\n\n\n      if (stringLength % 8) this.shiftRight(8 - stringLength % 8); //endregion\n      //region Change \"bitsCount\"\n\n      this.bitsCount = stringLength; //endregion\n    } //**********************************************************************************\n\n    /**\r\n     * Initialize \"BitStream\" object from existing uint32 number\r\n     * @param {Number} number The string to initialize from\r\n     */\n\n  }, {\n    key: \"fromUint32\",\n    value: function fromUint32(uint32) {\n      this.buffer = new ArrayBuffer(4);\n      this.view = new Uint8Array(this.buffer);\n      var value = new Uint32Array([uint32]);\n      var view = new Uint8Array(value.buffer);\n\n      for (var i = 3; i >= 0; i--) {\n        this.view[i] = view[3 - i];\n      }\n\n      this.bitsCount = 32;\n    } //**********************************************************************************\n\n    /**\r\n     * Represent \"BitStream\" object content as a string\r\n     * @param {?number} [start=null] Start number to convert to string from\r\n     * @param {?number} [length=null] Length of BitStream to convert to string\r\n     * @returns {string}\r\n     */\n\n  }, {\n    key: \"toString\",\n    value: function toString() {\n      var start = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : null;\n      var length = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;\n\n      //region Check input parameters\n      // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\n      if (start == null) {\n        // noinspection AssignmentToFunctionParameterJS\n        start = 0;\n      } // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\n\n\n      if (start >= this.view.length || start < 0) {\n        // noinspection AssignmentToFunctionParameterJS\n        start = 0;\n      } // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\n\n\n      if (length == null) {\n        // noinspection AssignmentToFunctionParameterJS\n        length = this.view.length - start;\n      } // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\n\n\n      if (length >= this.view.length || length < 0) {\n        // noinspection AssignmentToFunctionParameterJS\n        length = this.view.length - start;\n      } //endregion\n      //region Initial variables\n\n\n      var result = []; //endregion\n      //region Convert from bytes to \"bit string\"\n      // noinspection NonBlockStatementBodyJS\n\n      for (var i = start; i < start + length; i++) {\n        result.push(bitsToStringArray[this.view[i]]);\n      } //endregion\n      // noinspection ChainedFunctionCallJS\n\n\n      return result.join(\"\").slice((this.view.length << 3) - this.bitsCount);\n    } //**********************************************************************************\n    // noinspection FunctionWithMultipleReturnPointsJS\n\n    /**\r\n     * Shift entire \"BitStream\" value right to number of bits\r\n     * @param {number} shift Number of bits to shift value\r\n     * @param {boolean} [needShrink=true] Need to shrink result or not\r\n     */\n\n  }, {\n    key: \"shiftRight\",\n    value: function shiftRight(shift) {\n      var needShrink = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : true;\n      //region Check parameters\n      // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, EqualityComparisonWithCoercionJS, NonBlockStatementBodyJS\n      if (this.view.length == 0) return; // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, NonBlockStatementBodyJS\n\n      if (shift < 0 || shift > 8) throw new Error(\"The \\\"shift\\\" parameter must be in range 0-8\"); // noinspection NonBlockStatementBodyJS\n\n      if (shift > this.bitsCount) throw new Error(\"The \\\"shift\\\" parameter can not be bigger than \\\"this.bitsCount\\\"\"); //endregion\n      //region Initial variables\n      // noinspection MagicNumberJS\n\n      var shiftMask = 0xFF >> 8 - shift;\n      this.view[this.view.length - 1] >>= shift; //endregion\n      //region Shift value\n      // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\n\n      for (var i = this.view.length - 2; i >= 0; i--) {\n        // noinspection NonShortCircuitBooleanExpressionJS\n        this.view[i + 1] |= (this.view[i] & shiftMask) << 8 - shift;\n        this.view[i] >>= shift;\n      } //endregion\n      //region Decrease number of bits stored into value\n\n\n      this.bitsCount -= shift; // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, EqualityComparisonWithCoercionJS, NonBlockStatementBodyJS\n\n      if (this.bitsCount == 0) this.clear(); //endregion\n      //region Change stream size if needed\n      // noinspection NonBlockStatementBodyJS\n\n      if (needShrink) this.shrink(); //endregion\n    } //**********************************************************************************\n    // noinspection JSUnusedGlobalSymbols, FunctionWithMultipleReturnPointsJS\n\n    /**\r\n     * Shift entire \"BitStream\" value left to number of bits\r\n     * @param {number} shift Number of bits to shift value\r\n     */\n\n  }, {\n    key: \"shiftLeft\",\n    value: function shiftLeft(shift) {\n      /*\r\n       NOTE: We do not really shift value because of internal structure of \"BitStream\":\r\n       all bytes inside \"BitStream\" are aligned to right position. So, even if we will\r\n       really shift value to left after that we will need again shift it right to the\r\n       same number of bits. Thus all that we do here is hiding of left bits and descresing\r\n       the \"bitsCount\" number.\r\n       */\n      //region Check parameters\n      // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, EqualityComparisonWithCoercionJS, NonBlockStatementBodyJS\n      if (this.view.length == 0) return; // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, NonBlockStatementBodyJS\n\n      if (shift < 0 || shift > 8) throw new Error(\"The \\\"shift\\\" parameter must be in range 0-8\"); // noinspection NonBlockStatementBodyJS\n\n      if (shift > this.bitsCount) throw new Error(\"The \\\"shift\\\" parameter can not be bigger than \\\"this.bitsCount\\\"\"); //endregion\n      //region Remove shifted bits\n      // noinspection MagicNumberJS, NonShortCircuitBooleanExpressionJS\n\n      var bitsOffset = this.bitsCount & 0x07;\n\n      if (bitsOffset > shift) {\n        // noinspection MagicNumberJS\n        this.view[0] &= 0xFF >> bitsOffset + shift;\n      } else {\n        //region Change size of buffer\n        var buffer = new ArrayBuffer(this.buffer.byteLength - 1);\n        var view = new Uint8Array(buffer); // noinspection NestedFunctionCallJS\n\n        view.set(new Uint8Array(this.buffer, 1, this.buffer.byteLength - 1)); //endregion\n        //region Mask item with index 0\n        // noinspection MagicNumberJS\n\n        view[0] &= 0xFF >> shift - bitsOffset; //endregion\n        //region Store final array into current stream\n\n        this.buffer = buffer.slice(0);\n        this.view = new Uint8Array(this.buffer); //endregion\n      } //endregion\n      //region Decrease number of bits stored into value\n\n\n      this.bitsCount -= shift; // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, EqualityComparisonWithCoercionJS, NonBlockStatementBodyJS\n\n      if (this.bitsCount == 0) this.clear(); //endregion\n    } //**********************************************************************************\n    // noinspection FunctionWithMultipleReturnPointsJS, FunctionTooLongJS\n\n    /**\r\n     * Return slice of existing \"BitStream\"\r\n     * @param {?number} [start=null] Start position of the slice (in bits)\r\n     * @param {?number} [end=null] End position of the slice (in bits)\r\n     * @returns {BitStream}\r\n     */\n\n  }, {\n    key: \"slice\",\n    value: function slice() {\n      var start = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : null;\n      var end = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;\n      //region Make ability to pass non-value bits\n      var valueShift = 0; // noinspection NonBlockStatementBodyJS\n\n      if (this.bitsCount % 8) valueShift = 8 - this.bitsCount % 8; // noinspection AssignmentToFunctionParameterJS\n\n      start += valueShift; // noinspection AssignmentToFunctionParameterJS\n\n      end += valueShift; //endregion\n      //region Initial variables\n      // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\n\n      if (start == null) {\n        // noinspection AssignmentToFunctionParameterJS\n        start = 0;\n      } // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, NonBlockStatementBodyJS\n\n\n      if (start < 0 || start > (this.view.length << 3) - 1) return new BitStream(); //(\"Wrong start position: \" + start);\n      // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\n\n      if (end == null) {\n        // noinspection AssignmentToFunctionParameterJS\n        end = (this.view.length << 3) - 1;\n      } // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, NonBlockStatementBodyJS\n\n\n      if (end < 0 || end > (this.view.length << 3) - 1) return new BitStream(); //(\"Wrong end position: \" + end);\n      // noinspection NonBlockStatementBodyJS\n\n      if (end - start + 1 > this.bitsCount) return new BitStream(); //(\"Maximum length is \" + this.bitsCount);\n\n      var startIndex = start >> 3; // noinspection MagicNumberJS, NonShortCircuitBooleanExpressionJS\n\n      var startOffset = start & 0x07;\n      var endIndex = end >> 3; // noinspection MagicNumberJS, NonShortCircuitBooleanExpressionJS\n\n      var endOffset = end & 0x07; // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, ConditionalExpressionJS, EqualityComparisonWithCoercionJS\n\n      var bitsLength = endIndex - startIndex == 0 ? 1 : endIndex - startIndex + 1;\n      var result = new BitStream(); //endregion\n      //region Store \"primary bytes\"\n\n      result.buffer = new ArrayBuffer(bitsLength);\n      result.view = new Uint8Array(result.buffer);\n      result.bitsCount = bitsLength << 3; // noinspection NestedFunctionCallJS\n\n      result.view.set(new Uint8Array(this.buffer, startIndex, bitsLength)); //endregion\n      //region Change \"start byte\"\n      // noinspection MagicNumberJS\n\n      result.view[0] &= 0xFF >> startOffset; //endregion\n      //region Change \"end byte\"\n      // noinspection MagicNumberJS\n\n      result.view[bitsLength] &= 0xFF << 7 - endOffset; //endregion\n      //region Shift result array to right\n      // noinspection NonBlockStatementBodyJS\n\n      if (7 - endOffset) result.shiftRight(7 - endOffset, false); //endregion\n      //region Set final number of bits\n\n      result.bitsCount = end - start + 1; //endregion\n      //region Cut unnecessary bytes from result\n\n      result.shrink(); //endregion\n\n      return result;\n    } //**********************************************************************************\n    // noinspection FunctionWithMultipleReturnPointsJS\n\n    /**\r\n     * Return copy of existing \"BitStream\"\r\n     * @param {?number} [start=null] Start position of the copy (in bits)\r\n     * @param {?number} [length=null] Length of the copy (in bits)\r\n     * @returns {BitStream}\r\n     */\n\n  }, {\n    key: \"copy\",\n    value: function copy() {\n      var start = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : null;\n      var length = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;\n      //region Check input parameters\n      // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, NonBlockStatementBodyJS\n      if (start < 0 || start > (this.view.length << 3) - 1) return new BitStream(); //(\"Wrong start position: \" + start);\n      // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\n\n      if (length === null) {\n        // noinspection AssignmentToFunctionParameterJS\n        length = (this.view.length << 3) - start - 1;\n      } // noinspection NonBlockStatementBodyJS\n\n\n      if (length > this.bitsCount) return new BitStream(); //(\"Maximum length is \" + this.bitsCount);\n      //endregion\n\n      return this.slice(start, start + length - 1);\n    } //**********************************************************************************\n\n    /**\r\n     * Shrink unnecessary bytes in current stream accordingly to \"bitsCount\" value\r\n     */\n\n  }, {\n    key: \"shrink\",\n    value: function shrink() {\n      // noinspection ConditionalExpressionJS\n      var currentLength = (this.bitsCount >> 3) + (this.bitsCount % 8 ? 1 : 0);\n\n      if (currentLength < this.buffer.byteLength) {\n        //region Change size of buffer\n        var buffer = new ArrayBuffer(currentLength);\n        var view = new Uint8Array(buffer); // noinspection NestedFunctionCallJS\n\n        view.set(new Uint8Array(this.buffer, this.buffer.byteLength - currentLength, currentLength)); //endregion\n        //region Store final array into current stream\n\n        this.buffer = buffer.slice(0);\n        this.view = new Uint8Array(this.buffer); //endregion\n      }\n    } //**********************************************************************************\n    // noinspection JSUnusedGlobalSymbols\n\n    /**\r\n     * Reverse bits order in each byte in the stream\r\n     * Got it from here: http://graphics.stanford.edu/~seander/bithacks.html#ReverseByteWith32Bits\r\n     */\n\n  }, {\n    key: \"reverseBytes\",\n    value: function reverseBytes() {\n      //region Reverse bits order in each byte in the stream\n      for (var i = 0; i < this.view.length; i++) {\n        // noinspection MagicNumberJS, NonShortCircuitBooleanExpressionJS\n        this.view[i] = (this.view[i] * 0x0802 & 0x22110 | this.view[i] * 0x8020 & 0x88440) * 0x10101 >> 16;\n      } //endregion\n      //region Shift \"most significant\" byte\n\n\n      if (this.bitsCount % 8) {\n        // noinspection ConditionalExpressionJS\n        var currentLength = (this.bitsCount >> 3) + (this.bitsCount % 8 ? 1 : 0); // noinspection MagicNumberJS, NonShortCircuitBooleanExpressionJS\n\n        this.view[this.view.length - currentLength] >>= 8 - (this.bitsCount & 0x07);\n      } //endregion\n\n    } //**********************************************************************************\n    // noinspection JSUnusedGlobalSymbols\n\n    /**\r\n     * Reverse all bits in entire \"BitStream\"\r\n     */\n\n  }, {\n    key: \"reverseValue\",\n    value: function reverseValue() {\n      var initialValue = this.toString();\n      var initialValueLength = initialValue.length;\n      var reversedValue = new Array(initialValueLength); // noinspection NonBlockStatementBodyJS\n\n      for (var i = 0; i < initialValueLength; i++) {\n        reversedValue[initialValueLength - 1 - i] = initialValue[i];\n      } // noinspection NestedFunctionCallJS\n\n\n      this.fromString(reversedValue.join(\"\"));\n    } //**********************************************************************************\n    // noinspection JSUnusedGlobalSymbols, FunctionWithMultipleReturnPointsJS\n\n    /**\r\n     * Trying to represent entire \"BitStream\" as an unsigned integer.\r\n     * @return {number}\r\n     */\n\n  }, {\n    key: \"getNumberValue\",\n    value: function getNumberValue() {\n      //region Initial variables\n      var byteLength = this.buffer.byteLength - 1; //endregion\n      //region Check posibility for convertion\n      // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, NonBlockStatementBodyJS\n\n      if (byteLength > 3) return -1; // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, EqualityComparisonWithCoercionJS, NonBlockStatementBodyJS\n\n      if (byteLength == -1) return 0; //endregion\n      //region Convert byte array to \"Uint32Array\" value\n\n      var value = new Uint32Array(1);\n      var view = new Uint8Array(value.buffer); // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, NonBlockStatementBodyJS\n\n      for (var i = byteLength; i >= 0; i--) {\n        view[byteLength - i] = this.view[i];\n      } //endregion\n\n\n      return value[0];\n    } //**********************************************************************************\n    // noinspection JSUnusedGlobalSymbols\n\n    /**\r\n     * Find any bit pattern in \"BitStream\"\r\n     * @param {BitStream} pattern Stream having pattern value\r\n     * @param {?number} [start=null] Start position to search from\r\n     * @param {?number} [length=null] Length of byte block to search at\r\n     * @param {boolean} [backward=false] Flag to search in backward order\r\n     * @returns {number}\r\n     */\n\n  }, {\n    key: \"findPattern\",\n    value: function findPattern(pattern) {\n      var start = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;\n      var length = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;\n      var backward = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : false;\n      //region Convert \"BitStream\" values to \"ByteStream\"\n      var stringStream = new ByteStream({\n        string: this.toString()\n      });\n      var stringPattern = new ByteStream({\n        string: pattern.toString()\n      }); //endregion\n\n      return stringStream.findPattern(stringPattern, start, length, backward);\n    } //**********************************************************************************\n    // noinspection JSUnusedGlobalSymbols\n\n    /**\r\n     * Find first position of any pattern from input array\r\n     * @param {Array.<BitStream>} patterns Array with patterns which should be found\r\n     * @param {?number} [start=null] Start position to search from\r\n     * @param {?number} [length=null] Length of byte block to search at\r\n     * @param {boolean} [backward=false] Flag to search in backward order\r\n     * @returns {{id: number, position: number}}\r\n     */\n\n  }, {\n    key: \"findFirstIn\",\n    value: function findFirstIn(patterns) {\n      var start = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;\n      var length = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;\n      var backward = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : false;\n      //region Convert \"BitStream\" values to \"ByteStream\"\n      var stringStream = new ByteStream({\n        string: this.toString()\n      });\n      var stringPatterns = new Array(patterns.length);\n\n      for (var i = 0; i < patterns.length; i++) {\n        stringPatterns[i] = new ByteStream({\n          string: patterns[i].toString()\n        });\n      } //endregion\n\n\n      return stringStream.findFirstIn(stringPatterns, start, length, backward);\n    } //**********************************************************************************\n    // noinspection JSUnusedGlobalSymbols\n\n    /**\r\n     * Find all positions of any pattern from input array\r\n     * @param {Array.<BitStream>} patterns Array with patterns which should be found\r\n     * @param {?number} [start=null] Start position to search from\r\n     * @param {?number} [length=null] Length of byte block to search at\r\n     * @returns {Array}\r\n     */\n\n  }, {\n    key: \"findAllIn\",\n    value: function findAllIn(patterns) {\n      var start = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;\n      var length = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;\n      //region Convert \"BitStream\" values to \"ByteStream\"\n      var stringStream = new ByteStream({\n        string: this.toString()\n      });\n      var stringPatterns = new Array(patterns.length);\n\n      for (var i = 0; i < patterns.length; i++) {\n        stringPatterns[i] = new ByteStream({\n          string: patterns[i].toString()\n        });\n      } //endregion\n\n\n      return stringStream.findAllIn(stringPatterns, start, length);\n    } //**********************************************************************************\n    // noinspection JSUnusedGlobalSymbols\n\n    /**\r\n     * Find all positions of a pattern\r\n     * @param {BitStream} pattern Stream having pattern value\r\n     * @param {?number} [start=null] Start position to search from\r\n     * @param {?number} [length=null] Length of byte block to search at\r\n     * @returns {Array|number}\r\n     */\n\n  }, {\n    key: \"findAllPatternIn\",\n    value: function findAllPatternIn(pattern) {\n      var start = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;\n      var length = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;\n      //region Convert \"BitStream\" values to \"ByteStream\" \n      var stringStream = new ByteStream({\n        string: this.toString()\n      });\n      var stringPattern = new ByteStream({\n        string: pattern.toString()\n      }); //endregion \n\n      return stringStream.findAllPatternIn(stringPattern, start, length);\n    } //**********************************************************************************\n    // noinspection JSUnusedGlobalSymbols\n\n    /**\r\n     * Find first position of data, not included in patterns from input array\r\n     * @param {Array.<BitStream>} patterns Array with patterns which should be found\r\n     * @param {?number} [start=null] Start position to search from\r\n     * @param {?number} [length=null] Length of byte block to search at\r\n     * @param {boolean} [backward=false] Flag to search in backward order\r\n     * @returns {{left: {id: number, position: *}, right: {id: number, position: number}, value: ByteStream}}\r\n     */\n\n  }, {\n    key: \"findFirstNotIn\",\n    value: function findFirstNotIn(patterns) {\n      var start = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;\n      var length = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;\n      var backward = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : false;\n      //region Convert \"BitStream\" values to \"ByteStream\"\n      var stringStream = new ByteStream({\n        string: this.toString()\n      });\n      var stringPatterns = new Array(patterns.length);\n\n      for (var i = 0; i < patterns.length; i++) {\n        stringPatterns[i] = new ByteStream({\n          string: patterns[i].toString()\n        });\n      } //endregion\n\n\n      return stringStream.findFirstNotIn(stringPatterns, start, length, backward);\n    } //**********************************************************************************\n    // noinspection JSUnusedGlobalSymbols\n\n    /**\r\n     * Find all positions of data, not included in patterns from input array\r\n     * @param {Array.<BitStream>} patterns Array with patterns which should be found\r\n     * @param {?number} [start=null] Start position to search from\r\n     * @param {?number} [length=null] Length of byte block to search at\r\n     * @returns {Array}\r\n     */\n\n  }, {\n    key: \"findAllNotIn\",\n    value: function findAllNotIn(patterns) {\n      var start = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;\n      var length = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;\n      //region Convert \"BitStream\" values to \"ByteStream\"\n      var stringStream = new ByteStream({\n        string: this.toString()\n      });\n      var stringPatterns = new Array(patterns.length);\n\n      for (var i = 0; i < patterns.length; i++) {\n        stringPatterns[i] = new ByteStream({\n          string: patterns[i].toString()\n        });\n      } //endregion\n\n\n      return stringStream.findAllNotIn(stringPatterns, start, length);\n    } //**********************************************************************************\n    // noinspection JSUnusedGlobalSymbols\n\n    /**\r\n     * Find position of a sequence of any patterns from input array\r\n     * @param {Array.<BitStream>} patterns Array with patterns which should be found\r\n     * @param {?number} [start=null] Start position to search from\r\n     * @param {?number} [length=null] Length of byte block to search at\r\n     * @param {boolean} [backward=false] Flag to search in backward order\r\n     * @returns {{position, value}|*}\r\n     */\n\n  }, {\n    key: \"findFirstSequence\",\n    value: function findFirstSequence(patterns) {\n      var start = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;\n      var length = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;\n      var backward = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : false;\n      //region Convert \"BitStream\" values to \"ByteStream\"\n      var stringStream = new ByteStream({\n        string: this.toString()\n      });\n      var stringPatterns = new Array(patterns.length);\n\n      for (var i = 0; i < patterns.length; i++) {\n        stringPatterns[i] = new ByteStream({\n          string: patterns[i].toString()\n        });\n      } //endregion\n\n\n      return stringStream.findFirstSequence(stringPatterns, start, length, backward);\n    } //**********************************************************************************\n    // noinspection JSUnusedGlobalSymbols\n\n    /**\r\n     * Find position of a sequence of any patterns from input array\r\n     * @param {Array.<BitStream>} patterns Array with patterns which should be found\r\n     * @param {?number} [start=null] Start position to search from\r\n     * @param {?number} [length=null] Length of byte block to search at\r\n     * @returns {Array}\r\n     */\n\n  }, {\n    key: \"findAllSequences\",\n    value: function findAllSequences(patterns, start, length) {\n      //region Convert \"BitStream\" values to \"ByteStream\"\n      var stringStream = new ByteStream({\n        string: this.toString()\n      });\n      var stringPatterns = new Array(patterns.length);\n\n      for (var i = 0; i < patterns.length; i++) {\n        stringPatterns[i] = new ByteStream({\n          string: patterns[i].toString()\n        });\n      } //endregion\n\n\n      return stringStream.findAllSequences(stringPatterns, start, length);\n    } //**********************************************************************************\n    // noinspection JSUnusedGlobalSymbols\n\n    /**\r\n     * Find all paired patterns in the stream\r\n     * @param {BitStream} leftPattern Left pattern to search for\r\n     * @param {BitStream} rightPattern Right pattern to search for\r\n     * @param {?number} [start=null] Start position to search from\r\n     * @param {?number} [length=null] Length of byte block to search at\r\n     * @returns {Array}\r\n     */\n\n  }, {\n    key: \"findPairedPatterns\",\n    value: function findPairedPatterns(leftPattern, rightPattern) {\n      var start = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;\n      var length = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : null;\n      //region Convert \"BitStream\" values to \"ByteStream\"\n      var stringStream = new ByteStream({\n        string: this.toString()\n      });\n      var stringLeftPattern = new ByteStream({\n        string: leftPattern.toString()\n      });\n      var stringRightPattern = new ByteStream({\n        string: rightPattern.toString()\n      }); //endregion\n\n      return stringStream.findPairedPatterns(stringLeftPattern, stringRightPattern, start, length);\n    } //**********************************************************************************\n    // noinspection JSUnusedGlobalSymbols, FunctionWithMultipleLoopsJS\n\n    /**\r\n     * Find all paired patterns in the stream\r\n     * @param {Array.<BitStream>} inputLeftPatterns Array of left patterns to search for\r\n     * @param {Array.<BitStream>} inputRightPatterns Array of right patterns to search for\r\n     * @param {?number} [start=null] Start position to search from\r\n     * @param {?number} [length=null] Length of byte block to search at\r\n     * @returns {Array}\r\n     */\n\n  }, {\n    key: \"findPairedArrays\",\n    value: function findPairedArrays(inputLeftPatterns, inputRightPatterns) {\n      var start = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;\n      var length = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : null;\n      //region Convert \"BitStream\" values to \"ByteStream\"\n      var stringStream = new ByteStream({\n        string: this.toString()\n      });\n      var stringLeftPatterns = new Array(inputLeftPatterns.length);\n\n      for (var i = 0; i < inputLeftPatterns.length; i++) {\n        stringLeftPatterns[i] = new ByteStream({\n          string: inputLeftPatterns[i].toString()\n        });\n      }\n\n      var stringRightPatterns = new Array(inputRightPatterns.length);\n\n      for (var _i5 = 0; _i5 < inputRightPatterns.length; _i5++) {\n        stringRightPatterns[_i5] = new ByteStream({\n          string: inputRightPatterns[_i5].toString()\n        });\n      } //endregion\n\n\n      return stringStream.findPairedArrays(stringLeftPatterns, stringRightPatterns, start, length);\n    } //**********************************************************************************\n    // noinspection JSUnusedGlobalSymbols, FunctionWithMultipleReturnPointsJS\n\n    /**\r\n     * Replace one pattern with other\r\n     * @param {BitStream} searchPattern The pattern to search for\r\n     * @param {BitStream} replacePattern The pattern to replace initial pattern\r\n     * @param {?number} [start=null] Start position to search from\r\n     * @param {?number} [length=null] Length of byte block to search at\r\n     * @returns {boolean}\r\n     */\n\n  }, {\n    key: \"replacePattern\",\n    value: function replacePattern(searchPattern, _replacePattern3) {\n      var start = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;\n      var length = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : null;\n      //region Convert \"BitStream\" values to \"ByteStream\"\n      var stringStream = new ByteStream({\n        string: this.toString()\n      });\n      var stringSearchPattern = new ByteStream({\n        string: searchPattern.toString()\n      });\n      var stringReplacePattern = new ByteStream({\n        string: _replacePattern3.toString()\n      }); //endregion\n      //region Re-initialize existing data\n\n      if (stringStream.findPairedPatterns(stringSearchPattern, stringReplacePattern, start, length)) {\n        // noinspection NestedFunctionCallJS\n        this.fromString(stringStream.toString());\n        return true;\n      } //endregion\n\n\n      return false;\n    } //**********************************************************************************\n    // noinspection JSUnusedGlobalSymbols\n\n    /**\r\n     * Skip any pattern from input array\r\n     * @param {Array.<BitStream>} patterns Array with patterns which should be ommited\r\n     * @param {?number} [start=null] Start position to search from\r\n     * @param {?number} [length=null] Length of byte block to search at\r\n     * @param {boolean} [backward=false] Flag to search in backward order\r\n     * @returns {*}\r\n     */\n\n  }, {\n    key: \"skipPatterns\",\n    value: function skipPatterns(patterns, start, length, backward) {\n      //region Convert \"BitStream\" values to \"ByteStream\"\n      var stringStream = new ByteStream({\n        string: this.toString()\n      });\n      var stringPatterns = new Array(patterns.length);\n\n      for (var i = 0; i < patterns.length; i++) {\n        stringPatterns[i] = new ByteStream({\n          string: patterns[i].toString()\n        });\n      } //endregion\n\n\n      return stringStream.skipPatterns(stringPatterns, start, length, backward);\n    } //**********************************************************************************\n    // noinspection JSUnusedGlobalSymbols\n\n    /**\r\n     * Skip any pattern not from input array\r\n     * @param {Array.<BitStream>} patterns Array with patterns which should be ommited\r\n     * @param {?number} [start=null] Start position to search from\r\n     * @param {?number} [length=null] Length of byte block to search at\r\n     * @param {boolean} [backward=false] Flag to search in backward order\r\n     * @returns {number}\r\n     */\n\n  }, {\n    key: \"skipNotPatterns\",\n    value: function skipNotPatterns(patterns, start, length, backward) {\n      //region Convert \"BitStream\" values to \"ByteStream\"\n      var stringStream = new ByteStream({\n        string: this.toString()\n      });\n      var stringPatterns = new Array(patterns.length);\n\n      for (var i = 0; i < patterns.length; i++) {\n        stringPatterns[i] = new ByteStream({\n          string: patterns[i].toString()\n        });\n      } //endregion\n\n\n      return stringStream.skipNotPatterns(stringPatterns, start, length, backward);\n    } //**********************************************************************************\n    // noinspection JSUnusedGlobalSymbols\n\n    /**\r\n     * Append a new \"BitStream\" content to the current \"BitStream\"\r\n     * @param {BitStream} stream A new \"stream\" to append to current \"stream\"\r\n     */\n\n  }, {\n    key: \"append\",\n    value: function append(stream) {\n      //region Initialize current stream with new data\n      // noinspection NestedFunctionCallJS\n      this.fromString([this.toString(), stream.toString()].join(\"\")); //endregion\n    } //**********************************************************************************\n\n  }]);\n\n  return BitStream;\n}(); //**************************************************************************************\n\nexport var SeqBitStream = /*#__PURE__*/function () {\n  //**********************************************************************************\n  function SeqBitStream() {\n    var parameters = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n\n    _classCallCheck(this, SeqBitStream);\n\n    //region Internal variables\n    this.stream = new BitStream();\n    this._start = 0;\n    this._length = this.stream.bitsCount;\n    this.backward = false;\n    this.appendBlock = 0; //endregion\n\n    for (var _i6 = 0, _Object$keys4 = Object.keys(parameters); _i6 < _Object$keys4.length; _i6++) {\n      var key = _Object$keys4[_i6];\n\n      switch (key) {\n        case \"stream\":\n        case \"start\":\n        case \"length\":\n        case \"backward\":\n        case \"appendBlock\":\n          this[key] = parameters[key];\n          break;\n\n        default:\n      }\n    }\n  } //**********************************************************************************\n  // noinspection FunctionWithMultipleReturnPointsJS\n\n\n  _createClass(SeqBitStream, [{\n    key: \"start\",\n    get: //**********************************************************************************\n    function get() {\n      return this._start;\n    } //**********************************************************************************\n    // noinspection FunctionWithMultipleReturnPointsJS\n    ,\n    set: function set(value) {\n      // noinspection NonBlockStatementBodyJS\n      if (value > this.stream.bitsCount) return; // noinspection ConditionalExpressionJS\n\n      this._length -= this.backward ? this._start - value : value - this._start;\n      this._start = value; //region Initialization of \"prev\" internal variables\n      // noinspection JSUnusedGlobalSymbols\n\n      this.prevStart = this._start; // noinspection JSUnusedGlobalSymbols\n\n      this.prevLength = this._length; //endregion\n    }\n  }, {\n    key: \"length\",\n    get: //**********************************************************************************\n    function get() {\n      return this._length;\n    } //**********************************************************************************\n    ,\n    set: function set(value) {\n      // noinspection NonBlockStatementBodyJS\n      if (value > this.stream.bitsCount) return; // noinspection JSUnusedGlobalSymbols\n\n      this.prevLength = this._length;\n      this._length = value;\n    }\n  }, {\n    key: \"stream\",\n    get: //**********************************************************************************\n    function get() {\n      return this._stream;\n    } //**********************************************************************************\n    // noinspection JSUnusedGlobalSymbols\n\n    /**\r\n     * Get next \"length\" bits from the stream\r\n     * @param {number} length Number of bits to read\r\n     * @returns {*}\r\n     */\n    ,\n    set: function set(value) {\n      this._stream = value; // noinspection JSUnusedGlobalSymbols\n\n      this.prevLength = this._length;\n      this._length = value.bitsCount; // noinspection JSUnusedGlobalSymbols\n\n      this.prevStart = this._start; // noinspection ConditionalExpressionJS\n\n      this._start = this.backward ? this.length : 0;\n    }\n  }, {\n    key: \"getBits\",\n    value: function getBits(length) {\n      //region Check input parameters \n      if (this.start + length > this.stream.bitsCount) {\n        // noinspection AssignmentToFunctionParameterJS\n        length = this.stream.bitsCount - this.start;\n      } //endregion \n      //region Initial variables \n\n\n      var result; //endregion \n      //region Copy necessary length of bits\n\n      if (this.backward) {\n        result = this.stream.copy(this.start - length, length);\n        this.start -= result.bitsCount;\n      } else {\n        result = this.stream.copy(this.start, length);\n        this.start += result.bitsCount;\n      } //endregion\n\n\n      return result;\n    } //**********************************************************************************\n    // noinspection FunctionTooLongJS\n\n    /**\r\n     * Get string representation for the next \"length\" bits from the stream\r\n     * @param {number} length Number of bits to read\r\n     * @returns {string}\r\n     */\n\n  }, {\n    key: \"getBitsString\",\n    value: function getBitsString(length) {\n      //region Check input parameters\n      if (this.start + length > this.stream.bitsCount) {\n        // noinspection AssignmentToFunctionParameterJS\n        length = this.stream.bitsCount - this.start;\n      } //endregion\n      //region Initial variables\n\n\n      var result = [];\n      var start; // noinspection NonBlockStatementBodyJS\n\n      if (this.backward) start = this.start - length;else start = this.start;\n      var end = this.start + length - 1; //region Make ability to pass non-value bits\n\n      var valueShift = 0; // noinspection NonBlockStatementBodyJS\n\n      if (this.stream.bitsCount % 8) valueShift = 8 - this.stream.bitsCount % 8;\n      start += valueShift;\n      end += valueShift; //endregion\n\n      var startIndex = start >> 3; // noinspection MagicNumberJS, NonShortCircuitBooleanExpressionJS\n\n      var startOffset = start & 0x07;\n      var endIndex = end >> 3; // noinspection MagicNumberJS, NonShortCircuitBooleanExpressionJS\n\n      var endOffset = end & 0x07; // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, ConditionalExpressionJS, EqualityComparisonWithCoercionJS\n\n      var bitsLengthIndex = startIndex + (endIndex - startIndex == 0 ? 1 : endIndex - startIndex + 1); //endregion\n      //region Get string representation of bits\n\n      for (var i = startIndex; i < bitsLengthIndex; i++) {\n        var value = bitsToStringArray[this.stream.view[i]]; // noinspection EqualityComparisonWithCoercionJS, NonBlockStatementBodyJS\n\n        if (i == startIndex) value = value.slice(startOffset); // noinspection EqualityComparisonWithCoercionJS, NonBlockStatementBodyJS\n\n        if (i == bitsLengthIndex - 1) value = value.slice(0, endOffset - 7 + value.length);\n        result.push(value);\n      }\n\n      result = result.join(\"\"); //endregion\n      //region Change internal values\n      // noinspection NonBlockStatementBodyJS\n\n      if (this.backward) this.start -= result.length;else this.start += result.length; //endregion\n\n      return result;\n    } //**********************************************************************************\n    // noinspection JSUnusedGlobalSymbols, FunctionWithMultipleLoopsJS, FunctionWithMultipleReturnPointsJS\n\n    /**\r\n     * Get number value representation of the next \"length\" bits from the stream, preliminary reversed\r\n     * @param {number} length Number of bits to read\r\n     * @returns {*}\r\n     */\n\n  }, {\n    key: \"getBitsReversedValue\",\n    value: function getBitsReversedValue(length) {\n      //region Initial variables \n      var initialValue = this.getBitsString(length);\n      var initialValueLength = initialValue.length;\n      var byteIndex;\n      var initialOffset = 8 - initialValueLength % 8;\n      var reversedValue = new Array(initialValueLength);\n      var value = new Uint32Array(1);\n      var valueView = new Uint8Array(value.buffer, 0, 4);\n      var i; // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, MagicNumberJS, NonBlockStatementBodyJS\n\n      if (initialValueLength > 32) return -1; // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, MagicNumberJS, EqualityComparisonWithCoercionJS, NonBlockStatementBodyJS\n\n      if (length == 32) byteIndex = 3;else byteIndex = initialValueLength - 1 >> 3; //endregion\n      //region Reverse value \n      // noinspection NonBlockStatementBodyJS\n\n      for (i = 0; i < initialValueLength; i++) {\n        reversedValue[initialValueLength - 1 - i] = initialValue[i];\n      } //endregion \n      //region Convert byte array to \"Uint32Array\" value \n\n\n      for (i = initialOffset; i < initialOffset + initialValueLength; i++) {\n        // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, EqualityComparisonWithCoercionJS\n        if (reversedValue[i - initialOffset] == \"1\") {\n          // noinspection MagicNumberJS\n          valueView[byteIndex] |= 0x01 << 7 - i % 8;\n        } // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, EqualityComparisonWithCoercionJS, NonBlockStatementBodyJS\n\n\n        if (i && (i + 1) % 8 == 0) byteIndex--;\n      } //endregion \n\n\n      return value[0];\n    } //**********************************************************************************\n\n    /**\r\n     * Represent remaining bits in \"BitStream\" as a string\r\n     * @return {string}\r\n     */\n\n  }, {\n    key: \"toString\",\n    value: function toString() {\n      var streamToDisplay = this.stream.copy(this.start, this.length);\n      return streamToDisplay.toString();\n    } //**********************************************************************************\n\n  }]);\n\n  return SeqBitStream;\n}(); //**************************************************************************************","map":{"version":3,"sources":["C:/Users/rkanthet/Documents/test_window_object/node_modules/bytestreamjs/src/bytestream.js"],"names":["ByteStream","parameters","clear","Object","keys","key","length","i","_view","stub","fromUint8Array","view","fromArrayBuffer","buffer","fromString","string","fromHexString","hexstring","_buffer","value","slice","Uint8Array","ArrayBuffer","set","byteLength","array","stringLength","charCodeAt","start","result","String","fromCharCode","hexString","hexMap","Map","j","temp","get","charAt","str","toString","toUpperCase","Error","stream","end","size","initialSize","streamViewLength","copyView","realloc","pattern","backward","patternLength","patternArray","push","equal","equalStart","patterns","id","position","findPattern","valid","patternFound","findFirstIn","Array","from","left","right","currentLength","findFirstNotIn","firstIn","skipNotPatterns","firstNotIn","skipPatterns","findFirstSequence","leftPattern","rightPattern","isEqual","currentPositionLeft","leftPatterns","findAllPatternIn","rightPatterns","splice","sort","a","b","inputLeftPatterns","inputRightPatterns","findAllIn","searchPattern","replacePattern","findAllResult","output","status","searchPatternPositions","replacePatternPositions","element","patternDifference","changedBuffer","changedView","currentPosition","k","SeqStream","_length","_start","appendBlock","prevLength","prevStart","_stream","gap","findAllNotIn","findAllSequences","findPairedPatterns","findPairedArrays","char","number","Uint16Array","Uint32Array","changeLength","block","getBlock","Int16Array","Int32Array","parseByteMap","map","elements","dataView","resultArray","elementsCount","count","mapLength","structureLength","maxlength","name","defaultValue","func","type","bitsToStringArray","BitStream","bitsCount","fromByteStream","byteStream","fromUint32","uint32","byteIndex","shiftRight","join","shift","needShrink","shiftMask","shrink","bitsOffset","valueShift","startIndex","startOffset","endIndex","endOffset","bitsLength","initialValue","initialValueLength","reversedValue","stringStream","stringPattern","stringPatterns","stringLeftPattern","stringRightPattern","stringLeftPatterns","stringRightPatterns","stringSearchPattern","stringReplacePattern","SeqBitStream","copy","bitsLengthIndex","getBitsString","initialOffset","valueView","streamToDisplay"],"mappings":"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","sourcesContent":["/*\r\n * Copyright (c) 2016-2018, Peculiar Ventures\r\n * All rights reserved.\r\n *\r\n * Author 2016-2018, Yury Strozhevsky <www.strozhevsky.com>.\r\n *\r\n */\r\n//**************************************************************************************\r\nexport class ByteStream\r\n{\r\n\t//**********************************************************************************\r\n\t// noinspection FunctionWithMultipleLoopsJS\r\n\t/**\r\n\t * Constructor for ByteStream class\r\n\t * @param {{[length]: number, [stub]: number, [view]: Uint8Array, [buffer]: ArrayBuffer, [string]: string, [hexstring]: string}} parameters\r\n\t */\r\n\tconstructor(parameters = {})\r\n\t{\r\n\t\tthis.clear();\r\n\t\t\r\n\t\tfor(const key of Object.keys(parameters))\r\n\t\t{\r\n\t\t\tswitch(key)\r\n\t\t\t{\r\n\t\t\t\tcase \"length\":\r\n\t\t\t\t\tthis.length = parameters.length;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"stub\":\r\n\t\t\t\t\t// noinspection NonBlockStatementBodyJS\r\n\t\t\t\t\tfor(let i = 0; i < this._view.length; i++)\r\n\t\t\t\t\t\tthis._view[i] = parameters.stub;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"view\":\r\n\t\t\t\t\tthis.fromUint8Array(parameters.view);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"buffer\":\r\n\t\t\t\t\tthis.fromArrayBuffer(parameters.buffer);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"string\":\r\n\t\t\t\t\tthis.fromString(parameters.string);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"hexstring\":\r\n\t\t\t\t\tthis.fromHexString(parameters.hexstring);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t//**********************************************************************************\r\n\t/**\r\n\t * Setter for \"buffer\"\r\n\t * @param {ArrayBuffer} value\r\n\t */\r\n\tset buffer(value)\r\n\t{\r\n\t\tthis._buffer = value.slice(0);\r\n\t\tthis._view = new Uint8Array(this._buffer);\r\n\t}\r\n\t//**********************************************************************************\r\n\t/**\r\n\t * Getter for \"buffer\"\r\n\t * @returns {ArrayBuffer}\r\n\t */\r\n\tget buffer()\r\n\t{\r\n\t\treturn this._buffer;\r\n\t}\r\n\t//**********************************************************************************\r\n\t/**\r\n\t * Setter for \"view\"\r\n\t * @param {Uint8Array} value\r\n\t */\r\n\tset view(value)\r\n\t{\r\n\t\tthis._buffer = new ArrayBuffer(value.length);\r\n\t\tthis._view = new Uint8Array(this._buffer);\r\n\t\t\r\n\t\tthis._view.set(value);\r\n\t}\r\n\t//**********************************************************************************\r\n\t/**\r\n\t * Getter for \"view\"\r\n\t * @returns {Uint8Array}\r\n\t */\r\n\tget view()\r\n\t{\r\n\t\treturn this._view;\r\n\t}\r\n\t//**********************************************************************************\r\n\t/**\r\n\t * Getter for \"length\"\r\n\t * @returns {number}\r\n\t */\r\n\tget length()\r\n\t{\r\n\t\treturn this._buffer.byteLength;\r\n\t}\r\n\t//**********************************************************************************\r\n\t/**\r\n\t * Setter for \"length\"\r\n\t * @param {number} value\r\n\t */\r\n\tset length(value)\r\n\t{\r\n\t\tthis._buffer = new ArrayBuffer(value);\r\n\t\tthis._view = new Uint8Array(this._buffer);\r\n\t}\r\n\t//**********************************************************************************\r\n\t/**\r\n\t * Clear existing stream\r\n\t */\r\n\tclear()\r\n\t{\r\n\t\tthis._buffer = new ArrayBuffer(0);\r\n\t\tthis._view = new Uint8Array(this._buffer);\r\n\t}\r\n\t//**********************************************************************************\r\n\t/**\r\n\t * Initialize \"Stream\" object from existing \"ArrayBuffer\"\r\n\t * @param {!ArrayBuffer} array The ArrayBuffer to copy from\r\n\t */\r\n\tfromArrayBuffer(array)\r\n\t{\r\n\t\tthis.buffer = array;\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection FunctionNamingConventionJS\r\n\t/**\r\n\t * Initialize \"Stream\" object from existing \"Uint8Array\"\r\n\t * @param {!Uint8Array} array The Uint8Array to copy from\r\n\t */\r\n\tfromUint8Array(array)\r\n\t{\r\n\t\tthis._buffer = new ArrayBuffer(array.length);\r\n\t\tthis._view = new Uint8Array(this._buffer);\r\n\t\t\r\n\t\tthis._view.set(array);\r\n\t}\r\n\t//**********************************************************************************\r\n\t/**\r\n\t * Initialize \"Stream\" object from existing string\r\n\t * @param {string} string The string to initialize from\r\n\t */\r\n\tfromString(string)\r\n\t{\r\n\t\tconst stringLength = string.length;\r\n\t\t\r\n\t\tthis.length = stringLength;\r\n\t\t\r\n\t\t// noinspection NonBlockStatementBodyJS\r\n\t\tfor(let i = 0; i < stringLength; i++)\r\n\t\t\tthis.view[i] = string.charCodeAt(i);\r\n\t}\r\n\t//**********************************************************************************\r\n\t/**\r\n\t * Represent \"Stream\" object content as a string\r\n\t * @param {number} [start] Start position to convert to string\r\n\t * @param {number} [length] Length of array to convert to string\r\n\t * @returns {string}\r\n\t */\r\n\ttoString(start = 0, length = (this.view.length - start))\r\n\t{\r\n\t\t//region Initial variables\r\n\t\tlet result = \"\";\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Check input parameters\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\tif((start >= this.view.length) || (start < 0))\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tstart = 0;\r\n\t\t}\r\n\t\t\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\tif((length >= this.view.length) || (length < 0))\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tlength = this.view.length - start;\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Convert array of bytes to string\r\n\t\t// noinspection NonBlockStatementBodyJS\r\n\t\tfor(let i = start; i < (start + length); i++)\r\n\t\t\tresult += String.fromCharCode(this.view[i]);\r\n\t\t//endregion\r\n\t\t\r\n\t\treturn result;\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection FunctionTooLongJS\r\n\t/**\r\n\t * Initialize \"Stream\" object from existing hexdecimal string\r\n\t * @param {string} hexString String to initialize from\r\n\t */\r\n\tfromHexString(hexString)\r\n\t{\r\n\t\t//region Initial variables\r\n\t\tconst stringLength = hexString.length;\r\n\t\t\r\n\t\tthis.buffer = new ArrayBuffer(stringLength >> 1);\r\n\t\tthis.view = new Uint8Array(this.buffer);\r\n\t\t\r\n\t\tconst hexMap = new Map();\r\n\t\t\r\n\t\t// noinspection MagicNumberJS\r\n\t\thexMap.set(\"0\", 0x00);\r\n\t\t// noinspection MagicNumberJS\r\n\t\thexMap.set(\"1\", 0x01);\r\n\t\t// noinspection MagicNumberJS\r\n\t\thexMap.set(\"2\", 0x02);\r\n\t\t// noinspection MagicNumberJS\r\n\t\thexMap.set(\"3\", 0x03);\r\n\t\t// noinspection MagicNumberJS\r\n\t\thexMap.set(\"4\", 0x04);\r\n\t\t// noinspection MagicNumberJS\r\n\t\thexMap.set(\"5\", 0x05);\r\n\t\t// noinspection MagicNumberJS\r\n\t\thexMap.set(\"6\", 0x06);\r\n\t\t// noinspection MagicNumberJS\r\n\t\thexMap.set(\"7\", 0x07);\r\n\t\t// noinspection MagicNumberJS\r\n\t\thexMap.set(\"8\", 0x08);\r\n\t\t// noinspection MagicNumberJS\r\n\t\thexMap.set(\"9\", 0x09);\r\n\t\t// noinspection MagicNumberJS\r\n\t\thexMap.set(\"A\", 0x0A);\r\n\t\t// noinspection MagicNumberJS\r\n\t\thexMap.set(\"a\", 0x0A);\r\n\t\t// noinspection MagicNumberJS\r\n\t\thexMap.set(\"B\", 0x0B);\r\n\t\t// noinspection MagicNumberJS\r\n\t\thexMap.set(\"b\", 0x0B);\r\n\t\t// noinspection MagicNumberJS\r\n\t\thexMap.set(\"C\", 0x0C);\r\n\t\t// noinspection MagicNumberJS\r\n\t\thexMap.set(\"c\", 0x0C);\r\n\t\t// noinspection MagicNumberJS\r\n\t\thexMap.set(\"D\", 0x0D);\r\n\t\t// noinspection MagicNumberJS\r\n\t\thexMap.set(\"d\", 0x0D);\r\n\t\t// noinspection MagicNumberJS\r\n\t\thexMap.set(\"E\", 0x0E);\r\n\t\t// noinspection MagicNumberJS\r\n\t\thexMap.set(\"e\", 0x0E);\r\n\t\t// noinspection MagicNumberJS\r\n\t\thexMap.set(\"F\", 0x0F);\r\n\t\t// noinspection MagicNumberJS\r\n\t\thexMap.set(\"f\", 0x0F);\r\n\t\t\r\n\t\tlet j = 0;\r\n\t\t// noinspection MagicNumberJS\r\n\t\tlet temp = 0x00;\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Convert char-by-char\r\n\t\tfor(let i = 0; i < stringLength; i++)\r\n\t\t{\r\n\t\t\t// noinspection NegatedIfStatementJS\r\n\t\t\tif(!(i % 2))\r\n\t\t\t{\r\n\t\t\t\t// noinspection NestedFunctionCallJS\r\n\t\t\t\ttemp = hexMap.get(hexString.charAt(i)) << 4;\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\t// noinspection NestedFunctionCallJS\r\n\t\t\t\ttemp |= hexMap.get(hexString.charAt(i));\r\n\t\t\t\t\r\n\t\t\t\tthis.view[j] = temp;\r\n\t\t\t\tj++;\r\n\t\t\t}\r\n\t\t}\r\n\t\t//endregion\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection JSUnusedGlobalSymbols\r\n\t/**\r\n\t * Represent \"Stream\" object content as a hexdecimal string\r\n\t * @param {number} [start=0] Start position to convert to string\r\n\t * @param {number} [length=(this.view.length - start)] Length of array to convert to string\r\n\t * @returns {string}\r\n\t */\r\n\ttoHexString(start = 0, length = (this.view.length - start))\r\n\t{\r\n\t\t//region Initial variables\r\n\t\tlet result = \"\";\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Check input parameters\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\tif((start >= this.view.length) || (start < 0))\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tstart = 0;\r\n\t\t}\r\n\t\t\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\tif((length >= this.view.length) || (length < 0))\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tlength = this.view.length - start;\r\n\t\t}\r\n\t\t//endregion\r\n\r\n\t\tfor(let i = start; i < (start + length); i++)\r\n\t\t{\r\n\t\t\t// noinspection ChainedFunctionCallJS\r\n\t\t\tconst str = this.view[i].toString(16).toUpperCase();\r\n\t\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, ConditionalExpressionJS, EqualityComparisonWithCoercionJS\r\n\t\t\tresult = result + ((str.length == 1) ? \"0\" : \"\") + str;\r\n\t\t}\r\n\t\t\r\n\t\treturn result;\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection FunctionWithMultipleReturnPointsJS\r\n\t/**\r\n\t * Return copy of existing \"Stream\"\r\n\t * @param {number} [start=0] Start position of the copy\r\n\t * @param {number} [length=this.view.length] Length of the copy\r\n\t * @returns {ByteStream}\r\n\t */\r\n\tcopy(start = 0, length = (this._buffer.byteLength - start))\r\n\t{\r\n\t\t//region Check input parameters\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, NonBlockStatementBodyJS\r\n\t\tif((start === 0) && (this._buffer.byteLength === 0))\r\n\t\t\treturn new ByteStream();\r\n\t\t\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, NonBlockStatementBodyJS\r\n\t\tif((start < 0) || (start > (this._buffer.byteLength - 1)))\r\n\t\t\tthrow new Error(`Wrong start position: ${start}`);\r\n\t\t//endregion\r\n\t\t\r\n\t\tconst stream = new ByteStream();\r\n\t\t\r\n\t\tstream._buffer = this._buffer.slice(start, start + length);\r\n\t\tstream._view = new Uint8Array(stream._buffer);\r\n\t\t\r\n\t\treturn stream;\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection JSUnusedGlobalSymbols, FunctionWithMultipleReturnPointsJS\r\n\t/**\r\n\t * Return slice of existing \"Stream\"\r\n\t * @param {number} [start=0] Start position of the slice\r\n\t * @param {number} [end=this._buffer.byteLength] End position of the slice\r\n\t * @returns {ByteStream}\r\n\t */\r\n\tslice(start = 0, end = this._buffer.byteLength)\r\n\t{\r\n\t\t//region Check input parameters\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, NonBlockStatementBodyJS\r\n\t\tif((start === 0) && (this._buffer.byteLength === 0))\r\n\t\t\treturn new ByteStream();\r\n\t\t\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, NonBlockStatementBodyJS\r\n\t\tif((start < 0) || (start > (this._buffer.byteLength - 1)))\r\n\t\t\tthrow new Error(`Wrong start position: ${start}`);\r\n\t\t//endregion\r\n\t\t\r\n\t\tconst stream = new ByteStream();\r\n\t\t\r\n\t\tstream._buffer = this._buffer.slice(start, end);\r\n\t\tstream._view = new Uint8Array(stream._buffer);\r\n\t\t\r\n\t\treturn stream;\r\n\t}\r\n\t//**********************************************************************************\r\n\t/**\r\n\t * Change size of existing \"Stream\"\r\n\t * @param {!number} size Size for new \"Stream\"\r\n\t */\r\n\trealloc(size)\r\n\t{\r\n\t\t//region Initial variables\r\n\t\tconst buffer = new ArrayBuffer(size);\r\n\t\tconst view = new Uint8Array(buffer);\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Create a new ArrayBuffer content\r\n\t\t// noinspection NonBlockStatementBodyJS\r\n\t\tif(size > this._view.length)\r\n\t\t\tview.set(this._view);\r\n\t\telse\r\n\t\t{\r\n\t\t\t// noinspection NestedFunctionCallJS\r\n\t\t\tview.set(new Uint8Array(this._buffer, 0, size));\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Initialize \"Stream\" with new \"ArrayBuffer\"\r\n\t\tthis._buffer = buffer.slice(0);\r\n\t\tthis._view = new Uint8Array(this._buffer);\r\n\t\t//endregion\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection JSUnusedGlobalSymbols\r\n\t/**\r\n\t * Append a new \"Stream\" content to the current \"Stream\"\r\n\t * @param {ByteStream} stream A new \"stream\" to append to current \"stream\"\r\n\t */\r\n\tappend(stream)\r\n\t{\r\n\t\t//region Initial variables\r\n\t\tconst initialSize = this._buffer.byteLength;\r\n\t\tconst streamViewLength = stream._buffer.byteLength;\r\n\t\t\r\n\t\tconst copyView = stream._view.slice();\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Re-allocate current internal buffer\r\n\t\tthis.realloc(initialSize + streamViewLength);\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Copy input stream content to a new place\r\n\t\tthis._view.set(copyView, initialSize);\r\n\t\t//endregion\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection JSUnusedGlobalSymbols, FunctionWithMultipleReturnPointsJS\r\n\t/**\r\n\t * Insert \"Stream\" content to the current \"Stream\" at specific position\r\n\t * @param {ByteStream} stream A new \"stream\" to insert to current \"stream\"\r\n\t * @param {number} [start=0] Start position to insert to\r\n\t * @param {number} [length]\r\n\t * @returns {boolean}\r\n\t */\r\n\tinsert(stream, start = 0, length = (this._buffer.byteLength - start))\r\n\t{\r\n\t\t//region Initial variables\r\n\t\t// noinspection NonBlockStatementBodyJS\r\n\t\tif(start > (this._buffer.byteLength - 1))\r\n\t\t\treturn false;\r\n\t\t\r\n\t\tif(length > (this._buffer.byteLength - start))\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tlength = this._buffer.byteLength - start;\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Check input variables\r\n\t\tif(length > stream._buffer.byteLength)\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tlength = stream._buffer.byteLength;\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Update content of the current stream\r\n\t\t// noinspection NonBlockStatementBodyJS, EqualityComparisonWithCoercionJS\r\n\t\tif(length == stream._buffer.byteLength)\r\n\t\t\tthis._view.set(stream._view, start);\r\n\t\telse\r\n\t\t{\r\n\t\t\t// noinspection NestedFunctionCallJS\r\n\t\t\tthis._view.set(stream._view.slice(0, length), start);\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\treturn true;\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection FunctionWithMultipleReturnPointsJS\r\n\t/**\r\n\t * Check that two \"Stream\" objects has equal content\r\n\t * @param {ByteStream} stream Stream to compare with\r\n\t * @returns {boolean}\r\n\t */\r\n\tisEqual(stream)\r\n\t{\r\n\t\t//region Check length of both buffers\r\n\t\t// noinspection NonBlockStatementBodyJS, EqualityComparisonWithCoercionJS\r\n\t\tif(this._buffer.byteLength != stream._buffer.byteLength)\r\n\t\t\treturn false;\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Compare each byte of both buffers\r\n\t\tfor(let i = 0; i < stream._buffer.byteLength; i++)\r\n\t\t{\r\n\t\t\t// noinspection NonBlockStatementBodyJS, EqualityComparisonWithCoercionJS\r\n\t\t\tif(this.view[i] != stream.view[i])\r\n\t\t\t\treturn false;\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\treturn true;\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection JSUnusedGlobalSymbols, FunctionWithMultipleReturnPointsJS\r\n\t/**\r\n\t * Check that current \"Stream\" objects has equal content with input \"Uint8Array\"\r\n\t * @param {Uint8Array} view View to compare with\r\n\t * @returns {boolean}\r\n\t */\r\n\tisEqualView(view)\r\n\t{\r\n\t\t//region Check length of both buffers\r\n\t\t// noinspection NonBlockStatementBodyJS, EqualityComparisonWithCoercionJS\r\n\t\tif(view.length != this.view.length)\r\n\t\t\treturn false;\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Compare each byte of both buffers\r\n\t\tfor(let i = 0; i < view.length; i++)\r\n\t\t{\r\n\t\t\t// noinspection NonBlockStatementBodyJS, EqualityComparisonWithCoercionJS\r\n\t\t\tif(this.view[i] != view[i])\r\n\t\t\t\treturn false;\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\treturn true;\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection JSUnusedGlobalSymbols, FunctionWithMultipleLoopsJS, FunctionWithMultipleReturnPointsJS, OverlyComplexFunctionJS, FunctionTooLongJS\r\n\t/**\r\n\t * Find any byte pattern in \"Stream\"\r\n\t * @param {ByteStream} pattern Stream having pattern value\r\n\t * @param {?number} [start] Start position to search from\r\n\t * @param {?number} [length] Length of byte block to search at\r\n\t * @param {boolean} [backward] Flag to search in backward order\r\n\t * @returns {number}\r\n\t */\r\n\tfindPattern(pattern, start = null, length = null, backward = false)\r\n\t{\r\n\t\t//region Check input variables\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\tif(start == null)\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS, ConditionalExpressionJS\r\n\t\t\tstart = (backward) ? this.buffer.byteLength : 0;\r\n\t\t}\r\n\t\t\r\n\t\tif(start > this.buffer.byteLength)\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tstart = this.buffer.byteLength;\r\n\t\t}\r\n\t\t\r\n\t\tif(backward)\r\n\t\t{\r\n\t\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\t\tif(length == null)\r\n\t\t\t{\r\n\t\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\t\tlength = start;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif(length > start)\r\n\t\t\t{\r\n\t\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\t\tlength = start;\r\n\t\t\t}\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\t\tif(length == null)\r\n\t\t\t{\r\n\t\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\t\tlength = this.buffer.byteLength - start;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif(length > (this.buffer.byteLength - start))\r\n\t\t\t{\r\n\t\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\t\tlength = this.buffer.byteLength - start;\r\n\t\t\t}\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Initial variables\r\n\t\tconst patternLength = pattern.buffer.byteLength;\r\n\t\t// noinspection NonBlockStatementBodyJS\r\n\t\tif(patternLength > length)\r\n\t\t\treturn (-1);\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Make a \"pre-read\" array for pattern\r\n\t\tconst patternArray = [];\r\n\t\t// noinspection NonBlockStatementBodyJS\r\n\t\tfor(let i = 0; i < patternLength; i++)\r\n\t\t\tpatternArray.push(pattern.view[i]);\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Search for pattern\r\n\t\tfor(let i = 0; i <= (length - patternLength); i++)\r\n\t\t{\r\n\t\t\tlet equal = true;\r\n\t\t\t// noinspection ConditionalExpressionJS\r\n\t\t\tconst equalStart = (backward) ? (start - patternLength - i) : (start + i);\r\n\t\t\t\r\n\t\t\tfor(let j = 0; j < patternLength; j++)\r\n\t\t\t{\r\n\t\t\t\t// noinspection EqualityComparisonWithCoercionJS\r\n\t\t\t\tif(this.view[j + equalStart] != patternArray[j])\r\n\t\t\t\t{\r\n\t\t\t\t\tequal = false;\r\n\t\t\t\t\t// noinspection BreakStatementJS\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif(equal)\r\n\t\t\t{\r\n\t\t\t\t// noinspection ConditionalExpressionJS\r\n\t\t\t\treturn (backward) ? (start - patternLength - i) : (start + patternLength + i); // Position after the pattern found\r\n\t\t\t}\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\treturn (-1);\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection OverlyComplexFunctionJS\r\n\t/**\r\n\t * Find first position of any pattern from input array\r\n\t * @param {Array.<ByteStream>} patterns Array with patterns which should be found\r\n\t * @param {?number} [start] Start position to search from\r\n\t * @param {?number} [length] Length of byte block to search at\r\n\t * @param {boolean} [backward=false] Flag to search in backward order\r\n\t * @returns {{id: number, position: number}}\r\n\t */\r\n\tfindFirstIn(patterns, start = null, length = null, backward = false)\r\n\t{\r\n\t\t//region Initial variables\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\tif(start == null)\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS, ConditionalExpressionJS\r\n\t\t\tstart = (backward) ? this.buffer.byteLength : 0;\r\n\t\t}\r\n\t\t\r\n\t\tif(start > this.buffer.byteLength)\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tstart = this.buffer.byteLength;\r\n\t\t}\r\n\t\t\r\n\t\tif(backward)\r\n\t\t{\r\n\t\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\t\tif(length == null)\r\n\t\t\t{\r\n\t\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\t\tlength = start;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif(length > start)\r\n\t\t\t{\r\n\t\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\t\tlength = start;\r\n\t\t\t}\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\t\tif(length == null)\r\n\t\t\t{\r\n\t\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\t\tlength = this.buffer.byteLength - start;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif(length > (this.buffer.byteLength - start))\r\n\t\t\t{\r\n\t\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\t\tlength = this.buffer.byteLength - start;\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\t// noinspection ConditionalExpressionJS\r\n\t\tconst result = {\r\n\t\t\tid: (-1),\r\n\t\t\tposition: (backward) ? 0 : (start + length),\r\n\t\t\tlength: 0\r\n\t\t};\r\n\t\t//endregion\r\n\t\t\r\n\t\tfor(let i = 0; i < patterns.length; i++)\r\n\t\t{\r\n\t\t\tconst position = this.findPattern(patterns[i], start, length, backward);\r\n\t\t\t// noinspection EqualityComparisonWithCoercionJS\r\n\t\t\tif(position != (-1))\r\n\t\t\t{\r\n\t\t\t\tlet valid = false;\r\n\t\t\t\tconst patternLength = patterns[i].length;\r\n\r\n\t\t\t\tif(backward)\r\n\t\t\t\t{\r\n\t\t\t\t\t// noinspection NonBlockStatementBodyJS\r\n\t\t\t\t\tif((position - patternLength) >= (result.position - result.length))\r\n\t\t\t\t\t\tvalid = true;\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\t// noinspection NonBlockStatementBodyJS\r\n\t\t\t\t\tif((position - patternLength) <= (result.position - result.length))\r\n\t\t\t\t\t\tvalid = true;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tif(valid)\r\n\t\t\t\t{\r\n\t\t\t\t\tresult.position = position;\r\n\t\t\t\t\tresult.id = i;\r\n\t\t\t\t\tresult.length = patternLength;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\treturn result;\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection FunctionWithMultipleReturnPointsJS\r\n\t/**\r\n\t * Find all positions of any pattern from input array\r\n\t * @param {Array.<ByteStream>} patterns Array with patterns which should be found\r\n\t * @param {?number} [start] Start position to search from\r\n\t * @param {?number} [length] Length of byte block to search at\r\n\t * @returns {Array}\r\n\t */\r\n\tfindAllIn(patterns, start = 0, length = (this.buffer.byteLength - start))\r\n\t{\r\n\t\t//region Initial variables\r\n\t\tconst result = [];\r\n\t\t\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\tif(start == null)\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tstart = 0;\r\n\t\t}\r\n\t\t\r\n\t\t// noinspection NonBlockStatementBodyJS\r\n\t\tif(start > (this.buffer.byteLength - 1))\r\n\t\t\treturn result;\r\n\t\t\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\tif(length == null)\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tlength = this.buffer.byteLength - start;\r\n\t\t}\r\n\r\n\t\tif(length > (this.buffer.byteLength - start))\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tlength = this.buffer.byteLength - start;\r\n\t\t}\r\n\t\t\r\n\t\tlet patternFound = {\r\n\t\t\tid: (-1),\r\n\t\t\tposition: start\r\n\t\t};\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Find all accurences of patterns\r\n\t\tdo\r\n\t\t{\r\n\t\t\tconst position = patternFound.position;\r\n\t\t\t\r\n\t\t\tpatternFound = this.findFirstIn(patterns, patternFound.position, length);\r\n\t\t\t\r\n\t\t\t// noinspection EqualityComparisonWithCoercionJS\r\n\t\t\tif(patternFound.id == (-1))\r\n\t\t\t{\r\n\t\t\t\t// noinspection BreakStatementJS\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tlength -= (patternFound.position - position);\r\n\t\t\t\r\n\t\t\tresult.push({\r\n\t\t\t\tid: patternFound.id,\r\n\t\t\t\tposition: patternFound.position\r\n\t\t\t});\r\n\t\t} while(true); // eslint-disable-line\r\n\t\t//endregion\r\n\t\t\r\n\t\treturn result;\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection FunctionWithMultipleLoopsJS, FunctionWithMultipleReturnPointsJS\r\n\t/**\r\n\t * Find all positions of a pattern\r\n\t * @param {ByteStream} pattern Stream having pattern value\r\n\t * @param {?number} [start] Start position to search from\r\n\t * @param {?number} [length] Length of byte block to search at\r\n\t * @returns {Array|number} Array with all pattern positions or (-1) if failed\r\n\t */\r\n\tfindAllPatternIn(pattern, start = 0, length = (this.buffer.byteLength - start))\r\n\t{\r\n\t\t//region Check input variables\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\tif(start == null)\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tstart = 0;\r\n\t\t}\r\n\t\t\r\n\t\tif(start > this.buffer.byteLength)\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tstart = this.buffer.byteLength;\r\n\t\t}\r\n\t\t\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\tif(length == null)\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tlength = this.buffer.byteLength - start;\r\n\t\t}\r\n\t\t\r\n\t\tif(length > (this.buffer.byteLength - start))\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tlength = this.buffer.byteLength - start;\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Initial variables\r\n\t\tconst result = [];\r\n\t\t\r\n\t\tconst patternLength = pattern.buffer.byteLength;\r\n\t\t// noinspection NonBlockStatementBodyJS\r\n\t\tif(patternLength > length)\r\n\t\t\treturn (-1);\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Make a \"pre-read\" array for pattern\r\n\t\tconst patternArray = Array.from(pattern.view);\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Search for pattern\r\n\t\tfor(let i = 0; i <= (length - patternLength); i++)\r\n\t\t{\r\n\t\t\tlet equal = true;\r\n\t\t\tconst equalStart = start + i;\r\n\t\t\t\r\n\t\t\tfor(let j = 0; j < patternLength; j++)\r\n\t\t\t{\r\n\t\t\t\t// noinspection EqualityComparisonWithCoercionJS\r\n\t\t\t\tif(this.view[j + equalStart] != patternArray[j])\r\n\t\t\t\t{\r\n\t\t\t\t\tequal = false;\r\n\t\t\t\t\t// noinspection BreakStatementJS\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif(equal)\r\n\t\t\t{\r\n\t\t\t\tresult.push(start + patternLength + i); // Position after the pattern found\r\n\t\t\t\ti += (patternLength - 1); // On next step of \"for\" we will have \"i++\"\r\n\t\t\t}\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\treturn result;\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection OverlyComplexFunctionJS, FunctionTooLongJS\r\n\t/**\r\n\t * Find first position of data, not included in patterns from input array\r\n\t * @param {Array.<ByteStream>} patterns Array with patterns which should be ommited\r\n\t * @param {?number} [start] Start position to search from\r\n\t * @param {?number} [length] Length of byte block to search at\r\n\t * @param {boolean} [backward=false] Flag to search in backward order\r\n\t * @returns {{left: {id: number, position: *}, right: {id: number, position: number}, value: ByteStream}}\r\n\t */\r\n\tfindFirstNotIn(patterns, start = null, length = null, backward = false)\r\n\t{\r\n\t\t//region Initial variables\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\tif(start == null)\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS, ConditionalExpressionJS\r\n\t\t\tstart = (backward) ? this.buffer.byteLength : 0;\r\n\t\t}\r\n\t\t\r\n\t\tif(start > this.buffer.byteLength)\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tstart = this.buffer.byteLength;\r\n\t\t}\r\n\t\t\r\n\t\tif(backward)\r\n\t\t{\r\n\t\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\t\tif(length == null)\r\n\t\t\t{\r\n\t\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\t\tlength = start;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif(length > start)\r\n\t\t\t{\r\n\t\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\t\tlength = start;\r\n\t\t\t}\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\t\tif(length == null)\r\n\t\t\t{\r\n\t\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\t\tlength = this.buffer.byteLength - start;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif(length > (this.buffer.byteLength - start))\r\n\t\t\t{\r\n\t\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\t\tlength = this.buffer.byteLength - start;\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tconst result = {\r\n\t\t\tleft: {\r\n\t\t\t\tid: (-1),\r\n\t\t\t\tposition: start\r\n\t\t\t},\r\n\t\t\tright: {\r\n\t\t\t\tid: (-1),\r\n\t\t\t\tposition: 0\r\n\t\t\t},\r\n\t\t\tvalue: new ByteStream()\r\n\t\t};\r\n\t\t\r\n\t\tlet currentLength = length;\r\n\t\t//endregion\r\n\t\t\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\twhile(currentLength > 0)\r\n\t\t{\r\n\t\t\t//region Search for nearest \"pattern\"\r\n\t\t\t// noinspection ConditionalExpressionJS\r\n\t\t\tresult.right = this.findFirstIn(patterns,\r\n\t\t\t\t(backward) ? (start - length + currentLength) : (start + length - currentLength),\r\n\t\t\t\tcurrentLength,\r\n\t\t\t\tbackward);\r\n\t\t\t//endregion\r\n\t\t\t\r\n\t\t\t//region No pattern at all\r\n\t\t\t// noinspection EqualityComparisonWithCoercionJS\r\n\t\t\tif(result.right.id == (-1))\r\n\t\t\t{\r\n\t\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\t\tlength = currentLength;\r\n\t\t\t\t\r\n\t\t\t\tif(backward)\r\n\t\t\t\t{\r\n\t\t\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\t\t\tstart -= length;\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\t\t\tstart = result.left.position;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tresult.value = new ByteStream();\r\n\t\t\t\t\r\n\t\t\t\tresult.value._buffer = this._buffer.slice(start, start + length);\r\n\t\t\t\tresult.value._view = new Uint8Array(result.value._buffer);\r\n\t\t\t\t\r\n\t\t\t\t// noinspection BreakStatementJS\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\t//endregion\r\n\t\t\t\r\n\t\t\t//region Check distance between two patterns\r\n\t\t\t// noinspection ConditionalExpressionJS, EqualityComparisonWithCoercionJS\r\n\t\t\tif(result.right.position != ((backward) ? (result.left.position - patterns[result.right.id].buffer.byteLength) : (result.left.position + patterns[result.right.id].buffer.byteLength)))\r\n\t\t\t{\r\n\t\t\t\tif(backward)\r\n\t\t\t\t{\r\n\t\t\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\t\t\tstart = result.right.position + patterns[result.right.id].buffer.byteLength;\r\n\t\t\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\t\t\tlength = result.left.position - result.right.position - patterns[result.right.id].buffer.byteLength;\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\t\t\tstart = result.left.position;\r\n\t\t\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\t\t\tlength = result.right.position - result.left.position - patterns[result.right.id].buffer.byteLength;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tresult.value = new ByteStream();\r\n\t\t\t\t\r\n\t\t\t\tresult.value._buffer = this._buffer.slice(start, start + length);\r\n\t\t\t\tresult.value._view = new Uint8Array(result.value._buffer);\r\n\t\t\t\t\r\n\t\t\t\t// noinspection BreakStatementJS\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\t//endregion\r\n\t\t\t\r\n\t\t\t//region Store information about previous pattern\r\n\t\t\tresult.left = result.right;\r\n\t\t\t//endregion\r\n\t\t\t\r\n\t\t\t//region Change current length\r\n\t\t\tcurrentLength -= patterns[result.right.id]._buffer.byteLength;\r\n\t\t\t//endregion\r\n\t\t}\r\n\t\t\r\n\t\t//region Swap \"patterns\" in case of backward order\r\n\t\tif(backward)\r\n\t\t{\r\n\t\t\tconst temp = result.right;\r\n\t\t\tresult.right = result.left;\r\n\t\t\tresult.left = temp;\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\treturn result;\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection FunctionWithMultipleReturnPointsJS\r\n\t/**\r\n\t * Find all positions of data, not included in patterns from input array\r\n\t * @param {Array.<ByteStream>} patterns Array with patterns which should be ommited\r\n\t * @param {?number} [start] Start position to search from\r\n\t * @param {?number} [length] Length of byte block to search at\r\n\t * @returns {Array}\r\n\t */\r\n\tfindAllNotIn(patterns, start = null, length = null)\r\n\t{\r\n\t\t//region Initial variables\r\n\t\tconst result = [];\r\n\t\t\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\tif(start == null)\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tstart = 0;\r\n\t\t}\r\n\t\t\r\n\t\t// noinspection NonBlockStatementBodyJS\r\n\t\tif(start > (this.buffer.byteLength - 1))\r\n\t\t\treturn result;\r\n\t\t\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\tif(length == null)\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tlength = this.buffer.byteLength - start;\r\n\t\t}\r\n\t\t\r\n\t\tif(length > (this.buffer.byteLength - start))\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tlength = this.buffer.byteLength - start;\r\n\t\t}\r\n\t\t\r\n\t\tlet patternFound = {\r\n\t\t\tleft: {\r\n\t\t\t\tid: (-1),\r\n\t\t\t\tposition: start\r\n\t\t\t},\r\n\t\t\tright: {\r\n\t\t\t\tid: (-1),\r\n\t\t\t\tposition: start\r\n\t\t\t},\r\n\t\t\tvalue: new ByteStream()\r\n\t\t};\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Find all accurences of patterns\r\n\t\t// noinspection EqualityComparisonWithCoercionJS\r\n\t\tdo\r\n\t\t{\r\n\t\t\tconst position = patternFound.right.position;\r\n\t\t\t\r\n\t\t\tpatternFound = this.findFirstNotIn(patterns, patternFound.right.position, length);\r\n\t\t\t\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tlength -= (patternFound.right.position - position);\r\n\t\t\t\r\n\t\t\tresult.push({\r\n\t\t\t\tleft: {\r\n\t\t\t\t\tid: patternFound.left.id,\r\n\t\t\t\t\tposition: patternFound.left.position\r\n\t\t\t\t},\r\n\t\t\t\tright: {\r\n\t\t\t\t\tid: patternFound.right.id,\r\n\t\t\t\t\tposition: patternFound.right.position\r\n\t\t\t\t},\r\n\t\t\t\tvalue: patternFound.value\r\n\t\t\t});\r\n\t\t} while(patternFound.right.id != (-1));\r\n\t\t//endregion\r\n\t\t\r\n\t\treturn result;\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection FunctionWithMultipleReturnPointsJS, OverlyComplexFunctionJS\r\n\t/**\r\n\t * Find position of a sequence of any patterns from input array\r\n\t * @param {Array.<ByteStream>} patterns Array of pattern to look for\r\n\t * @param {?number} [start] Start position to search from\r\n\t * @param {?number} [length] Length of byte block to search at\r\n\t * @param {boolean} [backward=false] Flag to search in backward order\r\n\t * @returns {*}\r\n\t */\r\n\tfindFirstSequence(patterns, start = null, length = null, backward = false)\r\n\t{\r\n\t\t//region Initial variables\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\tif(start == null)\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS, ConditionalExpressionJS\r\n\t\t\tstart = (backward) ? this.buffer.byteLength : 0;\r\n\t\t}\r\n\t\t\r\n\t\tif(start > this.buffer.byteLength)\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tstart = this.buffer.byteLength;\r\n\t\t}\r\n\t\t\r\n\t\tif(backward)\r\n\t\t{\r\n\t\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\t\tif(length == null)\r\n\t\t\t{\r\n\t\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\t\tlength = start;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif(length > start)\r\n\t\t\t{\r\n\t\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\t\tlength = start;\r\n\t\t\t}\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\t\tif(length == null)\r\n\t\t\t{\r\n\t\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\t\tlength = this.buffer.byteLength - start;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif(length > (this.buffer.byteLength - start))\r\n\t\t\t{\r\n\t\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\t\tlength = this.buffer.byteLength - start;\r\n\t\t\t}\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Find first byte from sequence\r\n\t\tconst firstIn = this.skipNotPatterns(patterns, start, length, backward);\r\n\t\t// noinspection EqualityComparisonWithCoercionJS\r\n\t\tif(firstIn == (-1))\r\n\t\t{\r\n\t\t\treturn {\r\n\t\t\t\tposition: (-1),\r\n\t\t\t\tvalue: new ByteStream()\r\n\t\t\t};\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Find first byte not in sequence\r\n\t\t// noinspection ConditionalExpressionJS\r\n\t\tconst firstNotIn = this.skipPatterns(patterns,\r\n\t\t\tfirstIn,\r\n\t\t\tlength - ((backward) ? (start - firstIn) : (firstIn - start)),\r\n\t\t\tbackward);\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Make output value\r\n\t\tif(backward)\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tstart = firstNotIn;\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tlength = (firstIn - firstNotIn);\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tstart = firstIn;\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tlength = (firstNotIn - firstIn);\r\n\t\t}\r\n\t\t\r\n\t\tconst value = new ByteStream();\r\n\t\t\r\n\t\tvalue._buffer = this._buffer.slice(start, start + length);\r\n\t\tvalue._view = new Uint8Array(value._buffer);\r\n\t\t//endregion\r\n\t\t\r\n\t\treturn {\r\n\t\t\tposition: firstNotIn,\r\n\t\t\tvalue\r\n\t\t};\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection FunctionWithMultipleReturnPointsJS\r\n\t/**\r\n\t * Find all positions of a sequence of any patterns from input array\r\n\t * @param {Array.<ByteStream>} patterns Array of patterns to search for\r\n\t * @param {?number} [start] Start position to search from\r\n\t * @param {?number} [length] Length of byte block to search at\r\n\t * @returns {Array}\r\n\t */\r\n\tfindAllSequences(patterns, start = null, length = null)\r\n\t{\r\n\t\t//region Initial variables\r\n\t\tconst result = [];\r\n\t\t\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\tif(start == null)\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tstart = 0;\r\n\t\t}\r\n\t\t\r\n\t\t// noinspection NonBlockStatementBodyJS\r\n\t\tif(start > (this.buffer.byteLength - 1))\r\n\t\t\treturn result;\r\n\t\t\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\tif(length == null)\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tlength = this.buffer.byteLength - start;\r\n\t\t}\r\n\t\t\r\n\t\tif(length > (this.buffer.byteLength - start))\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tlength = this.buffer.byteLength - start;\r\n\t\t}\r\n\t\t\r\n\t\tlet patternFound = {\r\n\t\t\tposition: start,\r\n\t\t\tvalue: new ByteStream()\r\n\t\t};\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Find all accurences of patterns\r\n\t\t// noinspection EqualityComparisonWithCoercionJS\r\n\t\tdo\r\n\t\t{\r\n\t\t\tconst position = patternFound.position;\r\n\t\t\t\r\n\t\t\tpatternFound = this.findFirstSequence(patterns, patternFound.position, length);\r\n\t\t\t\r\n\t\t\t// noinspection EqualityComparisonWithCoercionJS\r\n\t\t\tif(patternFound.position != (-1))\r\n\t\t\t{\r\n\t\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\t\tlength -= (patternFound.position - position);\r\n\t\t\t\t\r\n\t\t\t\tresult.push({\r\n\t\t\t\t\tposition: patternFound.position,\r\n\t\t\t\t\tvalue: patternFound.value\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\t\r\n\t\t} while(patternFound.position != (-1));\r\n\t\t//endregion\r\n\t\t\r\n\t\treturn result;\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection FunctionWithMultipleLoopsJS, FunctionWithMultipleReturnPointsJS, OverlyComplexFunctionJS, FunctionTooLongJS\r\n\t/**\r\n\t * Find all paired patterns in the stream\r\n\t * @param {ByteStream} leftPattern Left pattern to search for\r\n\t * @param {ByteStream} rightPattern Right pattern to search for\r\n\t * @param {?number} [start=null] Start position to search from\r\n\t * @param {?number} [length=null] Length of byte block to search at\r\n\t * @returns {Array}\r\n\t */\r\n\tfindPairedPatterns(leftPattern, rightPattern, start = null, length = null)\r\n\t{\r\n\t\t//region Initial variables\r\n\t\tconst result = [];\r\n\t\t\r\n\t\t// noinspection NonBlockStatementBodyJS\r\n\t\tif(leftPattern.isEqual(rightPattern))\r\n\t\t\treturn result;\r\n\t\t\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\tif(start == null)\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tstart = 0;\r\n\t\t}\r\n\t\t\r\n\t\t// noinspection NonBlockStatementBodyJS\r\n\t\tif(start > (this.buffer.byteLength - 1))\r\n\t\t\treturn result;\r\n\t\t\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\tif(length == null)\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tlength = this.buffer.byteLength - start;\r\n\t\t}\r\n\t\t\r\n\t\tif(length > (this.buffer.byteLength - start))\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tlength = this.buffer.byteLength - start;\r\n\t\t}\r\n\t\t\r\n\t\tlet currentPositionLeft = 0;\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Find all \"left patterns\" as sorted array\r\n\t\tconst leftPatterns = this.findAllPatternIn(leftPattern, start, length);\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, NonBlockStatementBodyJS, EqualityComparisonWithCoercionJS\r\n\t\tif(leftPatterns.length == 0)\r\n\t\t\treturn result;\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Find all \"right patterns\" as sorted array\r\n\t\tconst rightPatterns = this.findAllPatternIn(rightPattern, start, length);\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, NonBlockStatementBodyJS, EqualityComparisonWithCoercionJS\r\n\t\tif(rightPatterns.length == 0)\r\n\t\t\treturn result;\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Combine patterns\r\n\t\twhile(currentPositionLeft < leftPatterns.length)\r\n\t\t{\r\n\t\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, EqualityComparisonWithCoercionJS\r\n\t\t\tif(rightPatterns.length == 0)\r\n\t\t\t{\r\n\t\t\t\t// noinspection BreakStatementJS\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t// noinspection EqualityComparisonWithCoercionJS\r\n\t\t\tif(leftPatterns[0] == rightPatterns[0])\r\n\t\t\t{\r\n\t\t\t\t// Possible situation when one pattern is a part of another\r\n\t\t\t\t// For example \"stream\" and \"endstream\"\r\n\t\t\t\t// In case when we have only \"endstream\" in fact \"stream\" will be also found at the same position\r\n\t\t\t\t// (position of the pattern is an index AFTER the pattern)\r\n\t\t\t\t\r\n\t\t\t\tresult.push({\r\n\t\t\t\t\tleft: leftPatterns[0],\r\n\t\t\t\t\tright: rightPatterns[0]\r\n\t\t\t\t});\r\n\t\t\t\t\r\n\t\t\t\tleftPatterns.splice(0, 1);\r\n\t\t\t\trightPatterns.splice(0, 1);\r\n\t\t\t\t\r\n\t\t\t\t// noinspection ContinueStatementJS\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif(leftPatterns[currentPositionLeft] > rightPatterns[0])\r\n\t\t\t{\r\n\t\t\t\t// noinspection BreakStatementJS\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\twhile(leftPatterns[currentPositionLeft] < rightPatterns[0])\r\n\t\t\t{\r\n\t\t\t\tcurrentPositionLeft++;\r\n\t\t\t\t\r\n\t\t\t\tif(currentPositionLeft >= leftPatterns.length)\r\n\t\t\t\t{\r\n\t\t\t\t\t// noinspection BreakStatementJS\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tresult.push({\r\n\t\t\t\tleft: leftPatterns[currentPositionLeft - 1],\r\n\t\t\t\tright: rightPatterns[0]\r\n\t\t\t});\r\n\t\t\t\r\n\t\t\tleftPatterns.splice(currentPositionLeft - 1, 1);\r\n\t\t\trightPatterns.splice(0, 1);\r\n\t\t\t\r\n\t\t\tcurrentPositionLeft = 0;\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Sort result\r\n\t\tresult.sort((a, b) => (a.left - b.left));\r\n\t\t//endregion\r\n\t\t\r\n\t\treturn result;\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection FunctionWithMultipleLoopsJS, FunctionWithMultipleReturnPointsJS, OverlyComplexFunctionJS, FunctionTooLongJS\r\n\t/**\r\n\t * Find all paired patterns in the stream\r\n\t * @param {Array.<ByteStream>} inputLeftPatterns Array of left patterns to search for\r\n\t * @param {Array.<ByteStream>} inputRightPatterns Array of right patterns to search for\r\n\t * @param {?number} [start=null] Start position to search from\r\n\t * @param {?number} [length=null] Length of byte block to search at\r\n\t * @returns {Array}\r\n\t */\r\n\tfindPairedArrays(inputLeftPatterns, inputRightPatterns, start = null, length = null)\r\n\t{\r\n\t\t//region Initial variables\r\n\t\tconst result = [];\r\n\t\t\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\tif(start == null)\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tstart = 0;\r\n\t\t}\r\n\t\t\r\n\t\t// noinspection NonBlockStatementBodyJS\r\n\t\tif(start > (this.buffer.byteLength - 1))\r\n\t\t\treturn result;\r\n\t\t\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\tif(length == null)\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tlength = this.buffer.byteLength - start;\r\n\t\t}\r\n\t\t\r\n\t\tif(length > (this.buffer.byteLength - start))\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tlength = this.buffer.byteLength - start;\r\n\t\t}\r\n\t\t\r\n\t\tlet currentPositionLeft = 0;\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Find all \"left patterns\" as sorted array\r\n\t\tconst leftPatterns = this.findAllIn(inputLeftPatterns, start, length);\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, NonBlockStatementBodyJS, EqualityComparisonWithCoercionJS\r\n\t\tif(leftPatterns.length == 0)\r\n\t\t\treturn result;\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Find all \"right patterns\" as sorted array\r\n\t\tconst rightPatterns = this.findAllIn(inputRightPatterns, start, length);\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, NonBlockStatementBodyJS, EqualityComparisonWithCoercionJS\r\n\t\tif(rightPatterns.length == 0)\r\n\t\t\treturn result;\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Combine patterns\r\n\t\twhile(currentPositionLeft < leftPatterns.length)\r\n\t\t{\r\n\t\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, EqualityComparisonWithCoercionJS\r\n\t\t\tif(rightPatterns.length == 0)\r\n\t\t\t{\r\n\t\t\t\t// noinspection BreakStatementJS\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t// noinspection EqualityComparisonWithCoercionJS\r\n\t\t\tif(leftPatterns[0].position == rightPatterns[0].position)\r\n\t\t\t{\r\n\t\t\t\t// Possible situation when one pattern is a part of another\r\n\t\t\t\t// For example \"stream\" and \"endstream\"\r\n\t\t\t\t// In case when we have only \"endstream\" in fact \"stream\" will be also found at the same position\r\n\t\t\t\t// (position of the pattern is an index AFTER the pattern)\r\n\t\t\t\t\r\n\t\t\t\tresult.push({\r\n\t\t\t\t\tleft: leftPatterns[0],\r\n\t\t\t\t\tright: rightPatterns[0]\r\n\t\t\t\t});\r\n\t\t\t\t\r\n\t\t\t\tleftPatterns.splice(0, 1);\r\n\t\t\t\trightPatterns.splice(0, 1);\r\n\t\t\t\t\r\n\t\t\t\t// noinspection ContinueStatementJS\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif(leftPatterns[currentPositionLeft].position > rightPatterns[0].position)\r\n\t\t\t{\r\n\t\t\t\t// noinspection BreakStatementJS\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\twhile(leftPatterns[currentPositionLeft].position < rightPatterns[0].position)\r\n\t\t\t{\r\n\t\t\t\tcurrentPositionLeft++;\r\n\t\t\t\t\r\n\t\t\t\tif(currentPositionLeft >= leftPatterns.length)\r\n\t\t\t\t{\r\n\t\t\t\t\t// noinspection BreakStatementJS\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tresult.push({\r\n\t\t\t\tleft: leftPatterns[currentPositionLeft - 1],\r\n\t\t\t\tright: rightPatterns[0]\r\n\t\t\t});\r\n\t\t\t\r\n\t\t\tleftPatterns.splice(currentPositionLeft - 1, 1);\r\n\t\t\trightPatterns.splice(0, 1);\r\n\t\t\t\r\n\t\t\tcurrentPositionLeft = 0;\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Sort result\r\n\t\tresult.sort((a, b) => (a.left.position - b.left.position));\r\n\t\t//endregion\r\n\t\t\r\n\t\treturn result;\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection FunctionWithMultipleReturnPointsJS, FunctionTooLongJS\r\n\t/**\r\n\t * Replace one patter with other\r\n\t * @param {ByteStream} searchPattern The pattern to search for\r\n\t * @param {ByteStream} replacePattern The pattern to replace initial pattern\r\n\t * @param {?number} [start=null] Start position to search from\r\n\t * @param {?number} [length=null] Length of byte block to search at\r\n\t * @param {Array|null} [findAllResult=null] Pre-calculated results of \"findAllIn\"\r\n\t * @returns {*}\r\n\t */\r\n\treplacePattern(searchPattern, replacePattern, start = null, length = null, findAllResult = null)\r\n\t{\r\n\t\t//region Initial variables\r\n\t\tlet result;\r\n\t\t\r\n\t\tlet i;\r\n\t\tconst output = {\r\n\t\t\tstatus: (-1),\r\n\t\t\tsearchPatternPositions: [],\r\n\t\t\treplacePatternPositions: []\r\n\t\t};\r\n\t\t\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\tif(start == null)\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tstart = 0;\r\n\t\t}\r\n\t\t\r\n\t\t// noinspection NonBlockStatementBodyJS\r\n\t\tif(start > (this.buffer.byteLength - 1))\r\n\t\t\treturn false;\r\n\t\t\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\tif(length == null)\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tlength = this.buffer.byteLength - start;\r\n\t\t}\r\n\t\t\r\n\t\tif(length > (this.buffer.byteLength - start))\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tlength = this.buffer.byteLength - start;\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Find a pattern to search for\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, NonBlockStatementBodyJS\r\n\t\tif(findAllResult == null)\r\n\t\t{\r\n\t\t\tresult = this.findAllIn([searchPattern], start, length);\r\n\t\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, NonBlockStatementBodyJS, EqualityComparisonWithCoercionJS\r\n\t\t\tif(result.length == 0)\r\n\t\t\t\treturn output;\r\n\t\t}\r\n\t\telse\r\n\t\t\tresult = findAllResult;\r\n\t\t\r\n\t\t// noinspection NestedFunctionCallJS\r\n\t\toutput.searchPatternPositions.push(...Array.from(result, element => element.position));\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Variables for new buffer initialization\r\n\t\tconst patternDifference = searchPattern.buffer.byteLength - replacePattern.buffer.byteLength;\r\n\t\t\r\n\t\tconst changedBuffer = new ArrayBuffer(this.view.length - (result.length * patternDifference));\r\n\t\tconst changedView = new Uint8Array(changedBuffer);\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Copy data from 0 to start\r\n\t\t// noinspection NestedFunctionCallJS\r\n\t\tchangedView.set(new Uint8Array(this.buffer, 0, start));\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Replace pattern\r\n\t\tfor(i = 0; i < result.length; i++)\r\n\t\t{\r\n\t\t\t//region Initial variables\r\n\t\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, ConditionalExpressionJS, EqualityComparisonWithCoercionJS\r\n\t\t\tconst currentPosition = (i == 0) ? start : result[i - 1].position;\r\n\t\t\t//endregion\r\n\t\t\t\r\n\t\t\t//region Copy bytes other then search pattern\r\n\t\t\t// noinspection NestedFunctionCallJS\r\n\t\t\tchangedView.set(new Uint8Array(this.buffer, currentPosition, result[i].position - searchPattern.buffer.byteLength - currentPosition), currentPosition - i * patternDifference);\r\n\t\t\t//endregion\r\n\t\t\t\r\n\t\t\t//region Put replace pattern in a new buffer\r\n\t\t\tchangedView.set(replacePattern.view, result[i].position - searchPattern.buffer.byteLength - i * patternDifference);\r\n\t\t\t\r\n\t\t\toutput.replacePatternPositions.push(result[i].position - searchPattern.buffer.byteLength - i * patternDifference);\r\n\t\t\t//endregion\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Copy data from the end of old buffer\r\n\t\ti--;\r\n\t\t// noinspection NestedFunctionCallJS\r\n\t\tchangedView.set(new Uint8Array(this.buffer, result[i].position, this.buffer.byteLength - result[i].position), result[i].position - searchPattern.buffer.byteLength + replacePattern.buffer.byteLength - i * patternDifference);\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Re-initialize existing buffer\r\n\t\tthis.buffer = changedBuffer;\r\n\t\tthis.view = new Uint8Array(this.buffer);\r\n\t\t//endregion\r\n\t\t\r\n\t\toutput.status = 1;\r\n\t\t\r\n\t\treturn output;\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection FunctionWithMultipleLoopsJS, FunctionWithMultipleReturnPointsJS, OverlyComplexFunctionJS, FunctionTooLongJS\r\n\t/**\r\n\t * Skip any pattern from input array\r\n\t * @param {Array.<ByteStream>} patterns Array with patterns which should be ommited\r\n\t * @param {?number} [start=null] Start position to search from\r\n\t * @param {?number} [length=null] Length of byte block to search at\r\n\t * @param {boolean} [backward=false] Flag to search in backward order\r\n\t * @returns {*}\r\n\t */\r\n\tskipPatterns(patterns, start = null, length = null, backward = false)\r\n\t{\r\n\t\t//region Initial variables\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\tif(start == null)\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS, ConditionalExpressionJS\r\n\t\t\tstart = (backward) ? this.buffer.byteLength : 0;\r\n\t\t}\r\n\t\t\r\n\t\tif(start > this.buffer.byteLength)\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tstart = this.buffer.byteLength;\r\n\t\t}\r\n\t\t\r\n\t\tif(backward)\r\n\t\t{\r\n\t\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\t\tif(length == null)\r\n\t\t\t{\r\n\t\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\t\tlength = start;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif(length > start)\r\n\t\t\t{\r\n\t\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\t\tlength = start;\r\n\t\t\t}\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\t\tif(length == null)\r\n\t\t\t{\r\n\t\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\t\tlength = this.buffer.byteLength - start;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif(length > (this.buffer.byteLength - start))\r\n\t\t\t{\r\n\t\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\t\tlength = this.buffer.byteLength - start;\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tlet result = start;\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Search for pattern\r\n\t\tfor(let k = 0; k < patterns.length; k++)\r\n\t\t{\r\n\t\t\tconst patternLength = patterns[k].buffer.byteLength;\r\n\t\t\t// noinspection ConditionalExpressionJS\r\n\t\t\tconst equalStart = (backward) ? (result - patternLength) : (result);\r\n\t\t\tlet equal = true;\r\n\t\t\t\r\n\t\t\tfor(let j = 0; j < patternLength; j++)\r\n\t\t\t{\r\n\t\t\t\t// noinspection EqualityComparisonWithCoercionJS\r\n\t\t\t\tif(this.view[j + equalStart] != patterns[k].view[j])\r\n\t\t\t\t{\r\n\t\t\t\t\tequal = false;\r\n\t\t\t\t\t// noinspection BreakStatementJS\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif(equal)\r\n\t\t\t{\r\n\t\t\t\tk = (-1);\r\n\t\t\t\t\r\n\t\t\t\tif(backward)\r\n\t\t\t\t{\r\n\t\t\t\t\tresult -= patternLength;\r\n\t\t\t\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, NonBlockStatementBodyJS\r\n\t\t\t\t\tif(result <= 0)\r\n\t\t\t\t\t\treturn result;\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\tresult += patternLength;\r\n\t\t\t\t\t// noinspection NonBlockStatementBodyJS\r\n\t\t\t\t\tif(result >= (start + length))\r\n\t\t\t\t\t\treturn result;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\treturn result;\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection FunctionWithMultipleLoopsJS, OverlyComplexFunctionJS, FunctionTooLongJS\r\n\t/**\r\n\t * Skip any pattern not from input array\r\n\t * @param {Array.<ByteStream>} patterns Array with patterns which should not be ommited\r\n\t * @param start\r\n\t * @param length\r\n\t * @param backward\r\n\t * @returns {number}\r\n\t */\r\n\tskipNotPatterns(patterns, start = null, length = null, backward = false)\r\n\t{\r\n\t\t//region Initial variables\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\tif(start == null)\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS, ConditionalExpressionJS\r\n\t\t\tstart = (backward) ? this.buffer.byteLength : 0;\r\n\t\t}\r\n\t\t\r\n\t\tif(start > this.buffer.byteLength)\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tstart = this.buffer.byteLength;\r\n\t\t}\r\n\t\t\r\n\t\tif(backward)\r\n\t\t{\r\n\t\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\t\tif(length == null)\r\n\t\t\t{\r\n\t\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\t\tlength = start;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif(length > start)\r\n\t\t\t{\r\n\t\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\t\tlength = start;\r\n\t\t\t}\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\t\tif(length == null)\r\n\t\t\t{\r\n\t\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\t\tlength = this.buffer.byteLength - start;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif(length > (this.buffer.byteLength - start))\r\n\t\t\t{\r\n\t\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\t\tlength = this.buffer.byteLength - start;\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tlet result = (-1);\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Search for pattern\r\n\t\tfor(let i = 0; i < length; i++)\r\n\t\t{\r\n\t\t\tfor(let k = 0; k < patterns.length; k++)\r\n\t\t\t{\r\n\t\t\t\tconst patternLength = patterns[k].buffer.byteLength;\r\n\t\t\t\t// noinspection ConditionalExpressionJS\r\n\t\t\t\tconst equalStart = (backward) ? (start - i - patternLength) : (start + i);\r\n\t\t\t\tlet equal = true;\r\n\t\t\t\t\r\n\t\t\t\tfor(let j = 0; j < patternLength; j++)\r\n\t\t\t\t{\r\n\t\t\t\t\t// noinspection EqualityComparisonWithCoercionJS\r\n\t\t\t\t\tif(this.view[j + equalStart] != patterns[k].view[j])\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tequal = false;\r\n\t\t\t\t\t\t// noinspection BreakStatementJS\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tif(equal)\r\n\t\t\t\t{\r\n\t\t\t\t\t// noinspection ConditionalExpressionJS\r\n\t\t\t\t\tresult = (backward) ? (start - i) : (start + i); // Exact position of pattern found\r\n\t\t\t\t\t// noinspection BreakStatementJS\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t// noinspection EqualityComparisonWithCoercionJS\r\n\t\t\tif(result != (-1))\r\n\t\t\t{\r\n\t\t\t\t// noinspection BreakStatementJS\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\treturn result;\r\n\t}\r\n\t//**********************************************************************************\r\n}\r\n//**************************************************************************************\r\nexport class SeqStream \r\n{\r\n\t//**********************************************************************************\r\n\t/**\r\n\t * Constructor for \"SeqStream\" class\r\n\t * @param {{[stream]: ByteStream, [length]: number, [backward]: boolean, [start]: number, [appendBlock]: number}} parameters\r\n\t */\r\n\tconstructor(parameters = {})\r\n\t{\r\n\t\t/**\r\n\t\t * Major stream\r\n\t\t * @type {ByteStream}\r\n\t\t */\r\n\t\tthis.stream = new ByteStream();\r\n\t\t/**\r\n\t\t * Length of the major stream\r\n\t\t * @type {number}\r\n\t\t */\r\n\t\tthis._length = 0;\r\n\t\t/**\r\n\t\t * Flag to search in backward direction\r\n\t\t * @type {boolean}\r\n\t\t */\r\n\t\tthis.backward = false;\r\n\t\t/**\r\n\t\t * Start position to search\r\n\t\t * @type {number}\r\n\t\t */\r\n\t\tthis._start = 0;\r\n\t\t/**\r\n\t\t * Length of a block when append information to major stream\r\n\t\t * @type {number}\r\n\t\t */\r\n\t\tthis.appendBlock = 0;\r\n\t\t\r\n\t\tthis.prevLength = 0;\r\n\t\tthis.prevStart = 0;\r\n\t\t\r\n\t\tfor(const key of Object.keys(parameters))\r\n\t\t{\r\n\t\t\tswitch(key)\r\n\t\t\t{\r\n\t\t\t\tcase \"stream\":\r\n\t\t\t\t\tthis.stream = parameters.stream;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"backward\":\r\n\t\t\t\t\tthis.backward = parameters.backward;\r\n\t\t\t\t\t// noinspection JSUnusedGlobalSymbols\r\n\t\t\t\t\tthis._start = this.stream.buffer.byteLength;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"length\":\r\n\t\t\t\t\t// noinspection JSUnusedGlobalSymbols\r\n\t\t\t\t\tthis._length = parameters.length;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"start\":\r\n\t\t\t\t\t// noinspection JSUnusedGlobalSymbols\r\n\t\t\t\t\tthis._start = parameters.start;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"appendBlock\":\r\n\t\t\t\t\tthis.appendBlock = parameters.appendBlock;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"view\":\r\n\t\t\t\t\tthis.stream = new ByteStream({ view: parameters.view});\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"buffer\":\r\n\t\t\t\t\tthis.stream = new ByteStream({ buffer: parameters.buffer});\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"string\":\r\n\t\t\t\t\tthis.stream = new ByteStream({ string: parameters.string});\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"hexstring\":\r\n\t\t\t\t\tthis.stream = new ByteStream({ hexstring: parameters.hexstring});\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t//**********************************************************************************\r\n\t/**\r\n\t * Setter for \"stream\" property\r\n\t * @param {ByteStream} value\r\n\t */\r\n\tset stream(value)\r\n\t{\r\n\t\tthis._stream = value;\r\n\t\t\r\n\t\tthis.prevLength = this._length;\r\n\t\t// noinspection JSUnusedGlobalSymbols\r\n\t\tthis._length = value._buffer.byteLength;\r\n\t\t\r\n\t\tthis.prevStart = this._start;\r\n\t\t// noinspection JSUnusedGlobalSymbols\r\n\t\tthis._start = 0;\r\n\t}\r\n\t//**********************************************************************************\r\n\t/**\r\n\t * Getter for \"stream\" property\r\n\t * @returns {ByteStream}\r\n\t */\r\n\tget stream()\r\n\t{\r\n\t\treturn this._stream;\r\n\t}\r\n\t//**********************************************************************************\r\n\t/**\r\n\t * Setter for \"length\" property\r\n\t * @param {number} value\r\n\t */\r\n\tset length(value)\r\n\t{\r\n\t\tthis.prevLength = this._length;\r\n\t\t// noinspection JSUnusedGlobalSymbols\r\n\t\tthis._length = value;\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection FunctionWithMultipleReturnPointsJS\r\n\t/**\r\n\t * Getter for \"length\" property\r\n\t * @returns {number}\r\n\t */\r\n\tget length()\r\n\t{\r\n\t\t// noinspection NonBlockStatementBodyJS\r\n\t\tif(this.appendBlock)\r\n\t\t\treturn this.start;\r\n\t\t\r\n\t\treturn this._length;\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection FunctionWithMultipleReturnPointsJS\r\n\t/**\r\n\t * Setter for \"start\" property\r\n\t * @param {number} value\r\n\t */\r\n\tset start(value)\r\n\t{\r\n\t\t// noinspection NonBlockStatementBodyJS\r\n\t\tif(value > this.stream.buffer.byteLength)\r\n\t\t\treturn;\r\n\t\t\r\n\t\t//region Initialization of \"prev\" internal variables\r\n\t\tthis.prevStart = this._start;\r\n\t\tthis.prevLength = this._length;\r\n\t\t//endregion\r\n\t\t\r\n\t\t// noinspection JSUnusedGlobalSymbols, ConditionalExpressionJS\r\n\t\tthis._length -= ((this.backward) ? (this._start - value) : (value - this._start));\r\n\t\t// noinspection JSUnusedGlobalSymbols\r\n\t\tthis._start = value;\r\n\t}\r\n\t//**********************************************************************************\r\n\t/**\r\n\t * Getter for \"start\" property\r\n\t * @returns {number}\r\n\t */\r\n\tget start()\r\n\t{\r\n\t\treturn this._start;\r\n\t}\r\n\t//**********************************************************************************\r\n\t/**\r\n\t * Return ArrayBuffer with having value of existing SeqStream length\r\n\t * @return {ArrayBuffer}\r\n\t */\r\n\tget buffer()\r\n\t{\r\n\t\treturn this._stream._buffer.slice(0, this._length);\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection JSUnusedGlobalSymbols\r\n\t/**\r\n\t * Reset current position of the \"SeqStream\"\r\n\t */\r\n\tresetPosition()\r\n\t{\r\n\t\t// noinspection JSUnusedGlobalSymbols\r\n\t\tthis._start = this.prevStart;\r\n\t\t// noinspection JSUnusedGlobalSymbols\r\n\t\tthis._length = this.prevLength;\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection JSUnusedGlobalSymbols, FunctionWithMultipleReturnPointsJS\r\n\t/**\r\n\t * Find any byte pattern in \"ByteStream\"\r\n\t * @param {ByteStream} pattern Stream having pattern value\r\n\t * @param {?number} [gap] Maximum gap between start position and position of nearest object\r\n\t * @returns {number}\r\n\t */\r\n\tfindPattern(pattern, gap = null)\r\n\t{\r\n\t\t//region Initial variables\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\tif((gap == null) || (gap > this.length))\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tgap = this.length;\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Find pattern\r\n\t\tconst result = this.stream.findPattern(pattern, this.start, this.length, this.backward);\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, NonBlockStatementBodyJS, EqualityComparisonWithCoercionJS\r\n\t\tif(result == (-1))\r\n\t\t\treturn result;\r\n\t\t\r\n\t\tif(this.backward)\r\n\t\t{\r\n\t\t\t// noinspection NonBlockStatementBodyJS\r\n\t\t\tif(result < (this.start - pattern.buffer.byteLength - gap))\r\n\t\t\t\treturn (-1);\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\t// noinspection NonBlockStatementBodyJS\r\n\t\t\tif(result > (this.start + pattern.buffer.byteLength + gap))\r\n\t\t\t\treturn (-1);\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Create new values\r\n\t\tthis.start = result;\r\n\t\t//endregion ;\r\n\t\t\r\n\t\treturn result;\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection JSUnusedGlobalSymbols, FunctionWithMultipleReturnPointsJS\r\n\t/**\r\n\t * Find first position of any pattern from input array\r\n\t * @param {Array.<ByteStream>} patterns Array with patterns which should be found\r\n\t * @param {?number} [gap] Maximum gap between start position and position of nearest object\r\n\t * @returns {{id: number, position: number}}\r\n\t */\r\n\tfindFirstIn(patterns, gap = null)\r\n\t{\r\n\t\t//region Initial variables\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\tif((gap == null) || (gap > this.length))\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tgap = this.length;\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Search for patterns\r\n\t\tconst result = this.stream.findFirstIn(patterns, this.start, this.length, this.backward);\r\n\t\t// noinspection NonBlockStatementBodyJS, EqualityComparisonWithCoercionJS\r\n\t\tif(result.id == (-1))\r\n\t\t\treturn result;\r\n\t\t\r\n\t\tif(this.backward)\r\n\t\t{\r\n\t\t\tif(result.position < (this.start - patterns[result.id].buffer.byteLength - gap))\r\n\t\t\t{\r\n\t\t\t\t// noinspection ConditionalExpressionJS\r\n\t\t\t\treturn {\r\n\t\t\t\t\tid: (-1),\r\n\t\t\t\t\tposition: (this.backward) ? 0 : (this.start + this.length)\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tif(result.position > (this.start + patterns[result.id].buffer.byteLength + gap))\r\n\t\t\t{\r\n\t\t\t\t// noinspection ConditionalExpressionJS\r\n\t\t\t\treturn {\r\n\t\t\t\t\tid: (-1),\r\n\t\t\t\t\tposition: (this.backward) ? 0 : (this.start + this.length)\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Create new values\r\n\t\tthis.start = result.position;\r\n\t\t//endregion ;\r\n\t\t\r\n\t\treturn result;\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection JSUnusedGlobalSymbols\r\n\t/**\r\n\t * Find all positions of any pattern from input array\r\n\t * @param {Array.<ByteStream>} patterns Array with patterns which should be found\r\n\t * @returns {Array}\r\n\t */\r\n\tfindAllIn(patterns)\r\n\t{\r\n\t\t// In case of \"backward order\" the start position is at the end on stream.\r\n\t\t// In case of \"normal order\" the start position is at the begging of the stream.\r\n\t\t// But in fact for search for all patterns we need to have start position in \"normal order\".\r\n\t\t// noinspection ConditionalExpressionJS\r\n\t\tconst start = (this.backward) ? (this.start - this.length) : this.start;\r\n\t\t\r\n\t\treturn this.stream.findAllIn(patterns, start, this.length);\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection JSUnusedGlobalSymbols, FunctionWithMultipleReturnPointsJS, OverlyComplexFunctionJS\r\n\t/**\r\n\t * Find first position of data, not included in patterns from input array\r\n\t * @param {Array.<ByteStream>} patterns Array with patterns which should be ommited\r\n\t * @param {?number} gap Maximum gap between start position and position of nearest object\r\n\t * @returns {*}\r\n\t */\r\n\tfindFirstNotIn(patterns, gap = null)\r\n\t{\r\n\t\t//region Initial variables\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\tif((gap == null) || (gap > this._length))\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tgap = this._length;\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Search for patterns\r\n\t\tconst result = this._stream.findFirstNotIn(patterns, this._start, this._length, this.backward);\r\n\t\t// noinspection NonBlockStatementBodyJS, EqualityComparisonWithCoercionJS\r\n\t\tif((result.left.id == (-1)) && (result.right.id == (-1)))\r\n\t\t\treturn result;\r\n\t\t\r\n\t\tif(this.backward)\r\n\t\t{\r\n\t\t\t// noinspection EqualityComparisonWithCoercionJS\r\n\t\t\tif(result.right.id != (-1))\r\n\t\t\t{\r\n\t\t\t\tif(result.right.position < (this._start - patterns[result.right.id]._buffer.byteLength - gap))\r\n\t\t\t\t{\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\tleft: {\r\n\t\t\t\t\t\t\tid: (-1),\r\n\t\t\t\t\t\t\tposition: this._start\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tright: {\r\n\t\t\t\t\t\t\tid: (-1),\r\n\t\t\t\t\t\t\tposition: 0\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tvalue: new ByteStream()\r\n\t\t\t\t\t};\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\t// noinspection EqualityComparisonWithCoercionJS\r\n\t\t\tif(result.left.id != (-1))\r\n\t\t\t{\r\n\t\t\t\tif(result.left.position > (this._start + patterns[result.left.id]._buffer.byteLength + gap))\r\n\t\t\t\t{\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\tleft: {\r\n\t\t\t\t\t\t\tid: (-1),\r\n\t\t\t\t\t\t\tposition: this._start\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tright: {\r\n\t\t\t\t\t\t\tid: (-1),\r\n\t\t\t\t\t\t\tposition: 0\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tvalue: new ByteStream()\r\n\t\t\t\t\t};\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Create new values\r\n\t\tif(this.backward)\r\n\t\t{\r\n\t\t\t// noinspection NonBlockStatementBodyJS, EqualityComparisonWithCoercionJS\r\n\t\t\tif(result.left.id == (-1))\r\n\t\t\t\tthis.start = 0;\r\n\t\t\telse\r\n\t\t\t\tthis.start = result.left.position;\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\t// noinspection NonBlockStatementBodyJS, EqualityComparisonWithCoercionJS\r\n\t\t\tif(result.right.id == (-1))\r\n\t\t\t\tthis.start = (this._start + this._length);\r\n\t\t\telse\r\n\t\t\t\tthis.start = result.right.position;\r\n\t\t}\r\n\t\t//endregion ;\r\n\t\t\r\n\t\treturn result;\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection JSUnusedGlobalSymbols\r\n\t/**\r\n\t * Find all positions of data, not included in patterns from input array\r\n\t * @param {Array.<ByteStream>} patterns Array with patterns which should be ommited\r\n\t * @returns {Array}\r\n\t */\r\n\tfindAllNotIn(patterns)\r\n\t{\r\n\t\t// In case of \"backward order\" the start position is at the end on stream.\r\n\t\t// In case of \"normal order\" the start position is at the begging of the stream.\r\n\t\t// But in fact for search for all patterns we need to have start position in \"normal order\".\r\n\t\t// noinspection ConditionalExpressionJS\r\n\t\tconst start = (this.backward) ? (this._start - this._length) : this._start;\r\n\t\t\r\n\t\treturn this._stream.findAllNotIn(patterns, start, this._length);\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection JSUnusedGlobalSymbols, FunctionWithMultipleReturnPointsJS\r\n\t/**\r\n\t * Find position of a sequence of any patterns from input array\r\n\t * @param {Array.<ByteStream>} patterns Array with patterns which should be ommited\r\n\t * @param {?number} [length] Length to search sequence for\r\n\t * @param {?number} [gap] Maximum gap between start position and position of nearest object\r\n\t * @returns {*}\r\n\t */\r\n\tfindFirstSequence(patterns, length = null, gap = null)\r\n\t{\r\n\t\t//region Initial variables\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\tif((length == null) || (length > this._length))\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tlength = this._length;\r\n\t\t}\r\n\t\t\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\tif((gap == null) || (gap > length))\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tgap = length;\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Search for sequence\r\n\t\tconst result = this._stream.findFirstSequence(patterns, this._start, length, this.backward);\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, NonBlockStatementBodyJS, EqualityComparisonWithCoercionJS\r\n\t\tif(result.value.buffer.byteLength == 0)\r\n\t\t\treturn result;\r\n\t\t\r\n\t\tif(this.backward)\r\n\t\t{\r\n\t\t\tif(result.position < (this._start - result.value._buffer.byteLength - gap))\r\n\t\t\t{\r\n\t\t\t\treturn {\r\n\t\t\t\t\tposition: (-1),\r\n\t\t\t\t\tvalue: new ByteStream()\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tif(result.position > (this._start + result.value._buffer.byteLength + gap))\r\n\t\t\t{\r\n\t\t\t\treturn {\r\n\t\t\t\t\tposition: (-1),\r\n\t\t\t\t\tvalue: new ByteStream()\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Create new values\r\n\t\tthis.start = result.position;\r\n\t\t//endregion ;\r\n\t\t\r\n\t\treturn result;\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection JSUnusedGlobalSymbols\r\n\t/**\r\n\t * Find position of a sequence of any patterns from input array\r\n\t * @param {Array.<ByteStream>} patterns Array with patterns which should be found\r\n\t * @returns {Array}\r\n\t */\r\n\tfindAllSequences(patterns)\r\n\t{\r\n\t\t// In case of \"backward order\" the start position is at the end on stream.\r\n\t\t// In case of \"normal order\" the start position is at the begging of the stream.\r\n\t\t// But in fact for search for all patterns we need to have start position in \"normal order\".\r\n\t\t// noinspection ConditionalExpressionJS\r\n\t\tconst start = (this.backward) ? (this.start - this.length) : this.start;\r\n\t\t\r\n\t\treturn this.stream.findAllSequences(patterns, start, this.length);\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection JSUnusedGlobalSymbols, FunctionWithMultipleReturnPointsJS\r\n\t/**\r\n\t * Find all paired patterns in the stream\r\n\t * @param {ByteStream} leftPattern Left pattern to search for\r\n\t * @param {ByteStream} rightPattern Right pattern to search for\r\n\t * @param {?number} [gap] Maximum gap between start position and position of nearest object\r\n\t * @returns {Array}\r\n\t */\r\n\tfindPairedPatterns(leftPattern, rightPattern, gap = null)\r\n\t{\r\n\t\t//region Initial variables\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\tif((gap == null) || (gap > this.length))\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tgap = this.length;\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\t// In case of \"backward order\" the start position is at the end on stream.\r\n\t\t// In case of \"normal order\" the start position is at the begging of the stream.\r\n\t\t// But in fact for search for all patterns we need to have start position in \"normal order\".\r\n\t\t// noinspection ConditionalExpressionJS\r\n\t\tconst start = (this.backward) ? (this.start - this.length) : this.start;\r\n\t\t\r\n\t\t//region Search for patterns\r\n\t\tconst result = this.stream.findPairedPatterns(leftPattern, rightPattern, start, this.length);\r\n\t\tif(result.length)\r\n\t\t{\r\n\t\t\tif(this.backward)\r\n\t\t\t{\r\n\t\t\t\t// noinspection NonBlockStatementBodyJS\r\n\t\t\t\tif(result[0].right < (this.start - rightPattern.buffer.byteLength - gap))\r\n\t\t\t\t\treturn [];\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\t// noinspection NonBlockStatementBodyJS\r\n\t\t\t\tif(result[0].left > (this.start + leftPattern.buffer.byteLength + gap))\r\n\t\t\t\t\treturn [];\r\n\t\t\t}\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\treturn result;\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection JSUnusedGlobalSymbols, FunctionWithMultipleReturnPointsJS\r\n\t/**\r\n\t * Find all paired patterns in the stream\r\n\t * @param {Array.<ByteStream>} leftPatterns Array of left patterns to search for\r\n\t * @param {Array.<ByteStream>} rightPatterns Array of right patterns to search for\r\n\t * @param {?number} [gap] Maximum gap between start position and position of nearest object\r\n\t * @returns {Array}\r\n\t */\r\n\tfindPairedArrays(leftPatterns, rightPatterns, gap = null)\r\n\t{\r\n\t\t//region Initial variables\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\tif((gap == null) || (gap > this.length))\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tgap = this.length;\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\t// In case of \"backward order\" the start position is at the end on stream.\r\n\t\t// In case of \"normal order\" the start position is at the begging of the stream.\r\n\t\t// But in fact for search for all patterns we need to have start position in \"normal order\".\r\n\t\t// noinspection ConditionalExpressionJS\r\n\t\tconst start = (this.backward) ? (this.start - this.length) : this.start;\r\n\t\t\r\n\t\t//region Search for patterns\r\n\t\tconst result = this.stream.findPairedArrays(leftPatterns, rightPatterns, start, this.length);\r\n\t\tif(result.length)\r\n\t\t{\r\n\t\t\tif(this.backward)\r\n\t\t\t{\r\n\t\t\t\t// noinspection NonBlockStatementBodyJS\r\n\t\t\t\tif(result[0].right.position < (this.start - rightPatterns[result[0].right.id].buffer.byteLength - gap))\r\n\t\t\t\t\treturn [];\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\t// noinspection NonBlockStatementBodyJS\r\n\t\t\t\tif(result[0].left.position > (this.start + leftPatterns[result[0].left.id].buffer.byteLength + gap))\r\n\t\t\t\t\treturn [];\r\n\t\t\t}\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\treturn result;\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection JSUnusedGlobalSymbols\r\n\t/**\r\n\t * Replace one patter with other\r\n\t * @param {ByteStream} searchPattern The pattern to search for\r\n\t * @param {ByteStream} replacePattern The pattern to replace initial pattern\r\n\t * @returns {*}\r\n\t */\r\n\treplacePattern(searchPattern, replacePattern)\r\n\t{\r\n\t\t// In case of \"backward order\" the start position is at the end on stream.\r\n\t\t// In case of \"normal order\" the start position is at the begging of the stream.\r\n\t\t// But in fact for search for all patterns we need to have start position in \"normal order\".\r\n\t\t// noinspection ConditionalExpressionJS\r\n\t\tconst start = (this.backward) ? (this.start - this.length) : this.start;\r\n\t\t\r\n\t\treturn this.stream.replacePattern(searchPattern, replacePattern, start, this.length);\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection JSUnusedGlobalSymbols\r\n\t/**\r\n\t * Skip of any pattern from input array\r\n\t * @param {Array.<ByteStream>} patterns Array with patterns which should be ommited\r\n\t * @returns {*}\r\n\t */\r\n\tskipPatterns(patterns)\r\n\t{\r\n\t\tconst result = this.stream.skipPatterns(patterns, this.start, this.length, this.backward);\r\n\t\t\r\n\t\t//region Create new values\r\n\t\tthis.start = result;\r\n\t\t//endregion ;\r\n\t\t\r\n\t\treturn result;\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection JSUnusedGlobalSymbols, FunctionWithMultipleReturnPointsJS\r\n\t/**\r\n\t * Skip of any pattern from input array\r\n\t * @param {Array.<ByteStream>} patterns Array with patterns which should be ommited\r\n\t * @returns {number}\r\n\t */\r\n\tskipNotPatterns(patterns)\r\n\t{\r\n\t\tconst result = this.stream.skipNotPatterns(patterns, this.start, this.length, this.backward);\r\n\t\t// noinspection NonBlockStatementBodyJS, EqualityComparisonWithCoercionJS\r\n\t\tif(result == (-1))\r\n\t\t\treturn (-1);\r\n\t\t\r\n\t\t//region Create new values\r\n\t\tthis.start = result;\r\n\t\t//endregion ;\r\n\t\t\r\n\t\treturn result;\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection JSUnusedGlobalSymbols\r\n\t/**\r\n\t * Append a new \"Stream\" content to the current \"Stream\"\r\n\t * @param {ByteStream} stream A new \"stream\" to append to current \"stream\"\r\n\t */\r\n\tappend(stream)\r\n\t{\r\n\t\tif((this._start + stream._buffer.byteLength) > this._stream._buffer.byteLength)\r\n\t\t{\r\n\t\t\tif(stream._buffer.byteLength > this.appendBlock)\r\n\t\t\t{\r\n\t\t\t\t// noinspection MagicNumberJS\r\n\t\t\t\tthis.appendBlock = (stream._buffer.byteLength + 1000);\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis._stream.realloc(this._stream._buffer.byteLength + this.appendBlock);\r\n\t\t}\r\n\t\t\r\n\t\tthis._stream._view.set(stream._view, this._start);\r\n\t\t\r\n\t\tthis._length += (stream._buffer.byteLength * 2);\r\n\t\tthis.start = (this._start + stream._buffer.byteLength);\r\n\t\tthis.prevLength -= (stream._buffer.byteLength * 2);\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection JSUnusedGlobalSymbols\r\n\t/**\r\n\t * Append a \"view\" content to the current \"Stream\"\r\n\t * @param {Uint8Array} view A new \"view\" to append to current \"stream\"\r\n\t */\r\n\tappendView(view)\r\n\t{\r\n\t\tif((this._start + view.length) > this._stream._buffer.byteLength)\r\n\t\t{\r\n\t\t\tif(view.length > this.appendBlock)\r\n\t\t\t{\r\n\t\t\t\t// noinspection MagicNumberJS\r\n\t\t\t\tthis.appendBlock = (view.length + 1000);\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis._stream.realloc(this._stream._buffer.byteLength + this.appendBlock);\r\n\t\t}\r\n\t\t\r\n\t\tthis._stream._view.set(view, this._start);\r\n\t\t\r\n\t\tthis._length += (view.length * 2);\r\n\t\tthis.start = (this._start + view.length);\r\n\t\tthis.prevLength -= (view.length * 2);\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection JSUnusedGlobalSymbols\r\n\t/**\r\n\t * Append a new char to the current \"Stream\"\r\n\t * @param {number} char A new char to append to current \"stream\"\r\n\t */\r\n\tappendChar(char)\r\n\t{\r\n\t\tif((this._start + 1) > this._stream._buffer.byteLength)\r\n\t\t{\r\n\t\t\t// noinspection ConstantOnLefSideOfComparisonJS\r\n\t\t\tif(1 > this.appendBlock)\r\n\t\t\t{\r\n\t\t\t\t// noinspection MagicNumberJS\r\n\t\t\t\tthis.appendBlock = 1000;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis._stream.realloc(this._stream._buffer.byteLength + this.appendBlock);\r\n\t\t}\r\n\t\t\r\n\t\tthis._stream._view[this._start] = char;\r\n\t\t\r\n\t\tthis._length += 2;\r\n\t\tthis.start = (this._start + 1);\r\n\t\tthis.prevLength -= 2;\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection FunctionNamingConventionJS\r\n\t/**\r\n\t * Append a new number to the current \"Stream\"\r\n\t * @param {number} number A new unsigned 16-bit integer to append to current \"stream\"\r\n\t */\r\n\tappendUint16(number)\r\n\t{\r\n\t\tif((this._start + 2) > this._stream._buffer.byteLength)\r\n\t\t{\r\n\t\t\t// noinspection ConstantOnLefSideOfComparisonJS\r\n\t\t\tif(2 > this.appendBlock)\r\n\t\t\t{\r\n\t\t\t\t// noinspection MagicNumberJS\r\n\t\t\t\tthis.appendBlock = 1000;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis._stream.realloc(this._stream._buffer.byteLength + this.appendBlock);\r\n\t\t}\r\n\t\t\r\n\t\tconst value = new Uint16Array([number]);\r\n\t\tconst view = new Uint8Array(value.buffer);\r\n\t\t\r\n\t\tthis._stream._view[this._start] = view[1];\r\n\t\tthis._stream._view[this._start + 1] = view[0];\r\n\t\t\r\n\t\tthis._length += 4;\r\n\t\tthis.start = (this._start + 2);\r\n\t\tthis.prevLength -= 4;\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection FunctionNamingConventionJS\r\n\t/**\r\n\t * Append a new number to the current \"Stream\"\r\n\t * @param {number} number A new unsigned 24-bit integer to append to current \"stream\"\r\n\t */\r\n\tappendUint24(number)\r\n\t{\r\n\t\tif((this._start + 3) > this._stream._buffer.byteLength)\r\n\t\t{\r\n\t\t\t// noinspection ConstantOnLefSideOfComparisonJS\r\n\t\t\tif(3 > this.appendBlock)\r\n\t\t\t{\r\n\t\t\t\t// noinspection MagicNumberJS\r\n\t\t\t\tthis.appendBlock = 1000;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis._stream.realloc(this._stream._buffer.byteLength + this.appendBlock);\r\n\t\t}\r\n\t\t\r\n\t\tconst value = new Uint32Array([number]);\r\n\t\tconst view = new Uint8Array(value.buffer);\r\n\t\t\r\n\t\tthis._stream._view[this._start] = view[2];\r\n\t\tthis._stream._view[this._start + 1] = view[1];\r\n\t\tthis._stream._view[this._start + 2] = view[0];\r\n\t\t\r\n\t\tthis._length += 6;\r\n\t\tthis.start = (this._start + 3);\r\n\t\tthis.prevLength -= 6;\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection FunctionNamingConventionJS\r\n\t/**\r\n\t * Append a new number to the current \"Stream\"\r\n\t * @param {number} number A new unsigned 32-bit integer to append to current \"stream\"\r\n\t */\r\n\tappendUint32(number)\r\n\t{\r\n\t\tif((this._start + 4) > this._stream._buffer.byteLength)\r\n\t\t{\r\n\t\t\t// noinspection ConstantOnLefSideOfComparisonJS\r\n\t\t\tif(4 > this.appendBlock)\r\n\t\t\t{\r\n\t\t\t\t// noinspection MagicNumberJS\r\n\t\t\t\tthis.appendBlock = 1000;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis._stream.realloc(this._stream._buffer.byteLength + this.appendBlock);\r\n\t\t}\r\n\t\t\r\n\t\tconst value = new Uint32Array([number]);\r\n\t\tconst view = new Uint8Array(value.buffer);\r\n\t\t\r\n\t\tthis._stream._view[this._start] = view[3];\r\n\t\tthis._stream._view[this._start + 1] = view[2];\r\n\t\tthis._stream._view[this._start + 2] = view[1];\r\n\t\tthis._stream._view[this._start + 3] = view[0];\r\n\t\t\r\n\t\tthis._length += 8;\r\n\t\tthis.start = (this._start + 4);\r\n\t\tthis.prevLength -= 8;\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection FunctionWithMultipleReturnPointsJS\r\n\t/**\r\n\t * Get a block of data\r\n\t * @param {number} size Size of the data block to get\r\n\t * @param {boolean} [changeLength=true] Should we change \"length\" and \"start\" value after reading the data block\r\n\t * @returns {Array}\r\n\t */\r\n\tgetBlock(size, changeLength = true)\r\n\t{\r\n\t\t//region Check input parameters\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, NonBlockStatementBodyJS\r\n\t\tif(this._length <= 0)\r\n\t\t\treturn [];\r\n\t\t\r\n\t\tif(this._length < size)\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tsize = this._length;\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Initial variables\r\n\t\tlet result;\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Getting result depends on \"backward\" flag\r\n\t\tif(this.backward)\r\n\t\t{\r\n\t\t\tconst buffer = this._stream._buffer.slice(this._length - size, this._length);\r\n\t\t\tconst view = new Uint8Array(buffer);\r\n\t\t\t\r\n\t\t\tresult = new Array(size);\r\n\t\t\t\r\n\t\t\t// noinspection NonBlockStatementBodyJS\r\n\t\t\tfor(let i = 0; i < size; i++)\r\n\t\t\t\tresult[size - 1 - i] = view[i];\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tconst buffer = this._stream._buffer.slice(this._start, this._start + size);\r\n\t\t\t\r\n\t\t\t// noinspection NestedFunctionCallJS\r\n\t\t\tresult = Array.from(new Uint8Array(buffer));\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Change \"length\" value if needed\r\n\t\tif(changeLength)\r\n\t\t{\r\n\t\t\t// noinspection ConditionalExpressionJS\r\n\t\t\tthis.start += ((this.backward) ? ((-1) * size) : size);\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\treturn result;\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection JSUnusedGlobalSymbols, FunctionWithMultipleReturnPointsJS, FunctionNamingConventionJS\r\n\t/**\r\n\t * Get 2-byte unsigned integer value\r\n\t * @param {boolean} [changeLength=true] Should we change \"length\" and \"start\" value after reading the data block\r\n\t * @returns {number}\r\n\t */\r\n\tgetUint16(changeLength = true)\r\n\t{\r\n\t\tconst block = this.getBlock(2, changeLength);\r\n\t\t\r\n\t\t//region Check posibility for convertion\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, NonBlockStatementBodyJS\r\n\t\tif(block.length < 2)\r\n\t\t\treturn 0;\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Convert byte array to \"Uint16Array\" value\r\n\t\tconst value = new Uint16Array(1);\r\n\t\tconst view = new Uint8Array(value.buffer);\r\n\t\t\r\n\t\tview[0] = block[1];\r\n\t\tview[1] = block[0];\r\n\t\t//endregion\r\n\t\t\r\n\t\treturn value[0];\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection JSUnusedGlobalSymbols, FunctionWithMultipleReturnPointsJS, FunctionNamingConventionJS\r\n\t/**\r\n\t * Get 2-byte signed integer value\r\n\t * @param {boolean} [changeLength=true] Should we change \"length\" and \"start\" value after reading the data block\r\n\t * @returns {number}\r\n\t */\r\n\tgetInt16(changeLength = true)\r\n\t{\r\n\t\tconst block = this.getBlock(2, changeLength);\r\n\r\n\t\t//region Check posibility for convertion\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, NonBlockStatementBodyJS\r\n\t\tif(block.length < 2)\r\n\t\t\treturn 0;\r\n\t\t//endregion\r\n\r\n\t\t//region Convert byte array to \"Int16Array\" value\r\n\t\tconst value = new Int16Array(1);\r\n\t\tconst view = new Uint8Array(value.buffer);\r\n\r\n\t\tview[0] = block[1];\r\n\t\tview[1] = block[0];\r\n\t\t//endregion\r\n\r\n\t\treturn value[0];\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection JSUnusedGlobalSymbols, FunctionWithMultipleReturnPointsJS, FunctionNamingConventionJS\r\n\t/**\r\n\t * Get 3-byte unsigned integer value\r\n\t * @param {boolean} [changeLength=true] Should we change \"length\" and \"start\" value after reading the data block\r\n\t * @returns {number}\r\n\t */\r\n\tgetUint24(changeLength = true)\r\n\t{\r\n\t\tconst block = this.getBlock(3, changeLength);\r\n\t\t\r\n\t\t//region Check posibility for convertion\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, NonBlockStatementBodyJS\r\n\t\tif(block.length < 3)\r\n\t\t\treturn 0;\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Convert byte array to \"Uint32Array\" value\r\n\t\tconst value = new Uint32Array(1);\r\n\t\tconst view = new Uint8Array(value.buffer);\r\n\t\t\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, NonBlockStatementBodyJS\r\n\t\tfor(let i = 3; i >= 1; i--)\r\n\t\t\tview[3 - i] = block[i - 1];\r\n\t\t//endregion\r\n\t\t\r\n\t\treturn value[0];\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection JSUnusedGlobalSymbols, FunctionWithMultipleReturnPointsJS, FunctionNamingConventionJS\r\n\t/**\r\n\t * Get 4-byte unsigned integer value\r\n\t * @param {boolean} [changeLength=true] Should we change \"length\" and \"start\" value after reading the data block\r\n\t * @returns {number}\r\n\t */\r\n\tgetUint32(changeLength = true)\r\n\t{\r\n\t\tconst block = this.getBlock(4, changeLength);\r\n\t\t\r\n\t\t//region Check posibility for convertion\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, NonBlockStatementBodyJS\r\n\t\tif(block.length < 4)\r\n\t\t\treturn 0;\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Convert byte array to \"Uint32Array\" value\r\n\t\tconst value = new Uint32Array(1);\r\n\t\tconst view = new Uint8Array(value.buffer);\r\n\t\t\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, NonBlockStatementBodyJS\r\n\t\tfor(let i = 3; i >= 0; i--)\r\n\t\t\tview[3 - i] = block[i];\r\n\t\t//endregion\r\n\t\t\r\n\t\treturn value[0];\r\n\t}\r\n\t//**********************************************************************************\r\n\t/**\r\n\t * Get 4-byte signed integer value\r\n\t * @param {boolean} [changeLength=true] Should we change \"length\" and \"start\" value after reading the data block\r\n\t * @returns {number}\r\n\t */\r\n\tgetInt32(changeLength = true)\r\n\t{\r\n\t\tconst block = this.getBlock(4, changeLength);\r\n\r\n\t\t//region Check posibility for convertion\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, NonBlockStatementBodyJS\r\n\t\tif(block.length < 4)\r\n\t\t\treturn 0;\r\n\t\t//endregion\r\n\r\n\t\t//region Convert byte array to \"Int32Array\" value\r\n\t\tconst value = new Int32Array(1);\r\n\t\tconst view = new Uint8Array(value.buffer);\r\n\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, NonBlockStatementBodyJS\r\n\t\tfor(let i = 3; i >= 0; i--)\r\n\t\t\tview[3 - i] = block[i];\r\n\t\t//endregion\r\n\r\n\t\treturn value[0];\r\n\t}\r\n\t//**********************************************************************************\r\n}\r\n//**************************************************************************************\r\n// noinspection FunctionWithMultipleLoopsJS, FunctionWithMultipleReturnPointsJS, OverlyComplexFunctionJS, FunctionTooLongJS\r\n/**\r\n * Get parsed values from \"byte map\"\r\n * @param {ByteStream} stream Stream to parse data from\r\n * @param {Object} map Object with information how to parse \"byte map\"\r\n * @param {number} elements Number of elements in parsing byte map\r\n * @param {?number} [start=null] Start position to parse from\r\n * @param {?number} [length=null] Length of byte block to parse from\r\n * @returns {*}\r\n */\r\nexport function parseByteMap(stream, map, elements, start = null, length = null)\r\n{\r\n\t/*\r\n\t Map example:\r\n\t \r\n\t let map = [\r\n\t {\r\n\t type: \"string\",\r\n\t name: \"type\",\r\n\t minlength: 1,\r\n\t maxlength: 1,\r\n\t func: function(array)\r\n\t {\r\n\t let result = {\r\n\t status: (-1),\r\n\t length: 1\r\n\t };\r\n\t \r\n\t switch(array[0])\r\n\t {\r\n\t case 0x6E: // \"n\"\r\n\t result.value = \"n\";\r\n\t break;\r\n\t case 0x66: // \"f\"\r\n\t result.value = \"f\";\r\n\t break;\r\n\t default:\r\n\t return result;\r\n\t }\r\n\t \r\n\t result.status = 1;\r\n\t \r\n\t return result;\r\n\t }\r\n\t },\r\n\t {\r\n\t type: \"check\",\r\n\t minlength: 1,\r\n\t maxlength: 2,\r\n\t func: function(array)\r\n\t {\r\n\t let position = (-1);\r\n\t \r\n\t if(array[0] == 0x0A)\r\n\t position = 1;\r\n\t if(array[1] == 0x0A)\r\n\t position = 2;\r\n\t \r\n\t return {\r\n\t status: (position > 0) ? 1 : (-1),\r\n\t length: position\r\n\t };\r\n\t }\r\n\t }\r\n\t ];\r\n\t */\r\n\t\r\n\t//region Initial variables\r\n\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\tif(start === null)\r\n\t{\r\n\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\tstart = 0;\r\n\t}\r\n\t\r\n\t// noinspection NonBlockStatementBodyJS\r\n\tif(start > (stream.buffer.byteLength - 1))\r\n\t\treturn false;\r\n\t\r\n\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\tif(length === null)\r\n\t{\r\n\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\tlength = stream.buffer.byteLength - start;\r\n\t}\r\n\t\r\n\tif(length > (stream.buffer.byteLength - start))\r\n\t{\r\n\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\tlength = stream.buffer.byteLength - start;\r\n\t}\r\n\t\r\n\tlet dataView;\r\n\t\r\n\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, EqualityComparisonWithCoercionJS, NonBlockStatementBodyJS\r\n\tif((start == 0) && (length == stream.buffer.byteLength))\r\n\t\tdataView = stream.view;\r\n\telse\r\n\t\tdataView = new Uint8Array(stream.buffer, start, length);\r\n\t\r\n\tconst resultArray = new Array(elements);\r\n\tlet elementsCount = 0;\r\n\t\r\n\tlet count = 0;\r\n\tconst mapLength = map.length;\r\n\t//endregion\r\n\t\r\n\t//region Parse all byte, structure by structure\r\n\twhile(count < length)\r\n\t{\r\n\t\tlet structureLength = 0;\r\n\t\t\r\n\t\tresultArray[elementsCount] = {};\r\n\t\t\r\n\t\tfor(let i = 0; i < mapLength; i++)\r\n\t\t{\r\n\t\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, JSUnresolvedVariable, EqualityComparisonWithCoercionJS\r\n\t\t\tif(map[i].maxlength == 0)\r\n\t\t\t{\r\n\t\t\t\t// noinspection NonBlockStatementBodyJS\r\n\t\t\t\tif(\"defaultValue\" in map[i])\r\n\t\t\t\t\t(resultArray[elementsCount])[map[i].name] = map[i].defaultValue;\r\n\t\t\t\t\r\n\t\t\t\t// noinspection ContinueStatementJS\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t// noinspection JSUnresolvedVariable\r\n\t\t\tconst array = new Array(map[i].maxlength);\r\n\t\t\t\r\n\t\t\t// noinspection JSUnresolvedVariable\r\n\t\t\tfor(let j = 0; j < map[i].maxlength; j++)\r\n\t\t\t{\r\n\t\t\t\t// noinspection IncrementDecrementResultUsedJS\r\n\t\t\t\tarray[j] = dataView[count++];\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t// noinspection JSUnresolvedVariable\r\n\t\t\tconst result = (map[i].func)(array);\r\n\t\t\t// noinspection EqualityComparisonWithCoercionJS, NonBlockStatementBodyJS\r\n\t\t\tif(result.status == (-1))\r\n\t\t\t{\r\n\t\t\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, NonBlockStatementBodyJS, EqualityComparisonWithCoercionJS\r\n\t\t\t\tif(resultArray.length == 1)\r\n\t\t\t\t\treturn [];\r\n\r\n\t\t\t\treturn resultArray.slice(0, resultArray.length - 1);\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, EqualityComparisonWithCoercionJS, NonBlockStatementBodyJS\r\n\t\t\tif(map[i].type != \"check\")\r\n\t\t\t\t(resultArray[elementsCount])[map[i].name] = result.value;\r\n\t\t\t\r\n\t\t\t// noinspection JSUnresolvedVariable\r\n\t\t\tcount -= (map[i].maxlength - result.length);\r\n\t\t\tstructureLength += result.length;\r\n\t\t}\r\n\t\t\r\n\t\t// noinspection IncrementDecrementResultUsedJS\r\n\t\t(resultArray[elementsCount++]).structureLength = structureLength;\r\n\t}\r\n\t//endregion\r\n\t\r\n\treturn resultArray;\r\n}\r\n//**************************************************************************************\r\n//region \"Bits-to-string\" array\r\nconst bitsToStringArray = [\r\n\t\"00000000\", \"00000001\", \"00000010\",\r\n\t\"00000011\", \"00000100\", \"00000101\",\r\n\t\"00000110\", \"00000111\", \"00001000\",\r\n\t\"00001001\", \"00001010\", \"00001011\",\r\n\t\"00001100\", \"00001101\", \"00001110\",\r\n\t\"00001111\", \"00010000\", \"00010001\",\r\n\t\"00010010\", \"00010011\", \"00010100\",\r\n\t\"00010101\", \"00010110\", \"00010111\",\r\n\t\"00011000\", \"00011001\", \"00011010\",\r\n\t\"00011011\", \"00011100\", \"00011101\",\r\n\t\"00011110\", \"00011111\", \"00100000\",\r\n\t\"00100001\", \"00100010\", \"00100011\",\r\n\t\"00100100\", \"00100101\", \"00100110\",\r\n\t\"00100111\", \"00101000\", \"00101001\",\r\n\t\"00101010\", \"00101011\", \"00101100\",\r\n\t\"00101101\", \"00101110\", \"00101111\",\r\n\t\"00110000\", \"00110001\", \"00110010\",\r\n\t\"00110011\", \"00110100\", \"00110101\",\r\n\t\"00110110\", \"00110111\", \"00111000\",\r\n\t\"00111001\", \"00111010\", \"00111011\",\r\n\t\"00111100\", \"00111101\", \"00111110\",\r\n\t\"00111111\", \"01000000\", \"01000001\",\r\n\t\"01000010\", \"01000011\", \"01000100\",\r\n\t\"01000101\", \"01000110\", \"01000111\",\r\n\t\"01001000\", \"01001001\", \"01001010\",\r\n\t\"01001011\", \"01001100\", \"01001101\",\r\n\t\"01001110\", \"01001111\", \"01010000\",\r\n\t\"01010001\", \"01010010\", \"01010011\",\r\n\t\"01010100\", \"01010101\", \"01010110\",\r\n\t\"01010111\", \"01011000\", \"01011001\",\r\n\t\"01011010\", \"01011011\", \"01011100\",\r\n\t\"01011101\", \"01011110\", \"01011111\",\r\n\t\"01100000\", \"01100001\", \"01100010\",\r\n\t\"01100011\", \"01100100\", \"01100101\",\r\n\t\"01100110\", \"01100111\", \"01101000\",\r\n\t\"01101001\", \"01101010\", \"01101011\",\r\n\t\"01101100\", \"01101101\", \"01101110\",\r\n\t\"01101111\", \"01110000\", \"01110001\",\r\n\t\"01110010\", \"01110011\", \"01110100\",\r\n\t\"01110101\", \"01110110\", \"01110111\",\r\n\t\"01111000\", \"01111001\", \"01111010\",\r\n\t\"01111011\", \"01111100\", \"01111101\",\r\n\t\"01111110\", \"01111111\", \"10000000\",\r\n\t\"10000001\", \"10000010\", \"10000011\",\r\n\t\"10000100\", \"10000101\", \"10000110\",\r\n\t\"10000111\", \"10001000\", \"10001001\",\r\n\t\"10001010\", \"10001011\", \"10001100\",\r\n\t\"10001101\", \"10001110\", \"10001111\",\r\n\t\"10010000\", \"10010001\", \"10010010\",\r\n\t\"10010011\", \"10010100\", \"10010101\",\r\n\t\"10010110\", \"10010111\", \"10011000\",\r\n\t\"10011001\", \"10011010\", \"10011011\",\r\n\t\"10011100\", \"10011101\", \"10011110\",\r\n\t\"10011111\", \"10100000\", \"10100001\",\r\n\t\"10100010\", \"10100011\", \"10100100\",\r\n\t\"10100101\", \"10100110\", \"10100111\",\r\n\t\"10101000\", \"10101001\", \"10101010\",\r\n\t\"10101011\", \"10101100\", \"10101101\",\r\n\t\"10101110\", \"10101111\", \"10110000\",\r\n\t\"10110001\", \"10110010\", \"10110011\",\r\n\t\"10110100\", \"10110101\", \"10110110\",\r\n\t\"10110111\", \"10111000\", \"10111001\",\r\n\t\"10111010\", \"10111011\", \"10111100\",\r\n\t\"10111101\", \"10111110\", \"10111111\",\r\n\t\"11000000\", \"11000001\", \"11000010\",\r\n\t\"11000011\", \"11000100\", \"11000101\",\r\n\t\"11000110\", \"11000111\", \"11001000\",\r\n\t\"11001001\", \"11001010\", \"11001011\",\r\n\t\"11001100\", \"11001101\", \"11001110\",\r\n\t\"11001111\", \"11010000\", \"11010001\",\r\n\t\"11010010\", \"11010011\", \"11010100\",\r\n\t\"11010101\", \"11010110\", \"11010111\",\r\n\t\"11011000\", \"11011001\", \"11011010\",\r\n\t\"11011011\", \"11011100\", \"11011101\",\r\n\t\"11011110\", \"11011111\", \"11100000\",\r\n\t\"11100001\", \"11100010\", \"11100011\",\r\n\t\"11100100\", \"11100101\", \"11100110\",\r\n\t\"11100111\", \"11101000\", \"11101001\",\r\n\t\"11101010\", \"11101011\", \"11101100\",\r\n\t\"11101101\", \"11101110\", \"11101111\",\r\n\t\"11110000\", \"11110001\", \"11110010\",\r\n\t\"11110011\", \"11110100\", \"11110101\",\r\n\t\"11110110\", \"11110111\", \"11111000\",\r\n\t\"11111001\", \"11111010\", \"11111011\",\r\n\t\"11111100\", \"11111101\", \"11111110\",\r\n\t\"11111111\"\r\n];\r\n//endregion\r\n//**************************************************************************************\r\nexport class BitStream\r\n{\r\n\t//**********************************************************************************\r\n\t/**\r\n\t * Constructor for \"BitStream\" class\r\n\t * @param {{[byteStream]: ByteStream, [view]: Uint8Array, [buffer]: ArrayBuffer, [string]: string, [bitsCount]: number}} parameters\r\n\t */\r\n\tconstructor(parameters = {})\r\n\t{\r\n\t\tthis.buffer = new ArrayBuffer(0);\r\n\t\tthis.view = new Uint8Array(this.buffer);\r\n\t\t\r\n\t\tthis.bitsCount = 0; // Number of bits stored in current \"BitStream\"\r\n\t\t\r\n\t\tfor(const key of Object.keys(parameters))\r\n\t\t{\r\n\t\t\tswitch(key)\r\n\t\t\t{\r\n\t\t\t\tcase \"byteStream\":\r\n\t\t\t\t\tthis.fromByteStream(parameters.byteStream);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"view\":\r\n\t\t\t\t\tthis.fromUint8Array(parameters.view);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"buffer\":\r\n\t\t\t\t\tthis.fromArrayBuffer(parameters.buffer);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"string\":\r\n\t\t\t\t\tthis.fromString(parameters.string);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"uint32\":\r\n\t\t\t\t\tthis.fromUint32(parameters.uint32);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"bitsCount\":\r\n\t\t\t\t\tthis.bitsCount = parameters.bitsCount;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t//**********************************************************************************\r\n\t/**\r\n\t * Clear existing stream\r\n\t */\r\n\tclear()\r\n\t{\r\n\t\tthis.buffer = new ArrayBuffer(0);\r\n\t\tthis.view = new Uint8Array(this.buffer);\r\n\t\t\r\n\t\tthis.bitsCount = 0;\r\n\t}\r\n\t//**********************************************************************************\r\n\t/**\r\n\t * Initialize \"BitStream\" by data from existing \"ByteStream\"\r\n\t * @param {ByteStream} stream\r\n\t */\r\n\tfromByteStream(stream)\r\n\t{\r\n\t\tthis.buffer = stream.buffer.slice(0);\r\n\t\tthis.view = new Uint8Array(this.buffer);\r\n\t\t\r\n\t\tthis.bitsCount = this.view.length << 3;\r\n\t}\r\n\t//**********************************************************************************\r\n\t/**\r\n\t * Initialize \"BitStream\" object from existing \"ArrayBuffer\"\r\n\t * @param {ArrayBuffer} array The ArrayBuffer to copy from\r\n\t */\r\n\tfromArrayBuffer(array)\r\n\t{\r\n\t\tthis.buffer = array.slice(0);\r\n\t\tthis.view = new Uint8Array(this.buffer);\r\n\t\t\r\n\t\tthis.bitsCount = this.view.length << 3;\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection FunctionNamingConventionJS\r\n\t/**\r\n\t * Initialize \"BitStream\" object from existing \"Uint8Array\"\r\n\t * @param {Uint8Array} array The Uint8Array to copy from\r\n\t */\r\n\tfromUint8Array(array)\r\n\t{\r\n\t\tthis.buffer = new ArrayBuffer(array.length);\r\n\t\tthis.view = new Uint8Array(this.buffer);\r\n\t\t\r\n\t\tthis.view.set(array);\r\n\t\t\r\n\t\tthis.bitsCount = this.view.length << 3;\r\n\t}\r\n\t//**********************************************************************************\r\n\t/**\r\n\t * Initialize \"BitStream\" object from existing bit string\r\n\t * @param {string} string The string to initialize from\r\n\t */\r\n\tfromString(string)\r\n\t{\r\n\t\t//region Initial variables\r\n\t\tconst stringLength = string.length;\r\n\t\t\r\n\t\t// noinspection ConditionalExpressionJS\r\n\t\tthis.buffer = new ArrayBuffer((stringLength >> 3) + ((stringLength % 8) ? 1 : 0));\r\n\t\tthis.view = new Uint8Array(this.buffer);\r\n\t\t\r\n\t\tthis.bitsCount = ((stringLength >> 3) + 1) << 3; // In order to handle correct shifting\r\n\t\t\r\n\t\tlet byteIndex = 0;\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Convert from \"bit string\" to bytes\r\n\t\tfor(let i = 0; i < stringLength; i++)\r\n\t\t{\r\n\t\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, EqualityComparisonWithCoercionJS, NonBlockStatementBodyJS\r\n\t\t\tif(string[i] == \"1\")\r\n\t\t\t\tthis.view[byteIndex] |= 1 << (7 - (i % 8));\r\n\t\t\t\r\n\t\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, EqualityComparisonWithCoercionJS, NonBlockStatementBodyJS\r\n\t\t\tif(i && (((i + 1) % 8) == 0))\r\n\t\t\t\tbyteIndex++;\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Shift \"BitStream\" into correct position\r\n\t\t// noinspection NonBlockStatementBodyJS\r\n\t\tif(stringLength % 8)\r\n\t\t\tthis.shiftRight(8 - (stringLength % 8));\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Change \"bitsCount\"\r\n\t\tthis.bitsCount = stringLength;\r\n\t\t//endregion\r\n\t}\r\n\t//**********************************************************************************\r\n\t/**\r\n\t * Initialize \"BitStream\" object from existing uint32 number\r\n\t * @param {Number} number The string to initialize from\r\n\t */\r\n\tfromUint32(uint32)\r\n\t{\r\n\t\tthis.buffer = new ArrayBuffer(4);\r\n\t\tthis.view = new Uint8Array(this.buffer);\r\n\r\n\t\tconst value = new Uint32Array([uint32]);\r\n\t\tconst view = new Uint8Array(value.buffer);\r\n\t\t\r\n\t\tfor(let i = 3; i >= 0; i--)\r\n\t\t\tthis.view[i] = view[3 - i];\r\n\r\n\t\tthis.bitsCount = 32;\r\n\t}\r\n\t//**********************************************************************************\r\n\t/**\r\n\t * Represent \"BitStream\" object content as a string\r\n\t * @param {?number} [start=null] Start number to convert to string from\r\n\t * @param {?number} [length=null] Length of BitStream to convert to string\r\n\t * @returns {string}\r\n\t */\r\n\ttoString(start = null, length = null)\r\n\t{\r\n\t\t//region Check input parameters\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\tif(start == null)\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tstart = 0;\r\n\t\t}\r\n\t\t\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\tif((start >= this.view.length) || (start < 0))\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tstart = 0;\r\n\t\t}\r\n\t\t\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\tif(length == null)\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tlength = this.view.length - start;\r\n\t\t}\r\n\t\t\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\tif((length >= this.view.length) || (length < 0))\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tlength = this.view.length - start;\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Initial variables\r\n\t\tconst result = [];\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Convert from bytes to \"bit string\"\r\n\t\t// noinspection NonBlockStatementBodyJS\r\n\t\tfor(let i = start; i < (start + length); i++)\r\n\t\t\tresult.push(bitsToStringArray[this.view[i]]);\r\n\t\t//endregion\r\n\t\t\r\n\t\t// noinspection ChainedFunctionCallJS\r\n\t\treturn result.join(\"\").slice((this.view.length << 3) - this.bitsCount);\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection FunctionWithMultipleReturnPointsJS\r\n\t/**\r\n\t * Shift entire \"BitStream\" value right to number of bits\r\n\t * @param {number} shift Number of bits to shift value\r\n\t * @param {boolean} [needShrink=true] Need to shrink result or not\r\n\t */\r\n\tshiftRight(shift, needShrink = true)\r\n\t{\r\n\t\t//region Check parameters\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, EqualityComparisonWithCoercionJS, NonBlockStatementBodyJS\r\n\t\tif(this.view.length == 0)\r\n\t\t\treturn;\r\n\t\t\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, NonBlockStatementBodyJS\r\n\t\tif((shift < 0) || (shift > 8))\r\n\t\t\tthrow new Error(\"The \\\"shift\\\" parameter must be in range 0-8\");\r\n\t\t\r\n\t\t// noinspection NonBlockStatementBodyJS\r\n\t\tif(shift > this.bitsCount)\r\n\t\t\tthrow new Error(\"The \\\"shift\\\" parameter can not be bigger than \\\"this.bitsCount\\\"\");\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Initial variables\r\n\t\t// noinspection MagicNumberJS\r\n\t\tconst shiftMask = 0xFF >> (8 - shift);\r\n\t\tthis.view[this.view.length - 1] >>= shift;\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Shift value\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\tfor(let i = (this.view.length - 2); i >= 0; i--)\r\n\t\t{\r\n\t\t\t// noinspection NonShortCircuitBooleanExpressionJS\r\n\t\t\tthis.view[i + 1] |= (this.view[i] & shiftMask) << (8 - shift);\r\n\t\t\tthis.view[i] >>= shift;\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Decrease number of bits stored into value\r\n\t\tthis.bitsCount -= shift;\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, EqualityComparisonWithCoercionJS, NonBlockStatementBodyJS\r\n\t\tif(this.bitsCount == 0)\r\n\t\t\tthis.clear();\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Change stream size if needed\r\n\t\t// noinspection NonBlockStatementBodyJS\r\n\t\tif(needShrink)\r\n\t\t\tthis.shrink();\r\n\t\t//endregion\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection JSUnusedGlobalSymbols, FunctionWithMultipleReturnPointsJS\r\n\t/**\r\n\t * Shift entire \"BitStream\" value left to number of bits\r\n\t * @param {number} shift Number of bits to shift value\r\n\t */\r\n\tshiftLeft(shift)\r\n\t{\r\n\t\t/*\r\n\t\t NOTE: We do not really shift value because of internal structure of \"BitStream\":\r\n\t\t all bytes inside \"BitStream\" are aligned to right position. So, even if we will\r\n\t\t really shift value to left after that we will need again shift it right to the\r\n\t\t same number of bits. Thus all that we do here is hiding of left bits and descresing\r\n\t\t the \"bitsCount\" number.\r\n\t\t */\r\n\t\t\r\n\t\t//region Check parameters\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, EqualityComparisonWithCoercionJS, NonBlockStatementBodyJS\r\n\t\tif(this.view.length == 0)\r\n\t\t\treturn;\r\n\t\t\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, NonBlockStatementBodyJS\r\n\t\tif((shift < 0) || (shift > 8))\r\n\t\t\tthrow new Error(\"The \\\"shift\\\" parameter must be in range 0-8\");\r\n\t\t\r\n\t\t// noinspection NonBlockStatementBodyJS\r\n\t\tif(shift > this.bitsCount)\r\n\t\t\tthrow new Error(\"The \\\"shift\\\" parameter can not be bigger than \\\"this.bitsCount\\\"\");\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Remove shifted bits\r\n\t\t// noinspection MagicNumberJS, NonShortCircuitBooleanExpressionJS\r\n\t\tconst bitsOffset = this.bitsCount & 0x07;\r\n\t\tif(bitsOffset > shift)\r\n\t\t{\r\n\t\t\t// noinspection MagicNumberJS\r\n\t\t\tthis.view[0] &= 0xFF >> (bitsOffset + shift);\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\t//region Change size of buffer\r\n\t\t\tconst buffer = new ArrayBuffer(this.buffer.byteLength - 1);\r\n\t\t\tconst view = new Uint8Array(buffer);\r\n\t\t\t\r\n\t\t\t// noinspection NestedFunctionCallJS\r\n\t\t\tview.set(new Uint8Array(this.buffer, 1, this.buffer.byteLength - 1));\r\n\t\t\t//endregion\r\n\t\t\t\r\n\t\t\t//region Mask item with index 0\r\n\t\t\t// noinspection MagicNumberJS\r\n\t\t\tview[0] &= 0xFF >> (shift - bitsOffset);\r\n\t\t\t//endregion\r\n\t\t\t\r\n\t\t\t//region Store final array into current stream\r\n\t\t\tthis.buffer = buffer.slice(0);\r\n\t\t\tthis.view = new Uint8Array(this.buffer);\r\n\t\t\t//endregion\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Decrease number of bits stored into value\r\n\t\tthis.bitsCount -= shift;\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, EqualityComparisonWithCoercionJS, NonBlockStatementBodyJS\r\n\t\tif(this.bitsCount == 0)\r\n\t\t\tthis.clear();\r\n\t\t//endregion\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection FunctionWithMultipleReturnPointsJS, FunctionTooLongJS\r\n\t/**\r\n\t * Return slice of existing \"BitStream\"\r\n\t * @param {?number} [start=null] Start position of the slice (in bits)\r\n\t * @param {?number} [end=null] End position of the slice (in bits)\r\n\t * @returns {BitStream}\r\n\t */\r\n\tslice(start = null, end = null)\r\n\t{\r\n\t\t//region Make ability to pass non-value bits\r\n\t\tlet valueShift = 0;\r\n\t\t// noinspection NonBlockStatementBodyJS\r\n\t\tif(this.bitsCount % 8)\r\n\t\t\tvalueShift = (8 - (this.bitsCount % 8));\r\n\t\t\r\n\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\tstart += valueShift;\r\n\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\tend += valueShift;\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Initial variables\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\tif(start == null)\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tstart = 0;\r\n\t\t}\r\n\t\t\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, NonBlockStatementBodyJS\r\n\t\tif((start < 0) || (start > ((this.view.length << 3) - 1)))\r\n\t\t\treturn new BitStream(); //(\"Wrong start position: \" + start);\r\n\t\t\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\tif(end == null)\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tend = (this.view.length << 3) - 1;\r\n\t\t}\r\n\t\t\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, NonBlockStatementBodyJS\r\n\t\tif((end < 0) || (end > ((this.view.length << 3) - 1)))\r\n\t\t\treturn new BitStream(); //(\"Wrong end position: \" + end);\r\n\t\t\r\n\t\t// noinspection NonBlockStatementBodyJS\r\n\t\tif((end - start + 1) > this.bitsCount)\r\n\t\t\treturn new BitStream(); //(\"Maximum length is \" + this.bitsCount);\r\n\t\t\r\n\t\tconst startIndex = start >> 3;\r\n\t\t// noinspection MagicNumberJS, NonShortCircuitBooleanExpressionJS\r\n\t\tconst startOffset = start & 0x07;\r\n\t\t\r\n\t\tconst endIndex = end >> 3;\r\n\t\t// noinspection MagicNumberJS, NonShortCircuitBooleanExpressionJS\r\n\t\tconst endOffset = end & 0x07;\r\n\t\t\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, ConditionalExpressionJS, EqualityComparisonWithCoercionJS\r\n\t\tconst bitsLength = ((endIndex - startIndex) == 0) ? 1 : (endIndex - startIndex + 1);\r\n\t\t\r\n\t\tconst result = new BitStream();\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Store \"primary bytes\"\r\n\t\tresult.buffer = new ArrayBuffer(bitsLength);\r\n\t\tresult.view = new Uint8Array(result.buffer);\r\n\t\tresult.bitsCount = bitsLength << 3;\r\n\t\t\r\n\t\t// noinspection NestedFunctionCallJS\r\n\t\tresult.view.set(new Uint8Array(this.buffer, startIndex, bitsLength));\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Change \"start byte\"\r\n\t\t// noinspection MagicNumberJS\r\n\t\tresult.view[0] &= (0xFF >> startOffset);\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Change \"end byte\"\r\n\t\t// noinspection MagicNumberJS\r\n\t\tresult.view[bitsLength] &= (0xFF << (7 - endOffset));\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Shift result array to right\r\n\t\t// noinspection NonBlockStatementBodyJS\r\n\t\tif(7 - endOffset)\r\n\t\t\tresult.shiftRight(7 - endOffset, false);\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Set final number of bits\r\n\t\tresult.bitsCount = (end - start + 1);\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Cut unnecessary bytes from result\r\n\t\tresult.shrink();\r\n\t\t//endregion\r\n\t\t\r\n\t\treturn result;\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection FunctionWithMultipleReturnPointsJS\r\n\t/**\r\n\t * Return copy of existing \"BitStream\"\r\n\t * @param {?number} [start=null] Start position of the copy (in bits)\r\n\t * @param {?number} [length=null] Length of the copy (in bits)\r\n\t * @returns {BitStream}\r\n\t */\r\n\tcopy(start = null, length = null)\r\n\t{\r\n\t\t//region Check input parameters\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, NonBlockStatementBodyJS\r\n\t\tif((start < 0) || (start > ((this.view.length << 3) - 1)))\r\n\t\t\treturn new BitStream(); //(\"Wrong start position: \" + start);\r\n\t\t\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\tif(length === null)\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tlength = (this.view.length << 3) - start - 1;\r\n\t\t}\r\n\t\t\r\n\t\t// noinspection NonBlockStatementBodyJS\r\n\t\tif(length > this.bitsCount)\r\n\t\t\treturn new BitStream(); //(\"Maximum length is \" + this.bitsCount);\r\n\t\t//endregion\r\n\t\t\r\n\t\treturn this.slice(start, start + length - 1);\r\n\t}\r\n\t//**********************************************************************************\r\n\t/**\r\n\t * Shrink unnecessary bytes in current stream accordingly to \"bitsCount\" value\r\n\t */\r\n\tshrink()\r\n\t{\r\n\t\t// noinspection ConditionalExpressionJS\r\n\t\tconst currentLength = (this.bitsCount >> 3) + ((this.bitsCount % 8) ? 1 : 0);\r\n\t\tif(currentLength < this.buffer.byteLength)\r\n\t\t{\r\n\t\t\t//region Change size of buffer\r\n\t\t\tconst buffer = new ArrayBuffer(currentLength);\r\n\t\t\tconst view = new Uint8Array(buffer);\r\n\t\t\t\r\n\t\t\t// noinspection NestedFunctionCallJS\r\n\t\t\tview.set(new Uint8Array(this.buffer, this.buffer.byteLength - currentLength, currentLength));\r\n\t\t\t//endregion\r\n\t\t\t\r\n\t\t\t//region Store final array into current stream\r\n\t\t\tthis.buffer = buffer.slice(0);\r\n\t\t\tthis.view = new Uint8Array(this.buffer);\r\n\t\t\t//endregion\r\n\t\t}\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection JSUnusedGlobalSymbols\r\n\t/**\r\n\t * Reverse bits order in each byte in the stream\r\n\t * Got it from here: http://graphics.stanford.edu/~seander/bithacks.html#ReverseByteWith32Bits\r\n\t */\r\n\treverseBytes()\r\n\t{\r\n\t\t//region Reverse bits order in each byte in the stream\r\n\t\tfor(let i = 0; i < this.view.length; i++)\r\n\t\t{\r\n\t\t\t// noinspection MagicNumberJS, NonShortCircuitBooleanExpressionJS\r\n\t\t\tthis.view[i] = ((this.view[i] * 0x0802 & 0x22110) | (this.view[i] * 0x8020 & 0x88440)) * 0x10101 >> 16;\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Shift \"most significant\" byte\r\n\t\tif(this.bitsCount % 8)\r\n\t\t{\r\n\t\t\t// noinspection ConditionalExpressionJS\r\n\t\t\tconst currentLength = (this.bitsCount >> 3) + ((this.bitsCount % 8) ? 1 : 0);\r\n\t\t\t// noinspection MagicNumberJS, NonShortCircuitBooleanExpressionJS\r\n\t\t\tthis.view[this.view.length - currentLength] >>= (8 - (this.bitsCount & 0x07));\r\n\t\t}\r\n\t\t//endregion\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection JSUnusedGlobalSymbols\r\n\t/**\r\n\t * Reverse all bits in entire \"BitStream\"\r\n\t */\r\n\treverseValue()\r\n\t{\r\n\t\tconst initialValue = this.toString();\r\n\t\tconst initialValueLength = initialValue.length;\r\n\t\t\r\n\t\tconst reversedValue = new Array(initialValueLength);\r\n\t\t\r\n\t\t// noinspection NonBlockStatementBodyJS\r\n\t\tfor(let i = 0; i < initialValueLength; i++)\r\n\t\t\treversedValue[initialValueLength - 1 - i] = initialValue[i];\r\n\t\t\r\n\t\t// noinspection NestedFunctionCallJS\r\n\t\tthis.fromString(reversedValue.join(\"\"));\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection JSUnusedGlobalSymbols, FunctionWithMultipleReturnPointsJS\r\n\t/**\r\n\t * Trying to represent entire \"BitStream\" as an unsigned integer.\r\n\t * @return {number}\r\n\t */\r\n\tgetNumberValue()\r\n\t{\r\n\t\t//region Initial variables\r\n\t\tconst byteLength = (this.buffer.byteLength - 1);\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Check posibility for convertion\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, NonBlockStatementBodyJS\r\n\t\tif(byteLength > 3)\r\n\t\t\treturn (-1);\r\n\t\t\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, EqualityComparisonWithCoercionJS, NonBlockStatementBodyJS\r\n\t\tif(byteLength == (-1))\r\n\t\t\treturn 0;\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Convert byte array to \"Uint32Array\" value\r\n\t\tconst value = new Uint32Array(1);\r\n\t\tconst view = new Uint8Array(value.buffer);\r\n\t\t\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, NonBlockStatementBodyJS\r\n\t\tfor(let i = byteLength; i >= 0; i--)\r\n\t\t\tview[byteLength - i] = this.view[i];\r\n\t\t//endregion\r\n\t\t\r\n\t\treturn value[0];\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection JSUnusedGlobalSymbols\r\n\t/**\r\n\t * Find any bit pattern in \"BitStream\"\r\n\t * @param {BitStream} pattern Stream having pattern value\r\n\t * @param {?number} [start=null] Start position to search from\r\n\t * @param {?number} [length=null] Length of byte block to search at\r\n\t * @param {boolean} [backward=false] Flag to search in backward order\r\n\t * @returns {number}\r\n\t */\r\n\tfindPattern(pattern, start = null, length = null, backward = false)\r\n\t{\r\n\t\t//region Convert \"BitStream\" values to \"ByteStream\"\r\n\t\tconst stringStream = new ByteStream({\r\n\t\t\tstring: this.toString()\r\n\t\t});\r\n\t\tconst stringPattern = new ByteStream({\r\n\t\t\tstring: pattern.toString()\r\n\t\t});\r\n\t\t//endregion\r\n\t\t\r\n\t\treturn stringStream.findPattern(stringPattern, start, length, backward);\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection JSUnusedGlobalSymbols\r\n\t/**\r\n\t * Find first position of any pattern from input array\r\n\t * @param {Array.<BitStream>} patterns Array with patterns which should be found\r\n\t * @param {?number} [start=null] Start position to search from\r\n\t * @param {?number} [length=null] Length of byte block to search at\r\n\t * @param {boolean} [backward=false] Flag to search in backward order\r\n\t * @returns {{id: number, position: number}}\r\n\t */\r\n\tfindFirstIn(patterns, start = null, length = null, backward = false)\r\n\t{\r\n\t\t//region Convert \"BitStream\" values to \"ByteStream\"\r\n\t\tconst stringStream = new ByteStream({\r\n\t\t\tstring: this.toString()\r\n\t\t});\r\n\t\t\r\n\t\tconst stringPatterns = new Array(patterns.length);\r\n\t\t\r\n\t\tfor(let i = 0; i < patterns.length; i++)\r\n\t\t{\r\n\t\t\tstringPatterns[i] = new ByteStream({\r\n\t\t\t\tstring: patterns[i].toString()\r\n\t\t\t});\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\treturn stringStream.findFirstIn(stringPatterns, start, length, backward);\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection JSUnusedGlobalSymbols\r\n\t/**\r\n\t * Find all positions of any pattern from input array\r\n\t * @param {Array.<BitStream>} patterns Array with patterns which should be found\r\n\t * @param {?number} [start=null] Start position to search from\r\n\t * @param {?number} [length=null] Length of byte block to search at\r\n\t * @returns {Array}\r\n\t */\r\n\tfindAllIn(patterns, start = null, length = null)\r\n\t{\r\n\t\t//region Convert \"BitStream\" values to \"ByteStream\"\r\n\t\tconst stringStream = new ByteStream({\r\n\t\t\tstring: this.toString()\r\n\t\t});\r\n\t\t\r\n\t\tconst stringPatterns = new Array(patterns.length);\r\n\t\t\r\n\t\tfor(let i = 0; i < patterns.length; i++)\r\n\t\t{\r\n\t\t\tstringPatterns[i] = new ByteStream({\r\n\t\t\t\tstring: patterns[i].toString()\r\n\t\t\t});\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\treturn stringStream.findAllIn(stringPatterns, start, length);\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection JSUnusedGlobalSymbols\r\n\t/**\r\n\t * Find all positions of a pattern\r\n\t * @param {BitStream} pattern Stream having pattern value\r\n\t * @param {?number} [start=null] Start position to search from\r\n\t * @param {?number} [length=null] Length of byte block to search at\r\n\t * @returns {Array|number}\r\n\t */\r\n\tfindAllPatternIn(pattern, start = null, length = null)\r\n\t{\r\n\t\t//region Convert \"BitStream\" values to \"ByteStream\" \r\n\t\tconst stringStream = new ByteStream({\r\n\t\t\tstring: this.toString()\r\n\t\t});\r\n\t\tconst stringPattern = new ByteStream({\r\n\t\t\tstring: pattern.toString()\r\n\t\t});\r\n\t\t//endregion \r\n\t\t\r\n\t\treturn stringStream.findAllPatternIn(stringPattern, start, length);\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection JSUnusedGlobalSymbols\r\n\t/**\r\n\t * Find first position of data, not included in patterns from input array\r\n\t * @param {Array.<BitStream>} patterns Array with patterns which should be found\r\n\t * @param {?number} [start=null] Start position to search from\r\n\t * @param {?number} [length=null] Length of byte block to search at\r\n\t * @param {boolean} [backward=false] Flag to search in backward order\r\n\t * @returns {{left: {id: number, position: *}, right: {id: number, position: number}, value: ByteStream}}\r\n\t */\r\n\tfindFirstNotIn(patterns, start = null, length = null, backward = false)\r\n\t{\r\n\t\t//region Convert \"BitStream\" values to \"ByteStream\"\r\n\t\tconst stringStream = new ByteStream({\r\n\t\t\tstring: this.toString()\r\n\t\t});\r\n\t\t\r\n\t\tconst stringPatterns = new Array(patterns.length);\r\n\t\t\r\n\t\tfor(let i = 0; i < patterns.length; i++)\r\n\t\t{\r\n\t\t\tstringPatterns[i] = new ByteStream({\r\n\t\t\t\tstring: patterns[i].toString()\r\n\t\t\t});\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\treturn stringStream.findFirstNotIn(stringPatterns, start, length, backward);\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection JSUnusedGlobalSymbols\r\n\t/**\r\n\t * Find all positions of data, not included in patterns from input array\r\n\t * @param {Array.<BitStream>} patterns Array with patterns which should be found\r\n\t * @param {?number} [start=null] Start position to search from\r\n\t * @param {?number} [length=null] Length of byte block to search at\r\n\t * @returns {Array}\r\n\t */\r\n\tfindAllNotIn(patterns, start = null, length = null)\r\n\t{\r\n\t\t//region Convert \"BitStream\" values to \"ByteStream\"\r\n\t\tconst stringStream = new ByteStream({\r\n\t\t\tstring: this.toString()\r\n\t\t});\r\n\t\t\r\n\t\tconst stringPatterns = new Array(patterns.length);\r\n\t\t\r\n\t\tfor(let i = 0; i < patterns.length; i++)\r\n\t\t{\r\n\t\t\tstringPatterns[i] = new ByteStream({\r\n\t\t\t\tstring: patterns[i].toString()\r\n\t\t\t});\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\treturn stringStream.findAllNotIn(stringPatterns, start, length);\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection JSUnusedGlobalSymbols\r\n\t/**\r\n\t * Find position of a sequence of any patterns from input array\r\n\t * @param {Array.<BitStream>} patterns Array with patterns which should be found\r\n\t * @param {?number} [start=null] Start position to search from\r\n\t * @param {?number} [length=null] Length of byte block to search at\r\n\t * @param {boolean} [backward=false] Flag to search in backward order\r\n\t * @returns {{position, value}|*}\r\n\t */\r\n\tfindFirstSequence(patterns, start = null, length = null, backward = false)\r\n\t{\r\n\t\t//region Convert \"BitStream\" values to \"ByteStream\"\r\n\t\tconst stringStream = new ByteStream({\r\n\t\t\tstring: this.toString()\r\n\t\t});\r\n\t\t\r\n\t\tconst stringPatterns = new Array(patterns.length);\r\n\t\t\r\n\t\tfor(let i = 0; i < patterns.length; i++)\r\n\t\t{\r\n\t\t\tstringPatterns[i] = new ByteStream({\r\n\t\t\t\tstring: patterns[i].toString()\r\n\t\t\t});\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\treturn stringStream.findFirstSequence(stringPatterns, start, length, backward);\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection JSUnusedGlobalSymbols\r\n\t/**\r\n\t * Find position of a sequence of any patterns from input array\r\n\t * @param {Array.<BitStream>} patterns Array with patterns which should be found\r\n\t * @param {?number} [start=null] Start position to search from\r\n\t * @param {?number} [length=null] Length of byte block to search at\r\n\t * @returns {Array}\r\n\t */\r\n\tfindAllSequences(patterns, start, length)\r\n\t{\r\n\t\t//region Convert \"BitStream\" values to \"ByteStream\"\r\n\t\tconst stringStream = new ByteStream({\r\n\t\t\tstring: this.toString()\r\n\t\t});\r\n\t\t\r\n\t\tconst stringPatterns = new Array(patterns.length);\r\n\t\t\r\n\t\tfor(let i = 0; i < patterns.length; i++)\r\n\t\t{\r\n\t\t\tstringPatterns[i] = new ByteStream({\r\n\t\t\t\tstring: patterns[i].toString()\r\n\t\t\t});\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\treturn stringStream.findAllSequences(stringPatterns, start, length);\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection JSUnusedGlobalSymbols\r\n\t/**\r\n\t * Find all paired patterns in the stream\r\n\t * @param {BitStream} leftPattern Left pattern to search for\r\n\t * @param {BitStream} rightPattern Right pattern to search for\r\n\t * @param {?number} [start=null] Start position to search from\r\n\t * @param {?number} [length=null] Length of byte block to search at\r\n\t * @returns {Array}\r\n\t */\r\n\tfindPairedPatterns(leftPattern, rightPattern, start = null, length = null)\r\n\t{\r\n\t\t//region Convert \"BitStream\" values to \"ByteStream\"\r\n\t\tconst stringStream = new ByteStream({\r\n\t\t\tstring: this.toString()\r\n\t\t});\r\n\t\tconst stringLeftPattern = new ByteStream({\r\n\t\t\tstring: leftPattern.toString()\r\n\t\t});\r\n\t\tconst stringRightPattern = new ByteStream({\r\n\t\t\tstring: rightPattern.toString()\r\n\t\t});\r\n\t\t//endregion\r\n\t\t\r\n\t\treturn stringStream.findPairedPatterns(stringLeftPattern, stringRightPattern, start, length);\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection JSUnusedGlobalSymbols, FunctionWithMultipleLoopsJS\r\n\t/**\r\n\t * Find all paired patterns in the stream\r\n\t * @param {Array.<BitStream>} inputLeftPatterns Array of left patterns to search for\r\n\t * @param {Array.<BitStream>} inputRightPatterns Array of right patterns to search for\r\n\t * @param {?number} [start=null] Start position to search from\r\n\t * @param {?number} [length=null] Length of byte block to search at\r\n\t * @returns {Array}\r\n\t */\r\n\tfindPairedArrays(inputLeftPatterns, inputRightPatterns, start = null, length = null)\r\n\t{\r\n\t\t//region Convert \"BitStream\" values to \"ByteStream\"\r\n\t\tconst stringStream = new ByteStream({\r\n\t\t\tstring: this.toString()\r\n\t\t});\r\n\t\t\r\n\t\tconst stringLeftPatterns = new Array(inputLeftPatterns.length);\r\n\t\t\r\n\t\tfor(let i = 0; i < inputLeftPatterns.length; i++)\r\n\t\t{\r\n\t\t\tstringLeftPatterns[i] = new ByteStream({\r\n\t\t\t\tstring: inputLeftPatterns[i].toString()\r\n\t\t\t});\r\n\t\t}\r\n\t\t\r\n\t\tconst stringRightPatterns = new Array(inputRightPatterns.length);\r\n\t\t\r\n\t\tfor(let i = 0; i < inputRightPatterns.length; i++)\r\n\t\t{\r\n\t\t\tstringRightPatterns[i] = new ByteStream({\r\n\t\t\t\tstring: inputRightPatterns[i].toString()\r\n\t\t\t});\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\treturn stringStream.findPairedArrays(stringLeftPatterns, stringRightPatterns, start, length);\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection JSUnusedGlobalSymbols, FunctionWithMultipleReturnPointsJS\r\n\t/**\r\n\t * Replace one pattern with other\r\n\t * @param {BitStream} searchPattern The pattern to search for\r\n\t * @param {BitStream} replacePattern The pattern to replace initial pattern\r\n\t * @param {?number} [start=null] Start position to search from\r\n\t * @param {?number} [length=null] Length of byte block to search at\r\n\t * @returns {boolean}\r\n\t */\r\n\treplacePattern(searchPattern, replacePattern, start = null, length = null)\r\n\t{\r\n\t\t//region Convert \"BitStream\" values to \"ByteStream\"\r\n\t\tconst stringStream = new ByteStream({\r\n\t\t\tstring: this.toString()\r\n\t\t});\r\n\t\tconst stringSearchPattern = new ByteStream({\r\n\t\t\tstring: searchPattern.toString()\r\n\t\t});\r\n\t\tconst stringReplacePattern = new ByteStream({\r\n\t\t\tstring: replacePattern.toString()\r\n\t\t});\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Re-initialize existing data\r\n\t\tif(stringStream.findPairedPatterns(stringSearchPattern, stringReplacePattern, start, length))\r\n\t\t{\r\n\t\t\t// noinspection NestedFunctionCallJS\r\n\t\t\tthis.fromString(stringStream.toString());\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\treturn false;\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection JSUnusedGlobalSymbols\r\n\t/**\r\n\t * Skip any pattern from input array\r\n\t * @param {Array.<BitStream>} patterns Array with patterns which should be ommited\r\n\t * @param {?number} [start=null] Start position to search from\r\n\t * @param {?number} [length=null] Length of byte block to search at\r\n\t * @param {boolean} [backward=false] Flag to search in backward order\r\n\t * @returns {*}\r\n\t */\r\n\tskipPatterns(patterns, start, length, backward)\r\n\t{\r\n\t\t//region Convert \"BitStream\" values to \"ByteStream\"\r\n\t\tconst stringStream = new ByteStream({\r\n\t\t\tstring: this.toString()\r\n\t\t});\r\n\t\t\r\n\t\tconst stringPatterns = new Array(patterns.length);\r\n\t\t\r\n\t\tfor(let i = 0; i < patterns.length; i++)\r\n\t\t{\r\n\t\t\tstringPatterns[i] = new ByteStream({\r\n\t\t\t\tstring: patterns[i].toString()\r\n\t\t\t});\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\treturn stringStream.skipPatterns(stringPatterns, start, length, backward);\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection JSUnusedGlobalSymbols\r\n\t/**\r\n\t * Skip any pattern not from input array\r\n\t * @param {Array.<BitStream>} patterns Array with patterns which should be ommited\r\n\t * @param {?number} [start=null] Start position to search from\r\n\t * @param {?number} [length=null] Length of byte block to search at\r\n\t * @param {boolean} [backward=false] Flag to search in backward order\r\n\t * @returns {number}\r\n\t */\r\n\tskipNotPatterns(patterns, start, length, backward)\r\n\t{\r\n\t\t//region Convert \"BitStream\" values to \"ByteStream\"\r\n\t\tconst stringStream = new ByteStream({\r\n\t\t\tstring: this.toString()\r\n\t\t});\r\n\t\t\r\n\t\tconst stringPatterns = new Array(patterns.length);\r\n\t\t\r\n\t\tfor(let i = 0; i < patterns.length; i++)\r\n\t\t{\r\n\t\t\tstringPatterns[i] = new ByteStream({\r\n\t\t\t\tstring: patterns[i].toString()\r\n\t\t\t});\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\treturn stringStream.skipNotPatterns(stringPatterns, start, length, backward);\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection JSUnusedGlobalSymbols\r\n\t/**\r\n\t * Append a new \"BitStream\" content to the current \"BitStream\"\r\n\t * @param {BitStream} stream A new \"stream\" to append to current \"stream\"\r\n\t */\r\n\tappend(stream)\r\n\t{\r\n\t\t//region Initialize current stream with new data\r\n\t\t// noinspection NestedFunctionCallJS\r\n\t\tthis.fromString([\r\n\t\t\tthis.toString(),\r\n\t\t\tstream.toString()\r\n\t\t].join(\"\"));\r\n\t\t//endregion\r\n\t}\r\n\t//**********************************************************************************\r\n}\r\n//**************************************************************************************\r\nexport class SeqBitStream\r\n{\r\n\t//**********************************************************************************\r\n\tconstructor(parameters = {})\r\n\t{\r\n\t\t//region Internal variables\r\n\t\tthis.stream = new BitStream();\r\n\t\t\r\n\t\tthis._start = 0;\r\n\t\tthis._length = this.stream.bitsCount;\r\n\t\t\r\n\t\tthis.backward = false;\r\n\t\t\r\n\t\tthis.appendBlock = 0;\r\n\t\t//endregion\r\n\t\t\r\n\t\tfor(const key of Object.keys(parameters))\r\n\t\t{\r\n\t\t\tswitch(key)\r\n\t\t\t{\r\n\t\t\t\tcase \"stream\":\r\n\t\t\t\tcase \"start\":\r\n\t\t\t\tcase \"length\":\r\n\t\t\t\tcase \"backward\":\r\n\t\t\t\tcase \"appendBlock\":\r\n\t\t\t\t\tthis[key] = parameters[key];\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection FunctionWithMultipleReturnPointsJS\r\n\tset start(value)\r\n\t{\r\n\t\t// noinspection NonBlockStatementBodyJS\r\n\t\tif(value > this.stream.bitsCount)\r\n\t\t\treturn;\r\n\t\t\r\n\t\t// noinspection ConditionalExpressionJS\r\n\t\tthis._length -= ((this.backward) ? (this._start - value) : (value - this._start));\r\n\t\tthis._start = value;\r\n\t\t\r\n\t\t//region Initialization of \"prev\" internal variables\r\n\t\t// noinspection JSUnusedGlobalSymbols\r\n\t\tthis.prevStart = this._start;\r\n\t\t// noinspection JSUnusedGlobalSymbols\r\n\t\tthis.prevLength = this._length;\r\n\t\t//endregion\r\n\t}\r\n\t//**********************************************************************************\r\n\tget start()\r\n\t{\r\n\t\treturn this._start;\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection FunctionWithMultipleReturnPointsJS\r\n\tset length(value)\r\n\t{\r\n\t\t// noinspection NonBlockStatementBodyJS\r\n\t\tif(value > this.stream.bitsCount)\r\n\t\t\treturn;\r\n\t\t\r\n\t\t// noinspection JSUnusedGlobalSymbols\r\n\t\tthis.prevLength = this._length;\r\n\t\tthis._length = value;\r\n\t}\r\n\t//**********************************************************************************\r\n\tget length()\r\n\t{\r\n\t\treturn this._length;\r\n\t}\r\n\t//**********************************************************************************\r\n\tset stream(value)\r\n\t{\r\n\t\tthis._stream = value;\r\n\t\t\r\n\t\t// noinspection JSUnusedGlobalSymbols\r\n\t\tthis.prevLength = this._length;\r\n\t\tthis._length = value.bitsCount;\r\n\t\t\r\n\t\t// noinspection JSUnusedGlobalSymbols\r\n\t\tthis.prevStart = this._start;\r\n\t\t// noinspection ConditionalExpressionJS\r\n\t\tthis._start = (this.backward) ? this.length : 0;\r\n\t}\r\n\t//**********************************************************************************\r\n\tget stream()\r\n\t{\r\n\t\treturn this._stream;\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection JSUnusedGlobalSymbols\r\n\t/**\r\n\t * Get next \"length\" bits from the stream\r\n\t * @param {number} length Number of bits to read\r\n\t * @returns {*}\r\n\t */\r\n\tgetBits(length)\r\n\t{\r\n\t\t//region Check input parameters \r\n\t\tif((this.start + length) > this.stream.bitsCount)\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tlength = (this.stream.bitsCount - this.start);\r\n\t\t}\r\n\t\t//endregion \r\n\t\t\r\n\t\t//region Initial variables \r\n\t\tlet result;\r\n\t\t//endregion \r\n\t\t\r\n\t\t//region Copy necessary length of bits\r\n\t\tif(this.backward)\r\n\t\t{\r\n\t\t\tresult = this.stream.copy(this.start - length, length);\r\n\t\t\tthis.start -= result.bitsCount;\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tresult = this.stream.copy(this.start, length);\r\n\t\t\tthis.start += result.bitsCount;\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\treturn result;\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection FunctionTooLongJS\r\n\t/**\r\n\t * Get string representation for the next \"length\" bits from the stream\r\n\t * @param {number} length Number of bits to read\r\n\t * @returns {string}\r\n\t */\r\n\tgetBitsString(length)\r\n\t{\r\n\t\t//region Check input parameters\r\n\t\tif((this.start + length) > this.stream.bitsCount)\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tlength = (this.stream.bitsCount - this.start);\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Initial variables\r\n\t\tlet result = [];\r\n\t\t\r\n\t\tlet start;\r\n\t\t\r\n\t\t// noinspection NonBlockStatementBodyJS\r\n\t\tif(this.backward)\r\n\t\t\tstart = this.start - length;\r\n\t\telse\r\n\t\t\tstart = this.start;\r\n\t\t\r\n\t\tlet end = this.start + length - 1;\r\n\t\t\r\n\t\t//region Make ability to pass non-value bits\r\n\t\tlet valueShift = 0;\r\n\t\t// noinspection NonBlockStatementBodyJS\r\n\t\tif(this.stream.bitsCount % 8)\r\n\t\t\tvalueShift = (8 - (this.stream.bitsCount % 8));\r\n\t\t\r\n\t\tstart += valueShift;\r\n\t\tend += valueShift;\r\n\t\t//endregion\r\n\t\t\r\n\t\tconst startIndex = start >> 3;\r\n\t\t// noinspection MagicNumberJS, NonShortCircuitBooleanExpressionJS\r\n\t\tconst startOffset = start & 0x07;\r\n\t\t\r\n\t\tconst endIndex = end >> 3;\r\n\t\t// noinspection MagicNumberJS, NonShortCircuitBooleanExpressionJS\r\n\t\tconst endOffset = end & 0x07;\r\n\t\t\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, ConditionalExpressionJS, EqualityComparisonWithCoercionJS\r\n\t\tconst bitsLengthIndex = startIndex + (((endIndex - startIndex) == 0) ? 1 : (endIndex - startIndex + 1));\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Get string representation of bits\r\n\t\tfor(let i = startIndex; i < bitsLengthIndex; i++)\r\n\t\t{\r\n\t\t\tlet value = bitsToStringArray[this.stream.view[i]];\r\n\t\t\t\r\n\t\t\t// noinspection EqualityComparisonWithCoercionJS, NonBlockStatementBodyJS\r\n\t\t\tif(i == startIndex)\r\n\t\t\t\tvalue = value.slice(startOffset);\r\n\t\t\t\r\n\t\t\t// noinspection EqualityComparisonWithCoercionJS, NonBlockStatementBodyJS\r\n\t\t\tif(i == (bitsLengthIndex - 1))\r\n\t\t\t\tvalue = value.slice(0, endOffset - 7 + value.length);\r\n\t\t\t\r\n\t\t\tresult.push(value);\r\n\t\t}\r\n\t\t\r\n\t\tresult = result.join(\"\");\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Change internal values\r\n\t\t// noinspection NonBlockStatementBodyJS\r\n\t\tif(this.backward)\r\n\t\t\tthis.start -= result.length;\r\n\t\telse\r\n\t\t\tthis.start += result.length;\r\n\t\t//endregion\r\n\t\t\r\n\t\treturn result;\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection JSUnusedGlobalSymbols, FunctionWithMultipleLoopsJS, FunctionWithMultipleReturnPointsJS\r\n\t/**\r\n\t * Get number value representation of the next \"length\" bits from the stream, preliminary reversed\r\n\t * @param {number} length Number of bits to read\r\n\t * @returns {*}\r\n\t */\r\n\tgetBitsReversedValue(length)\r\n\t{\r\n\t\t//region Initial variables \r\n\t\tconst initialValue = this.getBitsString(length);\r\n\t\tconst initialValueLength = initialValue.length;\r\n\t\t\r\n\t\tlet byteIndex;\r\n\t\t\r\n\t\tconst initialOffset = 8 - (initialValueLength % 8);\r\n\t\t\r\n\t\tconst reversedValue = new Array(initialValueLength);\r\n\t\t\r\n\t\tconst value = new Uint32Array(1);\r\n\t\tconst valueView = new Uint8Array(value.buffer, 0, 4);\r\n\t\t\r\n\t\tlet i;\r\n\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, MagicNumberJS, NonBlockStatementBodyJS\r\n\t\tif(initialValueLength > 32)\r\n\t\t\treturn (-1);\r\n\t\t\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, MagicNumberJS, EqualityComparisonWithCoercionJS, NonBlockStatementBodyJS\r\n\t\tif(length == 32)\r\n\t\t\tbyteIndex = 3;\r\n\t\telse\r\n\t\t\tbyteIndex = ((initialValueLength - 1) >> 3);\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Reverse value \r\n\t\t// noinspection NonBlockStatementBodyJS\r\n\t\tfor(i = 0; i < initialValueLength; i++)\r\n\t\t\treversedValue[initialValueLength - 1 - i] = initialValue[i];\r\n\t\t//endregion \r\n\t\t\r\n\t\t//region Convert byte array to \"Uint32Array\" value \r\n\t\tfor(i = initialOffset; i < (initialOffset + initialValueLength); i++)\r\n\t\t{\r\n\t\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, EqualityComparisonWithCoercionJS\r\n\t\t\tif(reversedValue[i - initialOffset] == \"1\")\r\n\t\t\t{\r\n\t\t\t\t// noinspection MagicNumberJS\r\n\t\t\t\tvalueView[byteIndex] |= 0x01 << (7 - (i % 8));\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, EqualityComparisonWithCoercionJS, NonBlockStatementBodyJS\r\n\t\t\tif(i && (((i + 1) % 8) == 0))\r\n\t\t\t\tbyteIndex--;\r\n\t\t}\r\n\t\t//endregion \r\n\t\t\r\n\t\treturn value[0];\r\n\t}\r\n\t//**********************************************************************************\r\n\t/**\r\n\t * Represent remaining bits in \"BitStream\" as a string\r\n\t * @return {string}\r\n\t */\r\n\ttoString()\r\n\t{\r\n\t\tconst streamToDisplay = this.stream.copy(this.start, this.length);\r\n\t\treturn streamToDisplay.toString();\r\n\t}\r\n\t//**********************************************************************************\r\n}\r\n//**************************************************************************************\r\n"]},"metadata":{},"sourceType":"module"}