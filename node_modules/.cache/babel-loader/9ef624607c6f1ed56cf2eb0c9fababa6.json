{"ast":null,"code":"\"use strict\";\n\nvar _Object$defineProperty = require(\"@babel/runtime-corejs2/core-js/object/define-property\");\n\nvar _interopRequireDefault = require(\"@babel/runtime-corejs2/helpers/interopRequireDefault\");\n\n_Object$defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\n_Object$defineProperty(exports, \"escape\", {\n  enumerable: true,\n  get: function get() {\n    return _htmlBase.escape;\n  }\n});\n\n_Object$defineProperty(exports, \"escapeSync\", {\n  enumerable: true,\n  get: function get() {\n    return _htmlBase.escapeSync;\n  }\n});\n\nexports.filterEscapeSync = exports.filterEscape = exports.filterSync = exports.filter = void 0;\n\nvar _promise = _interopRequireDefault(require(\"@babel/runtime-corejs2/core-js/promise\"));\n\nvar _keys = _interopRequireDefault(require(\"@babel/runtime-corejs2/core-js/object/keys\"));\n\nvar _reduce2 = _interopRequireDefault(require(\"lodash/reduce\"));\n\nvar _includes2 = _interopRequireDefault(require(\"lodash/includes\"));\n\nvar _forEach2 = _interopRequireDefault(require(\"lodash/forEach\"));\n\nvar _curry2 = _interopRequireDefault(require(\"lodash/curry\"));\n\nvar _htmlBase = require(\"./html-base\");\n/**\n * Some browsers don't implement {@link Element#remove()} or\n * {@link NodeList#remove()} or {@link HTMLCollection#remove()}. This wrapper\n * calls the appropriate `#remove()` method if available, or falls back to a\n * non-global-polluting polyfill.\n * @param {Element|NodeList|HTMLCollection} node\n * @returns {undefined}\n */\n\n\nfunction removeNode(node) {\n  if (node.remove) {\n    node.remove();\n    return;\n  }\n\n  if (node.parentElement) {\n    node.parentElement.removeChild(node);\n    return;\n  }\n\n  if ('length' in node) {\n    for (var i = node.length - 1; i >= 0; i -= 1) {\n      removeNode(node[i]);\n    }\n\n    return;\n  }\n\n  throw new Error('Could not find a way to remove node');\n}\n/**\n * @param {Object} allowedTags\n * @param {Array<string>} allowedStyles\n * @param {string} html\n * @private\n * @returns {string}\n */\n\n\nfunction _filter() {\n  for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n    args[_key] = arguments[_key];\n  }\n\n  return new _promise.default(function (resolve) {\n    resolve(_filterSync.apply(void 0, args));\n  });\n}\n/**\n * Curried async HTML filter.\n * @param {Object} allowedTags Map of tagName -> array of allowed attributes\n * @param {Array<string>} allowedStyles Array of allowed styles\n * @param {string} html html to filter\n * @returns {string}\n */\n\n\nvar filter = (0, _curry2.default)(_filter, 4);\n/**\n * @param {function} processCallback callback function to do additional\n * processing on node. of the form process(node)\n * @param {Object} allowedTags\n * @param {Array<string>} allowedStyles\n * @param {string} html\n * @private\n * @returns {string}\n */\n\nexports.filter = filter;\n\nfunction _filterSync(processCallback, allowedTags, allowedStyles, html) {\n  if (!html || !allowedStyles || !allowedTags) {\n    if (html.length === 0) {\n      return html;\n    }\n\n    throw new Error('`allowedTags`, `allowedStyles`, and `html` must be provided');\n  }\n\n  var doc = new DOMParser().parseFromString(html, 'text/html');\n  depthFirstForEach(doc.body.childNodes, filterNode);\n  processCallback(doc.body);\n\n  if (html.indexOf('body') === 1) {\n    return \"<body>\".concat(doc.body.innerHTML, \"</body>\");\n  }\n\n  return doc.body.innerHTML;\n  /**\n   * @param {Node} node\n   * @private\n   * @returns {undefined}\n   */\n\n  function filterNode(node) {\n    if (!isElement(node)) {\n      return;\n    }\n\n    var nodeName = node.nodeName.toLowerCase();\n    var allowedTagNames = (0, _keys.default)(allowedTags);\n    depthFirstForEach(node.childNodes, filterNode);\n\n    if ((0, _includes2.default)(allowedTagNames, nodeName)) {\n      var allowedAttributes = allowedTags[nodeName];\n      (0, _forEach2.default)(listAttributeNames(node.attributes), function (attrName) {\n        if (!(0, _includes2.default)(allowedAttributes, attrName)) {\n          node.removeAttribute(attrName);\n        } else if (attrName === 'href' || attrName === 'src') {\n          var attrValue = node.attributes.getNamedItem(attrName).value.trim().toLowerCase(); // We're doing at runtime what the no-script-url rule does at compile\n          // time\n          // eslint-disable-next-line no-script-url\n\n          if (attrValue.indexOf('javascript:') === 0 || attrValue.indexOf('vbscript:') === 0) {\n            reparent(node);\n          }\n        } else if (attrName === 'style') {\n          var styles = node.attributes.getNamedItem('style').value.split(';').map(function (style) {\n            var styleName = trim(style.split(':')[0]);\n\n            if ((0, _includes2.default)(allowedStyles, styleName)) {\n              return style;\n            }\n\n            return null;\n          }).filter(function (style) {\n            return Boolean(style);\n          }).join(';');\n          node.setAttribute('style', styles);\n        }\n      });\n    } else {\n      reparent(node);\n    }\n  }\n}\n/**\n * Same as _filter, but escapes rather than removes disallowed values\n * @param {Function} processCallback\n * @param {Object} allowedTags\n * @param {Array<string>} allowedStyles\n * @param {string} html\n * @returns {Promise<string>}\n */\n\n\nfunction _filterEscape() {\n  for (var _len2 = arguments.length, args = new Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {\n    args[_key2] = arguments[_key2];\n  }\n\n  return new _promise.default(function (resolve) {\n    resolve(_filterEscapeSync.apply(void 0, args));\n  });\n}\n/**\n * Same as _filterSync, but escapes rather than removes disallowed values\n * @param {Function} processCallback\n * @param {Object} allowedTags\n * @param {Array<string>} allowedStyles\n * @param {string} html\n * @returns {string}\n */\n\n\nfunction _filterEscapeSync(processCallback, allowedTags, allowedStyles, html) {\n  if (!html || !allowedStyles || !allowedTags) {\n    if (html.length === 0) {\n      return html;\n    }\n\n    throw new Error('`allowedTags`, `allowedStyles`, and `html` must be provided');\n  }\n\n  var doc = new DOMParser().parseFromString(html, 'text/html');\n  depthFirstForEach(doc.body.childNodes, filterNode);\n  processCallback(doc.body);\n\n  if (html.indexOf('body') === 1) {\n    return \"<body>\".concat(doc.body.innerHTML, \"</body>\");\n  }\n\n  return doc.body.innerHTML;\n  /**\n   * @param {Node} node\n   * @private\n   * @returns {undefined}\n   */\n\n  function filterNode(node) {\n    if (!isElement(node)) {\n      return;\n    }\n\n    depthFirstForEach(node.childNodes, filterNode);\n    var nodeName = node.nodeName.toLowerCase();\n    var allowedTagNames = (0, _keys.default)(allowedTags);\n\n    if ((0, _includes2.default)(allowedTagNames, nodeName)) {\n      var allowedAttributes = allowedTags[nodeName];\n      (0, _forEach2.default)(listAttributeNames(node.attributes), function (attrName) {\n        if (!(0, _includes2.default)(allowedAttributes, attrName)) {\n          node.removeAttribute(attrName);\n        } else if (attrName === 'href' || attrName === 'src') {\n          var attrValue = node.attributes.getNamedItem(attrName).value.toLowerCase(); // We're doing at runtime what the no-script-url rule does at compile\n          // time\n          // eslint-disable-next-line no-script-url\n\n          if (attrValue.indexOf('javascript:') === 0 || attrValue.indexOf('vbscript:') === 0) {\n            reparent(node);\n          }\n        } else if (attrName === 'style') {\n          var styles = node.attributes.getNamedItem('style').value.split(';').map(function (style) {\n            var styleName = trim(style.split(':')[0]);\n\n            if ((0, _includes2.default)(allowedStyles, styleName)) {\n              return style;\n            }\n\n            return null;\n          }).filter(function (style) {\n            return Boolean(style);\n          }).join(';');\n          node.setAttribute('style', styles);\n        }\n      });\n    } else {\n      escapeNode(node);\n    }\n  }\n}\n/**\n * Escapes a given html node\n * @param {Node} node\n * @returns {undefined}\n */\n\n\nfunction escapeNode(node) {\n  var before = document.createTextNode(\"<\".concat(node.nodeName.toLowerCase(), \">\"));\n  var after = document.createTextNode(\"</\".concat(node.nodeName.toLowerCase(), \">\"));\n  node.parentNode.insertBefore(before, node);\n\n  while (node.childNodes.length > 0) {\n    node.parentNode.insertBefore(node.childNodes[0], node);\n  }\n\n  node.parentNode.insertBefore(after, node);\n  removeNode(node);\n}\n\nvar trimPattern = /^\\s|\\s$/g;\n/**\n * @param {string} str\n * @returns {string}\n */\n\nfunction trim(str) {\n  return str.replace(trimPattern, '');\n}\n/**\n * @param {Node} node\n * @private\n * @returns {undefined}\n */\n\n\nfunction reparent(node) {\n  while (node.childNodes.length > 0) {\n    node.parentNode.insertBefore(node.childNodes[0], node);\n  }\n\n  removeNode(node);\n}\n/**\n * @param {NamedNodeMap} attributes\n * @private\n * @returns {Array<string>}\n */\n\n\nfunction listAttributeNames(attributes) {\n  return (0, _reduce2.default)(attributes, function (attrNames, attr) {\n    attrNames.push(attr.name);\n    return attrNames;\n  }, []);\n}\n/**\n * @param {Array} list\n * @param {Function} fn\n * @private\n * @returns {undefined}\n */\n\n\nfunction depthFirstForEach(list, fn) {\n  for (var i = list.length; i >= 0; i -= 1) {\n    fn(list[i]);\n  }\n}\n/**\n * @param {Node} o\n * @private\n * @returns {Boolean}\n */\n\n\nfunction isElement(o) {\n  if (!o) {\n    return false;\n  }\n\n  if (o.ownerDocument === undefined) {\n    return false;\n  }\n\n  if (o.nodeType !== 1) {\n    return false;\n  }\n\n  if (typeof o.nodeName !== 'string') {\n    return false;\n  }\n\n  return true;\n}\n/**\n * Curried HTML filter.\n * @param {Object} allowedTags Map of tagName -> array of allowed attributes\n * @param {Array<string>} allowedStyles Array of allowed styles\n * @param {string} html html to filter\n * @returns {string}\n */\n\n\nvar filterSync = (0, _curry2.default)(_filterSync, 4);\n/**\n * Curried HTML filter that escapes rather than removes disallowed tags\n * @param {Object} allowedTags Map of tagName -> array of allowed attributes\n * @param {Array<string>} allowedStyles Array of allowed styles\n * @param {string} html html to filter\n * @returns {Promise<string>}\n */\n\nexports.filterSync = filterSync;\nvar filterEscape = (0, _curry2.default)(_filterEscape, 4);\n/**\n * Curried HTML filter that escapes rather than removes disallowed tags\n * @param {Object} allowedTags Map of tagName -> array of allowed attributes\n * @param {Array<string>} allowedStyles Array of allowed styles\n * @param {string} html html to filter\n * @returns {string}\n */\n\nexports.filterEscape = filterEscape;\nvar filterEscapeSync = (0, _curry2.default)(_filterEscapeSync, 4);\nexports.filterEscapeSync = filterEscapeSync;","map":{"version":3,"mappings":"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","names":["removeNode","node","remove","parentElement","removeChild","i","length","Error","_filter","args","arguments","resolve","_filterSync","filter","processCallback","allowedTags","allowedStyles","html","doc","DOMParser","parseFromString","depthFirstForEach","body","childNodes","filterNode","indexOf","innerHTML","isElement","nodeName","toLowerCase","allowedTagNames","allowedAttributes","listAttributeNames","attributes","attrName","removeAttribute","attrValue","getNamedItem","value","trim","reparent","styles","split","map","style","styleName","Boolean","join","setAttribute","_filterEscape","_filterEscapeSync","escapeNode","before","document","createTextNode","after","parentNode","insertBefore","trimPattern","str","replace","attrNames","attr","push","name","list","fn","o","ownerDocument","undefined","nodeType","filterSync","filterEscape","filterEscapeSync"],"sources":["html.shim.js"],"sourcesContent":["/*!\n * Copyright (c) 2015-2020 Cisco Systems, Inc. See LICENSE file.\n */\n\n/* eslint-env browser */\n\nimport {curry, forEach, includes, reduce} from 'lodash';\n\nexport {escape, escapeSync} from './html-base';\n\n/**\n * Some browsers don't implement {@link Element#remove()} or\n * {@link NodeList#remove()} or {@link HTMLCollection#remove()}. This wrapper\n * calls the appropriate `#remove()` method if available, or falls back to a\n * non-global-polluting polyfill.\n * @param {Element|NodeList|HTMLCollection} node\n * @returns {undefined}\n */\nfunction removeNode(node) {\n  if (node.remove) {\n    node.remove();\n\n    return;\n  }\n\n  if (node.parentElement) {\n    node.parentElement.removeChild(node);\n\n    return;\n  }\n\n  if ('length' in node) {\n    for (let i = node.length - 1; i >= 0; i -= 1) {\n      removeNode(node[i]);\n    }\n\n    return;\n  }\n\n  throw new Error('Could not find a way to remove node');\n}\n\n/**\n * @param {Object} allowedTags\n * @param {Array<string>} allowedStyles\n * @param {string} html\n * @private\n * @returns {string}\n */\nfunction _filter(...args) {\n  return new Promise((resolve) => {\n    resolve(_filterSync(...args));\n  });\n}\n\n/**\n * Curried async HTML filter.\n * @param {Object} allowedTags Map of tagName -> array of allowed attributes\n * @param {Array<string>} allowedStyles Array of allowed styles\n * @param {string} html html to filter\n * @returns {string}\n */\nexport const filter = curry(_filter, 4);\n\n/**\n * @param {function} processCallback callback function to do additional\n * processing on node. of the form process(node)\n * @param {Object} allowedTags\n * @param {Array<string>} allowedStyles\n * @param {string} html\n * @private\n * @returns {string}\n */\nfunction _filterSync(processCallback, allowedTags, allowedStyles, html) {\n  if (!html || !allowedStyles || !allowedTags) {\n    if (html.length === 0) {\n      return html;\n    }\n\n    throw new Error('`allowedTags`, `allowedStyles`, and `html` must be provided');\n  }\n\n  const doc = (new DOMParser()).parseFromString(html, 'text/html');\n\n  depthFirstForEach(doc.body.childNodes, filterNode);\n  processCallback(doc.body);\n\n  if (html.indexOf('body') === 1) {\n    return `<body>${doc.body.innerHTML}</body>`;\n  }\n\n  return doc.body.innerHTML;\n\n  /**\n   * @param {Node} node\n   * @private\n   * @returns {undefined}\n   */\n  function filterNode(node) {\n    if (!isElement(node)) {\n      return;\n    }\n\n    const nodeName = node.nodeName.toLowerCase();\n    const allowedTagNames = Object.keys(allowedTags);\n\n    depthFirstForEach(node.childNodes, filterNode);\n\n    if (includes(allowedTagNames, nodeName)) {\n      const allowedAttributes = allowedTags[nodeName];\n\n      forEach(listAttributeNames(node.attributes), (attrName) => {\n        if (!includes(allowedAttributes, attrName)) {\n          node.removeAttribute(attrName);\n        }\n        else if (attrName === 'href' || attrName === 'src') {\n          const attrValue = node.attributes.getNamedItem(attrName).value.trim().toLowerCase();\n\n          // We're doing at runtime what the no-script-url rule does at compile\n          // time\n          // eslint-disable-next-line no-script-url\n          if (attrValue.indexOf('javascript:') === 0 || attrValue.indexOf('vbscript:') === 0) {\n            reparent(node);\n          }\n        }\n        else if (attrName === 'style') {\n          const styles = node\n            .attributes\n            .getNamedItem('style')\n            .value\n            .split(';')\n            .map((style) => {\n              const styleName = trim(style.split(':')[0]);\n\n              if (includes(allowedStyles, styleName)) {\n                return style;\n              }\n\n              return null;\n            })\n            .filter((style) => Boolean(style))\n            .join(';');\n\n          node.setAttribute('style', styles);\n        }\n      });\n    }\n    else {\n      reparent(node);\n    }\n  }\n}\n\n/**\n * Same as _filter, but escapes rather than removes disallowed values\n * @param {Function} processCallback\n * @param {Object} allowedTags\n * @param {Array<string>} allowedStyles\n * @param {string} html\n * @returns {Promise<string>}\n */\nfunction _filterEscape(...args) {\n  return new Promise((resolve) => {\n    resolve(_filterEscapeSync(...args));\n  });\n}\n\n/**\n * Same as _filterSync, but escapes rather than removes disallowed values\n * @param {Function} processCallback\n * @param {Object} allowedTags\n * @param {Array<string>} allowedStyles\n * @param {string} html\n * @returns {string}\n */\nfunction _filterEscapeSync(processCallback, allowedTags, allowedStyles, html) {\n  if (!html || !allowedStyles || !allowedTags) {\n    if (html.length === 0) {\n      return html;\n    }\n\n    throw new Error('`allowedTags`, `allowedStyles`, and `html` must be provided');\n  }\n\n  const doc = (new DOMParser()).parseFromString(html, 'text/html');\n\n  depthFirstForEach(doc.body.childNodes, filterNode);\n  processCallback(doc.body);\n\n  if (html.indexOf('body') === 1) {\n    return `<body>${doc.body.innerHTML}</body>`;\n  }\n\n  return doc.body.innerHTML;\n\n  /**\n   * @param {Node} node\n   * @private\n   * @returns {undefined}\n   */\n  function filterNode(node) {\n    if (!isElement(node)) {\n      return;\n    }\n\n    depthFirstForEach(node.childNodes, filterNode);\n\n    const nodeName = node.nodeName.toLowerCase();\n    const allowedTagNames = Object.keys(allowedTags);\n\n    if (includes(allowedTagNames, nodeName)) {\n      const allowedAttributes = allowedTags[nodeName];\n\n      forEach(listAttributeNames(node.attributes), (attrName) => {\n        if (!includes(allowedAttributes, attrName)) {\n          node.removeAttribute(attrName);\n        }\n        else if (attrName === 'href' || attrName === 'src') {\n          const attrValue = node.attributes.getNamedItem(attrName).value.toLowerCase();\n\n          // We're doing at runtime what the no-script-url rule does at compile\n          // time\n          // eslint-disable-next-line no-script-url\n          if (attrValue.indexOf('javascript:') === 0 || attrValue.indexOf('vbscript:') === 0) {\n            reparent(node);\n          }\n        }\n        else if (attrName === 'style') {\n          const styles = node\n            .attributes\n            .getNamedItem('style')\n            .value\n            .split(';')\n            .map((style) => {\n              const styleName = trim(style.split(':')[0]);\n\n              if (includes(allowedStyles, styleName)) {\n                return style;\n              }\n\n              return null;\n            })\n            .filter((style) => Boolean(style))\n            .join(';');\n\n          node.setAttribute('style', styles);\n        }\n      });\n    }\n    else {\n      escapeNode(node);\n    }\n  }\n}\n\n/**\n * Escapes a given html node\n * @param {Node} node\n * @returns {undefined}\n */\nfunction escapeNode(node) {\n  const before = document.createTextNode(`<${node.nodeName.toLowerCase()}>`);\n  const after = document.createTextNode(`</${node.nodeName.toLowerCase()}>`);\n\n  node.parentNode.insertBefore(before, node);\n  while (node.childNodes.length > 0) {\n    node.parentNode.insertBefore(node.childNodes[0], node);\n  }\n  node.parentNode.insertBefore(after, node);\n\n  removeNode(node);\n}\n\nconst trimPattern = /^\\s|\\s$/g;\n\n/**\n * @param {string} str\n * @returns {string}\n */\nfunction trim(str) {\n  return str.replace(trimPattern, '');\n}\n\n/**\n * @param {Node} node\n * @private\n * @returns {undefined}\n */\nfunction reparent(node) {\n  while (node.childNodes.length > 0) {\n    node.parentNode.insertBefore(node.childNodes[0], node);\n  }\n  removeNode(node);\n}\n\n/**\n * @param {NamedNodeMap} attributes\n * @private\n * @returns {Array<string>}\n */\nfunction listAttributeNames(attributes) {\n  return reduce(attributes, (attrNames, attr) => {\n    attrNames.push(attr.name);\n\n    return attrNames;\n  }, []);\n}\n\n/**\n * @param {Array} list\n * @param {Function} fn\n * @private\n * @returns {undefined}\n */\nfunction depthFirstForEach(list, fn) {\n  for (let i = list.length; i >= 0; i -= 1) {\n    fn(list[i]);\n  }\n}\n\n/**\n * @param {Node} o\n * @private\n * @returns {Boolean}\n */\nfunction isElement(o) {\n  if (!o) {\n    return false;\n  }\n\n  if (o.ownerDocument === undefined) {\n    return false;\n  }\n\n  if (o.nodeType !== 1) {\n    return false;\n  }\n\n  if (typeof o.nodeName !== 'string') {\n    return false;\n  }\n\n  return true;\n}\n\n/**\n * Curried HTML filter.\n * @param {Object} allowedTags Map of tagName -> array of allowed attributes\n * @param {Array<string>} allowedStyles Array of allowed styles\n * @param {string} html html to filter\n * @returns {string}\n */\nexport const filterSync = curry(_filterSync, 4);\n\n/**\n * Curried HTML filter that escapes rather than removes disallowed tags\n * @param {Object} allowedTags Map of tagName -> array of allowed attributes\n * @param {Array<string>} allowedStyles Array of allowed styles\n * @param {string} html html to filter\n * @returns {Promise<string>}\n */\nexport const filterEscape = curry(_filterEscape, 4);\n\n/**\n * Curried HTML filter that escapes rather than removes disallowed tags\n * @param {Object} allowedTags Map of tagName -> array of allowed attributes\n * @param {Array<string>} allowedStyles Array of allowed styles\n * @param {string} html html to filter\n * @returns {string}\n */\nexport const filterEscapeSync = curry(_filterEscapeSync, 4);\n"]},"metadata":{},"sourceType":"script"}