{"ast":null,"code":"\"use strict\";\n\nvar _Reflect$construct = require(\"@babel/runtime-corejs2/core-js/reflect/construct\");\n\nvar _Object$defineProperty = require(\"@babel/runtime-corejs2/core-js/object/define-property\");\n\nvar _interopRequireDefault = require(\"@babel/runtime-corejs2/helpers/interopRequireDefault\");\n\n_Object$defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nexports.default = void 0;\n\nvar _classCallCheck2 = _interopRequireDefault(require(\"@babel/runtime-corejs2/helpers/classCallCheck\"));\n\nvar _createClass2 = _interopRequireDefault(require(\"@babel/runtime-corejs2/helpers/createClass\"));\n\nvar _inherits2 = _interopRequireDefault(require(\"@babel/runtime-corejs2/helpers/inherits\"));\n\nvar _possibleConstructorReturn2 = _interopRequireDefault(require(\"@babel/runtime-corejs2/helpers/possibleConstructorReturn\"));\n\nvar _getPrototypeOf2 = _interopRequireDefault(require(\"@babel/runtime-corejs2/helpers/getPrototypeOf\"));\n\nvar _weakMap = _interopRequireDefault(require(\"@babel/runtime-corejs2/core-js/weak-map\"));\n\nvar _deleteProperty = _interopRequireDefault(require(\"@babel/runtime-corejs2/core-js/reflect/delete-property\"));\n\nvar _httpCore = require(\"@webex/http-core\");\n\nfunction _createSuper(Derived) {\n  var hasNativeReflectConstruct = _isNativeReflectConstruct();\n\n  return function _createSuperInternal() {\n    var Super = (0, _getPrototypeOf2.default)(Derived),\n        result;\n\n    if (hasNativeReflectConstruct) {\n      var NewTarget = (0, _getPrototypeOf2.default)(this).constructor;\n      result = _Reflect$construct(Super, arguments, NewTarget);\n    } else {\n      result = Super.apply(this, arguments);\n    }\n\n    return (0, _possibleConstructorReturn2.default)(this, result);\n  };\n}\n\nfunction _isNativeReflectConstruct() {\n  if (typeof Reflect === \"undefined\" || !_Reflect$construct) return false;\n  if (_Reflect$construct.sham) return false;\n  if (typeof Proxy === \"function\") return true;\n\n  try {\n    Boolean.prototype.valueOf.call(_Reflect$construct(Boolean, [], function () {}));\n    return true;\n  } catch (e) {\n    return false;\n  }\n}\n\nvar sequenceNumbers = new _weakMap.default();\n/**\n * @class\n */\n\nvar WebexTrackingIdInterceptor = /*#__PURE__*/function (_Interceptor) {\n  (0, _inherits2.default)(WebexTrackingIdInterceptor, _Interceptor);\n\n  var _super = _createSuper(WebexTrackingIdInterceptor);\n\n  function WebexTrackingIdInterceptor() {\n    (0, _classCallCheck2.default)(this, WebexTrackingIdInterceptor);\n    return _super.apply(this, arguments);\n  }\n\n  (0, _createClass2.default)(WebexTrackingIdInterceptor, [{\n    key: \"sequence\",\n    get:\n    /**\n     * Sequence number; increments on access\n     * @type {Number}\n     */\n    function get() {\n      var sq = sequenceNumbers.get(this) || 0;\n      sq += 1;\n      sequenceNumbers.set(this, sq);\n      return sq;\n    }\n    /**\n     * @returns {WebexTrackingIdInterceptor}\n     */\n\n  }, {\n    key: \"onRequest\",\n    value:\n    /**\n     * @see Interceptor#onRequest\n     * @param {Object} options\n     * @returns {Object}\n     */\n    function onRequest(options) {\n      options.headers = options.headers || {}; // If trackingid is already set, don't overwrite it\n\n      if ('trackingid' in options.headers) {\n        // If trackingid is set to null, false, or undefined, delete it to\n        // prevent a CORS preflight.\n        if (!options.headers.trackingid) {\n          (0, _deleteProperty.default)(options.headers, 'trackingid');\n        }\n\n        return options;\n      }\n\n      if (this.requiresTrackingId(options)) {\n        options.headers.trackingid = \"\".concat(this.webex.sessionId, \"_\").concat(this.sequence);\n      }\n\n      if (options.headers.trackingid && options.replayCount) {\n        var tid = options.headers.trackingid.split('+');\n        tid[1] = options.replayCount;\n        options.headers.trackingid = tid.join('+');\n      }\n\n      return options;\n    }\n    /**\n     * Determines whether or not include a tracking id\n     * @param {Object} options\n     * @returns {boolean}\n     */\n\n  }, {\n    key: \"requiresTrackingId\",\n    value: function requiresTrackingId(options) {\n      return !options.headers.trackingid;\n    }\n  }], [{\n    key: \"create\",\n    value: function create() {\n      return new WebexTrackingIdInterceptor({\n        webex: this\n      });\n    }\n  }]);\n  return WebexTrackingIdInterceptor;\n}(_httpCore.Interceptor);\n\nexports.default = WebexTrackingIdInterceptor;","map":{"version":3,"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;AAIA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAEA,IAAMA,eAAe,GAAG,sBAAxB;AAEA;AACA;AACA;;IACqBC,0B;;;;;;;;;;;;;AACnB;AACF;AACA;AACA;AACE,mBAAe;AACb,UAAIC,EAAE,GAAGF,eAAe,CAACG,GAAhBH,CAAoB,IAApBA,KAA6B,CAAtC;AAEAE,QAAE,IAAI,CAANA;AACAF,qBAAe,CAACI,GAAhBJ,CAAoB,IAApBA,EAA0BE,EAA1BF;AAEA,aAAOE,EAAP;AACD;AAED;AACF;AACA;;;;;AAKE;AACF;AACA;AACA;AACA;AACE,uBAAUG,OAAV,EAAmB;AACjBA,aAAO,CAACC,OAARD,GAAkBA,OAAO,CAACC,OAARD,IAAmB,EAArCA,CADiB,CAEjB;;AACA,UAAI,gBAAgBA,OAAO,CAACC,OAA5B,EAAqC;AACnC;AACA;AACA,YAAI,CAACD,OAAO,CAACC,OAARD,CAAgBE,UAArB,EAAiC;AAC/B,uCAAuBF,OAAO,CAACC,OAA/B,EAAwC,YAAxC;AACD;;AAED,eAAOD,OAAP;AACD;;AAED,UAAI,KAAKG,kBAAL,CAAwBH,OAAxB,CAAJ,EAAsC;AACpCA,eAAO,CAACC,OAARD,CAAgBE,UAAhBF,aAAgC,KAAKI,KAAL,CAAWC,SAA3C,cAAwD,KAAKC,QAA7D;AACD;;AAED,UAAIN,OAAO,CAACC,OAARD,CAAgBE,UAAhBF,IAA8BA,OAAO,CAACO,WAA1C,EAAuD;AACrD,YAAMC,GAAG,GAAGR,OAAO,CAACC,OAARD,CAAgBE,UAAhBF,CAA2BS,KAA3BT,CAAiC,GAAjCA,CAAZ;AAEAQ,WAAG,CAAC,CAAD,CAAHA,GAASR,OAAO,CAACO,WAAjBC;AACAR,eAAO,CAACC,OAARD,CAAgBE,UAAhBF,GAA6BQ,GAAG,CAACE,IAAJF,CAAS,GAATA,CAA7BR;AACD;;AAED,aAAOA,OAAP;AACD;AAED;AACF;AACA;AACA;AACA;;;;WACE,4BAAmBA,OAAnB,EAA4B;AAC1B,aAAO,CAACA,OAAO,CAACC,OAARD,CAAgBE,UAAxB;AACD;;;WA3CD,kBAAgB;AACd,aAAO,IAAIN,0BAAJ,CAA+B;AAACQ,aAAK,EAAE;AAAR,OAA/B,CAAP;AACD;;;EAnBqDO,qB","names":["sequenceNumbers","WebexTrackingIdInterceptor","sq","get","set","options","headers","trackingid","requiresTrackingId","webex","sessionId","sequence","replayCount","tid","split","join","Interceptor"],"sources":["webex-tracking-id.js"],"sourcesContent":["/*!\n * Copyright (c) 2015-2020 Cisco Systems, Inc. See LICENSE file.\n */\n\nimport {Interceptor} from '@webex/http-core';\n\nconst sequenceNumbers = new WeakMap();\n\n/**\n * @class\n */\nexport default class WebexTrackingIdInterceptor extends Interceptor {\n  /**\n   * Sequence number; increments on access\n   * @type {Number}\n   */\n  get sequence() {\n    let sq = sequenceNumbers.get(this) || 0;\n\n    sq += 1;\n    sequenceNumbers.set(this, sq);\n\n    return sq;\n  }\n\n  /**\n   * @returns {WebexTrackingIdInterceptor}\n   */\n  static create() {\n    return new WebexTrackingIdInterceptor({webex: this});\n  }\n\n  /**\n   * @see Interceptor#onRequest\n   * @param {Object} options\n   * @returns {Object}\n   */\n  onRequest(options) {\n    options.headers = options.headers || {};\n    // If trackingid is already set, don't overwrite it\n    if ('trackingid' in options.headers) {\n      // If trackingid is set to null, false, or undefined, delete it to\n      // prevent a CORS preflight.\n      if (!options.headers.trackingid) {\n        Reflect.deleteProperty(options.headers, 'trackingid');\n      }\n\n      return options;\n    }\n\n    if (this.requiresTrackingId(options)) {\n      options.headers.trackingid = `${this.webex.sessionId}_${this.sequence}`;\n    }\n\n    if (options.headers.trackingid && options.replayCount) {\n      const tid = options.headers.trackingid.split('+');\n\n      tid[1] = options.replayCount;\n      options.headers.trackingid = tid.join('+');\n    }\n\n    return options;\n  }\n\n  /**\n   * Determines whether or not include a tracking id\n   * @param {Object} options\n   * @returns {boolean}\n   */\n  requiresTrackingId(options) {\n    return !options.headers.trackingid;\n  }\n}\n"]},"metadata":{},"sourceType":"script"}