{"ast":null,"code":"\"use strict\";\n\nvar _Array$from = require(\"@babel/runtime-corejs2/core-js/array/from\");\n\nvar _Symbol = require(\"@babel/runtime-corejs2/core-js/symbol\");\n\nvar _Symbol$iterator = require(\"@babel/runtime-corejs2/core-js/symbol/iterator\");\n\nvar _Array$isArray = require(\"@babel/runtime-corejs2/core-js/array/is-array\");\n\nvar _Object$defineProperty = require(\"@babel/runtime-corejs2/core-js/object/define-property\");\n\nvar _interopRequireDefault = require(\"@babel/runtime-corejs2/helpers/interopRequireDefault\");\n\n_Object$defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nexports.default = _request;\n\nvar _regenerator = _interopRequireDefault(require(\"@babel/runtime-corejs2/regenerator\"));\n\nvar _promise = _interopRequireDefault(require(\"@babel/runtime-corejs2/core-js/promise\"));\n\nvar _keys = _interopRequireDefault(require(\"@babel/runtime-corejs2/core-js/object/keys\"));\n\nvar _deleteProperty = _interopRequireDefault(require(\"@babel/runtime-corejs2/core-js/reflect/delete-property\"));\n\nvar _typeof2 = _interopRequireDefault(require(\"@babel/runtime-corejs2/helpers/typeof\"));\n\nvar _asyncToGenerator2 = _interopRequireDefault(require(\"@babel/runtime-corejs2/helpers/asyncToGenerator\"));\n\nvar _pick2 = _interopRequireDefault(require(\"lodash/pick\"));\n\nvar _isArray2 = _interopRequireDefault(require(\"lodash/isArray\"));\n\nvar _defaults2 = _interopRequireDefault(require(\"lodash/defaults\"));\n\nvar _qs = _interopRequireDefault(require(\"qs\"));\n\nvar _xhr = _interopRequireDefault(require(\"../lib/xhr\"));\n\nvar _detect = _interopRequireDefault(require(\"../lib/detect\"));\n\nfunction _createForOfIteratorHelper(o, allowArrayLike) {\n  var it = typeof _Symbol !== \"undefined\" && o[_Symbol$iterator] || o[\"@@iterator\"];\n\n  if (!it) {\n    if (_Array$isArray(o) || (it = _unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === \"number\") {\n      if (it) o = it;\n      var i = 0;\n\n      var F = function F() {};\n\n      return {\n        s: F,\n        n: function n() {\n          if (i >= o.length) return {\n            done: true\n          };\n          return {\n            done: false,\n            value: o[i++]\n          };\n        },\n        e: function e(_e) {\n          throw _e;\n        },\n        f: F\n      };\n    }\n\n    throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n  }\n\n  var normalCompletion = true,\n      didErr = false,\n      err;\n  return {\n    s: function s() {\n      it = it.call(o);\n    },\n    n: function n() {\n      var step = it.next();\n      normalCompletion = step.done;\n      return step;\n    },\n    e: function e(_e2) {\n      didErr = true;\n      err = _e2;\n    },\n    f: function f() {\n      try {\n        if (!normalCompletion && it.return != null) it.return();\n      } finally {\n        if (didErr) throw err;\n      }\n    }\n  };\n}\n\nfunction _unsupportedIterableToArray(o, minLen) {\n  if (!o) return;\n  if (typeof o === \"string\") return _arrayLikeToArray(o, minLen);\n  var n = Object.prototype.toString.call(o).slice(8, -1);\n  if (n === \"Object\" && o.constructor) n = o.constructor.name;\n  if (n === \"Map\" || n === \"Set\") return _Array$from(o);\n  if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen);\n}\n\nfunction _arrayLikeToArray(arr, len) {\n  if (len == null || len > arr.length) len = arr.length;\n\n  for (var i = 0, arr2 = new Array(len); i < len; i++) {\n    arr2[i] = arr[i];\n  }\n\n  return arr2;\n}\n/**\n * @name request\n * @param {Object} options\n * @returns {Promise}\n */\n\n\nfunction _request(options) {\n  return new _promise.default(function (resolve) {\n    var params = (0, _pick2.default)(options, 'method', 'uri', 'withCredentials', 'headers', 'timeout', 'responseType'); // Set `response` to `true` to approximate an `HttpResponse` object\n\n    params.response = true;\n    setXhr(params);\n    bindProgressEvents(params, options);\n    setAuth(params, options);\n    setCookies(params, options);\n    setDefaults(params, options);\n    setResponseType(params, options);\n    setContentType(params, options);\n    setPayload(params, options);\n    setQs(params, options);\n    options.logger.debug(\"start http \".concat(options.method ? options.method : 'request', \" to \").concat(options.uri));\n    var x = (0, _xhr.default)(params, function (error, response) {\n      /* istanbul ignore next */\n      if (error) {\n        options.logger.warn(error);\n      }\n      /* istanbul ignore else */\n\n\n      if (response) {\n        if (response.statusCode >= 400) {\n          options.logger.warn(\"http \".concat(options.method ? options.method : 'request', \" to \").concat(options.uri, \" result: \").concat(response.statusCode));\n        } else {\n          options.logger.debug(\"http \".concat(options.method ? options.method : 'request', \" to \").concat(options.uri, \" result: \").concat(response.statusCode));\n        }\n\n        response.options = options;\n        processResponseJson(response, params);\n        resolve(response);\n      } else {\n        resolve({\n          statusCode: 0,\n          options: options,\n          headers: options.headers,\n          method: options.method,\n          url: options.uri,\n          body: error\n        });\n      }\n    });\n    x.onprogress = options.download.emit.bind(options.download, 'progress');\n  }).catch(function (error) {\n    options.logger.warn(error);\n    /* eslint arrow-body-style: [0] */\n\n    /* istanbul ignore next */\n\n    return {\n      statusCode: 0,\n      options: options,\n      headers: options.headers,\n      method: options.method,\n      url: options.uri,\n      body: error\n    };\n  });\n  /**\n   * @param {Object} params\n   * @param {Object} o\n   * @private\n   * @returns {undefined}\n   */\n\n  function bindProgressEvents(params, o) {\n    if (params.method && ['PATCH', 'POST', 'PUT'].includes(params.method.toUpperCase())) {\n      if (!params.xhr) {\n        params.xhr = new XMLHttpRequest();\n      }\n\n      params.xhr.upload.onprogress = o.upload.emit.bind(o.upload, 'progress');\n    }\n  }\n  /**\n   * @param {Object} params\n   * @param {Object} o\n   * @private\n   * @returns {undefined}\n   */\n\n\n  function setXhr(params) {\n    params.xhr = new XMLHttpRequest();\n  }\n  /**\n   * @param {Object} params\n   * @param {Object} o\n   * @private\n   * @returns {undefined}\n   */\n\n\n  function setAuth(params, o) {\n    if (o.auth) {\n      if (o.auth.bearer) {\n        params.headers.authorization = \"Bearer \".concat(o.auth.bearer);\n      } else {\n        var user = o.auth.user || o.auth.username;\n        var pass = o.auth.pass || o.auth.password;\n        var token = btoa(\"\".concat(user, \":\").concat(pass));\n        params.headers.authorization = \"Basic \".concat(token);\n      }\n    }\n  }\n  /**\n   * @param {Object} params\n   * @param {Object} o\n   * @private\n   * @returns {undefined}\n   */\n\n\n  function setCookies(params, o) {\n    if (o.jar) {\n      params.withCredentials = true;\n    }\n  }\n  /**\n   * @param {Object} params\n   * @param {Object} o\n   * @private\n   * @returns {undefined}\n   */\n\n\n  function setDefaults(params, o) {\n    var defs = {\n      cors: true,\n      // raynos/xhr defaults withCredentials to true if cors is true, so we need\n      // to make it explicitly false by default\n      withCredentials: false,\n      timeout: 0\n    };\n    (0, _defaults2.default)(params, (0, _pick2.default)(o, (0, _keys.default)(defs)), defs);\n  }\n  /**\n   * @param {Object} params\n   * @param {Object} o\n   * @private\n   * @returns {undefined}\n   */\n\n\n  function setResponseType(params, o) {\n    if (o.responseType === 'buffer') {\n      params.responseType = 'arraybuffer';\n    }\n  }\n  /**\n   * @param {Object} params\n   * @param {Object} o\n   * @private\n   * @returns {undefined}\n   */\n\n\n  function setContentType(_x, _x2) {\n    return _setContentType.apply(this, arguments);\n  }\n  /**\n   * @param {Object} params\n   * @param {Object} o\n   * @private\n   * @returns {undefined}\n   */\n\n\n  function _setContentType() {\n    _setContentType = (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee(params, o) {\n      return _regenerator.default.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              if (!(o.body instanceof Blob || o.body instanceof ArrayBuffer)) {\n                _context.next = 8;\n                break;\n              }\n\n              o.json = params.json = false;\n              _context.t0 = params.headers['content-type'];\n\n              if (_context.t0) {\n                _context.next = 7;\n                break;\n              }\n\n              _context.next = 6;\n              return (0, _detect.default)(o.body);\n\n            case 6:\n              _context.t0 = _context.sent;\n\n            case 7:\n              params.headers['content-type'] = _context.t0;\n\n            case 8:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n    return _setContentType.apply(this, arguments);\n  }\n\n  function setQs(params, o) {\n    if (o.qs) {\n      params.uri += \"?\".concat(_qs.default.stringify(o.qs));\n    }\n  }\n  /**\n   * Converts arraybuffers to blobs before uploading them\n   * @param {mixed} file\n   * @private\n   * @returns {mixed}\n   */\n\n\n  function ensureBlob(file) {\n    if (file instanceof ArrayBuffer) {\n      var ret = file.type ? new Blob([file], {\n        type: file.type\n      }) : new Blob([file]);\n      ret.filename = file.filename || file.name || 'untitled';\n      return ret;\n    }\n\n    return file;\n  }\n  /**\n   * Appends an item to a form\n   * @param {FormData} form\n   * @param {string} key\n   * @param {mixed} value\n   * @returns {undefined}\n   */\n\n\n  function append(form, key, value) {\n    if ((0, _isArray2.default)(value)) {\n      var _iterator = _createForOfIteratorHelper(value),\n          _step;\n\n      try {\n        for (_iterator.s(); !(_step = _iterator.n()).done;) {\n          var v = _step.value;\n          append(form, key, v);\n        }\n      } catch (err) {\n        _iterator.e(err);\n      } finally {\n        _iterator.f();\n      }\n\n      return;\n    }\n\n    value = ensureBlob(value);\n\n    if (value.name) {\n      value.filename = value.name;\n      form.append(key, value, value.name);\n    } else {\n      form.append(key, value);\n    }\n  }\n  /**\n   * @param {Object} params\n   * @param {Object} o\n   * @private\n   * @returns {undefined}\n   */\n\n\n  function setPayload(params, o) {\n    if ((!('json' in o) || o.json === true) && o.body) {\n      params.json = o.body;\n    } else if (o.form) {\n      params.headers['Content-Type'] = 'application/x-www-form-urlencoded';\n      params.body = _qs.default.stringify(o.form);\n      (0, _deleteProperty.default)(params, 'json');\n    } else if (o.formData) {\n      params.body = (0, _keys.default)(o.formData).reduce(function (fd, key) {\n        var value = o.formData[key];\n        append(fd, key, value);\n        return fd;\n      }, new FormData());\n    } else {\n      params.body = o.body;\n      (0, _deleteProperty.default)(params, 'json');\n    }\n  }\n  /**\n   * @param {Object} response\n   * @param {Object} params\n   * @private\n   * @returns {undefined}\n   */\n\n\n  function processResponseJson(response, params) {\n    // If params.json is not defined, xhr won't deserialize the response\n    // so we should give it a shot just in case.\n    if (!params.json && (0, _typeof2.default)(response.body) !== 'object') {\n      try {\n        response.body = JSON.parse(response.body);\n      } catch (e) {\n        /* eslint no-empty: [0] */\n      }\n    }\n  }\n}","map":{"version":3,"mappings":"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","names":["_request","options","resolve","params","response","setXhr","bindProgressEvents","setAuth","setCookies","setDefaults","setResponseType","setContentType","setPayload","setQs","logger","debug","method","uri","x","error","warn","statusCode","processResponseJson","headers","url","body","onprogress","download","emit","bind","catch","o","includes","toUpperCase","xhr","XMLHttpRequest","upload","auth","bearer","authorization","user","username","pass","password","token","btoa","jar","withCredentials","defs","cors","timeout","responseType","_setContentType","Blob","ArrayBuffer","_context","json","qs","stringify","ensureBlob","file","ret","type","filename","name","append","form","key","value","v","_iterator","formData","reduce","fd","FormData","JSON","parse","e"],"sources":["request.shim.js"],"sourcesContent":["/* eslint-disable no-underscore-dangle */\n/*!\n * Copyright (c) 2015-2020 Cisco Systems, Inc. See LICENSE file.\n */\n\n/* eslint-env browser */\n\n// Note: several code paths are ignored in this file. As far as I can tell, any\n// error conditions that would provoke those paths are otherwise prevented and\n// reported.\n\nimport {defaults, isArray, pick} from 'lodash';\nimport qs from 'qs';\n\nimport xhr from '../lib/xhr';\nimport detect from '../lib/detect';\n\n/**\n * @name request\n * @param {Object} options\n * @returns {Promise}\n */\nexport default function _request(options) {\n  return new Promise((resolve) => {\n    const params = pick(options, 'method', 'uri', 'withCredentials', 'headers', 'timeout', 'responseType');\n\n    // Set `response` to `true` to approximate an `HttpResponse` object\n    params.response = true;\n\n    setXhr(params);\n    bindProgressEvents(params, options);\n    setAuth(params, options);\n    setCookies(params, options);\n    setDefaults(params, options);\n    setResponseType(params, options);\n    setContentType(params, options);\n    setPayload(params, options);\n    setQs(params, options);\n\n    options.logger.debug(`start http ${options.method ? options.method : 'request'} to ${options.uri}`);\n\n    const x = xhr(params, (error, response) => {\n      /* istanbul ignore next */\n      if (error) {\n        options.logger.warn(error);\n      }\n\n      /* istanbul ignore else */\n      if (response) {\n        if (response.statusCode >= 400) {\n          options.logger.warn(`http ${options.method ? options.method : 'request'} to ${options.uri} result: ${response.statusCode}`);\n        }\n        else {\n          options.logger.debug(`http ${options.method ? options.method : 'request'} to ${options.uri} result: ${response.statusCode}`);\n        }\n        response.options = options;\n        processResponseJson(response, params);\n        resolve(response);\n      }\n      else {\n        resolve({\n          statusCode: 0,\n          options,\n          headers: options.headers,\n          method: options.method,\n          url: options.uri,\n          body: error\n        });\n      }\n    });\n\n    x.onprogress = options.download.emit.bind(options.download, 'progress');\n  })\n    .catch((error) => {\n      options.logger.warn(error);\n\n      /* eslint arrow-body-style: [0] */\n      /* istanbul ignore next */\n      return {\n        statusCode: 0,\n        options,\n        headers: options.headers,\n        method: options.method,\n        url: options.uri,\n        body: error\n      };\n    });\n\n  /**\n   * @param {Object} params\n   * @param {Object} o\n   * @private\n   * @returns {undefined}\n   */\n  function bindProgressEvents(params, o) {\n    if (params.method && ['PATCH', 'POST', 'PUT'].includes(params.method.toUpperCase())) {\n      if (!params.xhr) {\n        params.xhr = new XMLHttpRequest();\n      }\n      params.xhr.upload.onprogress = o.upload.emit.bind(o.upload, 'progress');\n    }\n  }\n\n  /**\n   * @param {Object} params\n   * @param {Object} o\n   * @private\n   * @returns {undefined}\n   */\n  function setXhr(params) {\n    params.xhr = new XMLHttpRequest();\n  }\n\n  /**\n   * @param {Object} params\n   * @param {Object} o\n   * @private\n   * @returns {undefined}\n   */\n  function setAuth(params, o) {\n    if (o.auth) {\n      if (o.auth.bearer) {\n        params.headers.authorization = `Bearer ${o.auth.bearer}`;\n      }\n      else {\n        const user = o.auth.user || o.auth.username;\n        const pass = o.auth.pass || o.auth.password;\n\n        const token = btoa(`${user}:${pass}`);\n\n        params.headers.authorization = `Basic ${token}`;\n      }\n    }\n  }\n\n  /**\n   * @param {Object} params\n   * @param {Object} o\n   * @private\n   * @returns {undefined}\n   */\n  function setCookies(params, o) {\n    if (o.jar) {\n      params.withCredentials = true;\n    }\n  }\n\n  /**\n   * @param {Object} params\n   * @param {Object} o\n   * @private\n   * @returns {undefined}\n   */\n  function setDefaults(params, o) {\n    const defs = {\n      cors: true,\n      // raynos/xhr defaults withCredentials to true if cors is true, so we need\n      // to make it explicitly false by default\n      withCredentials: false,\n      timeout: 0\n    };\n\n    defaults(params, pick(o, Object.keys(defs)), defs);\n  }\n\n  /**\n   * @param {Object} params\n   * @param {Object} o\n   * @private\n   * @returns {undefined}\n   */\n  function setResponseType(params, o) {\n    if (o.responseType === 'buffer') {\n      params.responseType = 'arraybuffer';\n    }\n  }\n\n  /**\n   * @param {Object} params\n   * @param {Object} o\n   * @private\n   * @returns {undefined}\n   */\n  async function setContentType(params, o) {\n    if (o.body instanceof Blob || o.body instanceof ArrayBuffer) {\n      o.json = params.json = false;\n      params.headers['content-type'] = params.headers['content-type'] || await detect(o.body);\n    }\n  }\n\n  /**\n   * @param {Object} params\n   * @param {Object} o\n   * @private\n   * @returns {undefined}\n   */\n  function setQs(params, o) {\n    if (o.qs) {\n      params.uri += `?${qs.stringify(o.qs)}`;\n    }\n  }\n\n  /**\n   * Converts arraybuffers to blobs before uploading them\n   * @param {mixed} file\n   * @private\n   * @returns {mixed}\n   */\n  function ensureBlob(file) {\n    if (file instanceof ArrayBuffer) {\n      const ret = file.type ? new Blob([file], {type: file.type}) : new Blob([file]);\n\n      ret.filename = file.filename || file.name || 'untitled';\n\n      return ret;\n    }\n\n    return file;\n  }\n\n  /**\n   * Appends an item to a form\n   * @param {FormData} form\n   * @param {string} key\n   * @param {mixed} value\n   * @returns {undefined}\n   */\n  function append(form, key, value) {\n    if (isArray(value)) {\n      for (const v of value) {\n        append(form, key, v);\n      }\n\n      return;\n    }\n\n    value = ensureBlob(value);\n    if (value.name) {\n      value.filename = value.name;\n      form.append(key, value, value.name);\n    }\n    else {\n      form.append(key, value);\n    }\n  }\n\n  /**\n   * @param {Object} params\n   * @param {Object} o\n   * @private\n   * @returns {undefined}\n   */\n  function setPayload(params, o) {\n    if ((!('json' in o) || o.json === true) && o.body) {\n      params.json = o.body;\n    }\n    else if (o.form) {\n      params.headers['Content-Type'] = 'application/x-www-form-urlencoded';\n      params.body = qs.stringify(o.form);\n      Reflect.deleteProperty(params, 'json');\n    }\n    else if (o.formData) {\n      params.body = Object.keys(o.formData).reduce((fd, key) => {\n        const value = o.formData[key];\n\n        append(fd, key, value);\n\n        return fd;\n      }, new FormData());\n    }\n    else {\n      params.body = o.body;\n      Reflect.deleteProperty(params, 'json');\n    }\n  }\n\n  /**\n   * @param {Object} response\n   * @param {Object} params\n   * @private\n   * @returns {undefined}\n   */\n  function processResponseJson(response, params) {\n    // If params.json is not defined, xhr won't deserialize the response\n    // so we should give it a shot just in case.\n    if (!params.json && typeof response.body !== 'object') {\n      try {\n        response.body = JSON.parse(response.body);\n      }\n      catch (e) {\n        /* eslint no-empty: [0] */\n      }\n    }\n  }\n}\n"]},"metadata":{},"sourceType":"script"}