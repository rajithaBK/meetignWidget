{"ast":null,"code":"\"use strict\";\n\nvar _Object$defineProperty = require(\"@babel/runtime-corejs2/core-js/object/define-property\");\n\nvar _interopRequireDefault = require(\"@babel/runtime-corejs2/helpers/interopRequireDefault\");\n\n_Object$defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nexports.default = void 0;\n\nvar _keys = _interopRequireDefault(require(\"@babel/runtime-corejs2/core-js/object/keys\"));\n\nvar _apply = _interopRequireDefault(require(\"@babel/runtime-corejs2/core-js/reflect/apply\"));\n\nvar _promise = _interopRequireDefault(require(\"@babel/runtime-corejs2/core-js/promise\"));\n\nvar _omit2 = _interopRequireDefault(require(\"lodash/omit\"));\n\nvar _isObject2 = _interopRequireDefault(require(\"lodash/isObject\"));\n\nvar _cloneDeep2 = _interopRequireDefault(require(\"lodash/cloneDeep\"));\n\nvar _util = _interopRequireDefault(require(\"util\"));\n\nvar _ampersandState = _interopRequireDefault(require(\"ampersand-state\"));\n\nvar _storage = require(\"./storage\");\n/*!\n * Copyright (c) 2015-2020 Cisco Systems, Inc. See LICENSE file.\n */\n\n/**\n * @class\n */\n\n\nvar WebexPlugin = _ampersandState.default.extend({\n  derived: {\n    boundedStorage: {\n      deps: [],\n      fn: function fn() {\n        return (0, _storage.makeWebexPluginStore)('bounded', this);\n      }\n    },\n    unboundedStorage: {\n      deps: [],\n      fn: function fn() {\n        return (0, _storage.makeWebexPluginStore)('unbounded', this);\n      }\n    },\n    config: {\n      // figure out why caching config breaks the refresh integration test\n      // but not the refresh automation test.\n      cache: false,\n      deps: ['webex', 'webex.config'],\n      fn: function fn() {\n        if (this.webex && this.webex.config) {\n          var namespace = this.getNamespace();\n\n          if (namespace) {\n            return this.webex.config[namespace.toLowerCase()];\n          }\n\n          return this.webex.config;\n        }\n\n        return {};\n      }\n    },\n    logger: {\n      deps: ['webex', 'webex.logger'],\n      fn: function fn() {\n        return this.webex.logger || console;\n      }\n    },\n    webex: {\n      deps: ['parent'],\n      fn: function fn() {\n        if (!this.parent && !this.collection) {\n          throw new Error('Cannot determine `this.webex` without `this.parent` or `this.collection`. Please initialize `this` via `children` or `collection` or set `this.parent` manually');\n        }\n        /* eslint consistent-this: [0] */\n\n\n        var parent = this;\n\n        while (parent.parent || parent.collection) {\n          parent = parent.parent || parent.collection;\n        }\n\n        return parent;\n      }\n    }\n  },\n  session: {\n    parent: {\n      type: 'any'\n    },\n\n    /**\n     * Indicates this plugin is ready to be used. Defaults to true but can be\n     * overridden by plugins as appropriate. Used by {@link WebexCore#read}\n     * @instance\n     * @memberof WebexPlugin\n     * @type {boolean}\n     */\n    ready: {\n      default: true,\n      type: 'boolean'\n    }\n  },\n\n  /**\n   * Overrides AmpersandState#clear to make sure we never unset `parent` and\n   * recursively visits children/collections.\n   * @instance\n   * @memberof WebexPlugin\n   * @param {Object} options\n   * @returns {WebexPlugin}\n   */\n  clear: function clear(options) {\n    var _this = this;\n\n    (0, _keys.default)(this.attributes).forEach(function (key) {\n      if (key !== 'parent') {\n        _this.unset(key, options);\n      }\n    });\n    (0, _keys.default)(this._children).forEach(function (key) {\n      _this[key].clear();\n    });\n    (0, _keys.default)(this._collections).forEach(function (key) {\n      _this[key].reset();\n    });\n    return this;\n  },\n\n  /**\n   * Initializer\n   * @private\n   * @param {Object} attrs\n   * @param {Object} options\n   * @returns {undefined}\n   */\n  initialize: function initialize() {\n    var _this2 = this;\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    (0, _apply.default)(_ampersandState.default.prototype.initialize, this, args); // HACK to deal with the fact that AmpersandState#dataTypes#set is a pure\n    // function.\n\n    this._dataTypes = (0, _cloneDeep2.default)(this._dataTypes);\n    (0, _keys.default)(this._dataTypes).forEach(function (key) {\n      if (_this2._dataTypes[key].set) {\n        _this2._dataTypes[key].set = _this2._dataTypes[key].set.bind(_this2);\n      }\n    }); // END HACK\n    // Propagate change:[attribute] events from children\n\n    this.on('change', function (model, options) {\n      if (_this2.parent) {\n        _this2.parent.trigger(\"change:\".concat(_this2.getNamespace().toLowerCase()), _this2.parent, _this2, options);\n      }\n    });\n  },\n\n  /**\n   * @instance\n   * @memberof WebexPlugin\n   * @param {number} depth\n   * @private\n   * @returns {Object}\n   */\n  inspect: function inspect(depth) {\n    return _util.default.inspect((0, _omit2.default)(this.serialize({\n      props: true,\n      session: true,\n      derived: true\n    }), 'boundedStorage', 'unboundedStorage', 'config', 'logger', 'webex', 'parent'), {\n      depth: depth\n    });\n  },\n  request: function request() {\n    var _this$webex;\n\n    return (_this$webex = this.webex).request.apply(_this$webex, arguments);\n  },\n  upload: function upload() {\n    var _this$webex2;\n\n    return (_this$webex2 = this.webex).upload.apply(_this$webex2, arguments);\n  },\n  when: function when(eventName) {\n    var _this3 = this;\n\n    for (var _len2 = arguments.length, rest = new Array(_len2 > 1 ? _len2 - 1 : 0), _key2 = 1; _key2 < _len2; _key2++) {\n      rest[_key2 - 1] = arguments[_key2];\n    }\n\n    if (rest && rest.length > 0) {\n      throw new Error('#when() does not accept a callback, you must attach to its promise');\n    }\n\n    return new _promise.default(function (resolve) {\n      _this3.once(eventName, function () {\n        for (var _len3 = arguments.length, args = new Array(_len3), _key3 = 0; _key3 < _len3; _key3++) {\n          args[_key3] = arguments[_key3];\n        }\n\n        return resolve(args);\n      });\n    });\n  },\n\n  /**\n   * Helper function for dealing with both forms of {@link AmpersandState#set()}\n   * @param {string} key\n   * @param {mixed} value\n   * @param {Object} options\n   * @private\n   * @returns {Array<Object, Object>}\n   */\n  _filterSetParameters: function _filterSetParameters(key, value, options) {\n    var attrs;\n\n    if ((0, _isObject2.default)(key) || key === null) {\n      attrs = key;\n      options = value;\n    } else {\n      attrs = {};\n      attrs[key] = value;\n    }\n\n    options = options || {};\n    return [attrs, options];\n  }\n});\n\nvar _default = WebexPlugin;\nexports.default = _default;","map":{"version":3,"mappings":"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","names":["WebexPlugin","AmpState","extend","derived","boundedStorage","deps","fn","unboundedStorage","config","cache","webex","namespace","getNamespace","toLowerCase","logger","console","parent","collection","Error","session","type","ready","default","clear","options","attributes","forEach","key","_this","unset","_children","_collections","reset","initialize","args","arguments","prototype","_dataTypes","_this2","set","bind","on","model","trigger","inspect","depth","util","serialize","props","request","upload","when","eventName","rest","length","resolve","_this3","once","_filterSetParameters","value","attrs"],"sources":["webex-plugin.js"],"sourcesContent":["/*!\n * Copyright (c) 2015-2020 Cisco Systems, Inc. See LICENSE file.\n */\n\nimport util from 'util';\n\nimport AmpState from 'ampersand-state';\nimport {\n  cloneDeep,\n  isObject,\n  omit\n} from 'lodash';\n\nimport {makeWebexPluginStore} from './storage';\n\n/**\n * @class\n */\nconst WebexPlugin = AmpState.extend({\n  derived: {\n    boundedStorage: {\n      deps: [],\n      fn() {\n        return makeWebexPluginStore('bounded', this);\n      }\n    },\n    unboundedStorage: {\n      deps: [],\n      fn() {\n        return makeWebexPluginStore('unbounded', this);\n      }\n    },\n    config: {\n    // figure out why caching config breaks the refresh integration test\n    // but not the refresh automation test.\n      cache: false,\n      deps: [\n        'webex',\n        'webex.config'\n      ],\n      fn() {\n        if (this.webex && this.webex.config) {\n          const namespace = this.getNamespace();\n\n          if (namespace) {\n            return this.webex.config[namespace.toLowerCase()];\n          }\n\n          return this.webex.config;\n        }\n\n        return {};\n      }\n    },\n\n    logger: {\n      deps: [\n        'webex',\n        'webex.logger'\n      ],\n      fn() {\n        return this.webex.logger || console;\n      }\n    },\n\n    webex: {\n      deps: ['parent'],\n      fn() {\n        if (!this.parent && !this.collection) {\n          throw new Error('Cannot determine `this.webex` without `this.parent` or `this.collection`. Please initialize `this` via `children` or `collection` or set `this.parent` manually');\n        }\n\n        /* eslint consistent-this: [0] */\n        let parent = this;\n\n        while (parent.parent || parent.collection) {\n          parent = parent.parent || parent.collection;\n        }\n\n        return parent;\n      }\n    }\n  },\n\n  session: {\n    parent: {\n      type: 'any'\n    },\n    /**\n     * Indicates this plugin is ready to be used. Defaults to true but can be\n     * overridden by plugins as appropriate. Used by {@link WebexCore#read}\n     * @instance\n     * @memberof WebexPlugin\n     * @type {boolean}\n     */\n    ready: {\n      default: true,\n      type: 'boolean'\n    }\n  },\n\n  /**\n   * Overrides AmpersandState#clear to make sure we never unset `parent` and\n   * recursively visits children/collections.\n   * @instance\n   * @memberof WebexPlugin\n   * @param {Object} options\n   * @returns {WebexPlugin}\n   */\n  clear(options) {\n    Object.keys(this.attributes).forEach((key) => {\n      if (key !== 'parent') {\n        this.unset(key, options);\n      }\n    });\n\n    Object.keys(this._children).forEach((key) => {\n      this[key].clear();\n    });\n\n    Object.keys(this._collections).forEach((key) => {\n      this[key].reset();\n    });\n\n    return this;\n  },\n\n  /**\n   * Initializer\n   * @private\n   * @param {Object} attrs\n   * @param {Object} options\n   * @returns {undefined}\n   */\n  initialize(...args) {\n    Reflect.apply(AmpState.prototype.initialize, this, args);\n\n    // HACK to deal with the fact that AmpersandState#dataTypes#set is a pure\n    // function.\n    this._dataTypes = cloneDeep(this._dataTypes);\n    Object.keys(this._dataTypes).forEach((key) => {\n      if (this._dataTypes[key].set) {\n        this._dataTypes[key].set = this._dataTypes[key].set.bind(this);\n      }\n    });\n    // END HACK\n\n    // Propagate change:[attribute] events from children\n    this.on('change', (model, options) => {\n      if (this.parent) {\n        this.parent.trigger(`change:${this.getNamespace().toLowerCase()}`, this.parent, this, options);\n      }\n    });\n  },\n\n  /**\n   * @instance\n   * @memberof WebexPlugin\n   * @param {number} depth\n   * @private\n   * @returns {Object}\n   */\n  inspect(depth) {\n    return util.inspect(omit(this.serialize({\n      props: true,\n      session: true,\n      derived: true\n    }), 'boundedStorage', 'unboundedStorage', 'config', 'logger', 'webex', 'parent'), {depth});\n  },\n\n  request(...args) {\n    return this.webex.request(...args);\n  },\n\n  upload(...args) {\n    return this.webex.upload(...args);\n  },\n\n  when(eventName, ...rest) {\n    if (rest && rest.length > 0) {\n      throw new Error('#when() does not accept a callback, you must attach to its promise');\n    }\n\n    return new Promise((resolve) => {\n      this.once(eventName, (...args) => resolve(args));\n    });\n  },\n\n  /**\n   * Helper function for dealing with both forms of {@link AmpersandState#set()}\n   * @param {string} key\n   * @param {mixed} value\n   * @param {Object} options\n   * @private\n   * @returns {Array<Object, Object>}\n   */\n  _filterSetParameters(key, value, options) {\n    let attrs;\n\n    if (isObject(key) || key === null) {\n      attrs = key;\n      options = value;\n    }\n    else {\n      attrs = {};\n      attrs[key] = value;\n    }\n\n    options = options || {};\n\n    return [attrs, options];\n  }\n});\n\nexport default WebexPlugin;\n"]},"metadata":{},"sourceType":"script"}